{"meta":{"title":"èŒé¢å–µå–µä¾ çš„ä¸ªäººåšå®¢","subtitle":"","description":"èŒé¢å–µå–µä¾ çš„ä¸ªäººåšå®¢","author":"èŒé¢å–µå–µä¾ ","url":"https://lolico.me","root":"/"},"pages":[{"title":"Lolico's Blog | 404","date":"2022-03-06T10:28:21.343Z","updated":"2022-03-06T10:28:21.343Z","comments":true,"path":"404.html","permalink":"https://lolico.me/404.html","excerpt":"","text":"Lolico's Blog | 404*{margin:0;padding:0}body{background:#f2f2f2}canvas{display:block;margin:50px auto 200px;margin-left:300px;border:1px solid #333;box-shadow:0 0 16px 2px rgba(0,0,0,.8)}a,p{font-family:Helvetica,Arial,sans-serif;font-size:20px;color:#777;display:block;width:400px;margin:0 auto;text-align:center;text-decoration:none}.info{margin:50px auto;text-align:center;font-size:20px;color:#999}a{color:#37e}#info{position:absolute;z-index:55;width:400px;right:200px;top:200px}#tenth>button{letter-spacing:0}#tenth span{letter-spacing:0;display:inline-block;position:relative;width:8px;transition:all .5s ease-in-out}#tenth span:nth-of-type(4){width:5px}#tenth span:nth-of-type(6){width:1px}#tenth span:nth-of-type(8){width:4px}#tenth:hover span:nth-of-type(1){animation:h .5s}#tenth:hover span:nth-of-type(2){animation:o .5s}#tenth:hover span:nth-of-type(3){animation:v .5s}#tenth:hover span:nth-of-type(4){animation:e .5s}#tenth:hover span:nth-of-type(5){animation:r .5s}#tenth:hover span:nth-of-type(7){animation:t .5s}#tenth:hover span:nth-of-type(8){animation:e .5s}#tenth:hover span:nth-of-type(9){animation:n .5s}@keyframes h{0%{transform:translate(0,0)}50%{transform:translate(50px,5px)}75%{transform:translate(5px,5px)}80%{transform:translate(0,0)}100%{transform:translate(0,0)}}@keyframes o{0%{transform:translate(0,0)}25%{transform:translate(-4px,0)}50%{transform:translate(3px,4px)}80%{transform:translate(0,0)}100%{transform:translate(0,0)}}@keyframes v{0%{transform:translate(0,0)}20%{transform:rotate(360deg)}50%{transform:scale(2)}80%{transform:translate(0,0)}100%{transform:translate(0,0)}}@keyframes e{0%{transform:translate(0,0)}20%{transform:translate(-10px,-2px)}80%{transform:translate(0,0)}100%{transform:translate(0,0)}}@keyframes r{0%{transform:translate(0,0)}20%{transform:translate(0,10px)}80%{transform:translate(0,32px)}100%{transform:translate(0,0)}}@keyframes t{0%{transform:translate(0,0)}20%{transform:translate(0,-10px)}40%{transform:translate(0,0)}60%{transform:translate(0,-10px)}80%{transform:translate(0,0)}100%{transform:translate(0,0)}}@keyframes n{0%{transform:translate(0,0)}50%{transform:skewY(50deg)}80%{transform:translate(0,0)}100%{transform:translate(0,0)}}button{position:absolute;right:420px;top:500px;z-index:99;width:180px;height:60px;background:0 0;color:#000;font-weight:700;letter-spacing:1px;border:none;font-size:18px;outline:0;cursor:pointer}404æ²¡æ‰¾åˆ°é¡µé¢ï¼Œå€’æœ‰ä¸ªå°æ¸¸æˆå¯ä»¥ç©ä¸€ä¸‹å“ˆä½¿ç”¨ğŸ‘†ã€ğŸ‘‡ã€ğŸ‘ˆã€ğŸ‘‰é”®ç§»åŠ¨è¿” å› é¦– é¡µvar map={tile_size:16,keys:[{id:0,colour:\"#333\",solid:0},{id:1,colour:\"#888\",solid:0},{id:2,colour:\"#555\",solid:1,bounce:.35},{id:3,colour:\"rgba(121, 220, 242, 0.4)\",friction:{x:.9,y:.9},gravity:{x:0,y:.1},jump:1,fore:1},{id:4,colour:\"#777\",jump:1},{id:5,colour:\"#E373FA\",solid:1,bounce:1.1},{id:6,colour:\"#666\",solid:1,bounce:0},{id:7,colour:\"#73C6FA\",solid:0,script:\"change_colour\"},{id:8,colour:\"#FADF73\",solid:0,script:\"next_level\"},{id:9,colour:\"#C93232\",solid:0,script:\"death\"},{id:10,colour:\"#555\",solid:1},{id:11,colour:\"#0FF\",solid:0,script:\"unlock\"}],data:[[2,2,2,2,2,2,2,2,2,2,2,2,2],[2,1,1,1,1,1,1,1,1,1,1,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,6,6,6,6,6,2],[2,1,1,1,1,1,1,1,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,1,1,1,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,1,1,1,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,1,1,1,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,1,1,1,1,1,2,2,2],[2,1,1,1,1,1,1,1,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,7,1,1,1,1,1,1,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,4,2,2,2,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,4,2,1,1,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,4,2,1,2,2,2],[2,1,1,1,1,1,1,1,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,4,2,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,4,2,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,4,2,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,4,2,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,4,2,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,4,2,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,4,2,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,4,2,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,4,2,1,2],[2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,2,1,2],[2,1,1,1,1,1,1,1,1,1,2,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,4,2,1,2],[2,1,1,1,1,1,1,1,1,1,2,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,4,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2],[2,1,2,1,1,1,1,1,1,1,2,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,4,2,1,2,2,2,2,2,2,2,2,1,1,1,1,2],[2,1,2,2,1,1,1,1,1,1,2,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,4,2,1,2,2,2,2,2,2,2,2,1,1,1,1,2],[2,1,2,2,2,1,1,1,1,1,2,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,4,2,1,2,2,2,2,2,2,2,2,1,1,1,1,2],[2,1,2,2,2,2,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,2,1,2,2,2,2,2,2,2,2,8,1,1,1,2],[2,1,2,2,2,2,2,2,2,2,2,6,2,1,1,1,1,1,1,1,1,1,1,2,2,1,1,1,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,4,2],[2,1,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,2,2,2,9,9,9,2,10,10,10,10,10,10,1,1,1,1,1,1,1,11,2,2,2,2,4,2],[2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,10,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,2],[2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,2],[2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,2,2,2,2,2,2,2,2],[2,6,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,2,1,1,1,1,1,1,2],[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,1,1,1,1,1,1,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2],[2,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,6,6,6,2,2,2,2,2,2,6,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2],[2,1,1,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2],[2,1,1,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],[2,1,1,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2],[2,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,1,1,1,1,2,5,5,2,1,1,1,1,1,1,1,1,1,1,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,2],[2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,2],[2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,2],[2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,2],[2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,2],[2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2],[2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2],[2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5,5,5,1,1,1,1,1,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2],[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]],gravity:{x:0,y:.3},vel_limit:{x:2,y:16},movement_speed:{jump:6,left:.3,right:.3},player:{x:2,y:2,colour:\"#FF9900\"},scripts:{change_colour:'game.player.colour = \"#\"+(Math.random()*0xFFFFFF"},{"title":"About","date":"2022-03-06T10:28:21.347Z","updated":"2022-03-06T10:28:21.347Z","comments":false,"path":"about/index.html","permalink":"https://lolico.me/about/index.html","excerpt":"","text":"å…³äºæˆ‘ï¼ˆé›¾å•µå•µbirdyãƒ¾(â‰§â–½â‰¦*)oæ—¶é—´è½´@timeline{2020@item{3æœˆ3æ—¥åšå®¢è¿ç§»åˆ°Hexoï¼ŒGithubæ‰˜ç®¡}2019@item{10æœˆ1æ—¥å­¦ä¹ SpringBootï¼ŒSpringå…¨å®¶æ¡¶ç­‰Webåç«¯æŠ€æœ¯}@item{7æœˆ1æ—¥å­¦ä¹ SpringMVCæ¡†æ¶}@item{3æœˆ1æ—¥å­¦ä¹ å‰ç«¯åŸºç¡€ï¼ˆHTMLï¼ŒCSSï¼ŒJSï¼‰}2018@item{9æœˆæŠ˜è…¾æœåŠ¡å™¨ï¼Œæ­å»ºå„ç§å°ç«™ç‚¹}@item{8æœˆ6æ—¥åŸºäºtypechoæ­å»ºä¸ªäººåšå®¢}@item{8æœˆ4æ—¥è´­ä¹°äººç”Ÿä¸­çš„ç¬¬ä¸€å°æœåŠ¡å™¨ï¼ˆé˜¿é‡Œäº‘å­¦ç”ŸECSï¼‰}}"},{"title":"","date":"2022-03-06T10:28:21.347Z","updated":"2022-03-06T10:28:21.347Z","comments":false,"path":"categories/index.html","permalink":"https://lolico.me/categories/index.html","excerpt":"","text":""},{"title":"","date":"2022-03-06T10:28:21.347Z","updated":"2022-03-06T10:28:21.347Z","comments":false,"path":"tags/index.html","permalink":"https://lolico.me/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"Streamæ¶ˆæ¯é˜Ÿåˆ—åœ¨SpringBootä¸­çš„å®è·µä¸è¸©å‘","slug":"Using-stream-to-implement-message-queue-in-springboot","date":"2020-06-28T13:54:57.000Z","updated":"2022-03-06T10:28:21.347Z","comments":true,"path":"2020/06/28/Using-stream-to-implement-message-queue-in-springboot/","link":"","permalink":"https://lolico.me/2020/06/28/Using-stream-to-implement-message-queue-in-springboot/","excerpt":"","text":"å‰è¨€Redis5æ–°å¢äº†ä¸€ä¸ªStreamçš„æ•°æ®ç±»å‹ï¼Œè¿™ä¸ªç±»å‹ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—æ¥ä½¿ç”¨æ—¶å¼¥è¡¥äº†Listå’ŒPub/Subçš„ä¸è¶³å¹¶ä¸”æä¾›äº†æ›´å¼ºå¤§çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ackæœºåˆ¶ä»¥åŠæ¶ˆè´¹è€…ç»„ç­‰æ¦‚å¿µï¼Œåœ¨æœ‰è½»é‡æ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨éœ€æ±‚æ—¶ï¼Œä½¿ç”¨è¿™ä¸ªæ–°ç±»å‹é‚£æ˜¯å†å¥½ä¸è¿‡äº†ã€‚å¯¹äºè¿™ä¸ªç±»å‹ï¼Œåœ¨è¿™é‡Œå°±ä¸èµ˜è¿°äº†ï¼Œæƒ³äº†è§£çš„è¯å¯ä»¥çœ‹ä¸€ä¸‹è¿™ç¯‡æ–‡ç« ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°±å…·ä½“æ¥è®²ä¸€ä¸‹åœ¨SpringBootä¸­çš„å®è·µä¸è¸©å‘ã€‚æ³¨æ„ï¼ŒSpringBootç‰ˆæœ¬éœ€è¦å¤§äº2.2ï¼ˆå³spring-data-rediséœ€è¦å¤§äº2.2ï¼‰ã€‚æ–°APIå’Œç±»åœ¨å¼€å§‹æ­£æ–‡ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç®€å•äº†è§£ä¸€ä¸‹åœ¨2.2å¼•å…¥çš„å’ŒStreamæ“ä½œç›¸å…³çš„æ–¹æ³•å’Œç±»ã€‚æ¶ˆæ¯å’Œæ¶ˆæ¯IDçš„å¯¹è±¡æ¶ˆæ¯ï¼ˆæˆ–è€…ç§°ä¸ºè®°å½•ï¼‰å’Œæ¶ˆæ¯IDåœ¨Spring-Data-Redisä¸­ä½¿ç”¨Recordå’ŒRecordIdæ¥è¡¨ç¤ºã€‚ä¸€ä¸ªRecordåŒ…å«ä¸‰éƒ¨åˆ†å†…å®¹ï¼šstreamè¡¨ç¤ºè¿™ä¸ªæ¶ˆæ¯è¦å‘å¾€é‚£ä¸ªStreamï¼Œä¹Ÿå°±æ˜¯Streamçš„keyrecordIdè¡¨ç¤ºè¿™ä¸ªæ¶ˆæ¯çš„IDï¼Œä¸€èˆ¬RedisæœåŠ¡å™¨è‡ªåŠ¨ç”Ÿæˆï¼Œä¹Ÿå¯ä»¥æŒ‡å®švalueè¡¨ç¤ºæ¶ˆæ¯å†…å®¹SpringBootä¸ºæˆ‘ä»¬æä¾›äº†äº”ç§æ¶ˆæ¯ç±»å‹çš„æŠ½è±¡ï¼šMapRecordã€ObjectRecordã€ByteRecordã€ByteBufferRecordã€StringRecordï¼Œä»¥åŠä¸€ä¸ªæ¶ˆæ¯IDç±»å‹ï¼šRecordIdã€‚è¿™é‡Œå¦å¤–è¯´ä¸€ä¸‹ï¼šå…¶å®é™¤å¼€ObjectRecordï¼Œå…¶ä»–å‡ ä¸ªRecordéƒ½æ˜¯é€šè¿‡ç»§æ‰¿MapRecordæ‰©å±•è€Œæ¥çš„ã€‚StringRecordä¸­çš„æ¶ˆæ¯å†…å®¹ä¹Ÿå¹¶éä»…ä»…æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œæ˜¯ä¸€ä¸ªé”®å€¼éƒ½ä¸ºå­—ç¬¦ä¸²ç±»å‹çš„Mapï¼ˆByteRecordã€ByteBufferRecordåŒç†ï¼‰ã€‚è€ŒObjectRecordæœ€åä¹Ÿä¼šä½¿ç”¨HashMapperè½¬æ¢æˆMapRecordã€‚ä¸ºä»€ä¹ˆæœ€åéƒ½æ˜¯æ“ä½œMapç±»å‹ï¼Ÿè¿™æ˜¯å› ä¸ºStreamä¸­çš„å†…å®¹æ˜¯ä»¥å¤šä¸ªkey-valueè¿™ç§é”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬æ€æ ·å»åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯å¯¹è±¡å‘¢ï¼Ÿä¸€èˆ¬æ¥è¯´æˆ‘ä»¬ä½¿ç”¨å‰ä¸¤ä¸ªæ¶ˆæ¯ç±»å‹æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥Spring-Data-Rediså¾ˆè´´å¿ƒçš„åœ¨Recordè¿™ä¸ªé¡¶çº§æ¥å£ä¸­æä¾›äº†ä¸¤ä¸ªé™æ€æ–¹æ³•ç”¨äºç›´æ¥æ„é€ MapRecordå’ŒObjectRecordï¼š12345678static &lt;S, K, V&gt; MapRecord&lt;S, K, V&gt; of(Map&lt;K, V&gt; map) Assert.notNull(map, \"Map must not be null!\"); return StreamRecords.mapBacked(map);&#125;static &lt;S, V&gt; ObjectRecord&lt;S, V&gt; of(V value) &#123; Assert.notNull(value, \"Value must not be null!\"); return StreamRecords.objectBacked(value);&#125;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•å®é™…ä¸Šæ˜¯è°ƒç”¨äº†StreamRecordsä¸­æä¾›çš„é™æ€æ–¹æ³•æ¥åˆ›å»ºï¼ŒStreamRecordsè¿™ä¸ªç±»æä¾›äº†ä¸‹é¢è¿™äº›æ–¹æ³•ç”¨äºåˆ›å»ºäº”ç§Recordï¼š123456ByteRecord rawBytes(Map&lt;byte[], byte[]&gt; raw) ByteBufferRecord rawBuffer(Map&lt;ByteBuffer, ByteBuffer&gt; raw) StringRecord string(Map&lt;String, String&gt; raw)&lt;S, K, V&gt; MapRecord&lt;S, K, V&gt; mapBacked(Map&lt;K, V&gt; map)&lt;S, V&gt; ObjectRecord&lt;S, V&gt; objectBacked(V value)RecordBuilder&lt;?&gt; newRecord() // é€šè¿‡builderæ–¹å¼åˆ›å»ºå½“ç„¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨æŸä¸ªå…·ä½“çš„Recordç±»å‹çš„createé™æ€æ–¹æ³•æ¥åˆ›å»ºï¼Œä¸‹é¢æ˜¯å‡ ä¸ªç¤ºä¾‹ï¼š12345678910String streamKey = \"channel:stream:key1\";//stream keyMailInfo mailInfo = new MailInfo(\"554205726@qq.com\", \"sendmail\");//å®šä¹‰ä¸€ä¸ªObjectç±»å‹çš„æ¶ˆæ¯å†…å®¹Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;() &#123;&#123; put(\"receiver\", \"534619360@qq.com\");&#125;&#125;; //å®šä¹‰ä¸€ä¸ªMapç±»å‹çš„æ¶ˆæ¯å†…å®¹Record.of(mailInfo).withStreamKey(streamKey);Record.of(map).withStreamKey(streamKey).withId(RecordId.of(\"123\"));//æŒ‡å®šidStreamRecords.objectBacked(mailInfo).withStreamKey(streamKey);StreamRecords.mapBacked(map).withStreamKey(streamKey).withId(RecordId.autoGenerate());//æŒ‡å®šidObjectRecord.create(streamKey, mailInfo); //ä½¿ç”¨ObjectRecordçš„createé™æ€æ–¹æ³•åˆ›å»ºå¦‚æœæˆ‘ä»¬ä¸é€šè¿‡withIdæ–¹æ³•æ˜¾ç¤ºè°ƒç”¨å»æŒ‡å®šidï¼Œé‚£ä¹ˆé»˜è®¤çš„æƒ…å†µä¸‹å°±æ˜¯ä½¿ç”¨RecordId.autoGenerate()è‡ªåŠ¨ç”Ÿæˆã€‚è¿˜æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹å°±æ˜¯åœ¨ä½¿ç”¨StreamRecordsçš„æ–¹æ³•æ¥æ„å»ºRecordæ—¶ä¸€å®šè¦è®°ä½ç”¨withStreamKeyæ–¹æ³•æ¥æŒ‡å®šStream Keyã€‚ä¸ç®¡æ˜¯æ¶ˆæ¯æˆ–æ˜¯æ¶ˆæ¯IDï¼Œè¿™äº›ç±»åŸºæœ¬éƒ½æä¾›äº†æ‰å¹³åŒ–çš„apiæ¥æ„é€ ï¼Œä½¿ç”¨èµ·æ¥è¿˜æ˜¯å¾ˆç®€å•çš„ã€‚é‚£ä¹ˆåœ¨æ„é€ äº†ä¸€ä¸ªRecordåæ€ä¹ˆå°†å…¶æŒä¹…åŒ–åˆ°Redisçš„Streamç±»å‹ä¸­å‘¢ï¼Ÿå‘Streamæ·»åŠ æ¶ˆæ¯ï¼ˆRecord)ä½¿ç”¨RedisTemplateæ“ä½œStreamï¼š123456789101112131415String streamKey = \"channel:stream:key1\";//stream keyMailInfo mailInfo = new MailInfo(\"554205726@qq.com\", \"sendmail\");ObjectRecord&lt;String, MailInfo&gt; record = ObjectRecord.create(streamKey, mailInfo);RecordId id = record.getId(); //æ„é€ Recordæ—¶ä½¿ç”¨çš„RecordIdRecordId recordId = redisTemplate.opsForStream().add(record); //è¿”å›çš„RecordIdid.getTimestamp(); //nullid.getSequence(); //nullid.shouldBeAutoGenerated(); //truerecordId.getTimestamp(); //not nullrecordId.getSequence(); //not nullrecordId.shouldBeAutoGenerated(); //falseä½¿ç”¨addæ–¹æ³•æ¥æ·»åŠ è®°å½•ï¼Œè¯¥æ–¹æ³•æ‰§è¡ŒæˆåŠŸåè¿”å›æ·»åŠ çš„è®°å½•çš„idä¿¡æ¯ã€‚æ³¨æ„ä¸‹é¢çš„ç»“æœï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜éœ€è¦æ³¨æ„ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬æ„é€ Recordæ—¶ä½¿ç”¨çš„RecordIdå’Œæ·»åŠ è®°å½•è¿”å›çš„RecordIdä¸åŒï¼Ÿè¿™ä¸ªé—®é¢˜å¾ˆå¥½ç†è§£ï¼Œå› ä¸ºæ„é€ Recordæ—¶ä¸æŒ‡å®šidæ—¶è™½ç„¶æ˜¯è‡ªåŠ¨ç”Ÿæˆï¼Œä½†æ˜¯è¿™ä¸ªè‡ªåŠ¨ç”Ÿæˆå¹¶ä¸æ˜¯åœ¨æ„é€ æ—¶å°±è‡ªåŠ¨ç”Ÿæˆå¥½äº†çš„ï¼Œè€Œæ˜¯åœ¨æ‰§è¡ŒRediså‘½ä»¤æŒä¹…åŒ–æ—¶RedisæœåŠ¡å™¨æ¥è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œæ‰€ä»¥å‰è€…åœ¨è·å–æ—¶é—´æˆ³å’Œåºå·çš„æ—¶è¿”å›nullã€‚ä¸ºä»€ä¹ˆæ·»åŠ è®°å½•è¿”å›çš„RecordIdè°ƒç”¨shouldBeAutoGeneratedæ–¹æ³•è¿”å›falseå‘¢ï¼Œä¸æ˜¯è‡ªåŠ¨ç”Ÿæˆäº†å—ï¼Ÿå…¶å®ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œå› ä¸ºåœ¨æŒä¹…åŒ–ä¸€æ¡Streamçš„è®°å½•æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šidï¼Œä¹Ÿå¯ä»¥é€‰æ‹©è®©Redisæ¥è‡ªåŠ¨ç”Ÿæˆï¼Œé‚£ä¹ˆè¿™ä¹Ÿå°±å¯¼è‡´addæ–¹æ³•æ‰§è¡ŒæˆåŠŸè·å–åˆ°Redisè¿”å›çš„idä¿¡æ¯ååœ¨æ„é€ RecordIdæ—¶å¹¶ä¸çŸ¥é“è¿”å›çš„è¿™ä¸ªidæ˜¯æˆ‘ä»¬ä¹‹å‰æŒ‡å®šçš„è¿˜æ˜¯Redisè‡ªåŠ¨ç”Ÿæˆçš„ï¼Œæ‰€ä»¥è¯´å‰è€…è¿”å›trueï¼Œåè€…è¿”å›falseå¹¶ä¸éš¾ç†è§£ã€‚è¯´åˆ°è¿™é‡Œï¼Œå…¶å®ä½ å»çœ‹ä¸€ä¸‹Recordæ„é€ æ—¶é»˜è®¤è‡ªåŠ¨ç”Ÿæˆidæ˜¯å¦‚ä½•åšåˆ°çš„å°±å¾ˆå¥½ç†è§£äº†ã€‚åœ¨è¿™é‡Œç¨å¾®æä¸€ä¸‹ï¼šåœ¨æ„é€ Recordæ—¶é»˜è®¤ä½¿ç”¨RecordId.autoGenerate()ä½œä¸ºRecordIdï¼Œè€Œè¿™ä¸ªæ–¹æ³•è¿”å›äº†ä¸€ä¸ªåŒ¿åå¯¹è±¡ï¼Œè¿™ä¸ªåŒ¿åå¯¹è±¡é‡å†™äº†ä¸Šé¢é‚£ä¸‰ä¸ªæ–¹æ³•ï¼Œå‰ä¸¤ä¸ªæ–¹æ³•é‡å†™ç›´æ¥è¿”å›nullï¼Œåè€…ä¹Ÿå°±æ˜¯shouldBeAutoGeneratedæ–¹æ³•è¿”å›trueã€‚å®ç°æ¶ˆæ¯é˜Ÿåˆ—åœ¨åŸºæœ¬äº†è§£äº†SpringBoot2.2æ–°å¢çš„å‡ ä¸ªStreamæ“ä½œapiå’Œç›¸å…³ç±»ä¹‹åï¼Œä¹Ÿå°±åˆ°äº†æˆ‘ä»¬Streamå®ç°æ¶ˆæ¯é˜Ÿåˆ—çš„å®è·µéƒ¨åˆ†äº†ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œä¸‹é¢æˆ‘ä¼šä»¥å‘é€é‚®ä»¶ä¸ºä¾‹æ¥è®²ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨Streanæ¥å®ç°æ¶ˆæ¯é˜Ÿåˆ—ã€‚ä¸ºäº†æ–¹ä¾¿åç»­çš„è®²è§£ï¼Œå…ˆæ„é€ ä¸€ä¸ªç®€å•çš„é‚®ä»¶ä¿¡æ¯ç±»ä½œä¸ºæˆ‘ä»¬çš„æ¶ˆæ¯å†…å®¹ï¼šMailInfo.java123456789@Data@AllArgsConstructor@NoArgsConstructorpublic class MailInfo &#123; private String receiver; private String description;&#125;æ„é€ StreamMessageListenerContaineråœ¨ä½¿ç”¨Pub/Subæ¨¡å¼æ—¶ï¼Œæˆ‘ä»¬éƒ½æ˜¯å…ˆåˆ›å»ºä¸€ä¸ªRedisMessageListenerContainerå®¹å™¨ï¼Œå‘è¿™ä¸ªå®¹å™¨æ³¨å†Œç›‘å¬å™¨ç„¶ååœ¨onMessageæ–¹æ³•ä¸­å¤„ç†ä¸šåŠ¡é€»è¾‘å³å¯ã€‚é‚£ä¹ˆä½¿ç”¨Streamç±»å‹çš„è¯æœ‰æ²¡æœ‰æä¾›ä¸€ä¸ªç±»ä¼¼çš„å®¹å™¨å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚åœ¨SpringBoot2.2æä¾›äº†StreamMessageListenerContainerè¿™ä¸ªStreamç±»å‹ä¸“æœ‰çš„æ¶ˆæ¯ç›‘å¬å®¹å™¨ï¼Œè€Œå”¯ä¸€çš„å®ç°ä¹Ÿå°±æ˜¯DefaultStreamMessageListenerContainerã€‚StreamMessageListenerContainerçš„æ„é€ å‡½æ•°ç›¸æ¯”RedisMessageListenerContainerå¤šäº†ä¸€ä¸ªStreamMessageListenerContainerOptionsï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯ä½¿ç”¨builderæ–¹å¼æ¥åˆ›å»ºçš„ï¼š123456789StreamMessageListenerContainerOptions&lt;String, ObjectRecord&lt;String, MailInfo&gt;&gt; options = StreamMessageListenerContainerOptions.builder() .batchSize(100) //ä¸€æ‰¹æ¬¡æ‹‰å–çš„æœ€å¤§countæ•° .executor(executor) //çº¿ç¨‹æ±  .pollTimeout(Duration.ZERO) //é˜»å¡å¼è½®è¯¢ .targetType(MailInfo.class) //ç›®æ ‡ç±»å‹ï¼ˆæ¶ˆæ¯å†…å®¹çš„ç±»å‹ï¼‰ .build();StreamMessageListenerContainer&lt;String, ObjectRecord&lt;String, MailInfo&gt;&gt; container = StreamMessageListenerContainer.create(redisConnectionFactory, options);åœ¨æ„é€ StreamMessageListenerContainerOptionsæ—¶æœ€å…³é”®çš„å°±æ˜¯targetTypeã€objectMapperä»¥åŠè®¾ç½®åºåˆ—åŒ–å™¨è¿™å‡ ä¸ªæ–¹æ³•ï¼Œè¿™äº›å‚æ•°çš„è®¾ç½®ä¼šç›´æ¥å½±å“åˆ°åç»­æ¥æ”¶åˆ°æ¶ˆæ¯åèƒ½å¦ååºåˆ—åŒ–ä¸ºjavaå¯¹è±¡ï¼ç”±äºè¿™éƒ¨åˆ†å†…å®¹æ¶‰åŠæºç è¿‡å¤šï¼Œåœ¨åé¢ä¸€éƒ¨åˆ†æˆ‘ä»¬å†é’ˆå¯¹è¿™å‡ ä¸ªæ–¹æ³•è¿›è¡Œè¯¦ç»†çš„æ¢æŸ¥ã€‚åœ¨æ„é€ å®ŒStreamMessageListenerContainerä¹‹åï¼Œç°åœ¨è¯¥æ€ä¹ˆæ³¨å†Œæ¶ˆæ¯ç›‘å¬å™¨å‘¢ï¼Ÿæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹ã€‚æ³¨å†ŒStreamListeneråœ¨Pub/Subæ¨¡å¼ä¸­æˆ‘ä»¬ä½¿ç”¨addMessageListener(MessageListener, Topic)æ–¹æ³•æ·»åŠ ä¸€ä¸ªMessageListeneråˆ°æŒ‡å®šçš„Topicï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨Streamæ¶ˆæ¯çš„ç›‘å¬å®¹å™¨æ—¶ï¼Œæˆ‘ä»¬æ˜¯ä½¿ç”¨receiveæ–¹æ³•ã€‚Spring-data-redisæä¾›äº†ä¸‰ä¸ªæ–¹æ³•ç”¨äºæ³¨å†ŒStreamListenerï¼š123456789default Subscription receive(StreamOffset&lt;K&gt; streamOffset, StreamListener&lt;K, V&gt; listener) &#123; return register(StreamReadRequest.builder(streamOffset).build(), listener);&#125;default Subscription receive(Consumer consumer, StreamOffset&lt;K&gt; streamOffset, StreamListener&lt;K, V&gt; listener) &#123; return register(StreamReadRequest.builder(streamOffset).consumer(consumer).autoAcknowledge(false).build(), listener);&#125;default Subscription receiveAutoAck(Consumer consumer, StreamOffset&lt;K&gt; streamOffset, StreamListener&lt;K, V&gt; listener) &#123; return register(StreamReadRequest.builder(streamOffset).consumer(consumer).autoAcknowledge(true).build(), listener);&#125;å¦‚æœä½ å‘ç°ä½ å“ªé‡Œreceiveæ–¹æ³•å’Œæˆ‘çš„ä¸å¤ªä¸€æ ·ï¼Ÿé‚£ä¹ˆä½ ä½¿ç”¨çš„ç‰ˆæœ¬åº”è¯¥æ˜¯2.2ï¼Œè¿™ä¸ªç‰ˆæœ¬çš„é—®é¢˜æ¯”è¾ƒå¤šï¼Œæ¯”å¦‚ä¸Šé¢è¿™ä¸ªåœ°æ–¹ï¼Œä½¿ç”¨ç¬¬äºŒä¸ªæ–¹æ³•æ³¨å†ŒStreamListenerï¼Œåœ¨æ¶ˆæ¯è¢«æ¶ˆè´¹ä¹‹åä¼šè‡ªåŠ¨ackï¼Œå› ä¸ºConsumerStreamReadRequestBuilderçš„autoAckå±æ€§é»˜è®¤å°±æ˜¯trueï¼ˆé™¤éä½¿ç”¨ç¬¬ä¸€ä¸ªæ–¹æ³•æŒ‡å®šStreamReadRequestï¼‰ï¼Œè¿™ä¸ªé—®é¢˜åœ¨2.3ä¿®å¤äº†ï¼Œæ„Ÿå…´è¶£å¯ä»¥å»çœ‹çœ‹è¿™éƒ¨åˆ†æºç ï¼Œä¿®è¡¥æäº¤åœ¨è¿™é‡Œã€‚æˆ‘ä¸ªäººæœ€åˆå°±æ˜¯ä½¿ç”¨çš„SpringBoot2.2.2ï¼Œä½¿ç”¨è¿‡ç¨‹ä¸­å‘ç°é—®é¢˜çœŸçš„æœ‰ç‚¹å¾ˆå¤šã€‚æ¯”å¦‚è¿˜æœ‰ä¸€å¤„åºåˆ—åŒ–å™¨æ³›å‹ç±»å‹é”™è¯¯å¯¼è‡´StreamMessageListenerContainerOptionsæ„é€ æ··ä¹±çš„é—®é¢˜ã€ä¿®è¡¥æäº¤ã€‘ï¼Œæ‰€ä»¥è¯´å¦‚æœä½ æƒ³å°é²œï¼Œé‚£ä¹ˆå¼ºçƒˆå»ºè®®ä½¿ç”¨SpringBootæœ€æ–°å‘å¸ƒçš„ç‰ˆæœ¬ã€‚Consumerå’ŒStreamOffsetå¯ä»¥çœ‹åˆ°receiveæ–¹æ³•å¦å¤–è¿˜éœ€è¦Consumerå’ŒStreamOffsetä¸¤ä¸ªå‚æ•°ï¼ŒConsumer1Consumer.from(\"group name\", \"consumer name\")Consumerè¡¨ç¤ºæ¶ˆè´¹è€…ç»„ä¸­çš„æŸä¸ªæ¶ˆè´¹è€…ï¼Œè¿™ä¸ªä¸œè¥¿åªä¼šåœ¨æ¶ˆè´¹è€…ç»„æ¨¡å¼ä¸­ç”¨åˆ°ã€‚æˆ‘ä»¬ä¸€èˆ¬é€šè¿‡ä¸Šé¢è¿™ç§æ–¹å¼æ¥åˆ›å»ºï¼Œç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºæ¶ˆè´¹è€…ç»„ï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæ¶ˆè´¹è€…ã€‚StreamOffsetStreamOffsetç”¨äºè¡¨ç¤ºåœ¨æŸä¸ªStreamä¸Šçš„åç§»é‡ï¼Œå®ƒåŒ…å«ä¸¤éƒ¨åˆ†å†…å®¹ï¼Œä¸€ä¸ªæ˜¯streamçš„keyï¼Œå¦ä¸€ä¸ªæ˜¯ReadOffsetç”¨äºè¡¨ç¤ºè¯»å–åç§»é‡ã€‚å‰è€…åº”è¯¥ä¸éœ€è¦è¿‡å¤šçš„è§£é‡Šï¼Œé‚£ä¹ˆReadOffsetè¿™ä¸ªè¯»å–åç§»é‡æ˜¯å¹²å˜›ç”¨çš„å‘¢ï¼Ÿè¦ææ¸…æ¥šReadOffsetï¼Œæˆ‘ä»¬é¦–å…ˆè¦çŸ¥é“Streamä¸­åç§»é‡çš„å«ä¹‰ï¼Œåœ¨Streamä¸­åç§»é‡æ—¢å¯ä»¥è¡¨ç¤ºæ¶ˆè´¹è®°å½•æ—¶çš„åç§»é‡ï¼Œåˆå¯ä»¥è¡¨ç¤ºæ¶ˆè´¹è€…ç»„åœ¨Streamä¸Šçš„åç§»é‡ã€‚è¿˜è®°å¾—Redisä¸­æˆ‘ä»¬æ€ä¹ˆè¯»å–Streamä¸­çš„è®°å½•å—ï¼Ÿé€šè¿‡xreadå‘½ä»¤ä¹Ÿå°±æ˜¯éæ¶ˆè´¹è€…ç»„æ¨¡å¼ç›´æ¥è¯»å–ï¼Œæˆ–è€…ä½¿ç”¨xreadgroupå‘½ä»¤åœ¨æ¶ˆè´¹è€…ç»„ä¸­å‘½ä»¤ä¸€ä¸ªæ¶ˆè´¹è€…å»æ¶ˆè´¹ä¸€æ¡è®°å½•ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡0ã€&gt;ã€$åˆ†åˆ«è¡¨ç¤ºç¬¬ä¸€æ¡è®°å½•ã€æœ€åä¸€æ¬¡æœªè¢«æ¶ˆè´¹çš„è®°å½•å’Œæœ€æ–°ä¸€æ¡è®°å½•ï¼Œè¿™ä¹Ÿå°±æ˜¯ReadOffsetçš„ç”¨é€”ä¹‹ä¸€ï¼šç”¨äºè¡¨ç¤ºç›´æ¥è¯»å–æˆ–æ¶ˆè´¹è€…ç»„ä¸­æ¶ˆè´¹è€…è¯»å–è®°å½•æ—¶çš„åç§»é‡ã€‚é‚£ä¹ˆè¿˜æœ‰å¦å¤–çš„ç”¨é€”å—ï¼Ÿå½“ç„¶äº†ï¼Œè¿˜è®°å¾—æ€æ ·åˆ›å»ºæ¶ˆè´¹è€…ç»„å—ï¼Ÿä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨xgroup createå‘½ä»¤åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…ç»„æ—¶å¯ä»¥é€‰æ‹©ä»Streamçš„ç¬¬ä¸€æ¡æ¶ˆæ¯å¼€å§‹ï¼Œæˆ–è€…Streamçš„ä¸­é—´æŸä¸ªè®°å½•å¼€å§‹ï¼Œåˆæˆ–è€…ä»Streamçš„æœ€æ–°ä¸€æ¡è®°å½•å¼€å§‹ã€‚ä¹Ÿå°±åˆ†åˆ«ä»£è¡¨äº†0ã€$ã€‚è¿™ä¹Ÿå°±æ˜¯ReadOffsetçš„ç”¨é€”ä¹‹äºŒï¼šç”¨äºè¡¨ç¤ºåˆ›å»ºæ¶ˆè´¹è€…ç»„æ—¶è¯¥æ¶ˆè´¹è€…ç»„åœ¨Streamä¸Šçš„åç§»é‡ã€‚ç†è§£ReadOffsetæœ€å¿«æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯åœ¨Redis-cliä¸­ç”¨Rediså‘½ä»¤æ“ä½œä¸€ç•ªã€‚è¿™å…¶ä¸­è¿˜æœ‰ä¸€äº›å€¼å¾—æ³¨æ„çš„é—®é¢˜ï¼Œæ¯”å¦‚åˆ›å»ºæ¶ˆè´¹è€…ç»„æ—¶ä¸èƒ½ä½¿ç”¨&gt;è¡¨ç¤ºæœ€åä¸€æ¬¡æœªè¢«æ¶ˆè´¹çš„è®°å½•ï¼›æ¯”å¦‚0è¡¨ç¤ºä»ç¬¬ä¸€æ¡å¼€å§‹å¹¶ä¸”åŒ…æ‹¬ç¬¬ä¸€æ¡ï¼›$è¡¨ç¤ºä»æœ€æ–°ä¸€æ¡å¼€å§‹ä½†å¹¶ä¸æ˜¯æŒ‡å½“å‰Streamçš„æœ€åä¸€æ¡è®°å½•ï¼Œæ‰€ä»¥ä½¿ç”¨$æ—¶æœ€æ–°ä¸€æ¡ä¹Ÿå°±æ˜¯è¡¨ç¤ºä¸‹ä¸€ä¸ªxaddæ·»åŠ çš„é‚£ä¸€æ¡è®°å½•ï¼Œæ‰€ä»¥è¯´$åœ¨éæ¶ˆè´¹è€…ç»„æ¨¡å¼çš„é˜»å¡è¯»å–ä¸‹æ‰æœ‰æ„ä¹‰ï¼å®ç°StreamListeneråŒæ ·çš„ç”¨Pub/Subæ¥ç±»æ¯”ï¼Œåœ¨Pub/Subæ¨¡å¼ä¸‹æˆ‘ä»¬å®ç°çš„æ¶ˆæ¯ç›‘å¬å™¨æ˜¯ä¸€èˆ¬æ˜¯MessageListeneræˆ–è€…ä½¿ç”¨MessageListenerAdapteråå°„è°ƒç”¨å¤„ç†æ–¹æ³•ï¼Œåœ¨Streanæ¶ˆæ¯é˜Ÿåˆ—çš„å®ç°ä¸­å¿…ç„¶ä¹Ÿéœ€è¦ä¸€ä¸ªç›‘å¬å™¨ç”¨äºå¤„ç†çœŸæ­£çš„ä¸šåŠ¡é€»è¾‘ï¼Œè¿™ä¸ªç±»ç›®å‰åªæœ‰ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯StreamListenerï¼š123456789101112131415161718public class StreamMessageListener implements StreamListener&lt;String, ObjectRecord&lt;String, MailInfo&gt;&gt; &#123; private final Logger logger = LoggerFactory.getLogger(StreamMessageListener.class); private final StringRedisTemplate stringRedisTemplate; public StreamMessageListener(StringRedisTemplate stringRedisTemplate) &#123; this.stringRedisTemplate = stringRedisTemplate; &#125; @Override public void onMessage(ObjectRecord&lt;String, MailInfo&gt; message) &#123; RecordId id = message.getId(); MailInfo messageValue = message.getValue(); logger.info(\"æ¶ˆè´¹stream:&#123;&#125;ä¸­çš„ä¿¡æ¯:&#123;&#125;, æ¶ˆæ¯id:&#123;&#125;\", message.getStream(), messageValue, id); // å‘é‚®ä»¶... stringRedisTemplate.opsForStream().acknowledge(MAIL_GROUP, message); //æ‰‹åŠ¨ack &#125;&#125;StreamListenerå’ŒMessageListenerå·®ä¸å¤šï¼Œåªéœ€è¦å®ç°onMessageæ–¹æ³•ï¼Œåªä¸è¿‡å¤šäº†ä¸ªæ³›å‹å‚æ•°ç½¢äº†ã€‚åœ¨å®ç°æ¶ˆæ¯ç›‘å¬å™¨åä¹Ÿå°±å¯ä»¥ä½¿ç”¨receiveæ–¹æ³•è¿›è¡Œæ³¨å†Œäº†ï¼š123container.receive(Consumer.from(MAIL_GROUP, \"consumer-1\"), StreamOffset.create(MAIL_CHANNEL, ReadOffset.lastConsumed()), new StreamMessageListener(stringRedisTemplate));æ³¨å†Œå®Œæˆä¹‹åå¯åŠ¨StreamMessageListenerContainerå®¹å™¨ï¼š1container.start();å®Œæ•´ä»£ç ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586/** * @author Lolico Li */@Componentpublic class StreamConsumerRunner implements ApplicationRunner, DisposableBean &#123; public static final String MAIL_CHANNEL = \"channel:stream:mail\"; public static final String MAIL_GROUP = \"group:mail\"; private final ThreadPoolTaskExecutor executor; private final RedisConnectionFactory redisConnectionFactory; private final StringRedisTemplate stringRedisTemplate; private StreamMessageListenerContainer&lt;String, ObjectRecord&lt;String, MailInfo&gt;&gt; container; public StreamConsumerRunner(ThreadPoolTaskExecutor executor, RedisConnectionFactory redisConnectionFactory, StringRedisTemplate stringRedisTemplate) &#123; this.executor = executor; this.redisConnectionFactory = redisConnectionFactory; this.stringRedisTemplate = stringRedisTemplate; &#125; @Override public void run(ApplicationArguments args) &#123; StreamMessageListenerContainerOptions&lt;String, ObjectRecord&lt;String, MailInfo&gt;&gt; options = StreamMessageListenerContainerOptions.builder() .batchSize(10) .executor(executor) .pollTimeout(Duration.ZERO) .targetType(MailInfo.class) .build(); StreamMessageListenerContainer&lt;String, ObjectRecord&lt;String, MailInfo&gt;&gt; container = StreamMessageListenerContainer.create(redisConnectionFactory, options); prepareChannelAndGroup(stringRedisTemplate.opsForStream(), MAIL_CHANNEL, MAIL_GROUP); container.receive(Consumer.from(MAIL_GROUP, \"consumer-1\"), StreamOffset.create(MAIL_CHANNEL, ReadOffset.lastConsumed()), new StreamMessageListener(stringRedisTemplate)); this.container = container; this.container.start(); &#125; private void prepareChannelAndGroup(StreamOperations&lt;String, ?, ?&gt; ops, String channel, String group) &#123; String status = \"OK\"; try &#123; StreamInfo.XInfoGroups groups = ops.groups(channel); if (groups.stream().noneMatch(xInfoGroup -&gt; group.equals(xInfoGroup.groupName()))) &#123; status = ops.createGroup(channel, group); &#125; &#125; catch (Exception exception) &#123; RecordId initialRecord = ops.add(ObjectRecord.create(channel, \"Initial Record\")); Assert.notNull(initialRecord, \"Cannot initialize stream with key '\" + channel + \"'\"); status = ops.createGroup(channel, ReadOffset.from(initialRecord), group); &#125; finally &#123; Assert.isTrue(\"OK\".equals(status), \"Cannot create group with name '\" + group + \"'\"); &#125; &#125; @Override public void destroy() &#123; this.container.stop(); &#125; public static class StreamMessageListener implements StreamListener&lt;String, ObjectRecord&lt;String, MailInfo&gt;&gt; &#123; private final Logger logger = LoggerFactory.getLogger(StreamMessageListener.class); private final StringRedisTemplate stringRedisTemplate; public StreamMessageListener(StringRedisTemplate stringRedisTemplate) &#123; this.stringRedisTemplate = stringRedisTemplate; &#125; @Override public void onMessage(ObjectRecord&lt;String, MailInfo&gt; message) &#123; RecordId id = message.getId(); MailInfo messageValue = message.getValue(); logger.info(\"æ¶ˆè´¹stream:&#123;&#125;ä¸­çš„ä¿¡æ¯:&#123;&#125;, æ¶ˆæ¯id:&#123;&#125;\", message.getStream(), messageValue, id); stringRedisTemplate.opsForStream().acknowledge(MAIL_GROUP, message); &#125; &#125;&#125;æ³¨æ„prepareChannelAndGroupæ–¹æ³•ï¼Œåœ¨åˆå§‹åŒ–å®¹å™¨æ—¶ï¼Œå¦‚æœkeyå¯¹åº”çš„streamæˆ–è€…groupä¸å­˜åœ¨æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æå‰æ£€æŸ¥å¹¶ä¸”åˆå§‹åŒ–ã€‚æµ‹è¯•æ·»åŠ ä¸€ä¸ªæµ‹è¯•æ¥å£ï¼š1234567@GetMapping(\"/sendMail\")public ResponseEntity&lt;RecordId&gt; sendMail(String receiver, String description) &#123; MailInfo mailInfo = new MailInfo(receiver, description); ObjectRecord&lt;String, MailInfo&gt; record = Record.of(mailInfo).withStreamKey(channel); RecordId recordId = redisTemplate.opsForStream().add(record); return ResponseEntity.ok(recordId);&#125;è®¿é—®è¿›è¡Œæµ‹è¯•ï¼š12020-06-28 19:26:17.870 INFO 21900 --- [ task-1] reamConsumerRunner$StreamMessageListener : æ¶ˆè´¹stream:channel:stream:mailä¸­çš„ä¿¡æ¯:MailInfo(receiver&#x3D;534619360@qq.com, description&#x3D;å‘é€é‚®ä»¶), æ¶ˆæ¯id:1593343576237-0æ§åˆ¶å°è¾“å‡ºæ—¥å¿—ï¼Œå¦‚æœåœ¨redis-cliä¸­ä½¿ç”¨xpendingå‘½ä»¤æ£€æŸ¥ackä¿¡æ¯ä¼šå‘ç°ä¹Ÿæ˜¯0ï¼Œå› ä¸ºæˆ‘ä»¬è™½ç„¶ä½¿ç”¨receiveæ–¹æ³•æ³¨å†Œï¼Œä½†æ˜¯åœ¨onMessageä¸­æ‰‹åŠ¨æäº¤äº†ç¡®è®¤ï¼Œå½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨receiveAutoAckæ–¹æ³•æ·»åŠ ã€‚å®è·µä¸­è¸©åˆ°çš„å‘è‡ªåŠ¨ackå’Œæ³›å‹ç±»å‹é”™è¯¯è¿™ä¸¤ä¸ªé—®é¢˜åœ¨å‰é¢å·²ç»æåˆ°äº†å¹¶ä¸”åœ¨2.3å·²ç»ä¿®å¤ï¼Œè¿™é‡Œä¸å¤šè¯´ã€‚è¿˜æ˜¯é‚£å¥è¯ï¼Œå¦‚æœæƒ³å°é²œï¼Œé‚£ä¹ˆå¼ºçƒˆæ¨èä½¿ç”¨SpringBootæœ€æ–°å‘å¸ƒçš„ç‰ˆæœ¬ã€‚RedisTemplateåºåˆ—åŒ–å™¨ä½¿ç”¨é”™è¯¯å¯¼è‡´å®¹å™¨æ— æ³•ååºåˆ—åŒ–RedisTemplateçš„hashvalueçš„åºåˆ—åŒ–å™¨æœ€åˆä½¿ç”¨çš„jsonåºåˆ—åŒ–å™¨ï¼Œå¯¼è‡´å®¹å™¨ç›‘å¬åˆ°æ–°æ¶ˆæ¯ååºåˆ—åŒ–æ—¶æŠ›å‡ºå¼‚å¸¸ï¼š12345678910111213java.lang.IllegalArgumentException: Value must not be null! at org.springframework.util.Assert.notNull(Assert.java:198) at org.springframework.data.redis.connection.stream.Record.of(Record.java:81) at org.springframework.data.redis.connection.stream.MapRecord.toObjectRecord(MapRecord.java:147) at org.springframework.data.redis.core.StreamObjectMapper.toObjectRecord(StreamObjectMapper.java:132) at org.springframework.data.redis.core.StreamObjectMapper.map(StreamObjectMapper.java:158) at org.springframework.data.redis.core.StreamOperations.read(StreamOperations.java:458) at org.springframework.data.redis.stream.DefaultStreamMessageListenerContainer.lambda$getReadFunction$2(DefaultStreamMessageListenerContainer.java:232) at org.springframework.data.redis.stream.StreamPollTask.doLoop(StreamPollTask.java:138) at org.springframework.data.redis.stream.StreamPollTask.run(StreamPollTask.java:123) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at java.lang.Thread.run(Thread.java:748)è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“Redisä¸­Streamä¸­å­˜çš„æ˜¯é”®å€¼å¯¹å¹¶ä¸”DefaultStreamOperationsä¸­æ“ä½œçš„éƒ½æ˜¯byte[]ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è™½ç„¶æ·»åŠ çš„æ˜¯ObjectRecordï¼Œä½†æ˜¯ä¼šå…ˆè½¬æ¢æˆMapRecordï¼Œç„¶åå†è¢«è½¬æ¢æˆByteRecordï¼Œæœ€åè¿›è¡Œåºåˆ—åŒ–ã€‚æ¥çœ‹ä¸€ä¸‹addæ–¹æ³•ï¼š123456public RecordId add(Record&lt;K, ?&gt; record) &#123; Assert.notNull(record, \"Record must not be null\"); MapRecord&lt;K, HK, HV&gt; input = StreamObjectMapper.toMapRecord(this, record); //è½¬æ¢æˆMapRecord ByteRecord binaryRecord = input.serialize(keySerializer(), hashKeySerializer(), hashValueSerializer()); //å†ä½¿ç”¨åºåˆ—åŒ–å™¨è½¬æ¢æˆByteRecord return execute(connection -&gt; connection.xAdd(binaryRecord), true);&#125;é€šè¿‡ä¸Šé¢è¿™ä¸ªæ–¹æ³•æˆ‘ä»¬å¯ä»¥å‘ç°streamåºåˆ—åŒ–æ—¶å’Œå…¶ä»–ç±»å‹ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨jsonåºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡æ—¶éƒ½æ˜¯ç›´æ¥è¿›è¡Œçš„ï¼Œè€Œè¿™é‡Œåˆ†äº†ä¸¤æ­¥å¹¶ä¸”åºåˆ—åŒ–å™¨æ˜¯ç”¨äºç¬¬äºŒéƒ¨è½¬æ¢ï¼Œé‚£ä¹ˆObjectRecordæ˜¯æ€ä¹ˆè½¬æ¢æˆMapRecordçš„å‘¢ï¼Ÿç‚¹è¿›StreamObjectMapper.toMapRecordæ–¹æ³•å¯ä»¥çœ‹åˆ°å…¶å®æ˜¯é€šè¿‡ObjectRecord#toMapRecordæ–¹æ³•å®Œæˆçš„ï¼Œè¿™ä¸ªæ–¹æ³•éœ€è¦ä¸€ä¸ªHashMapperç”¨äºå°†å¯¹è±¡çš„å±æ€§/å±æ€§å€¼æ˜ å°„æ„é€ æˆMapç±»å‹ï¼Œä½ ä¼šå‘ç°opsForStreamæ–¹æ³•é‡è½½äº†ä¸€ä¸ªé»˜è®¤æ— å‚çš„æ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•é»˜è®¤ä½¿ç”¨çš„æ˜¯ObjectHashMapperï¼Œåœ¨æˆ‘ä»¬æ„é€ StreamMessageListenerContainerOptionsBuilderæ—¶è°ƒç”¨targetTypeæ—¶é»˜è®¤ä½¿ç”¨çš„ä¹Ÿæ˜¯ObjectHashMapperã€‚è€Œè¿™ä¸ªObjectHashMapperä¼šå°†å¯¹è±¡ä¸­çš„å±æ€§å’Œå±æ€§å€¼è½¬æ¢æˆbyte[]å½¢å¼ï¼Œæ‰€ä»¥åœ¨ç¬¬ä¸€æ­¥ä¹‹åè¿™ä¸ªMapRecordä¸­çš„å€¼çš„ç±»å‹å·²ç»æ˜¯byte[]äº†ï¼Œé‚£ä¹ˆä¹Ÿå°±å¯¼è‡´ç¬¬äºŒæ­¥åœ¨ä½¿ç”¨jsonåºåˆ—åŒ–å™¨è½¬æ¢ä¸ºByteRecordæ—¶å‡ºç°è¿™ç§æƒ…å†µï¼šobjectMapper.writeValueAsBytes(byte[])ï¼Œè¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å®ä¾‹ï¼š12345678@Testvoid test() throws JsonProcessingException &#123; ObjectMapper mapper = new ObjectMapper(); byte[] value = \"534619360@qq.com\".getBytes(); byte[] bytes = mapper.writeValueAsBytes(value); System.out.println(new String(bytes)); //è¾“å‡º\"NTM0NjE5MzYwQHFxLmNvbQ==\"&#125;ååº”åˆ°streamä¸­å€¼å°±å˜æˆäº†\\â€œNTM0NjE5MzYwQHFxLmNvbQ==\\â€œï¼ˆå¼•å·éœ€è¦è½¬ä¹‰ï¼‰ã€‚ä¸ºäº†ä¾¿äºç†è§£ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®¾ç½®ä½¿ç”¨jsonåºåˆ—åŒ–å™¨çš„RedisTemplateè¿›è¡Œaddæ–­ç‚¹debugæµ‹è¯•çœ‹ä¸€ä¸‹è½¬æ¢åçš„ä¸¤ä¸ªRecordä¸­çš„å†…å®¹ï¼š123456@Testvoid test() &#123; stringRedisTemplate.setHashValueSerializer(RedisSerializer.json()); MailInfo mailInfo = new MailInfo(\"534619360@qq.com\", \"send mail\"); stringRedisTemplate.opsForStream().add(Record.of(mailInfo).withStreamKey(channel));&#125;è¿è¡Œæµ‹è¯•å¹¶æ–­ç‚¹æŸ¥çœ‹MapRecordå’ŒByteRecordï¼šä½¿ç”¨Redis Desktop ManageræŸ¥çœ‹å€¼ï¼šæµ‹è¯•ç»“æŸç»ˆç«¯æŠ›å‡ºä¸Šé¢æåˆ°çš„å¼‚å¸¸ã€‚è¿™ä¸ªé—®é¢˜è§£å†³åŠæ³•å°±æ˜¯ä½¿ç”¨Stringåºåˆ—åŒ–å™¨ä¹Ÿå°±æ˜¯ä½¿ç”¨StringRedisTemplateï¼Œå› ä¸ºè¿™ä¸ªåºåˆ—åŒ–å™¨ä¸èƒ½åºåˆ—åŒ–byte[]ç±»å‹çš„å¯¹è±¡ï¼Œä½¿ç”¨è¿™ä¸ªåºåˆ—åŒ–å™¨åœ¨åºåˆ—åŒ–æ—¶å¦‚æœå·²ç»æ˜¯byte[]ï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥è¿”å›åŸbyte[]ï¼šæ›´å…·ä½“çš„ç»†èŠ‚å¯ä»¥è·Ÿç€addæ–¹æ³•debugä¸€éã€‚ReadOffsetä½¿ç”¨é”™è¯¯å¯¼è‡´groupä¸­æ¶ˆè´¹è€…æ¶ˆè´¹å¤±è´¥å¼‚å¸¸ï¼š1RedisCommandExecutionException: ERR The $ ID is meaningless in the context of XREADGROUP: you want to read the history of this consumer by specifying a proper ID, or use the &gt; ID to get new messages. The $ ID would just return an empty result set.ä¸Šé¢StreamOffsetä¸­ä¹Ÿæåˆ°äº†ï¼Œè¿™æ¶‰åŠåˆ°0ã€&gt;ã€$çš„ä½¿ç”¨åœºæ™¯å’ŒèŒƒå›´ï¼Œå¦‚æœå‡ºç°è¿™ä¸ªå¼‚å¸¸ï¼Œå¾ˆæœ‰å¯èƒ½ä½ åœ¨æ¶ˆè´¹è€…ç»„æ¨¡å¼ä¸‹è®¾ç½®æ¶ˆè´¹è€…è¯»å–çš„offsetæ—¶ä½¿ç”¨äº†ReadOffset.latest()ï¼Œè€Œè¿™ä¸ªå¯¹åº”ç€$ï¼Œä¹Ÿå°±æ˜¯æœ€æ–°ä¸€æ¡è®°å½•ã€‚å¦‚æœä¸æ˜ç™½é‚£ä¹ˆä½ å¯èƒ½å¯¹è¿™ä¸‰ä¸ªæ ‡è¯†ç¬¦çš„ä½¿ç”¨è¿˜ä¸æ˜¯å¾ˆç†è§£ï¼Œæœ€å¥½çš„è§£å†³åŠæ³•å°±æ˜¯ä½¿ç”¨rediså‘½ä»¤å…ˆå®Œæ•´çš„æ“ä½œä¸€éã€‚streamæˆ–è€…groupä¸å­˜åœ¨å¯¼è‡´å¯åŠ¨æŠ›å‡ºå¼‚å¸¸åŒæ ·åœ¨ä¸Šé¢æåˆ°äº†ï¼Œåœ¨æ„é€ StreamMessageListenerContaineræ—¶éœ€è¦streamå’Œgroupå­˜åœ¨æ‰å¯ä»¥ã€‚è§£å†³æ–¹æ³•å°±æ˜¯æå‰æ£€æŸ¥å¹¶åˆå§‹åŒ–ï¼Œä¸Šé¢å·²ç»™å‡ºä»£ç ã€‚æ€»ç»“å…¶å®åœ¨å®è·µä¹‹åˆï¼Œæˆ‘åœ¨ç½‘ä¸Šä¹Ÿæœäº†å¾ˆå¤šç›¸å…³çš„èµ„æ–™ï¼Œä½†æ˜¯å‘ç°è¿™äº›èµ„æ–™åŸºæœ¬éƒ½æ˜¯ä½¿ç”¨redis-cliè¿›è¡Œå‘½ä»¤ä¸Šçš„æ“ä½œï¼Œå¹¶æ²¡æœ‰SpringBootä¸­å®ç°ã€‚è¿™æ¬¡å®è·µå¯è°“æ˜¯è‰°è¾›ï¼Œç”±äºç›®å‰è¯¥æ”¯æŒçš„è¿­ä»£æ¬¡æ•°æ¯”è¾ƒå°‘ï¼Œä¸ä¹ä¸€äº›bugæˆ–è€…å°é—®é¢˜ï¼ˆ2.3å·²ç»æ¯”è¾ƒç¨³å®šï¼‰ï¼Œå¹¶ä¸”åªæœ‰lettuceæä¾›äº†streamç±»å‹çš„æ“ä½œå®ç°ï¼Œè€Œlettuceæœ¬èº«åˆæœ‰äº›å°æ¯›ç—…ï¼Œè¿™äº›å› ç´ ç»“åˆåœ¨ä¸€èµ·ä¹Ÿå°±å¯¼è‡´è¿™ä¸ªè¿‡ç¨‹èŠ±è´¹äº†æˆ‘æ•´æ•´ä¸¤å¤©æ—¶é—´ï¼Œè€Œè¿™ç¯‡åšå®¢åˆèŠ±äº†æ•´æ•´ä¸€ä¸‹åˆçš„æ—¶é—´æ‰ç®—å®Œæˆï¼Œå…¶ä¸­å¯èƒ½æœ‰äº›å†…å®¹å› ä¸ºæ¶‰åŠä¸œè¥¿æ¯”è¾ƒå¤šåªèƒ½ç²—ç•¥æä¸€ä¸‹ï¼Œå¹¶ä¸”è¯­è¨€ç»„ç»‡ä¸Šä¸å¤ªå¥½å¯èƒ½ä¸å¥½å»ç†è§£ã€‚è¯è¯´å›æ¥ï¼Œè¿™ç¯‡æ–‡ç« ä¹Ÿç®—æ˜¯æˆ‘è‡ªå·±å®è·µåçš„ä¸€ä¸ªä¸ªäººæ€»ç»“å§ï¼Œè¿™ä¸ªè¿‡ç¨‹å…¶å®å­¦åˆ°çš„ä¸œè¥¿è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œä¹Ÿä¸æ‰è´¹èŠ±äº†è¿™ä¹ˆå¤šæ—¶é—´ã€‚å¦‚æœä½ å‘ç°æ–‡ç« æœ‰ä»€ä¹ˆåœ°æ–¹æœ‰é—®é¢˜æˆ–è€…æœ‰ä»€ä¹ˆåœ°æ–¹ä¸ç†è§£ï¼Œä¹Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€ä¸€èµ·äº¤æµ~","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"https://lolico.me/tags/Spring/"},{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://lolico.me/tags/SpringBoot/"},{"name":"Redis","slug":"Redis","permalink":"https://lolico.me/tags/Redis/"},{"name":"MQ","slug":"MQ","permalink":"https://lolico.me/tags/MQ/"}]},{"title":"å•æ–‡ä»¶å‘å¸ƒæ—¶${basedir}æ— æ•ˆå¯¼è‡´æ–‡ä»¶æ—¥å¿—æ— æ³•å†™å…¥çš„é—®é¢˜","slug":"Why-cannot-write-log-to-files-when-wpf-application-publishing-as-a-single-file","date":"2020-06-20T04:51:36.000Z","updated":"2022-03-06T10:28:21.347Z","comments":true,"path":"2020/06/20/Why-cannot-write-log-to-files-when-wpf-application-publishing-as-a-single-file/","link":"","permalink":"https://lolico.me/2020/06/20/Why-cannot-write-log-to-files-when-wpf-application-publishing-as-a-single-file/","excerpt":"","text":"å†™åœ¨å‰é¢è¿˜æ˜¯NLogé—®é¢˜ï¼Œè™½ç„¶NLogä¸Šæ‰‹ç®€å•ï¼Œé…ç½®å®¹æ˜“ï¼Œä½†æ˜¯åœ¨NetCore3ä¸‹è¿˜æ˜¯æœ‰ä¸€äº›å‘çš„ï¼Œè™½ç„¶è¿™ä¸æ˜¯NLogçš„é—®é¢˜ã€‚å› ä¸ºè¿™ä¸ªé—®é¢˜ç™¾åº¦ä¸€åœˆéƒ½æ— æœï¼Œæ‰€ä»¥åœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹ï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©åˆ°ç™¾åº¦çš„åŒå­¦ï¼ˆè™½ç„¶è¿™ä¸ªç«™ç‚¹æ²¡æœ‰æäº¤åˆ°ç™¾åº¦æ”¶å½•ï¼Ÿé€ƒ~é—®é¢˜ç”±æ¥å¥½ï¼Œé‚£ä¹ˆç°åœ¨å›åˆ°ä¸»é¢˜ã€‚å‰ä¸€é˜µå­åœ¨ç”¨WPFæ¥åšä¸€ä¸ªFirstã€Followé›†ç®—æ³•æ¨¡æ‹Ÿçš„å·¥å…·ï¼Œé¡¹ç›®ä¸­ä½¿ç”¨NLogè®°å½•æ—¥å¿—ï¼Œåœ¨NetCore 3.1ä¸‹ä½œä¸ºå•æ–‡ä»¶å‘å¸ƒã€‚å‘å¸ƒåFileç±»å‹çš„æ—¥å¿—targetæ²¡æœ‰å°†æ—¥å¿—å¦‚æœŸå†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚å¹¶ä¸”ä»…åœ¨å•æ–‡ä»¶å‘å¸ƒå¹¶ä¸”fileNameä½¿ç”¨ç›¸å¯¹è·¯å¾„æˆ–è€…${basedir}æŒ‡å®šåŸºç¡€ç›®å½•æ—¶ï¼Œæ‰ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œå…¶å®è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ³•å¾ˆç®€å•ï¼Œåªéœ€ç¨å¾®æ”¹ä¸€ä¸‹å°±å¯ä»¥è§£å†³ã€‚è§£å†³ä½¿ç”¨${basedir:fixtempdir=true}æŒ‡å®šåŸºç¡€ç›®å½•ã€‚è¿™ä¸ªé—®é¢˜ä¸»è¦åŸå› å…¶å®æ˜¯NetCore3å•æ–‡ä»¶å‘å¸ƒæ—¶AppDomain.BaseDirectoryæ— æ³•æ­£ç¡®å¼•ç”¨åŸºç¡€è·¯å¾„çš„é—®é¢˜ï¼Œå¹¶ä¸”å¾®è½¯å¹¶æ²¡æœ‰æ‰“ç®—åœ¨NetCore3ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œæˆ–è®¸NetCore5ä¼šä¿®å¤è¿™ä¸ªé—®é¢˜å§ï¼Œæ–‡æœ«ä¼šæ”¾å‡ ä¸ªé“¾æ¥ï¼Œæ„Ÿå…´è¶£å¯ä»¥å»çœ‹çœ‹ã€‚å†™åœ¨æœ€ååˆæ°´äº†ä¸€ç¯‡æ–‡ç« ï¼Œæœ€è¿‘æ–‡ç« è´¨é‡æœ‰ç‚¹å·®ï¼Œä¸Šä¸ªæœˆè¿˜é¸½æ‰äº†ä¸€ç¯‡Aopè¯¦è§£çš„æ–‡ç« ï¼ˆå…¶å®ä¸€ç›´éƒ½åœ¨draftä¸­ï¼‰ï¼Œæ„Ÿè§‰æœ‰ç‚¹ç½ªæ¶æ„Ÿ :Då‚è€ƒï¼šPublishSingleFile excluding appsettings not working as expectedSingle file publish: AppContext.BaseDirectory doesnâ€™t point to apphost directoryWhen .net core app published as single file - ${basedir} is wrongWhy cannot write log to files when WPF application publishing as a single fileBasedir layout renderer","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"WPF","slug":"WPF","permalink":"https://lolico.me/tags/WPF/"},{"name":"NLog","slug":"NLog","permalink":"https://lolico.me/tags/NLog/"},{"name":".Net Core 3","slug":"Net-Core-3","permalink":"https://lolico.me/tags/Net-Core-3/"}]},{"title":"Asp.Net Coreä¸­ä½¿ç”¨NLogæ—¥å¿—æ—¶NLogè·¯ç”±ä¸ç”Ÿæ•ˆåªè¾“å‡ºInfoçº§åˆ«æ—¥å¿—çš„é—®é¢˜","slug":"Why-the-log-level-does-not-take-effect-when-using-NLog-in-Asp-Net-Core-application","date":"2020-06-16T13:44:44.000Z","updated":"2022-03-06T10:28:21.347Z","comments":true,"path":"2020/06/16/Why-the-log-level-does-not-take-effect-when-using-NLog-in-Asp-Net-Core-application/","link":"","permalink":"https://lolico.me/2020/06/16/Why-the-log-level-does-not-take-effect-when-using-NLog-in-Asp-Net-Core-application/","excerpt":"","text":"é—®é¢˜ç”±æ¥åœ¨ä¸€æ¬¡å°†Asp.net Coreé»˜è®¤æ—¥å¿—æ¢æˆNLogæ—¶ï¼Œå‘ç°NLogé…ç½®æ–‡ä»¶ä¸­çš„è®¾ç½®ä¸ç”Ÿæ•ˆï¼Ÿå…·ä½“çš„æ¥è¯´å°±æ˜¯åœ¨NLogæ–‡ä»¶ä¸­è®¾ç½®çš„è·¯ç”±ä»¥åŠå¯¹åº”çš„æ—¥å¿—çº§åˆ«åªæœ‰åœ¨Infoæˆ–è€…ä»¥ä¸Šæ—¶æ‰ç”Ÿæ•ˆï¼Œè€ŒDebugã€Traceçº§åˆ«åˆ™ä¸ä¼šæœ‰æ—¥å¿—è¾“å‡ºã€‚æ¯”å¦‚æˆ‘çš„NLogé…ç½®ï¼š123456789101112131415161718192021222324252627282930313233&lt;?xml version=\"1.0\" encoding=\"utf-8\" ?&gt;&lt;nlog xmlns=\"http://www.nlog-project.org/schemas/NLog.xsd\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.nlog-project.org/schemas/NLog.xsd NLog.xsd\" autoReload=\"true\" throwExceptions=\"false\" throwConfigExceptions=\"true\" internalLogLevel=\"Warn\" internalLogFile=\"$&#123;basedir&#125;/logs/internal.log\"&gt; &lt;variable name=\"logDirectory\" value=\"$&#123;basedir&#125;/logs\"/&gt; &lt;extensions&gt; &lt;add assembly=\"NLog.Web.AspNetCore\"/&gt; &lt;/extensions&gt; &lt;targets&gt; &lt;default-wrapper xsi:type=\"BufferingWrapper\" bufferSize=\"100\"/&gt; &lt;target xsi:type=\"File\" name=\"file\" fileName=\"$&#123;logDirectory&#125;/$&#123;shortdate&#125;-$&#123;level&#125;.log\" encoding=\"utf-8\" layout=\"$&#123;longdate&#125;|$&#123;uppercase:$&#123;level&#125;&#125;|$&#123;logger&#125;|$&#123;message&#125; $&#123;exception:format=tostring&#125;\" /&gt; &lt;/targets&gt; &lt;targets&gt; &lt;default-wrapper xsi:type=\"AsyncWrapper\"&gt; &lt;wrapper-target xsi:type=\"RetryingWrapper\"/&gt; &lt;/default-wrapper&gt; &lt;target xsi:type=\"ColoredConsole\" name=\"console\" detectConsoleAvailable=\"true\" layout=\"$&#123;longdate&#125;|$&#123;uppercase:$&#123;level&#125;&#125;|$&#123;logger&#125;|$&#123;message&#125;\"/&gt; &lt;/targets&gt; &lt;rules&gt; &lt;logger name=\"Microsoft.*\" minlevel=\"Debug\" writeTo=\"console\"/&gt; &lt;logger name=\"WebApplication.*\" minlevel=\"Trace\" writeTo=\"console\"/&gt; &lt;logger name=\"*\" minlevel=\"Info\" writeTo=\"file\" final=\"true\"/&gt; &lt;/rules&gt;&lt;/nlog&gt;æŒ‰ç…§rulesä¸­çš„è®¾ç½®ï¼ŒMicrosoftå‘½åç©ºé—´ä¸‹Debugçº§åˆ«çš„æ—¥å¿—åº”è¯¥éƒ½å¯ä»¥è¾“å‡ºåœ¨æ§åˆ¶å°ä¸­çš„ï¼Œä½†æ˜¯å¯åŠ¨åæ§åˆ¶å°çš„è¾“å‡ºåªæœ‰ï¼š123452020-06-16 20:41:34.9142|INFO|Microsoft.Hosting.Lifetime|Now listening on: https:&#x2F;&#x2F;localhost:50012020-06-16 20:41:34.9353|INFO|Microsoft.Hosting.Lifetime|Now listening on: http:&#x2F;&#x2F;localhost:50002020-06-16 20:41:34.9353|INFO|Microsoft.Hosting.Lifetime|Application started. Press Ctrl+C to shut down.2020-06-16 20:41:34.9353|INFO|Microsoft.Hosting.Lifetime|Hosting environment: Development2020-06-16 20:41:34.9353|INFO|Microsoft.Hosting.Lifetime|Content root path: D:\\workspace\\csharp\\WebApplication\\WebApplicationæ³¨æ„è¿™é‡Œçš„æ ¼å¼å·²ç»åº”ç”¨äº†NLogä¸­è®¾ç½®çš„å¸ƒå±€ï¼Œè¿™è¯´æ˜é…ç½®æ–‡ä»¶è¢«åŠ è½½äº†å¹¶æ²¡æœ‰é—®é¢˜ï¼Œä½†ä¸ºä»€ä¹ˆæ—¥å¿—çº§åˆ«çš„è®¾ç½®ä¸ç”Ÿæ•ˆå‘¢ï¼ŸåŸå› æ‰€åœ¨å…¶å®æ˜¯å› ä¸ºappsettings.{env}.jsonä¸­æ—¥å¿—çº§åˆ«çš„è®¾ç½®è¦†ç›–äº†Nlogä¸­çš„è®¾ç½®ã€‚åœ¨æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªAsp.Net Coreé¡¹ç›®æ—¶ï¼Œä¸€èˆ¬ä¼šå¸®æˆ‘ä»¬åˆ›å»ºå¥½ä¸¤ä¸ªappsettings.jsonæ–‡ä»¶ï¼šappsettings.json12345678910&#123; \"Logging\": &#123; \"LogLevel\": &#123; \"Default\": \"Information\", \"Microsoft\": \"Warning\", \"Microsoft.Hosting.Lifetime\": \"Information\" &#125; &#125;, \"AllowedHosts\": \"*\"&#125;appsettings.Development.json123456789&#123; \"Logging\": &#123; \"LogLevel\": &#123; \"Default\": \"Information\", \"Microsoft\": \"Warning\", \"Microsoft.Hosting.Lifetime\": \"Information\" &#125; &#125;&#125;æ³¨æ„è¿™é‡Œä½¿ç”¨.net core3.1åˆ›å»ºçš„æ¨¡æ¿ï¼Œ2.1åˆ›å»ºçš„é¡¹ç›®å‘½åç©ºé—´ä»¥åŠå¯¹åº”æ—¥å¿—çº§åˆ«ä¼šæœ‰æ‰€ä¸åŒã€‚ä»è¿™ä¸¤ä¸ªæ–‡ä»¶å¾ˆå®¹æ˜“å‘ç°é»˜è®¤çš„æ—¥å¿—çº§åˆ«ä¸ºInformationå¹¶ä¸”Microsoftå‘½åç©ºé—´ä¸‹çš„æ—¥å¿—çº§åˆ«è¢«è®¾ç½®æˆäº†Warningï¼Œå½“ç„¶ä¹Ÿå°±è¦†ç›–äº†NLogä¸­çš„è®¾ç½®ï¼Œä¸ºä»€ä¹ˆä¼šè¦†ç›–å‘¢ï¼Ÿå¯ä»¥æ€è€ƒä¸€ä¸‹ã€‚å¹¶ä¸”è¿™é‡Œçš„è®¾ç½®èƒ½å¤Ÿå½±å“åˆ°NLogä¸­çš„è®¾ç½®è¿˜æœ‰ä¸€ä¸ªå‰æï¼šå°†NLogæ·»åŠ åˆ°å®¹å™¨ï¼Œå¹¶ä¸”æ˜¯ä»¥DIçš„æ–¹å¼æ¥è·å–ILoggerï¼š12345678910private static IHostBuilder CreateHostBuilder(string[] args)&#123; return Host.CreateDefaultBuilder(args) .ConfigureLogging(logBuilder =&gt; &#123; logBuilder.ClearProviders() .AddNLog(\"NLog.config\"); &#125;) .ConfigureWebHostDefaults(webBuilder =&gt; webBuilder.UseStartup&lt;Startup&gt;());&#125;å¦‚æœä½ æ˜¯è¿™æ ·æ·»åŠ NLogï¼Œç„¶åä½¿ç”¨DIåœ¨éœ€è¦è®°å½•æ—¥å¿—çš„ç±»ä¸­æ³¨å…¥ILoggerçš„è¯ï¼Œé‚£å¾ˆå¯èƒ½å°±ä¸­æ‹›äº†ã€‚1private static readonly NLog.Logger _logger = NLog.LogManager.GetCurrentClassLogger();å¦‚æœä½ ä¸ä½¿ç”¨DIæ¥æ³¨å…¥è€Œæ˜¯ä½¿ç”¨ä¸Šé¢è¿™ä¸ªæ–¹å¼æ¥è·å–loggerï¼Œé‚£ä¹ˆå°±ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚ä½†æ˜¯æˆ‘ä»¬ä½¿ç”¨å®¹å™¨ä¸»è¦çš„ç›®çš„ä¸å°±æ˜¯å®¹å™¨å¯ä»¥æ›´æ–¹ä¾¿çš„ç®¡ç†å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å—ï¼Ÿæ›´å…·ä½“åœ°è¯´é‚£å°±æ˜¯DIã€‚é‚£è¿™ä¸ªé—®é¢˜è¯¥æ€æ ·è§£å†³å‘¢ï¼Ÿè§£å†³æ–¹æ³•è§£å†³çš„æ–¹æ³•å…¶å®å¾ˆç®€å•ï¼šé¦–å…ˆåˆ é™¤appsettings.{env}.jsonä¸­æ—¥å¿—ç›¸å…³çš„è®¾ç½®ï¼Œç„¶ååœ¨æ³¨å†ŒNLogæ—¶è®¾ç½®æœ€ä½æ—¥å¿—çº§åˆ«ä¸ºä½ æ‰€ç”¨åˆ°çš„æœ€ä½çº§åˆ«ï¼ˆå› ä¸ºå°±ç®—å»æ‰äº†è¿™äº›è®¾ç½®ï¼Œé»˜è®¤çš„æ—¥å¿—çº§åˆ«ä¹Ÿæ˜¯Informationï¼‰ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå°±ç›¸å½“äºæŠŠæ—¥å¿—çº§åˆ«æ§åˆ¶å’Œè¾“å‡ºéƒ½äº¤ç»™NLogæ¥ç®¡ç†ã€‚æ¯”å¦‚æˆ‘ä¸Šé¢çš„æ–‡ä»¶ä¸­ç»™è‡ªå·±é¡¹ç›®çš„å‘½åç©ºé—´è®¾ç½®äº†Traceå¹¶ä¸”å·²æ˜¯æœ€ä½çº§åˆ«ï¼Œé‚£ä¹ˆåœ¨åˆ é™¤appsettings.{env}.jsonä¸­æ—¥å¿—ç›¸å…³çš„è®¾ç½®åå¯ä»¥è¿™æ ·æ¥æ·»åŠ NLogï¼š1234567891011private static IHostBuilder CreateHostBuilder(string[] args)&#123; return Host.CreateDefaultBuilder(args) .ConfigureLogging(logBuilder =&gt; &#123; logBuilder.ClearProviders() .SetMinimumLevel(LogLevel.Trace) // æœ€ä½ä¸ºTrace .AddNLog(_configFileRelativePath); &#125;) .ConfigureWebHostDefaults(webBuilder =&gt; webBuilder.UseStartup&lt;Startup&gt;());&#125;æˆ–è€…ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨AddFilteræ¥ç»†åˆ†ä½¿å¾—æ—¥å¿—è¾“å‡ºå¯ä»¥â€œäº¤åˆ°â€NLogæ‰‹ä¸­ã€‚å½“ç„¶ï¼Œå¦‚æœä½ ä¸æƒ³åˆ é™¤åŸæœ‰çš„è®¾ç½®å¹¶ä¸”ä¸æƒ³é€šè¿‡SetMinimumLevel(LogLevel)æ–¹æ³•æ¥è®¾ç½®æœ€ä½çº§åˆ«ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨appsettings.{env}.jsonæ–‡ä»¶ä¸­è®¾ç½®å‘½åç©ºé—´å’Œç›¸åº”çš„æ—¥å¿—çº§åˆ«æ¥ä¿è¯NLogä¸­çš„è®¾ç½®ä¸ä¼šè¢«è¦†ç›–ï¼ˆå› ä¸ºè¿™ä¸ªæ–‡ä»¶åœ¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨è¢«åŠ è½½ï¼‰ã€‚æ€»ä¹‹ï¼Œåªéœ€è¦ä¿è¯NLogä¸­æ—¥å¿—çº§åˆ«çš„è®¾ç½®ä¸ä¼šå› ä¸ºè¯¥æ–‡ä»¶æˆ–è€…é»˜è®¤çš„Informationçº§åˆ«æ‰€è¦†ç›–å³å¯ã€‚å¦‚æœä¸ä½¿ç”¨DIæ¥è·å–çš„è¯é‚£å°±å½“æˆ‘æ²¡è¯´ã€‚ï¼ˆé€ƒ","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Asp.Net Core","slug":"Asp-Net-Core","permalink":"https://lolico.me/tags/Asp-Net-Core/"},{"name":"NLog","slug":"NLog","permalink":"https://lolico.me/tags/NLog/"}]},{"title":"éƒ¨ç½²Asp.Net Coreåº”ç”¨å¹¶ä½¿ç”¨Nginxåä»£æ—¶é‡åˆ°çš„ä¸¤ä¸ªé—®é¢˜","slug":"Two-problems-encountered-when-deploying-Asp-Net-Core-application-and-using-Nginx-to-reverse-proxy","date":"2020-06-12T12:08:19.000Z","updated":"2022-03-06T10:28:21.343Z","comments":true,"path":"2020/06/12/Two-problems-encountered-when-deploying-Asp-Net-Core-application-and-using-Nginx-to-reverse-proxy/","link":"","permalink":"https://lolico.me/2020/06/12/Two-problems-encountered-when-deploying-Asp-Net-Core-application-and-using-Nginx-to-reverse-proxy/","excerpt":"","text":"åœ¨ä¸€æ¬¡éƒ¨ç½²Asp.Net Coreåº”ç”¨æ—¶é‡åˆ°äº†è¿™ä¹ˆå‡ ä¸ªé—®é¢˜ï¼šå¯åŠ¨åº”ç”¨åï¼Œä»IConfigurationä¸­è·å–ä¸åˆ°è¿æ¥å­—ç¬¦ä¸²ã€‚ä½¿ç”¨nginxåä»£åï¼ŒIdentityæ¡†æ¶é¡µé¢è·³è½¬ååŸŸåè¢«æ”¹å†™æˆäº†localhostæˆ–è€…ä¸»æœºåã€‚é—®é¢˜ä¸€ï¼šåº”ç”¨ä½¿ç”¨sqliteæ•°æ®åº“ï¼Œåœ¨ç¨‹åºå¯åŠ¨ååˆ›å»ºå¹¶åˆå§‹åŒ–æ•°æ®åº“ï¼Œæœ¬åœ°å¼€å‘å¯åŠ¨å¹¶æ²¡æœ‰æŠ¥é”™ï¼Œä½†æ˜¯éƒ¨ç½²åˆ°æœåŠ¡å™¨å´è·å–ä¸åˆ°è¿æ¥å­—ç¬¦ä¸²ï¼ŒæŠ¥é”™ï¼šç™¾åº¦å’Œè°·æ­Œéƒ½æ— æœï¼Œæœ€åˆæˆ‘è¿˜ä»¥ä¸ºæ˜¯ç¨‹åºä¸­æŸä¸ªåœ°æ–¹å¯èƒ½å‡ºé”™äº†ï¼Œä½†æ˜¯åœ¨WSLä¸Šç»è¿‡å¤šæ¬¡æµ‹è¯•ï¼Œå‘ç°å¦‚æœæ²¡æœ‰åœ¨æ‰§è¡Œæ–‡ä»¶çš„ç›®å½•ä¸‹å¯åŠ¨äº†é¡¹ç›®æ‰ä¼šæŠ¥è¿™æ ·çš„é”™è¯¯ï¼Œè¿™ä¸ªé—®é¢˜å¾ˆå¥‡æ€ªï¼ŒçŒœæµ‹æ˜¯Directory.GetCurrentDirectory()è·å–è·¯å¾„å¯¼è‡´ï¼Œå¹¶æœªæ±‚è¯ã€‚çŸ¥é“äº†é—®é¢˜æ‰€åœ¨é‚£ä¹ˆè§£å†³çš„åŠæ³•å°±å¾ˆç®€å•äº†ï¼Œcdåˆ°æ‰§è¡Œæ–‡ä»¶ç›®å½•å¯åŠ¨å³å¯ã€‚é—®é¢˜äºŒï¼šè¿™ä¸ªé—®é¢˜æ˜¯å®å¡”é¢æ¿å¯¼è‡´çš„ï¼Œåœ¨è®¾ç½®åä»£çš„å‘é€åŸŸååï¼Œå¹¶æ²¡æœ‰ååº”åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨é¢æ¿ä¸Šè®¾ç½®proxy_set_header Host $host;åæ–‡ä»¶ä¸­å¹¶æ²¡æœ‰æ”¹è¿‡æ¥ï¼Œä¾æ—§æ˜¯localhostæˆ–è€…$hostnameï¼Œä¹Ÿå°±å¯¼è‡´äº†é¡µé¢è·³è½¬æ—¶åŸŸåå˜æˆäº†localhostæˆ–è€…ä¸»æœºåã€‚è§£å†³çš„åŠæ³•å¾ˆç®€å•ï¼Œåªéœ€è¦æ‰‹åŠ¨ä¿®æ”¹nginxé…ç½®æ–‡ä»¶ä¸­çš„åä»£å‘é€åŸŸåå³å¯ã€‚åœ¨è¿™ä¹‹å‰ï¼Œå…¶å®è¿˜é‡åˆ°äº†ä¸€ä¸ªå’Œnginxåä»£ç›¸å…³çš„é—®é¢˜ï¼šå¦‚æœä½¿ç”¨nginxæ¥ä»£ç†ç›®å½•ï¼Œä»è€Œå®ç°ä¸€ä¸ªåŸŸåä¸‹éƒ¨ç½²å¤šä¸ªé¡¹ç›®ï¼Œè¿™æ ·åšä¹‹åå°±å¯¼è‡´Asp.net Coreåº”ç”¨å…¨éƒ¨404ï¼Œç½‘ä¸Šæœç´¢ä¸€ç•ªï¼Œæœ‰äº›ç±»ä¼¼çš„é—®é¢˜è§£ç­”æåˆ°ä½¿ç”¨Microsoft.AspNetCore.HttpOverridesåŒ…ï¼Œä½†æ˜¯æˆ‘ç…§ç€æ“ä½œä¸€ç•ªåä¾æ—§æ²¡ç”¨ï¼Œç›®å‰æ¯”è¾ƒç¬¨çš„è§£å†³åŠæ³•å°±æ˜¯mvcçš„è·¯ç”±å‰æ‰‹åŠ¨åŠ å‰ç¼€ï¼Œæ›´å¥½çš„åŠæ³•ç›®å‰æ²¡æœ‰æ‰¾åˆ°ï¼Œå¦‚æœä½ çŸ¥é“ï¼Œè¿˜è¯·è¯„è®ºå‘ŠçŸ¥~","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Asp.Net Core","slug":"Asp-Net-Core","permalink":"https://lolico.me/tags/Asp-Net-Core/"},{"name":"Nginx","slug":"Nginx","permalink":"https://lolico.me/tags/Nginx/"}]},{"title":"è§£å†³JetBrainsäº§å“ä¸­æ— æ³•ä½¿ç”¨éå•†åº—å‘è¡Œç‰ˆæœ¬çš„WSLçš„é—®é¢˜","slug":"Using-custom-WSL-in-jetbrains-product","date":"2020-05-19T09:48:45.000Z","updated":"2022-03-06T10:28:21.347Z","comments":true,"path":"2020/05/19/Using-custom-WSL-in-jetbrains-product/","link":"","permalink":"https://lolico.me/2020/05/19/Using-custom-WSL-in-jetbrains-product/","excerpt":"","text":"JetBrainsäº§å“å¯¹äºWSLæä¾›äº†ä¸€å®šçš„æ”¯æŒï¼Œä½†æ˜¯å…¶åªæ”¯æŒMicrosoft Storeä¸­å‘è¡Œçš„WSLï¼Œå¯¹äºç±»ä¼¼ArchWSLè¿™ç§éå•†åº—å‘è¡Œç‰ˆï¼Œåœ¨é…ç½®å·¥å…·é“¾æ—¶å´ä¸èƒ½å¤Ÿè¢«å‘ç°ã€‚ä¸‹é¢ç»™å‡ºä¸¤ä¸ªæ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ç”±äºæˆ‘ç›®å‰åªä½¿ç”¨è¿‡ArchWSLè¿™ä¸ªéå•†åº—å‘è¡Œç‰ˆçš„WSLï¼Œæ‰€ä»¥ä¸‹é¢ä»¥ArchWSLä¸ºä¾‹ï¼Œå¯¹äºå…¶ä»–ç‰ˆæœ¬çš„WSLï¼Œç†è®ºä¸Šä¹Ÿè¡Œå¾—é€šã€‚ç¬¬ä¸€ç§æ–¹æ³•å¾ˆç®€å•ï¼Œåªéœ€è¦å¤åˆ¶æ‰§è¡Œæ–‡ä»¶åˆ°æŒ‡å®šç›®å½•åªéœ€å°†Arch.exeæ–‡ä»¶æ‹·è´ä¸€ä»½åˆ°C:\\Users\\lolico\\AppData\\Local\\Microsoft\\WindowsAppsç›®å½•ä¸‹å³å¯ã€‚æ³¨æ„ï¼Œå¦‚æœä½ å®‰è£…äº†å¤šä¸ªArchï¼Œåœ¨æ‹·è´æ—¶éœ€è¦å°†æ¯ä¸ªç‰ˆæœ¬å¯¹åº”çš„æ‰§è¡Œæ–‡ä»¶éƒ½æ‹·è´åˆ°WindowsAppsç›®å½•ä¸‹ã€‚ç¬¬äºŒç§æ–¹æ³•æ˜¯ç½‘ä¸Šæœç´¢åˆ°çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”åœ¨RubyMineå®˜æ–¹æ–‡æ¡£ä¸­æåˆ°äº†è¿™ä¸ªæ–¹æ³•ä»¥RubyMineä¸ºä¾‹ï¼Œä¿®æ”¹wsl.distributions.xmlæ–‡ä»¶ï¼š123456&lt;descriptor&gt; &lt;id&gt;Arch&lt;/id&gt; &lt;microsoft-id&gt;Arch&lt;/microsoft-id&gt; &lt;executable-path&gt;Arch.exe&lt;/executable-path&gt; &lt;presentable-name&gt;Arch Linux&lt;/presentable-name&gt;&lt;/descriptor&gt;executable-pathä½¿ç”¨æ‰§è¡Œæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚wsl.distributions.xmlæ–‡ä»¶ä½äºäº§å“å¯¹åº”çš„é…ç½®æ–‡ä»¶å¤¹ä¸‹ï¼Œå¯¹äºä¸åŒç‰ˆæœ¬ï¼Œé…ç½®æ–‡ä»¶å¤¹ä½ç½®å¯èƒ½ä¸ä¸€æ ·ã€‚æ—§ç‰ˆæœ¬è½¯ä»¶çš„é…ç½®æ–‡ä»¶å¤¹åœ¨%HOMEPATH%ä¸‹ï¼Œæ­¤æ—¶è¯¥æ–‡ä»¶ä½äºé…ç½®æ–‡ä»¶å¤¹ä¸‹çš„config\\optionsç›®å½•ä¸­ã€‚åœ¨2020.1ç‰ˆæœ¬ï¼Œé…ç½®æ–‡ä»¶å¤¹è¿ç§»åˆ°äº†%HOMEPATH%\\AppData\\Roaming\\JetBrainsä¸‹ï¼Œæ­¤æ—¶è¯¥æ–‡ä»¶ä½äºé…ç½®æ–‡ä»¶å¤¹ä¸‹çš„optionsç›®å½•ä¸­ã€‚ç”±äºæˆ‘ä¸€ç›´ä½¿ç”¨ToolBoxæ¥å®‰è£…å¹¶ç®¡ç†è¿™äº›è½¯ä»¶ï¼Œæ‰€ä»¥è¯´å¦‚æœä½ å¹¶ä¸æ˜¯ä»ToolBoxä¸­å®‰è£…çš„è½¯ä»¶ï¼Œæ–°ç‰ˆæœ¬çš„é…ç½®æ–‡ä»¶å¤¹å¯èƒ½ä»ç„¶åœ¨%HOMEPATH%ä¸‹ã€‚æœ€åï¼Œè¿˜æƒ³è¯´ä¸€å¥ï¼Œåœ¨ä½¿ç”¨å•†åº—å‘è¡Œç‰ˆæ—¶æˆ‘ä»¬å¯ä»¥ç”¨ç±»ä¼¼\\\\wsl$\\Ubuntuè¿™ç§è·¯å¾„æ¥è®¿é—®WSLçš„æ ¹ç›®å½•ï¼Œåœ¨ä½¿ç”¨éå•†åº—å‘è¡Œç‰ˆæ—¶å´ä¸è¡Œï¼Œè§£å†³çš„åŠæ³•è¿˜æ˜¯ä¸Šé¢æåˆ°ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼Œæ‹·è´æ–‡ä»¶åˆ°WindowsAppsä¹‹åå³å¯ä½¿ç”¨\\\\wsl$\\Archæ¥è®¿é—®Archçš„æ ¹ç›®å½•ã€‚å‚è€ƒï¼š^ Custom WSL distributions^ Support custom WSL distributive (not from Microsoft Store)","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"WSL","slug":"WSL","permalink":"https://lolico.me/tags/WSL/"},{"name":"IDEA","slug":"IDEA","permalink":"https://lolico.me/tags/IDEA/"},{"name":"WebStorm","slug":"WebStorm","permalink":"https://lolico.me/tags/WebStorm/"},{"name":"PyCharm","slug":"PyCharm","permalink":"https://lolico.me/tags/PyCharm/"}]},{"title":"SpringBoot 2.x AOPé»˜è®¤ä½¿ç”¨CGLIBä»£ç†","slug":"SpringBoot2-AOP-uses-cglib-proxy-by-default","date":"2020-05-03T11:18:32.000Z","updated":"2022-03-06T10:28:21.343Z","comments":true,"path":"2020/05/03/SpringBoot2-AOP-uses-cglib-proxy-by-default/","link":"","permalink":"https://lolico.me/2020/05/03/SpringBoot2-AOP-uses-cglib-proxy-by-default/","excerpt":"åœ¨ä¸€æ¬¡å¶ç„¶æƒ…å†µä¸‹å‘ç°SpringBootå¼€å‘çš„åº”ç”¨åœ¨æ²¡æœ‰ä½¿ç”¨@EnableAspectJAutoProxyæ³¨è§£çš„æƒ…å†µä¸‹ï¼ŒAOPè¿˜æ˜¯å¯ä»¥æ­£å¸¸å·¥ä½œã€‚ä¸ç»å¼•èµ·äº†æˆ‘çš„æ³¨æ„ï¼Œéšåä¾¿çŒœæµ‹SpringBootä¸­æ˜¯å¦å­˜åœ¨ä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»åœ¨ä¸ä½¿ç”¨æ³¨è§£çš„æƒ…å†µä¸‹å®Œæˆè‡ªåŠ¨é…ç½®å¹¶å¼€å¯äº†AOPã€‚","text":"åœ¨ä¸€æ¬¡å¶ç„¶æƒ…å†µä¸‹å‘ç°SpringBootå¼€å‘çš„åº”ç”¨åœ¨æ²¡æœ‰ä½¿ç”¨@EnableAspectJAutoProxyæ³¨è§£çš„æƒ…å†µä¸‹ï¼ŒAOPè¿˜æ˜¯å¯ä»¥æ­£å¸¸å·¥ä½œã€‚ä¸ç»å¼•èµ·äº†æˆ‘çš„æ³¨æ„ï¼Œéšåä¾¿çŒœæµ‹SpringBootä¸­æ˜¯å¦å­˜åœ¨ä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»åœ¨ä¸ä½¿ç”¨æ³¨è§£çš„æƒ…å†µä¸‹å®Œæˆè‡ªåŠ¨é…ç½®å¹¶å¼€å¯äº†AOPã€‚åœ¨Ideaä¸­å°è¯•æœç´¢AopAutoConfigurationï¼Œæœç„¶ä¸å‡ºæ‰€æ–™ï¼Œæœ‰è¿™ä¹ˆä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»ï¼š123456789101112131415161718192021222324252627@Configuration(proxyBeanMethods = false)@ConditionalOnProperty(prefix = \"spring.aop\", name = \"auto\", havingValue = \"true\", matchIfMissing = true)public class AopAutoConfiguration &#123; @Configuration(proxyBeanMethods = false) @ConditionalOnClass(Advice.class) static class AspectJAutoProxyingConfiguration &#123; @Configuration(proxyBeanMethods = false) @EnableAspectJAutoProxy(proxyTargetClass = false) @ConditionalOnProperty(prefix = \"spring.aop\", name = \"proxy-target-class\", havingValue = \"false\", matchIfMissing = false) static class jdkDynamicAutoProxyConfiguration &#123; &#125; @Configuration(proxyBeanMethods = false) @EnableAspectJAutoProxy(proxyTargetClass = true) @ConditionalOnProperty(prefix = \"spring.aop\", name = \"proxy-target-class\", havingValue = \"true\", matchIfMissing = true) static class CglibAutoProxyConfiguration &#123; &#125; &#125; // ...&#125;å¯ä»¥çœ‹åˆ°@ConditionalOnPropertyæ³¨è§£ä¸­matchIfMissingå±æ€§çš„è®¾ç½®ï¼Œä¹Ÿæ­£æ˜¯è¿™ä¸ªå±æ€§çš„è®¾ç½®ä½¿å¾—æˆ‘ä»¬åœ¨ä¸ä½¿ç”¨@EnableAspectJAutoProxyæ³¨è§£å¼€å¯AOPçš„æƒ…å†µä¸‹ï¼ŒAOPä¹Ÿå¯ä»¥æ­£å¸¸å·¥ä½œã€‚ä»è¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»ä¸­è¿˜èƒ½å¤Ÿçœ‹å‡ºAOPé»˜è®¤ä½¿ç”¨Cglibä»£ç†ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬ä½¿ç”¨@EnableAspectJAutoProxyæ³¨è§£å»æŒ‡å®šé»˜è®¤ä¸ä½¿ç”¨Cglibä»£ç†ï¼Œæœ‰æ²¡æœ‰ç”¨å‘¢ï¼Ÿç»è¿‡æµ‹è¯•å‘ç°ï¼Œä½¿ç”¨@EnableAspectJAutoProxyæ³¨è§£æ˜¾ç¤ºæŒ‡å®šæ˜¯æ²¡æœ‰ç”¨çš„ã€‚é‚£ä¹ˆè¯¥å¦‚ä½•è®¾ç½®é»˜è®¤ä½¿ç”¨jdkåŠ¨æ€ä»£ç†å‘¢ï¼Ÿæ ¹æ®è‡ªåŠ¨é…ç½®ç±»èƒ½çŸ¥é“ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨application.propertiesä¸­æŒ‡å®šspring.aop.proxy-target-class=falseæˆ–è€…è®¾ç½®spring.aop.auto=falseå…³é—­aopè‡ªåŠ¨é…ç½®åè‡ªè¡Œä½¿ç”¨@EnableAspectJAutoProxyæ³¨è§£è¿›è¡Œè®¾ç½®ã€‚å¹¶ä¸”å¦‚æœæŸ¥çœ‹SpringBoot1.5.xä¸­çš„è¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»ä¼šå‘ç°é»˜è®¤æ˜¯ä½¿ç”¨jdkåŠ¨æ€ä»£ç†ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆåœ¨SpringBoot2.xä¸­æ”¹ä¸ºé»˜è®¤ä½¿ç”¨Cglibäº†å‘¢ï¼Ÿä½¿ç”¨jdkåŠ¨æ€ä»£ç†ä¼šå­˜åœ¨ä¸€ä¸ªä»£ç†é—®é¢˜ï¼šç›®æ ‡å¯¹è±¡ä¸€å®šè¦å®ç°æ¥å£ã€‚å› ä¸ºjdkåŠ¨æ€ä»£ç†æ˜¯åŸºäºæ¥å£çš„ï¼Œå¹¶ä¸”æ„å‘³ç€å½“ä½¿ç”¨@Autowiredæ³¨å…¥ä¸€ä¸ªä½¿ç”¨jdkä»£ç†ç”Ÿæˆçš„å¯¹è±¡æ—¶å¿…é¡»ä½¿ç”¨æ¥å£ã€‚å°±åƒè¿™æ ·ï¼š12@AutowiredUserService userService;ä¸€æ—¦ä½¿ç”¨å®ç°ç±»çš„æ–¹å¼è¿›è¡Œæ³¨å…¥å°±ä¼šå¤±è´¥ï¼š12@AutowiredUserServiceImpl userService;ä½¿ç”¨Cglibä»£ç†å°±ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼ŒåŸå› å°±åœ¨äºCglibæ˜¯ä½¿ç”¨å­ç±»çš„æ–¹å¼è¿›è¡Œä»£ç†ã€‚å½“æŸ¥çœ‹ç±»ä¼¼@EnableCachingã€@EnableAsyncã€@EnableTransactionManagementæ³¨è§£ä¸­proxyTargetClasså±æ€§çš„æ³¨é‡Šï¼Œæˆ‘ä»¬è¿˜ä¼šå‘ç°æ³¨é‡Šä¸­è¯´åˆ°ï¼Œè¿™ä¸ªå±æ€§è®¾ç½®ä¸ºtrueåä¼šå½±å“Springç®¡ç†çš„æ‰€æœ‰Beanä½¿ç”¨çš„ä»£ç†æ–¹å¼ã€‚ä½†æ˜¯æˆ‘ç»è¿‡æµ‹è¯•å‘ç°å…¶ä»–æ³¨è§£çš„è¿™ä¸ªå±æ€§è®¾ç½®ä¸ºtrueæ—¶å¹¶ä¸ä¼šå½±å“@EnableAsyncçš„ä»£ç†æ–¹å¼ã€‚ä½†æ˜¯@EnableAsyncçš„è¿™ä¸ªå±æ€§è®¾ç½®ä¸ºtrueåä¼šå½±å“å…¶ä»–æ³¨è§£ä¸‹å¯¹è±¡çš„ä»£ç†æ–¹å¼ã€‚(SpringBoot2.2.2ä¸‹æµ‹è¯•)æ³¨æ„ï¼šproxyTargetClasså±æ€§é»˜è®¤ä¸ºfalseæ—¶å¹¶ä¸æ„å‘³ç€å¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰å®ç°æ¥å£ï¼Œç”Ÿæˆä»£ç†ç±»å°±ä¼šå¤±è´¥ï¼Œè¿™ç§æƒ…å†µä¸‹Springä¼šä½¿ç”¨Cglibä»£ç†ã€‚å‚è€ƒï¼š^ Use @EnableTransactionManagement(proxyTargetClass = true)^ @EnableTransactionManagement proxyTargetClass not control by spring.aop.proxyTargetClass","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"https://lolico.me/tags/Spring/"},{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://lolico.me/tags/SpringBoot/"},{"name":"AOP","slug":"AOP","permalink":"https://lolico.me/tags/AOP/"}]},{"title":"SpringSecurity è·¨åŸŸ","slug":"Spring-Security-CORS","date":"2020-04-26T16:01:12.000Z","updated":"2022-03-06T10:28:21.343Z","comments":true,"path":"2020/04/26/Spring-Security-CORS/","link":"","permalink":"https://lolico.me/2020/04/26/Spring-Security-CORS/","excerpt":"å†™åœ¨å‰é¢åœ¨SpringSecurityä¸­é…ç½®è·¨åŸŸï¼Œæˆ‘ç›¸ä¿¡æ‰€æœ‰ç”¨è¿‡SpringSecurityçš„äººåº”è¯¥éƒ½çŸ¥é“ï¼Œå› ä¸ºå®åœ¨æ˜¯å¤ªç®€å•äº†ã€‚é‚£æˆ‘ä¸ºä»€ä¹ˆè¿˜è¦å†™è¿™ç¯‡æ–‡ç« å‘¢ï¼Ÿå†™è¿™ç¯‡æ–‡ç« çš„ç›®çš„å½“ç„¶ä¸æ˜¯å»è§£é‡Šå¦‚ä½•é…ç½®è·¨åŸŸï¼Œè€Œæ˜¯é€šè¿‡åˆ†æSpringå¯¹è·¨åŸŸæ”¯æŒçš„æºç æ¥æ„Ÿå—è®¾è®¡ä¸­çš„ä¼˜é›…ã€‚å…ˆå£°æ˜ä¸€ä¸‹å¼€å‘ç¯å¢ƒï¼šSpringBootï¼š2.2.2","text":"å†™åœ¨å‰é¢åœ¨SpringSecurityä¸­é…ç½®è·¨åŸŸï¼Œæˆ‘ç›¸ä¿¡æ‰€æœ‰ç”¨è¿‡SpringSecurityçš„äººåº”è¯¥éƒ½çŸ¥é“ï¼Œå› ä¸ºå®åœ¨æ˜¯å¤ªç®€å•äº†ã€‚é‚£æˆ‘ä¸ºä»€ä¹ˆè¿˜è¦å†™è¿™ç¯‡æ–‡ç« å‘¢ï¼Ÿå†™è¿™ç¯‡æ–‡ç« çš„ç›®çš„å½“ç„¶ä¸æ˜¯å»è§£é‡Šå¦‚ä½•é…ç½®è·¨åŸŸï¼Œè€Œæ˜¯é€šè¿‡åˆ†æSpringå¯¹è·¨åŸŸæ”¯æŒçš„æºç æ¥æ„Ÿå—è®¾è®¡ä¸­çš„ä¼˜é›…ã€‚å…ˆå£°æ˜ä¸€ä¸‹å¼€å‘ç¯å¢ƒï¼šSpringBootï¼š2.2.2æ­£æ–‡æ—¢ç„¶è¯´åˆ°SpringSecurityé…ç½®è·¨åŸŸï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å…ˆç®€å•å¤ä¹ ä¸€ä¸‹å¦‚ä½•é…ç½®è·¨åŸŸã€‚é…ç½®è·¨åŸŸæˆ‘ä»¬éƒ½çŸ¥é“é›†æˆSpringSecurityåé…ç½®è·¨åŸŸæˆ‘ä»¬åªéœ€è¦åœ¨ç»§æ‰¿WebSecurityConfigurerAdapterç±»ï¼Œé‡å†™configure(HttpSecurity http)æ–¹æ³•ï¼Œå¼€å¯corså¹¶æä¾›ä¸€ä¸ªè·¨åŸŸé…ç½®æºå³å¯ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼šå¼€å¯è·¨åŸŸ123456789101112131415161718192021222324@Overrideprotected void configure(HttpSecurity http) throws Exception &#123; http.sessionManagement() .sessionCreationPolicy(SessionCreationPolicy.STATELESS) // å‰åç«¯åˆ†ç¦» .and() .csrf().disable() // ç¦ç”¨csrf .cors(); // è·¨åŸŸ // ... çœç•¥å…¶ä»–é…ç½®&#125;// æä¾›ä¸€ä¸ªCorsConfigurationSource// è¿™é‡Œç›´æ¥æ³¨å†ŒæˆBeanå³å¯ï¼Œæ³¨æ„æ–¹æ³•åå¿…é¡»æ˜¯corsConfigurationSourceï¼Œåé¢ä¼šè§£é‡Š// ä¹Ÿå¯ä»¥cors().configurationSource(corsConfigurationSource())æŒ‡å®š@Beanpublic CorsConfigurationSource corsConfigurationSource() &#123; CorsConfiguration configuration = new CorsConfiguration(); configuration.addAllowedOrigin(\"*\"); // æ ¹æ®å®é™…çš„éœ€è¦å»è®¾ç½® configuration.addAllowedMethod(\"*\"); // åŒä¸Š configuration.addAllowedHeader(\"*\"); configuration.setMaxAge(3600L); configuration.setAllowCredentials(true); UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource(); source.registerCorsConfiguration(\"/**\", configuration); return source;&#125;å°±å¦‚å‰é¢æ‰€è¯´ï¼Œåªéœ€è¦å¼€å¯corså†æä¾›ä¸€ä¸ªè·¨åŸŸé…ç½®æºå³å¯ã€‚æ–¹æ³•å¾ˆç®€å•ï¼Œä½†è¿™é‡Œæœ‰ä¸ªå‘éœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚æš´éœ²å…¬å…±æ¥å£æ—¶è·¨åŸŸçš„ä¸€ä¸ªå‘å¦‚æœæˆ‘ä»¬è¿˜é‡å†™äº†configure(WebSecurity web)æ–¹æ³•ï¼Œä½¿ç”¨web.ignoring().antMatchers(ignorePaths)å»æš´éœ²ä¸€ä¸ªå…¬å…±æ¥å£â€™/pubâ€™é‚£ä¹ˆä¸Šé¢çš„è·¨åŸŸé…ç½®å¯¹è¿™ä¸ªæ¥å£æ¥è¯´å°±æ²¡ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ¥å£ä¼šå‡ºç°è·¨åŸŸé—®é¢˜ã€‚ç„¶è€Œæˆ‘ä»¬åŸæœ¬å°±æ˜¯ä¸ºäº†æä¾›å…¬å…±æ¥å£â€™/pubâ€™ï¼Œä½†ç°åœ¨å´æœ‰è·¨åŸŸé—®é¢˜ï¼Œé‚£æ€ä¹ˆèƒ½è¡Œï¼ï¼ï¼ï¼ˆä¸€èˆ¬æ¥è¯´è¿™ä¸ªæ–¹æ³•æ˜¯å¯¹é™æ€èµ„æºè®¾ç½®ç›´æ¥æ”¾è¡Œï¼Œè€Œä¸æ˜¯å…¬å…±æ¥å£ï¼ï¼‰é‚£è¿™åˆ°åº•æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºSpringSecurityé…ç½®è·¨åŸŸæ”¯æŒï¼Œæ˜¯é€šè¿‡CorsFilterè¿‡æ»¤å™¨æ¥å®ç°çš„ï¼Œæˆ‘ä»¬web.ignoring()ä¸­è®¾ç½®åå¯¹åº”çš„æ¥å£è¯·æ±‚å°±ä¸ä¼šç»è¿‡CorsFilteræ¥å¤„ç†ï¼Œè¿™ä¸ªæ¥å£å½“ç„¶å°±å­˜åœ¨è·¨åŸŸé—®é¢˜äº†ï¼ä¹‹æ‰€ä»¥è¯´è¿™ä¸ªæ–¹æ³•æ˜¯å¯¹é™æ€èµ„æºè®¾ç½®ç›´æ¥æ”¾è¡Œï¼Œè€Œä¸æ˜¯å…¬å…±æ¥å£ä¹Ÿæ˜¯è¿™ä¸ªåŸå› ï¼Œé‚£æ­£ç¡®çš„æ–¹æ³•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿˜æ˜¯configure(HttpSecurity http)æ–¹æ³•ï¼š123456789101112@Overrideprotected void configure(HttpSecurity http) throws Exception &#123; http.sessionManagement() .sessionCreationPolicy(SessionCreationPolicy.STATELESS) // å‰åç«¯åˆ†ç¦» .and() .csrf().disable() // ç¦ç”¨csrf .cors() // è·¨åŸŸ .and() .authorizeRequests() .antMatchers(\"/pub/**\").permitAll() // åŒ¿åé€šè¿‡è®¤è¯ .anyRequest().authenticated() //å‰©ä¸‹çš„ä»»ä½•è¯·æ±‚éƒ½éœ€è¦è®¤è¯&#125;corsæ–¹æ³•ç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹cors()æ–¹æ³•ï¼Œç‚¹è¿›è¿™ä¸ªæ–¹æ³•çœ‹çœ‹ï¼Œå…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯åº”ç”¨äº†ä¸€ä¸ªCorsConfigureré…ç½®ç±»ã€‚å¦‚æœçœ‹è¿‡SpringSecurityè‡ªåŠ¨é…ç½®ï¼Œå¯¹å½¢å¦‚xxxConfigurerçš„ç±»ååº”è¯¥ä¸é™Œç”Ÿã€‚è¿™ä¸ªConfigurerå…¶å®å°±æ˜¯åœ¨â€FilterChainâ€ä¸Šæ·»åŠ äº†ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œå³CorsFilteræˆ‘ä»¬éƒ½çŸ¥é“CorsFilterçš„æ„é€ æ–¹æ³•éœ€è¦ä¸€ä¸ªCorsConfigurationSourceï¼Œåœ¨è¯·æ±‚åˆ°æ¥æ—¶ï¼Œä½¿ç”¨CorsProcessoræ ¹æ®æä¾›çš„CorsConfigurationå»å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ï¼ˆåœ¨CorsFilterä¸­é»˜è®¤æ˜¯DefaultCorsProcessorï¼‰è€ŒCorsConfigurationæ˜¯é€šè¿‡CorsConfigurationSource#getCorsConfigurationæ–¹æ³•è·å¾—çš„ï¼Œæ‰€ä»¥è¯´æ€ä¹ˆè·å¾—CorsConfigurationSourceè‡³å…³é‡è¦ã€‚è¿˜è®°å¾—ä¸Šé¢åœ¨é…ç½®CorsConfigurationSourceæ—¶ï¼Œæˆ‘ä»¬ç›´æ¥æ³¨å†ŒBeanè€Œä¸æ˜¯é€šè¿‡configurationSource()æ–¹æ³•æŒ‡å®šå—ï¼Ÿè¿™ç§æ–¹æ³•ä¸ºä»€ä¹ˆæ˜¯å¯è¡Œçš„å‘¢ï¼Ÿæ¥çœ‹ä¸€ä¸‹CorsConfigureræ˜¯å¦‚ä½•è·å¾—CorsConfigurationSourceå¹¶æ„é€ CorsFilterçš„ï¼šCorsConfigurer#getCorsFilter1234567891011121314151617181920212223242526272829303132333435363738private CorsFilter getCorsFilter(ApplicationContext context) &#123; //å¦‚æœæŒ‡å®šäº†CorsConfigurationSourceï¼Œé‚£ä¹ˆç”¨æŒ‡å®šçš„ if (this.configurationSource != null) &#123; return new CorsFilter(this.configurationSource); &#125; boolean containsCorsFilter = context.containsBeanDefinition(CORS_FILTER_BEAN_NAME); //å¦‚æœå®¹å™¨ä¸­å·²ç»æœ‰åå­—æ˜¯â€™corsFilterâ€˜çš„beanï¼Œåˆ™ç”¨å·²ç»æœ‰çš„ if (containsCorsFilter) &#123; return context.getBean(CORS_FILTER_BEAN_NAME, CorsFilter.class); &#125; boolean containsCorsSource = context.containsBean(CORS_CONFIGURATION_SOURCE_BEAN_NAME); //å¦‚æœæ—¢æ²¡æœ‰æŒ‡å®šï¼Œå®¹å™¨ä¸­ä¹Ÿä¸å­˜åœ¨åå­—æ˜¯â€™corsFilterâ€˜çš„CorsFilter //é‚£ä¹ˆçœ‹ä¸€ä¸‹å®¹å™¨ä¸­æœ‰æ²¡æœ‰åå­—æ˜¯â€™corsConfigurationSourceâ€˜çš„CorsConfigurationSource //å¦‚æœæœ‰ï¼Œå–å‡ºæ¥ä½œä¸ºCorsConfigurationSource if (containsCorsSource) &#123; CorsConfigurationSource configurationSource = context.getBean(CORS_CONFIGURATION_SOURCE_BEAN_NAME, CorsConfigurationSource.class); return new CorsFilter(configurationSource); &#125; //å¦‚æœä¹Ÿæ²¡æœ‰corsConfigurationSourceï¼Œçœ‹çœ‹ç±»è·¯å¾„ä¸‹å­˜ä¸å­˜åœ¨HandlerMappingIntrospectorè¿™ä¸ªç±» boolean mvcPresent = ClassUtils.isPresent(HANDLER_MAPPING_INTROSPECTOR,context.getClassLoader()); if (mvcPresent) &#123; //å¦‚æœå­˜åœ¨ return MvcCorsFilter.getMvcCorsFilter(context); &#125; return null;&#125;static class MvcCorsFilter &#123; //å†…éƒ¨ç±» private static final String HANDLER_MAPPING_INTROSPECTOR_BEAN_NAME = \"mvcHandlerMappingIntrospector\"; private static CorsFilter getMvcCorsFilter(ApplicationContext context) &#123; if (!context.containsBean(HANDLER_MAPPING_INTROSPECTOR_BEAN_NAME)) &#123; throw new NoSuchBeanDefinitionException(HANDLER_MAPPING_INTROSPECTOR_BEAN_NAME, \"A Bean named \" + HANDLER_MAPPING_INTROSPECTOR_BEAN_NAME +\" of type \" + HandlerMappingIntrospector.class.getName() + \" is required to use MvcRequestMatcher. Please ensure Spring Security &amp; Spring MVC are configured in a shared ApplicationContext.\"); &#125; // ä»å®¹å™¨ä¸­å–å‡ºHandlerMappingIntrospectorä½œä¸ºCorsConfigurationSource HandlerMappingIntrospector mappingIntrospector = context.getBean(HANDLER_MAPPING_INTROSPECTOR_BEAN_NAME, HandlerMappingIntrospector.class); return new CorsFilter(mappingIntrospector); &#125; &#125;è·å–CorsConfigurationSourceå¹¶æ„é€ CorsFilterçš„æ­¥éª¤æ³¨é‡Šé‡Œå†™çš„å¾ˆæ¸…æ¥šäº†ï¼Œæ­£å¸¸æ¥è¯´æˆ‘ä»¬é…ç½®è·¨åŸŸé…ç½®æºä¸ç®¡æ˜¯ç›´æ¥æŒ‡å®šä¹Ÿå¥½ï¼Œè¿˜æ˜¯æ³¨å†ŒæˆBeanä¹Ÿå¥½ï¼ˆæ³¨æ„Beanåå­—çš„è¦æ±‚ï¼‰ï¼Œéƒ½æ˜¯å¯ä»¥è¢«è·å–åˆ°çš„ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿçš„ç¡®æ˜¯è¿™æ ·åšçš„ï¼ˆç›´æ¥æä¾›ä¸€ä¸ªCorsConfigurationSourceï¼‰ã€‚ä½†ä¸ºä»€ä¹ˆæœ€åæœ‰MvcCorsFilter.getMvcCorsFilter(context)è¿™æ ·ä¸€ä¸ªè°ƒç”¨ï¼Ÿé€šè¿‡è¿™ä¸ªæ–¹æ³•é‡ŒæŠ›å‡ºçš„å¼‚å¸¸ä¿¡æ¯ä¸éš¾çŒœæµ‹åˆ°æ˜¯SpringSecurityä¸ºäº†å…¼å®¹SpringMVCä¸­é…ç½®è·¨åŸŸçš„æ–¹å¼ã€‚è¿˜è®°å¾—ä¸ä½¿ç”¨SpringSecurityæ—¶å¦‚ä½•åœ¨SpringMVCä¸­é…ç½®æ”¯æŒè·¨åŸŸå—ï¼Ÿä¸¤ç§æ–¹å¼ï¼šå°†@CrossOriginæ³¨è§£æ ‡æ³¨åœ¨æ”¯æŒè·¨åŸŸçš„æ¥å£ä¸Šé‡å†™WebMvcConfigurer#addCorsMappingsæ–¹æ³•è¿›è¡Œå…¨å±€é…ç½®çœ‹åˆ°è¿™é‡Œä½ å¯èƒ½ä¼šçŒœæµ‹ï¼šæ˜¯ä¸æ˜¯HandlerMappingIntrospectorå®ç°äº†CorsConfigurationSourceï¼Œå¹¶ä¸”æ˜¯æ ¹æ®ä¸Šé¢ä¸¤ç§æ–¹å¼çš„é…ç½®æ¥è¿”å›è·¨åŸŸé…ç½®çš„å‘¢ï¼Ÿäº‹å®ä¸Šï¼Œçš„ç¡®æ˜¯è¿™æ ·çš„ã€‚ä¸ºäº†ä¾¿äºç†è§£åé¢ç»™å‡ºçš„ä»£ç ï¼Œå…ˆæ¥çœ‹çœ‹CorsFilterç±»å’ŒCorsConfigurationSourceæ¥å£ï¼šCorsConfigurationSource1234public interface CorsConfigurationSource &#123; @Nullable CorsConfiguration getCorsConfiguration(HttpServletRequest request);&#125;è·¨åŸŸé…ç½®æºï¼Œå®ç°ç±»è¦å®ç°getCorsConfigurationæ–¹æ³•è¿”å›ä¸€ä¸ªCorsConfigurationè·¨åŸŸé…ç½®ï¼Œå…¶ä¸­åŒ…å«å…è®¸é‚£äº›åŸŸã€è¯·æ±‚æ–¹æ³•ã€è¯·æ±‚å¤´ï¼Œæ˜¯å¦å…è®¸æºå¸¦å‡­è¯ï¼Œç¼“å­˜æ—¶é—´æ˜¯å¤šä¹…ï¼Œå…è®¸æºå¸¦çš„å¤´å±æ€§ç­‰ä¿¡æ¯ã€‚CorsConfigurationSourceæœ‰äº”ä¸ªå®ç°ç±»ï¼šCorsInterceptorHandlerMappingIntrospectorPreFlightHandlerResourceHttpRequestHandlerUrlBasedCorsConfigurationSourceCorsFilter123456789101112131415161718192021222324252627public class CorsFilter extends OncePerRequestFilter &#123; private final CorsConfigurationSource configSource; private CorsProcessor processor = new DefaultCorsProcessor(); public CorsFilter(CorsConfigurationSource configSource) &#123; Assert.notNull(configSource, \"CorsConfigurationSource must not be null\"); this.configSource = configSource; &#125; public void setCorsProcessor(CorsProcessor processor) &#123; Assert.notNull(processor, \"CorsProcessor must not be null\"); this.processor = processor; &#125; @Override protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException &#123; // è·å–CorsConfiguration CorsConfiguration corsConfiguration = this.configSource.getCorsConfiguration(request); // æ ¹æ®CorsConfigurationå¤„ç†è¯·æ±‚ boolean isValid = this.processor.processRequest(corsConfiguration, request, response); if (!isValid || CorsUtils.isPreFlightRequest(request)) &#123; return; &#125; filterChain.doFilter(request, response); &#125;&#125;DefaultCorsProcessor#processRequestä¸­æ ¹æ®è¯·æ±‚æ˜¯å¦è·¨åŸŸï¼Œæ˜¯å¦æ˜¯é¢„æ£€è¯·æ±‚ä»¥åŠCorsConfigurationç­‰ä¿¡æ¯æ¥å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†å’Œåœ¨å“åº”å¤´ä¸­å†™å…¥ä¸€äº›ä¿¡æ¯ã€‚å…·ä½“çš„æºç å°±ä¸åˆ†æäº†ï¼Œè¿˜æ˜¯æ¯”è¾ƒå¥½ç†è§£çš„ã€‚å‰ææ˜¯éœ€è¦å¯¹CORSæœ‰ä¸€å®šçš„äº†è§£ï¼Œå¯ä»¥çœ‹ä¸‹HTTPè®¿é—®æ§åˆ¶ï¼ˆCORSï¼‰è¿™ç¯‡æ–‡ç« ã€‚HandlerMappingIntrospectorHandlerMappingIntrospectoræ¯”è¾ƒç‰¹åˆ«ï¼Œä¸è¦è®¤ä¸ºè¿™æ˜¯ä¸ªæ‹¦æˆªå™¨ï¼Œâ€Introspectorâ€ç¿»è¯‘æˆä¸­æ–‡æ˜¯å†…çœè€…çš„æ„æ€ã€‚è¿™ä¸ªç±»åœ¨åˆå§‹åŒ–åä¼šè°ƒç”¨afterPropertiesSetæ–¹æ³•ï¼Œå°†å®¹å™¨ä¸­æ‰€æœ‰çš„HandlerMappingæ·»åŠ åˆ°è¯¥ç±»çš„handlerMappingsè¿™ä¸ªListä¸­ã€‚æ¥çœ‹ä¸€ä¸‹å®˜æ–¹å¯¹äºè¿™ä¸ªç±»çš„è§£é‡Šï¼š1234Helper class to get information from the HandlerMapping that would serve a specific request.Provides the following methods: - getMatchableHandlerMapping(javax.servlet.http.HttpServletRequest) â€” obtain a HandlerMapping to check request-matching criteria against. - getCorsConfiguration(javax.servlet.http.HttpServletRequest) â€” obtain the CORS configuration for the request.è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªå¸®åŠ©ç±»ï¼Œç”¨äºä»HandlerMappingä¸­è·å–è¯·æ±‚çš„ç‰¹å®šä¿¡æ¯ï¼Œæä¾›äº†ä¸¤ä¸ªæ–¹æ³•ã€‚ç¬¬ä¸€ä¸ªæ–¹æ³•ç”¨äºè·å–ä¸€ä¸ªMatchableHandlerMappingæ¥æ£€æŸ¥è¯·æ±‚åŒ¹é…æ¡ä»¶ï¼Œç¬¬äºŒä¸ªæ–¹æ³•ç”¨äºè·å–é€‚ç”¨äºè¿™ä¸ªè¯·æ±‚çš„CorsConfigurationè·¨åŸŸé…ç½®ã€‚æˆ‘ä»¬é‡ç‚¹å…³æ³¨ç¬¬äºŒä¸ªæ–¹æ³•ï¼šHandlerMappingIntrospector#getCorsConfiguration1234567891011121314151617181920212223242526272829public CorsConfiguration getCorsConfiguration(HttpServletRequest request) &#123; Assert.notNull(this.handlerMappings, \"Handler mappings not initialized\"); HttpServletRequest wrapper = new RequestAttributeChangeIgnoringWrapper(request); for (HandlerMapping handlerMapping : this.handlerMappings) &#123; HandlerExecutionChain handler = null; try &#123; handler = handlerMapping.getHandler(wrapper); // è·å–å¤„ç†æ‰§è¡Œé“¾ &#125; catch (Exception ex) &#123; // Ignore &#125; if (handler == null) &#123; continue; &#125; if (handler.getInterceptors() != null) &#123; //éå†æ‹¦æˆªå™¨ï¼Œå¦‚æœæ‹¦æˆªå™¨åŒæ—¶å®ç°äº†CorsConfigurationSourceåˆ™ç”¨è¿™ä¸ªæ‹¦æˆªå™¨ä½œä¸ºè·¨åŸŸé…ç½®æº for (HandlerInterceptor interceptor : handler.getInterceptors()) &#123; if (interceptor instanceof CorsConfigurationSource) &#123; return ((CorsConfigurationSource) interceptor).getCorsConfiguration(wrapper); &#125; &#125; &#125; //ä»æ‰§è¡Œé“¾è·å–å¤„ç†å™¨ï¼Œå¦‚æœå¤„ç†å™¨æœ¬èº«ä¹Ÿå®ç°äº†CorsConfigurationSourceï¼Œåˆ™ç”¨å¤„ç†å™¨ä½œä¸ºè·¨åŸŸé…ç½®æº if (handler.getHandler() instanceof CorsConfigurationSource) &#123; return ((CorsConfigurationSource) handler.getHandler()).getCorsConfiguration(wrapper); &#125; &#125; return null;&#125;è¿™ä¸ªCorsConfigurationSourceå®ç°ç±»æ ¹æ®è¯·æ±‚ä»HandlerMappingä¸­è·å–è·å–HandlerExecutionChainæ‰§è¡Œé“¾ï¼Œå†ä¾æ¬¡ä»æ‰§è¡Œé“¾çš„æ‹¦æˆªå™¨å’Œå¤„ç†å™¨ä¸­è·å–CorsConfigurationSourceï¼Œå¦‚æœè·å–åˆ°äº†å†è°ƒç”¨å…¶HandlerMappingIntrospector#getCorsConfigurationæ–¹æ³•è¿”å›è·¨åŸŸé…ç½®ã€‚å…·ä½“æ¥è¯´å°±æ˜¯é‚£ä¸¤ä¸ªifåˆ¤æ–­ã€‚æ‰€ä»¥è¿™ä¹ˆè¯´æ¥çš„è¯ï¼ŒHandlerMappingIntrospectorè™½ç„¶å®ç°äº†CorsConfigurationSourceä½†å…¶æœ¬è´¨æœ‰ç‚¹åƒä¸€ä¸ªå§”æ‰˜ç±»ï¼Ÿå®ƒæ£€æŸ¥è¯·æ±‚å¯¹åº”çš„æ‰§è¡Œé“¾ä¸Šçš„æ‹¦æˆªå™¨å’Œå¤„ç†å™¨æœ‰æ²¡æœ‰å®ç°CorsConfigurationSourceï¼Œå¦‚æœæœ‰ï¼Œå†å§”æ‰˜ç»™è¿™ä¸ªCorsConfigurationSourceæ¥è·å–CorsConfigurationã€‚æ‰€ä»¥è¯´å¦‚æœæˆ‘ä»¬åœ¨ä¸€ä¸ªControllerçš„æ¥å£ä¸Šæ ‡æ³¨äº†@CrossOriginæ³¨è§£ï¼Œé‚£ä¹ˆå¯¹åº”çš„ï¼Œåœ¨æ‹¦æˆªå™¨ä¸­è·å–ä¸åˆ°CorsConfigurationï¼Œå°±ä¼šä»è¿™ä¸ªHandlerä¸Šè·å–åˆ°CorsConfigurationï¼Œä¹Ÿå°±æ˜¯å°†@CrossOriginæ³¨è§£ä¸­æä¾›çš„ä¿¡æ¯å°è£…æˆäº†CorsConfigurationã€‚é‚£ä¸ºä»€ä¹ˆè¿˜ä¼šå…ˆæ£€æŸ¥æ‰§è¡Œé“¾ä¸­çš„æ‹¦æˆªå™¨å‘¢ï¼Ÿå› ä¸ºSpringMVCä¸­è¿˜æœ‰ç¬¬äºŒç§æ–¹æ³•é…ç½®è·¨åŸŸæ”¯æŒï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢æåˆ°çš„é‡å†™WebMvcConfigurer#addCorsMappingsæ–¹æ³•è¿›è¡Œå…¨å±€é…ç½®ã€‚é‚£ä¸ºä»€ä¹ˆé‡å†™è¿™ä¸ªæ–¹æ³•æ·»åŠ è·¨åŸŸé…ç½®æœ€åä¼šæ³¨å†Œæˆæ‹¦æˆªå™¨å‘¢ï¼Ÿï¼ˆä¸€ä¸ªå®ç°äº†CorsConfigurationSourceçš„æ‹¦æˆªå™¨ï¼‰è¿™å°±è¦è¯´åˆ°SpringBootåœ¨WebMvcçš„è‡ªåŠ¨é…ç½®ã€WebMvcConfigurerå’ŒHandlerMappingäº†ã€‚å¦‚æœä½ æœ‰ä»”ç»†çœ‹è¿‡SpringBootåœ¨SpringMVCçš„è‡ªåŠ¨é…ç½®æ–¹é¢çš„æºç ï¼Œä½ ä¸€å®šçŸ¥é“WebMvcConfigurationSupportè¿™ä¸ªæœ€ä¸»è¦çš„é…ç½®ç±»åœ¨æ³¨å†ŒHandlerMappingçš„æ—¶å€™ä¼šä»ä¸€ä¸ªCorsRegistyä¸­è·å–è·¨åŸŸé…ç½®ï¼šï¼ˆè¿™é‡Œä»¥RequestMappingHandlerMappingä¸ºä¾‹ï¼‰WebMvcConfigurationSupport.java12345678910111213141516171819202122@Beanpublic RequestMappingHandlerMapping requestMappingHandlerMapping( @Qualifier(\"mvcContentNegotiationManager\") ContentNegotiationManager contentNegotiationManager, @Qualifier(\"mvcConversionService\") FormattingConversionService conversionService, @Qualifier(\"mvcResourceUrlProvider\") ResourceUrlProvider resourceUrlProvider) &#123; RequestMappingHandlerMapping mapping = createRequestMappingHandlerMapping(); mapping.setOrder(0); mapping.setInterceptors(getInterceptors(conversionService, resourceUrlProvider)); mapping.setContentNegotiationManager(contentNegotiationManager); mapping.setCorsConfigurations(getCorsConfigurations()); //è®¾ç½®è·¨åŸŸé…ç½® // ...çœç•¥ä¸€å¤§æ®µset return mapping;&#125;protected final Map&lt;String, CorsConfiguration&gt; getCorsConfigurations() &#123; if (this.corsConfigurations == null) &#123; CorsRegistry registry = new CorsRegistry(); addCorsMappings(registry); //å‘CorsRegistryä¸­æ·»åŠ è·¨åŸŸæ˜ å°„ this.corsConfigurations = registry.getCorsConfigurations(); //è·å–è·¨åŸŸé…ç½® &#125; return this.corsConfigurations;&#125;addCorsMappings()æ–¹æ³•æ˜¯ä¸ªç©ºæ–¹æ³•ï¼Œå¹¶ä¸”åªæœ‰DelegatingWebMvcConfigurationç±»é‡å†™äº†è¿™ä¸ªæ–¹æ³•ã€‚å®é™…ä¸ŠWebMvcConfigurationSupportè¿™ä¸ªç±»ä¸­ç”¨@Beanè¿™ä¸ªå¯ä¼ é€’çš„æ³¨è§£æ ‡æ³¨äº†å¾ˆå¤šæ–¹æ³•ä½†è¯¥ç±»ä¸Šå¹¶æ²¡æœ‰æ ‡æ³¨@Configurationï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜ä¼šèµ·åˆ°é…ç½®ç±»çš„ä½œç”¨å‘¢ï¼Ÿå…¶å®çœŸæ­£çš„é…ç½®ç±»æ˜¯DelegatingWebMvcConfigurationã€‚DelegatingWebMvcConfigurationåœ¨DelegatingWebMvcConfigurationè¿™ä¸ªç±»ä¸Šæœ‰ä¸ª@Configurationæ³¨è§£ï¼Œå¹¶ä¸”ç»§æ‰¿è‡ªWebMvcConfigurationSupportï¼Œå®é™…ä¸Šå®ƒå°±æ˜¯ä¸ªå§”æ‰˜ç±»ã€‚å¯ä»¥è¯´è¿™ä¸ªç±»æ‰æ˜¯çœŸæ­£çš„é…ç½®ç±»ï¼Œå»çœ‹çœ‹DelegatingWebMvcConfigurationè¿™ä¸ªç±»ï¼Œç›¸ä¿¡ä½ ä¸€å®šä¼šå‘ç°ä»€ä¹ˆï¼ï¼ï¼DelegatingWebMvcConfigurationä¸­æœ‰WebMvcConfigurerCompositeè¿™ä¹ˆä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”å°†å®¹å™¨ä¸­æ‰€æœ‰WebMvcConfigureræ³¨å…¥è¿›æ¥ï¼šDelegatingWebMvcConfiguration.java12345678910111213@Configuration(proxyBeanMethods = false)public class DelegatingWebMvcConfiguration extends WebMvcConfigurationSupport &#123; // WebMvcConfigurerå¤åˆç±» private final WebMvcConfigurerComposite configurers = new WebMvcConfigurerComposite(); // å°†å®¹å™¨ä¸­æ‰€æœ‰WebMvcConfigureræ·»åŠ åˆ°WebMvcConfigurerComposite @Autowired(required = false) public void setConfigurers(List&lt;WebMvcConfigurer&gt; configurers) &#123; if (!CollectionUtils.isEmpty(configurers)) &#123; this.configurers.addWebMvcConfigurers(configurers); &#125; &#125; // ...çœç•¥&#125;å¦‚æœä½ å»çœ‹äº†ä¸€ä¸‹è¿™ä¸ªç±»çš„æºç ï¼Œä½ å°±ä¼šå‘ç°WebMvcConfigurerä¸­æœ‰çš„æ–¹æ³•è¿™ä¸ªç±»éƒ½æœ‰ï¼Œå¹¶ä¸”è¿™ä¸ªå§”æ‰˜ç±»ä»…ä»…æ˜¯å°†è¯·æ±‚å§”æ‰˜ç»™configurersï¼Œæ¥çœ‹çœ‹é‡å†™çš„addCorsMappingsæ–¹æ³•ï¼šDelegatingWebMvcConfiguration#addCorsMappings1234@Overrideprotected void addCorsMappings(CorsRegistry registry) &#123; this.configurers.addCorsMappings(registry);&#125;è°ƒç”¨WebMvcConfigurerComposite#addCorsMappingsï¼Œæ˜¾è€Œæ˜“è§WebMvcConfigurerCompositeæ˜¯ä¸ªå¤åˆçš„WebMvcConfigurerï¼Œä»–ä¹Ÿå®ç°äº†WebMvcConfigurerå¹¶ä¸”å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªList&lt;WebMvcConfigurer&gt; delegatesåˆ—è¡¨ï¼Œå®ç°çš„æ‰€æœ‰æ–¹æ³•ä¼šä¾æ¬¡è°ƒç”¨åˆ—è¡¨ä¸­WebMvcConfigurerå¯¹åº”çš„æ–¹æ³•ã€‚ï¼ˆå¹¶ä¸”ä½ è¿˜èƒ½å‘ç°WebMvcConfigurerä¸­çš„æ–¹æ³•éƒ½æ˜¯ä½œä¸ºå›è°ƒæ–¹æ³•å¹¶ä¸”å¤§éƒ¨åˆ†æ˜¯è¿”å›voidçš„ï¼‰è¯´åˆ°è¿™é‡Œï¼Œä¸å¾—ä¸è¯´ä¸€ä¸ªé¢˜å¤–è¯ã€‚å¦‚æœçœ‹Springæºç æ¯”è¾ƒå¤šçš„è¯ï¼Œå°±ä¼šå‘ç°Springä¸­ç±»çš„å‘½åéƒ½æœ‰è§„å¾‹å¯å¾ªå¹¶ä¸”æŸäº›åç¼€éƒ½æ˜¯æœ‰ç‰¹å®šæ„ä¹‰çš„ï¼Œæ¯”å¦‚xxxCompositeã€xxxConfigurerã€Delegatingxxxã€xxxDelegatorç­‰ç­‰ï¼Œè¿™æ ·æˆ‘ä»¬çœ‹åˆ°è¿™ä¸ªç±»åå°±ç«‹é©¬èƒ½çŒœåˆ°å®ƒçš„ä½œç”¨ã€‚æˆ‘ä»¬å¹³æ—¶å¯¹WebMvcè¿›è¡Œä¸€äº›é…ç½®éƒ½æ˜¯å®ç°WebMvcConfigurerç±»ï¼Œé‡å†™å…¶ä¸­çš„æ–¹æ³•ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š1234567891011121314@Configurationpublic class WebMvcConfig implements WebMvcConfigurer &#123; @Override public void addCorsMappings(CorsRegistry registry) &#123; registry.addMapping(\"/**\") .allowedOrigins(\"*\") .allowedHeaders(\"*\") .allowedMethods(\"*\") .allowCredentials(true) .maxAge(3600); &#125; // ...&#125;è¯´åˆ°è¿™ï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äºWebMvcConfigurationSupport#getCorsConfigurationsæ–¹æ³•ä¼šå›è°ƒå®¹å™¨ä¸­æ‰€æœ‰WebMvcConfigurerå®ç°ç±»çš„addCorsMappings()æ–¹æ³•ï¼Œå‘CorsRegistryä¸­æ·»åŠ è·¨åŸŸæ˜ å°„ï¼Œç„¶åå†å–å‡ºCorsConfigurationè¿”å›ï¼š12345678protected final Map&lt;String, CorsConfiguration&gt; getCorsConfigurations() &#123; if (this.corsConfigurations == null) &#123; CorsRegistry registry = new CorsRegistry(); addCorsMappings(registry); //å‘CorsRegistryä¸­æ·»åŠ è·¨åŸŸæ˜ å°„ this.corsConfigurations = registry.getCorsConfigurations(); //è·å–è·¨åŸŸé…ç½® &#125; return this.corsConfigurations;&#125;æœ€åååº”åˆ°AbstractHandlerMappingä¸­çš„å°±æ˜¯ä½¿ç”¨CorsConfigurationæ³¨å†Œä¸€ä¸ªCorsInterceptoræ‹¦æˆªå™¨ï¼Œè¿™ä¸ªæ‹¦æˆªå™¨æ˜¯AbstractHandlerMappingä¸­çš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œç»§æ‰¿è‡ªHandlerInterceptorAdapterï¼Œå¹¶ä¸”å®ç°äº†CorsConfigurationSourceã€‚çœ‹åˆ°è¿™é‡Œï¼Œå¦‚æœæ²¡æœ‰äº†è§£è¿‡HandlerMappingï¼Œå¯èƒ½ä¼šä¸€å¤´é›¾æ°´ï¼Œå¯ä»¥çœ‹çœ‹æˆ‘çš„è¿™ç¯‡æ–‡ç« æºç è§’åº¦åˆ†æSpringå®¹å™¨å¯åŠ¨é˜¶æ®µæ³¨å†ŒControllerå¤„ç†å™¨çš„æµç¨‹ï¼Œè™½ç„¶ä¸æ˜¯è®²HandlerMappingï¼Œä½†æ˜¯ç›¸ä¿¡åœ¨çœ‹å®Œåï¼Œä¼šå¯¹HandlerMappingæœ‰ä¸€ä¸ªç†è§£ã€‚CorsInterceptor12345678910111213141516171819private class CorsInterceptor extends HandlerInterceptorAdapter implements CorsConfigurationSource &#123; @Nullable private final CorsConfiguration config; public CorsInterceptor(@Nullable CorsConfiguration config) &#123; this.config = config; &#125; @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler)throws Exception &#123; return corsProcessor.processRequest(this.config, request, response); &#125; @Override @Nullable public CorsConfiguration getCorsConfiguration(HttpServletRequest request) &#123; return this.config; &#125;&#125;è¿™ä¸ªç±»åªé‡å†™äº†æ‹¦æˆªå™¨çš„preHandleæ–¹æ³•ï¼Œå…¶ä»–æ–¹æ³•éƒ½æ˜¯ç©ºæ–¹æ³•ã€‚è€Œä¸”ä½ èƒ½å‘ç°è¿™ä¸ªpreHandleæ–¹æ³•ä¸­çš„å†…å®¹å’ŒCorsFilter#doFilterInternalæ–¹æ³•åŸºæœ¬æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œéƒ½æ˜¯æ ¹æ®CorsConfigurationä½¿ç”¨è·¨åŸŸå¤„ç†å™¨å¤„ç†è¯·æ±‚ã€‚çœ‹åˆ°è¿™é‡Œï¼Œç°åœ¨åº”è¯¥çŸ¥é“å…³äºHandlerMappingIntrospectorçš„çŒœæµ‹æ˜¯æ²¡é”™çš„ï¼Œå¹¶ä¸”çŸ¥é“äº†HandlerMappingIntrospectoræ˜¯å¦‚ä½•ä¸SpringMVCä¸¤ç§æ”¯æŒè·¨åŸŸçš„é…ç½®æ–¹å¼è”ç³»èµ·æ¥çš„ï¼Œè¿™é‡Œå†æ¬¡æ€»ç»“ä¸€ä¸‹ï¼šé¦–å…ˆè·å–è¯·æ±‚å¯¹åº”çš„æ‰§è¡Œé“¾ä¸Šçš„æ‹¦æˆªå™¨ï¼Œåˆ¤æ–­æ‹¦æˆªå™¨æœ‰æ²¡æœ‰å®ç°CorsConfigurationSourceï¼ˆCorsInterceptorç±»ï¼‰ï¼Œå¦‚æœæœ‰åˆ™è°ƒç”¨getCorsConfigurationè·å–CorsConfigurationåè¿”å›å¦‚æœæ‹¦æˆªå™¨ä¸Šè·å–å¤±è´¥ï¼Œåˆ™åˆ¤æ–­å¤„ç†å™¨æœ‰æ²¡æœ‰å®ç°CorsConfigurationSourceï¼ˆPreFlightHandlerç±»ï¼‰ï¼Œå¦‚æœæœ‰åˆ™è°ƒç”¨getCorsConfigurationè·å–CorsConfigurationåè¿”å›ä»è€Œå®ç°äº†å…¼å®¹SpringMVCä¸­ä¸¤ç§é…ç½®è·¨åŸŸçš„æ–¹å¼ã€‚è¿™å…¶ä¸­æœ€å…³é”®çš„å‡ ç‚¹å°±åœ¨äºCorsConfigurerè·å–CorsConfigurationSourceå¹¶ä¸”æ„é€ CorsFilterçš„æ­¥éª¤ã€HandlerMappingIntrospectorè·å–CorsConfigurationçš„æ­¥éª¤ï¼Œè¿˜æœ‰Springå›è°ƒWebMvcConfigurerå¯¹HandlerMappingè¿›è¡Œè®¾ç½®è·¨åŸŸé…ç½®ç­‰ä¿¡æ¯çš„æ­¥éª¤å…¶ä¸­è¿˜æ¶‰åŠåˆ°äº†SpringMVCä¸­HandlerMappingã€HandlerExecutionChainã€Handlerã€Interceptorç­‰ç›¸å…³çŸ¥è¯†ã€‚æ ¹æ®è¿™æ¬¡çš„åˆ†æï¼Œèƒ½å¾—åˆ°å‡ ä¸ªç»“è®ºï¼šSpringMVCæ”¯æŒè·¨åŸŸä¸¤ç§æ–¹å¼ä¸€ä¸ªæ˜¯åŸºäºå¤„ç†å™¨å®ç°ï¼Œå¦ä¸€ä¸ªæ˜¯åŸºäºæ‹¦æˆªå™¨å®ç°ã€‚SpringSecurityè·¨åŸŸæ˜¯åŸºäºè¿‡æ»¤å™¨ï¼Œå¹¶ä¸”å…¼å®¹äº†SpringMVCçš„ä¸¤ç§é…ç½®ï¼ˆä½¿ç”¨HandlerMappingIntrospectorâ€œæ¡¥æ¥â€ï¼‰ã€‚SpringSecurityä¸­çš„CorsConfigurerä½¿ç”¨HandlerMappingIntrospectoræ¥å…¼å®¹SpringMVCè·¨åŸŸä¸¤ç§æ–¹å¼ã€‚HandlerMappingIntrospectorè·å–CorsConfigurationæ—¶çš„ä¼˜å…ˆçº§æ˜¯å…ˆæ‹¦æˆªå™¨ï¼Œå†å¤„ç†å™¨ã€‚SpringBootæ³¨å†ŒHandlerMappingæˆ–è€…è¯´é€šè¿‡WebMvcAutoConfigurationè‡ªåŠ¨é…ç½®æ¥å¯¹WebMvcå¿…è¦çš„ç»„ä»¶è¿›è¡Œè£…é…å’Œæ³¨å…¥ã€‚WebMvcConfigureræ˜¯DelegatingWebMvcConfigurationç±»é©±åŠ¨WebMvcConfigurerCompositeæ¥è¿›è¡Œå›è°ƒçš„ã€‚å¹¶ä¸”ç»è¿‡è¿™æ¬¡çš„æºç é˜…è¯»ï¼Œä¹Ÿæ˜¯è¶³è¶³æ„Ÿå—åˆ°Springè®¾è®¡ä¸Šçš„ä¼˜é›…ã€‚å†™åœ¨æœ€åæ–‡ç« å†™çš„æœ‰ç‚¹ä¹±ï¼Œå¹¶ä¸”æœ‰ç‚¹è·³è·ƒã€‚ä»…ä»…æ˜¯è·Ÿç€æ–‡ç« æ¥çœ‹å¯èƒ½ä¸å¤§èƒ½çœ‹æ‡‚ï¼Œæœ€å¥½åœ¨ç”µè„‘ä¸Šæ ¹æ®æºç æ¥é˜…è¯»ã€‚è¿™ç¯‡æ–‡ç« ä¹Ÿä»…ä»…æ˜¯ä½œä¸ºæˆ‘ä¸ªäººåœ¨ä¸€æ¬¡è¸©å‘åå¥½å¥‡å¿ƒå¤§æ³•ï¼Œé˜…è¯»æºç åçš„ä¸€æ®µæ€»ç»“ä»¥åŠæ„Ÿæ‚Ÿå§ï¼Œè‡ªå·±èƒ½çœ‹æ‡‚å¹¶ä¸”ä»¥åè¿˜èƒ½çœ‹æ‡‚ä¹Ÿå°±æ»¡æ„äº†ã€‚å¦‚æœè¿™ç¯‡æ–‡ç« æœ‰å¹¸è¢«ä½ åˆ·åˆ°å¹¶ä¸”ä½ èƒ½å¤Ÿçœ‹æ‡‚æˆ‘æƒ³è¡¨è¾¾çš„é‚£æˆ‘è‡ªç„¶æ˜¯æ›´é«˜å…´ã€‚å…¶å®è¿™ä¸ªåšå®¢å­˜åœ¨çš„ç†ç”±ä¹Ÿä»…ä»…æ˜¯ä¸ºäº†è®°å½•è‡ªå·±å­¦ä¹ è¿‡ç¨‹ä¸­çš„æ„Ÿæ‚Ÿå’Œæ€»ç»“ï¼Œä¾¿äºè‡ªå·±ä»¥åå›é¡¾ï¼Œæ¯•ç«Ÿæˆ‘æ¯”è¾ƒå¥å¿˜ã€‚æ‰€ä»¥éœ€è¦è®°å½•ä¸‹æœ‰å¿…è¦çš„ï¼Œå¹¶ä¸”åœ¨ä¸ªäººçœ‹æ¥ï¼Œè¿™ç¯‡æ–‡ç« å¹²è´§è¿˜æ˜¯è¶³è¶³çš„ï¼Œæ‰€ä»¥è¯´æ›´åŠ æœ‰å¿…è¦è®°å½•ã€‚å…¶å®åœ¨å†™æ–‡ç« ä¹‹åˆæˆ‘ä¹Ÿä¸æƒ³å†™è¿™ä¹ˆä¸€ç¯‡æ–‡ç« ï¼Œå› ä¸ºå®åœ¨æ˜¯å¤ªéš¾å†™æ˜ç™½äº†ï¼Œå¹¶ä¸”ç”±äºæ¶‰åŠåˆ°çš„ä¸œè¥¿æ¯”è¾ƒåˆ†æ•£å¾ˆéš¾è¿›è¡Œç»„ç»‡ï¼Œä¹Ÿå¯èƒ½æˆ‘è¡¨è¾¾èƒ½åŠ›å·®çš„åŸå› å§ï¼Œä½†æœ€ç»ˆè¿˜æ˜¯èŠ±äº†ä¸€ä¸‹åˆåŠ ä¸€æ™šä¸Šï¼Œåœ¨ä¸æ–­ä¿®æ”¹ä¸‹äº§å‡ºäº†è¿™ä¹ˆä¸€ç¯‡å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿çš„æ–‡ç« ï¼Œå¯èƒ½æ˜¯å†™è¿‡çš„å­—æ•°æœ€å¤šçš„æ–‡ç« äº†å§ğŸ˜¥ã€‚æ–‡ç« ä¸­å¯èƒ½æœ‰é”™åˆ«å­—ä¹Ÿå¯èƒ½æœ‰é”™è¯¯çš„å†…å®¹ï¼Œå¦‚æœä½ å‘ç°æ–‡ç« æœ‰ä»€ä¹ˆé”™è¯¯çš„åœ°æ–¹æˆ–è€…æ²¡è¡¨è¿°æ¸…æ¥šçš„å†…å®¹ï¼Œæ¬¢è¿åœ¨è¯„è®ºä¸­äº¤æµã€‚","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"https://lolico.me/tags/Spring/"},{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://lolico.me/tags/SpringBoot/"},{"name":"Web","slug":"Web","permalink":"https://lolico.me/tags/Web/"},{"name":"Security","slug":"Security","permalink":"https://lolico.me/tags/Security/"},{"name":"CORS","slug":"CORS","permalink":"https://lolico.me/tags/CORS/"}]},{"title":"VueJSå­¦ä¹ ç¬”è®°ï¼šæ€»ç»“","slug":"vue","date":"2020-04-24T14:47:31.000Z","updated":"2022-03-06T10:28:21.347Z","comments":true,"path":"2020/04/24/vue/","link":"","permalink":"https://lolico.me/2020/04/24/vue/","excerpt":"","text":"å†™åœ¨å‰é¢åŸæœ¬æ˜¯æ‰“ç®—å†™ä¸€ä¸ªVueJSå­¦ä¹ ç¬”è®°ä¸“æ ï¼Œç”¨äºè®°å½•vueå­¦ä¹ è¿‡ç¨‹ä¸­çš„ä¸€äº›æ„Ÿæƒ³ï¼Œä½†åæ¥æƒ³æƒ³ï¼Œå¦‚æ­¤åšå®åœ¨æ˜¯å¤ªéº»çƒ¦ï¼Œå¹¶ä¸”æ¯ç¯‡æ–‡ç« çš„ç¯‡å¹…ä¹Ÿä¼šæ¯”è¾ƒçŸ­ï¼Œæ‰€ä»¥ç°åœ¨è€ƒè™‘ç›´æ¥åœ¨è¿™ä¸€ç¯‡åšæ–‡ä¸­è¿›è¡Œæ€»ç»“ã€‚å°†å­¦ä¹ è¿‡ç¨‹ä¸­çš„æ„Ÿè°¢æˆ–è€…è¸©å¾—ä¸€äº›å‘ç›´æ¥è®°å½•åœ¨æ­¤ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œå°½é‡åšåˆ°æ¯ä¸ªç‚¹éƒ½çŸ­å°ç²¾æ‚ã€‚è¯¥ç¯‡åšæ–‡å¹¶éæœ€ç»ˆç¨¿ï¼Œå†…å®¹ä¼šéšç€æ–‡ç« çš„æ›´æ–°ä¸æ–­ä¸°å¯Œã€‚å®˜æ–¹ä¸­æ–‡æ–‡æ¡£ï¼šGuideï¼šhttps://cn.vuejs.org/v2/guide/APIï¼šhttps://cn.vuejs.org/v2/api/Style Guideï¼šhttps://cn.vuejs.org/v2/style-guide/Examplesï¼šhttps://cn.vuejs.org/v2/examples/ä¸‹é¢å¤§éƒ¨åˆ†å†…å®¹éƒ½å¯ä»¥ä»å®˜æ–¹æ–‡æ¡£ä¸­æ‰¾åˆ°ã€‚è¿™ç¯‡æ€»ç»“ï¼Œä»…å°†æˆ‘ä¸ªäººè®¤ä¸ºæœ‰å¿…è¦è®°å½•çš„è¿›è¡Œæ±‡æ€»ï¼Œä»¥æ–¹ä¾¿åç»­æŸ¥æ‰¾å’Œå›é¡¾ã€‚æ­£æ–‡åœ¨é€‰é¡¹å±æ€§æˆ–è€…å›è°ƒæ–¹æ³•ä½¿ç”¨ç®­å¤´å‡½æ•°ä¼šå¯¼è‡´åœ¨æ–¹æ³•å†…ä½¿ç”¨thisè·å–ä¸åˆ°vueå®ä¾‹é”™è¯¯ç¤ºèŒƒ12created: () =&gt; console.log(this.a)vm.$watch('a', newValue =&gt; this.myMethod())äº‹ä»¶æ€»çº¿æœºåˆ¶ä¸‹ï¼Œç›‘å¬æ€»çº¿äº‹ä»¶çš„å›è°ƒæ–¹æ³•è¦ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Œå¦åˆ™thisæŒ‡ä»£æ€»çº¿å®ä¾‹ã€‚12345mounted()&#123; // æŒ‚è½½åæ‰§è¡Œ EventBus.$on('event-name',data =&gt; &#123; // è¿™é‡Œè¦ç”¨ç®­å¤´å‡½æ•°ï¼Œå¦åˆ™thisæŒ‡ä»£EventBus this.data = data; &#125;)&#125;v-bindã€v-onã€v-slotæŒ‡ä»¤ä½¿ç”¨åŠ¨æ€æŒ‡ä»¤å‚æ•°ï¼ˆ2.6.0+ï¼‰123&lt;a :[attr]=\"value\"&gt;...&lt;/a&gt;&lt;a @[event]=\"value\"&gt;...&lt;/a&gt;&lt;template #[solt]&gt;...&lt;/template&gt;attrã€eventå’Œsoltä¼šä½œä¸ºä¸€ä¸ªjavascriptè¡¨è¾¾å¼è¿›è¡Œæ±‚å€¼åœ¨DOMä¸­ä½¿ç”¨æ¨¡æ¿æ—¶ï¼Œé¿å…ä½¿ç”¨å¤§å†™å­—ç¬¦æ¥å‘½åé”®åï¼Œå› ä¸ºæµè§ˆå™¨ä¼šæŠŠattributeåå…¨éƒ¨å¼ºåˆ¶è½¬æ¢ä¸ºå°å†™ã€‚æ•°æ®ä¸€èˆ¬æ˜¯ä»çˆ¶ç»„ä»¶æµå‘å­ç»„ä»¶çš„ï¼Œpropçš„å€¼ä¼šå› çˆ¶ç»„ä»¶ä¸­æ•°æ®çš„æ”¹å˜è€Œæ”¹å˜ã€‚ä¸è¦ä¿®æ”¹propçš„å€¼ï¼Œå¦‚æœä¸€å®šè¦è¿™ä¹ˆåšï¼Œè¯·ä½¿ç”¨è®¡ç®—å±æ€§æˆ–è€…dataã€‚è®¡ç®—å±æ€§é»˜è®¤åªæœ‰getterï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥æä¾›ä¸€ä¸ªsetterã€‚1234567891011121314computed: &#123; fullName: &#123; // getter get: function () &#123; return this.firstName + ' ' + this.lastName &#125;, // setter set: function (newValue) &#123; var names = newValue.split(' ') this.firstName = names[0] this.lastName = names[names.length - 1] &#125; &#125;&#125;çˆ¶ç»„ä»¶ä¸­çš„dataå¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯å­ç»„ä»¶çš„dataå±æ€§å¿…é¡»æ˜¯ä¸€ä¸ªæ–¹æ³•ã€‚ç”±äºJavaScriptçš„é™åˆ¶ï¼ŒVueä¸èƒ½æ£€æµ‹æ•°ç»„å’Œå¯¹è±¡çš„å˜åŒ–ã€‚ä¹Ÿå°±æ˜¯è¯´å¯¹å¯¹è±¡çš„å±æ€§æˆ–æ•°ç»„è¿›è¡Œä¿®æ”¹æ·»åŠ åˆ é™¤ä¸ä¼šååº”åˆ°è§†å›¾ä¸­ï¼ˆä½†å€¼çš„å´æ”¹å˜äº†ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨vm.$setå®ä¾‹æ–¹æ³•ï¼ˆå…¨å±€æ–¹æ³•çš„åˆ«åï¼‰ï¼Œæˆ–Vue.setå…¨å±€æ–¹æ³•ã€‚123456789var vm = new Vue(&#123; data:&#123; lisi:&#123; age: 16 &#125; &#125;&#125;)vm.lisi.age = 18; // ç›´æ¥å¯¹å¯¹è±¡å±æ€§è¿›è¡Œä¿®æ”¹æ˜¯ä¸ä¼šç›´æ¥å“åº”åˆ°è§†å›¾ä¸­vm.$set(this.lisi,'age',18); // å“åº”å¼v-ifå’Œv-showçš„å¼‚åŒï¼šv-ifæŒ‡ä»¤æ˜¯ç›´æ¥é”€æ¯å’Œé‡å»ºDOMè¾¾åˆ°è®©å…ƒç´ æ˜¾ç¤ºå’Œéšè—çš„æ•ˆæœv-showæŒ‡ä»¤é€šè¿‡ä¿®æ”¹å…ƒç´ çš„displayå±æ€§è®©å…¶æ˜¾ç¤ºæˆ–è€…éšè—ä½¿ç”¨v-cloakæŒ‡ä»¤è§£å†³é¡µé¢åŠ è½½æ—¶é—ªçƒçš„é—®é¢˜äº‹ä»¶ä¿®é¥°ç¬¦ã€æŒ‰é”®ä¿®é¥°ç¬¦ä»¥åŠç³»ç»Ÿä¿®é¥°é”®ä½¿ç”¨refå±æ€§åœ¨çˆ¶ç»„ä»¶ä¸­è°ƒç”¨å­ç»„ä»¶çš„æ–¹æ³•ã€‚123456789101112131415161718192021222324252627282930313233343536373839&lt;div id=\"app\"&gt; &lt;button @click=\"add\"&gt; Click this button &#123;&#123;count&#125;&#125; times.&lt;/button&gt; &lt;children ref=\"child\"&gt;&lt;/children&gt;&lt;/div&gt;&lt;template id=\"btn\"&gt; &lt;div&gt; &lt;button @click=\"add\"&gt; Click this button &#123;&#123;count&#125;&#125; times.&lt;/button&gt; &lt;/div&gt;&lt;/template&gt;&lt;script&gt; var btn = &#123; template: '#btn', data() &#123; return &#123; count: 0 &#125; &#125;, methods: &#123; add() &#123; this.count++; &#125; &#125; &#125; const vm = new Vue(&#123; el: '#app', data:&#123; count: 0 &#125;, methods: &#123; add() &#123; this.count++; this.$refs.child.add(); // è°ƒç”¨å­ç»„ä»¶æ–¹æ³• &#125; &#125;, components: &#123; 'children': btn &#125; &#125;)&lt;/script&gt;","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Vue.js","slug":"Vue-js","permalink":"https://lolico.me/tags/Vue-js/"}]},{"title":"ä¿®æ”¹è¯„è®ºæ’ä»¶ä¸ºgitalk","slug":"Change-comment-plugin-to-gitalk","date":"2020-04-24T08:45:20.000Z","updated":"2022-03-06T10:28:21.343Z","comments":true,"path":"2020/04/24/Change-comment-plugin-to-gitalk/","link":"","permalink":"https://lolico.me/2020/04/24/Change-comment-plugin-to-gitalk/","excerpt":"","text":"æ­£å¼å°†è¯„è®ºæ’ä»¶ç”±valineæ›´æ”¹ä¸ºgitalkï¼Œæé«˜äº†è¯„è®ºçš„é—¨æ§›ï¼Œä½†è€ƒè™‘åˆ°æ–‡ç« å—ä¼—ä»¥åŠåšå®¢ç±»å‹ï¼Œè¿˜æ˜¯å¯ä»¥æ¥å—çš„ã€‚ä¹‹å‰çš„è¯„è®ºä¸¢å¤±ï¼Œåç»­ä¹Ÿå¯èƒ½ä¼šè€ƒè™‘å›åˆ°valineã€‚","categories":[{"name":"ä¸æ­£å¸¸çš„æ–‡ç« ","slug":"ä¸æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E4%B8%8D%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"ï¼Ÿï¼Ÿï¼Ÿ","slug":"ï¼Ÿï¼Ÿï¼Ÿ","permalink":"https://lolico.me/tags/%EF%BC%9F%EF%BC%9F%EF%BC%9F/"}]},{"title":"VueJSå­¦ä¹ ç¬”è®°ï¼šè®°ä¸€æ¬¡thisæ— æ³•è·å–vueå®ä¾‹çš„å‘","slug":"Why-cannot-use-this-pointer-to-get-vue-instance","date":"2020-04-22T14:16:44.000Z","updated":"2022-03-06T10:28:21.347Z","comments":true,"path":"2020/04/22/Why-cannot-use-this-pointer-to-get-vue-instance/","link":"","permalink":"https://lolico.me/2020/04/22/Why-cannot-use-this-pointer-to-get-vue-instance/","excerpt":"ä¸è¦åœ¨é€‰é¡¹å±æ€§æˆ–å›è°ƒä¸Šä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Œæ¯”å¦‚created: () =&gt; console.log(this.a)æˆ–vm.$watch(&#39;a&#39;, newValue =&gt; this.myMethod())ã€‚å› ä¸ºç®­å¤´å‡½æ•°å¹¶æ²¡æœ‰thisï¼Œthisä¼šä½œä¸ºå˜é‡ä¸€ç›´å‘ä¸Šçº§è¯æ³•ä½œç”¨åŸŸæŸ¥æ‰¾ï¼Œç›´è‡³æ‰¾åˆ°ä¸ºæ­¢ï¼Œç»å¸¸å¯¼è‡´Uncaught TypeError: Cannot read property of undefinedæˆ–Uncaught TypeError: this.myMethod is not a functionä¹‹ç±»çš„é”™è¯¯ã€‚","text":"ä¸è¦åœ¨é€‰é¡¹å±æ€§æˆ–å›è°ƒä¸Šä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Œæ¯”å¦‚created: () =&gt; console.log(this.a)æˆ–vm.$watch(&#39;a&#39;, newValue =&gt; this.myMethod())ã€‚å› ä¸ºç®­å¤´å‡½æ•°å¹¶æ²¡æœ‰thisï¼Œthisä¼šä½œä¸ºå˜é‡ä¸€ç›´å‘ä¸Šçº§è¯æ³•ä½œç”¨åŸŸæŸ¥æ‰¾ï¼Œç›´è‡³æ‰¾åˆ°ä¸ºæ­¢ï¼Œç»å¸¸å¯¼è‡´Uncaught TypeError: Cannot read property of undefinedæˆ–Uncaught TypeError: this.myMethod is not a functionä¹‹ç±»çš„é”™è¯¯ã€‚é”™è¯¯ç¤ºèŒƒï¼š12345678910111213&lt;el-button type=\"primay\" icon=\"el-icon-plus\" @click=\"add\"&gt;&lt;/el-button&gt;&lt;p&gt;&#123;&#123;count&#125;&#125;&lt;/p&gt;&lt;script&gt; const app = new Vue(&#123; // ... data: &#123; count: 1 &#125;, methods: &#123; add: () =&gt; this.count++ &#125; &#125;);&lt;/script&gt;æ­£ç¡®ç¤ºèŒƒï¼š12345678910111213&lt;script&gt; const app = new Vue(&#123; // ... methods: &#123; add: function () &#123; this.count++ &#125;, minus() &#123; this.count-- &#125; &#125; &#125;);&lt;/script&gt;","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Vue.js","slug":"Vue-js","permalink":"https://lolico.me/tags/Vue-js/"}]},{"title":"Gitè¿æ¥å¤šä¸ªGitHubè´¦å·","slug":"Gitè¿æ¥å¤šä¸ªGitHubè´¦å·","date":"2020-04-15T11:11:50.000Z","updated":"2022-03-06T10:28:21.343Z","comments":true,"path":"2020/04/15/Gitè¿æ¥å¤šä¸ªGitHubè´¦å·/","link":"","permalink":"https://lolico.me/2020/04/15/Git%E8%BF%9E%E6%8E%A5%E5%A4%9A%E4%B8%AAGitHub%E8%B4%A6%E5%8F%B7/","excerpt":"å‰è¨€ç”¨sshè¿æ¥GitHubï¼Œéœ€è¦åœ¨GitHubè´¦å·ä¸Šä¼ å”¯ä¸€çš„å…¬é’¥ã€‚å½“æˆ‘ä»¬éœ€è¦è¿æ¥ä¸¤ä¸ªæˆ–å¤šä¸ªGitHubè´¦å·ï¼Œä¸Šä¼ åŒä¸€ä¸ªå…¬é’¥æ˜¯ä¸å…è®¸çš„ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•è®¾ç½®æ‰èƒ½åœ¨ä¸€å°ç”µè„‘ä¸Šè¿æ¥å¤šä¸ªGitHubè´¦å·å‘¢ï¼Ÿ","text":"å‰è¨€ç”¨sshè¿æ¥GitHubï¼Œéœ€è¦åœ¨GitHubè´¦å·ä¸Šä¼ å”¯ä¸€çš„å…¬é’¥ã€‚å½“æˆ‘ä»¬éœ€è¦è¿æ¥ä¸¤ä¸ªæˆ–å¤šä¸ªGitHubè´¦å·ï¼Œä¸Šä¼ åŒä¸€ä¸ªå…¬é’¥æ˜¯ä¸å…è®¸çš„ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•è®¾ç½®æ‰èƒ½åœ¨ä¸€å°ç”µè„‘ä¸Šè¿æ¥å¤šä¸ªGitHubè´¦å·å‘¢ï¼Ÿåˆ›å»ºå¯†é’¥å¹¶ä¸Šä¼ åˆ°GitHubå‡è®¾æˆ‘ä»¬å·²ç»æœ‰ä¸€å¯¹é»˜è®¤çš„å¯†é’¥id_rsaã€id_rsa.pubå…³è”äº†aè´¦å·ï¼Œç°åœ¨æˆ‘ä»¬æ¥ä¸ºbè´¦å·åˆ›å»ºä¸€ä¸ªå¯†é’¥ï¼š1ssh-keygen -t rsa -f ~/.ssh/id_rsa_b -C \"youmail@example.com\"æ³¨æ„æ–‡ä»¶åä¸è¦ä¸å…¶ä»–çš„å¯†é’¥é‡å¤ï¼Œå¦åˆ™ä¼šè¦†ç›–ä¹‹å‰çš„å¯†é’¥ã€‚windowsä¸‹ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼šC:\\Users\\xxx\\.ssh\\id_rsa_bæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥åœ¨ç”¨æˆ·ç›®å½•ä¸‹çš„.sshæ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°id_rsa_bå’Œid_rsa_b.pubä¸¤ä¸ªæ–‡ä»¶ï¼Œå°†id_rsa_b.pubæ–‡ä»¶ä¸­çš„å†…å®¹ä¿å­˜åˆ°bè´¦å·çš„ssh keysä¸­ã€‚é…ç½®èº«ä»½éªŒè¯ä½¿ç”¨çš„å¯†é’¥æ¥ä¸‹æ¥æˆ‘ä»¬è¦åšçš„å°±æ˜¯å¯¹ä¸åŒè´¦å·é…ç½®ä½¿ç”¨ä¸åŒçš„å¯†é’¥å»è¿æ¥githubã€‚åœ¨.sshæ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªconfigæ–‡ä»¶ï¼ˆæ— æ‰©å±•åï¼‰ï¼Œå¡«å…¥ä»¥ä¸‹å†…å®¹ï¼š1234567891011# defaultHost github.com HostName github.com PreferredAuthentications publickey IdentityFile ~&#x2F;.ssh&#x2F;id_rsa# bHost b.github.com HostName github.com PreferredAuthentications publickey IdentityFile ~&#x2F;.ssh&#x2F;id_rsa_båœ¨è¿™éƒ¨åˆ†é…ç½®ä¸­æˆ‘ä»¬ä½¿ç”¨ä¸åŒçš„ä¸»æœºæ ‡è¯†å»æ˜ å°„åŒä¸€ä¸ªHostNameå³github.comï¼Œä½†æ˜¯æˆ‘ä»¬ä½¿ç”¨ä¸åŒçš„å¯†é’¥æ–‡ä»¶å»è¿›è¡Œèº«ä»½éªŒè¯ã€‚é…ç½®ä¸­çš„Hoståœ¨ä¸å’Œå…¶ä»–Hosté‡å¤çš„æƒ…å†µä¸‹å¯ä»¥éšæ„å¡«å†™ï¼Œä½†æ˜¯å»ºè®®ä½¿ç”¨ä¸€çœ¼å°±èƒ½çœ‹æ‡‚çš„æ ‡è¯†ï¼ˆå¹¶ä¸”è¿™ä¸ªæ ‡è¯†åœ¨åé¢æ˜¯éœ€è¦ç”¨åˆ°çš„ï¼‰åˆ°è¿™é‡Œï¼Œå…¶å®æ‰€æœ‰çš„å·¥ä½œéƒ½å·²ç»å®Œæˆã€‚åœ¨è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œå‰æˆ‘ä»¬å…ˆæµ‹è¯•sshæ˜¯å¦èƒ½è¿æ¥åˆ°githubï¼š12ssh -T git@github.comssh -T git@b.github.comä¸å‡ºæ„å¤–ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°éªŒè¯æˆåŠŸçš„æç¤ºã€‚å¦‚æœæç¤º CreateProcessW failed error:2ï¼Œå…ˆå°†configæ–‡ä»¶ä¸­çš„ä»£ç†è®¾ç½®æ³¨é‡Šä¾¿å¯ï¼Œå®é™…ä¸Šå¹¶ä¸å½±å“åç»­å¯¹ä»“åº“çš„æ¨é€ã€‚å¯¹bè´¦å·çš„ä»“åº“å•ç‹¬è®¾ç½®ç”¨æˆ·åå’Œé‚®ç®±ç°åœ¨æˆ‘ä»¬è¦åšçš„å°±æ˜¯å¯¹bè´¦å·ä¸‹çš„ä»“åº“è¿›è¡Œè®¾ç½®ï¼Œå› ä¸ºåœ¨åŸæœ¬åªæœ‰ä¸€ä¸ªè´¦å·æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥éƒ½ç”¨è¿‡ä¸‹é¢è¿™ä¸ªå‘½ä»¤æ¥å¯¹gitè®¾ç½®ä¸€ä¸ªå…¨å±€çš„ç”¨æˆ·åå’Œé‚®ç®±ï¼š12git config --global user.name \"a\"git config --global user.email \"a@example.com\"ç°åœ¨æˆ‘ä»¬å½“ç„¶ä¸èƒ½å¯¹bè´¦å·ä¸‹çš„ä»“åº“ä¹Ÿä½¿ç”¨å…¨å±€çš„ç”¨æˆ·åå’Œé‚®ç®±ã€‚å¦‚æœä½¿ç”¨å…¨å±€çš„é‚®ç®±å°†bçš„ä»“åº“pushåˆ°githubï¼Œé‚£ä¹ˆåœ¨githubæäº¤è®°å½•ä¸­çœ‹åˆ°çš„æäº¤è€…å°†ä¼šæ˜¯aï¼Œæ‰€ä»¥è¯´æˆ‘ä»¬éœ€è¦å¯¹bè´¦å·ä¸‹çš„ä»“åº“å•ç‹¬é…ç½®ç”¨æˆ·åå’Œé‚®ç®±ï¼Œè¿›å…¥é¡¹ç›®æ–‡ä»¶å¤¹ï¼š12git config user.name \"b\"git config user.email \"b@example.com\"é‚®ç®±è¦ä½¿ç”¨bè´¦å·æ³¨å†Œgithubæ—¶ä½¿ç”¨çš„é‚®ç®±ï¼Œå› ä¸ºgithubæäº¤è®°å½•ä¸­çš„æäº¤è€…æ˜¯æ ¹æ®è¿™ä¸ªé‚®ç®±æ¥æŸ¥æ‰¾çš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸èƒ½ä½¿ç”¨å…¨å±€é‚®ç®±åæäº¤è€…æ˜¯açš„åŸå› ã€‚ä¿®æ”¹è¿œç¨‹ä»“åº“çš„åœ°å€æ¥ä¸‹æ¥æˆ‘ä»¬è¿˜è¦é‡æ–°è®¾ç½®è¿œç¨‹ä»“åº“çš„åœ°å€ï¼Œå› ä¸ºå…‹éš†ä»“åº“æˆ–è€…åˆ›å»ºgithubä»“åº“æ·»åŠ è¿œç¨‹ä»“åº“åœ°å€æ—¶ä½¿ç”¨çš„ä¸»æœºæ ‡è¯†é»˜è®¤æ˜¯github.comï¼Œç„¶è€Œåœ¨configæ–‡ä»¶ä¸­å¯¹è¿™ä¸ªHostæ˜¯ä½¿ç”¨~/.ssh/id_rsaå¯†é’¥å»éªŒè¯ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬æœ¬åœ°å·²æœ‰bè´¦å·ä¸‹çš„ä»“åº“æˆ–è€…æœªæ¥å…‹éš†bè´¦å·ä¸‹çš„ä»“åº“æ—¶è¦ä¿®æ”¹é»˜è®¤çš„è¿œç¨‹ä»“åº“åœ°å€ï¼š12git remote rm origingit remote add origin git@b.github.com:b/repo.gitæ³¨æ„ä¸è¦ç…§æŠ„ï¼Œæ ¹æ®configæ–‡ä»¶ä¸­é…ç½®çš„Hostï¼Œgithubè´¦å·ä»¥åŠä»“åº“åå»è®¾ç½®â€˜@â€™ç¬¦å·åé¢çš„ä¸œè¥¿ã€‚æ‰€æœ‰çš„å·¥ä½œéƒ½å·²ç»å®Œæˆï¼Œpushæµ‹è¯•ä¸€ä¸‹ï¼š1git push origin masterå¦‚æœæˆ‘ä»¬å•çº¯çš„ä½¿ç”¨git pushå¯èƒ½ä¼šæŠ¥é”™ï¼Œå› ä¸ºè™½ç„¶æ·»åŠ äº†è¿œç¨‹ä»“åº“ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è®¾ç½®æœ¬åœ°åˆ†æ”¯å…·ä½“è·Ÿè¸ªå“ªä¸ªä¸Šæ¸¸åˆ†æ”¯ã€‚ä½¿ç”¨-uæˆ–--set-upstream-toé€‰é¡¹è¿è¡Œgit branchæ¥æ˜¾å¼åœ°è®¾ç½®ï¼š1git branch -u origin/master masteræ€»ç»“æ€»çš„æ¥è¯´ï¼Œæˆ‘ä»¬å°±æ˜¯ä½¿ç”¨äº†ä¸åŒçš„ä¸»æœºæ ‡è¯†å»æ˜ å°„github.comï¼Œå¹¶ä¸”å¯¹ä¸åŒçš„æ ‡è¯†åœ¨è¿æ¥githubæ—¶ä½¿ç”¨ç›¸åº”çš„å¯†é’¥å»éªŒè¯èº«ä»½ã€‚æˆ‘ä»¬è®¾ç½®å¤šä¸ªæ ‡è¯†ï¼Œç›¸åº”çš„ï¼Œæˆ‘ä»¬ä¹Ÿè¦ä¿®æ”¹è¿œç¨‹ä»“åº“ä½¿ç”¨çš„Hostæ ‡è¯†ï¼ˆå› ä¸ºå…‹éš†ä¸‹æ¥çš„ä»“åº“çš„è¿œç¨‹åœ°å€Hostæ ‡è¯†é»˜è®¤ä½¿ç”¨github.comï¼‰ã€‚è™½ç„¶ä¸Šé¢æˆ‘ä»¬æ˜¯æ‹¿ä¸¤ä¸ªè´¦å·æ¥ä¸¾ä¾‹å­ï¼Œä½†æ˜¯å¯¹äºå¤šä¸ªè´¦å·ï¼Œè®¾ç½®çš„æ–¹æ³•è¿˜æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"git","slug":"git","permalink":"https://lolico.me/tags/git/"}]},{"title":"python3å®‰è£…dlibåº“","slug":"python3å®‰è£…dlibåº“","date":"2020-04-12T06:44:09.000Z","updated":"2022-03-06T10:28:21.347Z","comments":true,"path":"2020/04/12/python3å®‰è£…dlibåº“/","link":"","permalink":"https://lolico.me/2020/04/12/python3%E5%AE%89%E8%A3%85dlib%E5%BA%93/","excerpt":"python3ç¼–è¯‘å®‰è£…dlibåº“ååˆ†éº»çƒ¦ï¼Œè¿™é‡Œæä¾›å·²ç»ç¼–è¯‘å¥½çš„whlæ–‡ä»¶ï¼Œä½¿ç”¨pipç›´æ¥å®‰è£…å³å¯ã€‚","text":"python3ç¼–è¯‘å®‰è£…dlibåº“ååˆ†éº»çƒ¦ï¼Œè¿™é‡Œæä¾›å·²ç»ç¼–è¯‘å¥½çš„whlæ–‡ä»¶ï¼Œä½¿ç”¨pipç›´æ¥å®‰è£…å³å¯ã€‚python3.6ä¸‹è½½ï¼šdlib-19.8.1-cp36-cp36m-win_amd64.whlmd5ï¼š9a704406fbb4036f70b5f174fec9db1fsha1ï¼še2e49b82b8dee6a9483362713239558c42c38feapython3.7ä¸‹è½½ï¼šdlib-19.17.99-cp37-cp37m-win_amd64.whlmd5ï¼šb8c35e6e0098a7ece3e1a6935bbf1ae8sha1ï¼š886f510821c3033649edcf86ea80ec1157f0b1a7python3.8ä¸‹è½½ï¼šdlib-19.19.0-cp38-cp38-win_amd64.whlmd5ï¼š7e00b04c3cf468e102b338d6837f4d5dsha1ï¼š129d0142f1232d60c6571dc07eacdcd392b92f7bå®‰è£…ï¼š1$ pip install dlib-xx.xx.xx-cpxx-cpxx-win_amd64.whl #å®‰è£…ç›¸åº”çš„æ–‡ä»¶","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Python","slug":"Python","permalink":"https://lolico.me/tags/Python/"},{"name":"pip","slug":"pip","permalink":"https://lolico.me/tags/pip/"},{"name":"dlib","slug":"dlib","permalink":"https://lolico.me/tags/dlib/"}]},{"title":"è§£é”ç½‘æ˜“äº‘éŸ³ä¹","slug":"unblock-netease-music","date":"2020-03-23T10:26:55.000Z","updated":"2022-03-06T10:28:21.347Z","comments":true,"path":"2020/03/23/unblock-netease-music/","link":"","permalink":"https://lolico.me/2020/03/23/unblock-netease-music/","excerpt":"","text":"å‰è¨€é€šè¿‡é…ç½®ä¸‹æ–‡ä¸­çš„ä»£ç†ï¼Œå®ç°è§£é”ç½‘æ˜“äº‘æ— ç‰ˆæƒéŸ³ä¹ä»¥åŠè¯•å¬éŸ³ä¹ï¼Œæ–‡ä¸­ä½¿ç”¨åˆ°çš„é¡¹ç›®ï¼šUnblockNeteaseMusicã€‚æ³¨æ„ï¼šäº’è”ç½‘å¹¶éæ³•å¤–ä¹‹åœ°ï¼Œæ­¤ä»£ç†å®Œå…¨å…è´¹å¹¶ä»…ç”¨ä½œå­¦ä¹ ä¸äº¤æµï¼Œä½¿ç”¨è¿‡ç¨‹ä¸­å‡ºç°ä»»ä½•é—®é¢˜æœ¬äººæ¦‚ä¸è´Ÿè´£ã€‚å¦‚å‘ç°ä»»ä½•æ”¶è´¹å€’å–ç­‰è¡Œä¸ºè¯·åŠæ—¶ä¸¾æŠ¥å¹¶åé¦ˆã€‚é£Ÿç”¨æ–¹æ³•ä½¿ç”¨å‰ä½ éœ€è¦çŸ¥é“ï¼šæœåŠ¡ç«¯å·²åšé™åˆ¶ï¼šä»…å…è®¸ä»£ç†ç½‘æ˜“äº‘ç›¸å…³åŸŸåå’Œipçš„è¯·æ±‚ï¼Œå…¶ä»–è¯·æ±‚ä¸€å¾‹æ‹’ç»ã€‚ç”±äºæœåŠ¡å™¨å¸¦å®½åªæœ‰5Mbpsï¼Œæ‰€ä»¥ç†è®ºé€Ÿåº¦ä¸ä¼šè¶…è¿‡640kb/sã€‚å¦‚æœä½¿ç”¨çš„äººæ¯”è¾ƒå¤šï¼Œå¯èƒ½å‡ºç°åŠ è½½æ¯”è¾ƒæ…¢çš„ç°è±¡ã€‚å»ºè®®ç½‘æ˜“äº‘éŸ³ä¹å†…å¼€å¯è¾¹å¬è¾¹å­˜ï¼Œå¸¸å¬çš„æ­Œä¸‹è½½åˆ°æœ¬åœ°ã€‚æœ€åï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡æ–‡æœ«çš„æ‰“èµæŒ‰é’®å¯¹æˆ‘è¿›è¡Œæ‰“èµé¼“åŠ±~ï¼ˆå¤§é›¾ç°æä¾›ä¸¤ç§æ–¹æ³•ï¼Œä¸æƒ³æŠ˜è…¾çš„ä½¿ç”¨æ–¹æ³•ä¸€ï¼ˆå±€é™æ€§è¾ƒå¤§ï¼‰ï¼Œå¦åˆ™è¯·é€‰æ‹©æ–¹æ³•äºŒï¼ˆæ¨èï¼‰ã€‚æ–¹æ³•ä¸€ï¼šç³»ç»Ÿä»£ç†PACä½¿ç”¨ç³»ç»Ÿä»£ç†PACè§£é”æ˜¯æœ€ç®€å•çš„æ–¹æ³•ï¼Œç¼ºç‚¹æ˜¯ Android å’Œ iOS åªèƒ½åœ¨è¿æ¥WiFiçš„ç¯å¢ƒä¸‹ä½¿ç”¨ã€‚ä¸‹é¢ä»‹ç»ä¸åŒå¹³å°ç³»ç»Ÿä»£ç†PACçš„è®¾ç½®æ–¹æ³•ï¼Œå¯¹å·å…¥åº§ã€‚Windowsä»¥ Windows 10 ä¸ºä¾‹ï¼Œè¿›å…¥ã€ŒWindows è®¾ç½®ã€&gt;ã€Œç½‘ç»œå’Œ Internetã€&gt;ã€Œä»£ç†ã€&gt;ã€Œè‡ªåŠ¨è®¾ç½®ä»£ç†ã€&gt;ã€Œä½¿ç”¨è®¾ç½®è„šæœ¬ã€ï¼Œå¡«å†™ä»¥ä¸‹åœ°å€ï¼š1http:&#x2F;&#x2F;music.lolico.me:39000&#x2F;proxy.pacè¿›å…¥ç½‘æ˜“äº‘éŸ³ä¹ã€Œè®¾ç½®ã€&gt;ã€Œå·¥å…·ã€&gt;ã€ŒHttpä»£ç†ã€ï¼Œé€‰æ‹©ã€Œä½¿ç”¨ IE ä»£ç†è®¾ç½®ã€ã€‚MacOSè¿›å…¥ã€Œç³»ç»Ÿåå¥½è®¾ç½®ã€&gt;ã€Œç½‘ç»œã€&gt;ã€Œé«˜çº§ã€&gt;ã€Œä»£ç†ã€ï¼Œå¡«å†™ä»¥ä¸‹åœ°å€ï¼š1http:&#x2F;&#x2F;music.lolico.me:39000&#x2F;proxy.pacAndroidè¿›å…¥ã€Œè®¾ç½®ã€&gt;ã€ŒWLANã€&gt;ã€Œä¿®æ”¹ç½‘ç»œã€&gt;ã€Œé«˜çº§é€‰é¡¹ã€&gt;ã€Œä»£ç†ã€&gt;ã€Œä»£ç†è‡ªåŠ¨é…ç½®ã€ï¼ˆä¸åŒæœºå‹è®¾ç½®çš„åœ°æ–¹ä¸ä¸€æ ·ï¼Œä¹Ÿå¯èƒ½åœ¨wifiå³è¾¹çš„æ„Ÿå¹å·ä¸­ï¼‰ï¼Œå¡«å†™ä»¥ä¸‹åœ°å€ï¼š1http:&#x2F;&#x2F;music.lolico.me:39000&#x2F;proxy.paciOSé¦–å…ˆä¸‹è½½CAè¯ä¹¦ï¼ˆæ‰“ä¸å¼€çš„è¯·æŒ‚ä»£ç†ï¼‰ï¼Œå‰å¾€â€œè®¾ç½®-é€šç”¨-æè¿°æ–‡ä»¶â€ï¼Œå®‰è£…ã€ŒUnblockNeteaseMusic Root CAã€ï¼Œç„¶ååœ¨â€œè®¾ç½®-é€šç”¨-å…³äºæœ¬æœº-è¯ä¹¦ä¿¡ä»»è®¾ç½®â€å¤„å¼€å¯å¯¹ã€ŒUnblockNeteaseMusic Root CAã€çš„ä¿¡ä»»ï¼Œæœ€åç»™å½“å‰è¿æ¥çš„wifié…ç½®httpä»£ç†ï¼Œé€‰æ‹©è‡ªåŠ¨å¹¶å¡«å…¥ä»¥ä¸‹åœ°å€ï¼š1http:&#x2F;&#x2F;music.lolico.me:39000&#x2F;proxy.pacæ–¹æ³•äºŒï¼šä»£ç†è½¯ä»¶ä½¿ç”¨ä»£ç†è½¯ä»¶ï¼Œä»»ä½•ç½‘ç»œç¯å¢ƒéƒ½å¯ç”¨ï¼Œä¸‹é¢æ”¾ä¸Šä¸åŒå¹³å°ä¸»æµä»£ç†è½¯ä»¶çš„ä½¿ç”¨æ­¥éª¤ï¼Œè‡³äºæ–‡ä¸­æ²¡æœ‰æåˆ°çš„å®¢æˆ·ç«¯ï¼Œèƒ½åŠ›è€…è‡ªè¡Œæ ¹æ®æä¾›çš„ç°æœ‰é…ç½®ä¿®æ”¹ã€‚Clash for WindowsğŸ‘‰å®‰è£…è½¯ä»¶ğŸ‘‰å¯¼å…¥é…ç½®æ–‡ä»¶ğŸ‘‰è¿›å…¥ã€ŒGeneralã€ï¼Œå¼€å¯ã€ŒSystem Proxyã€ğŸ‘‰è¿›å…¥ç½‘æ˜“äº‘éŸ³ä¹ã€Œè®¾ç½®ã€&gt;ã€Œå·¥å…·ã€&gt;ã€ŒHttpä»£ç†ã€ï¼Œé€‰æ‹©ã€Œä½¿ç”¨ IE ä»£ç†è®¾ç½®ã€ã€‚ğŸ˜˜Enjoy itï¼Clash for MacOSğŸ‘‰å®‰è£…è½¯ä»¶ğŸ‘‰å¯¼å…¥é…ç½®æ–‡ä»¶ğŸ˜˜Enjoy itï¼Clash for AndroidğŸ‘‰å®‰è£…è½¯ä»¶ğŸ‘‰å¯¼å…¥é…ç½®æ–‡ä»¶ğŸ‘‰ä¿å­˜ååº”ç”¨æ­¤é…ç½®ğŸ‘‰å›åˆ°ä¸»ç•Œé¢å¯åŠ¨ä»£ç†ğŸ˜˜Enjoy itï¼æ³¨æ„ï¼šé‰´äºå®‰å“ç«¯å¯¼å…¥é…ç½®æ–‡ä»¶æ— æ³•è°ƒèµ·Clashè¿›è¡Œè‡ªåŠ¨å¯¼å…¥ï¼Œè¯·æ‰‹åŠ¨å¯¼å…¥é…ç½®ï¼šï¼ˆæœ€æ–°ç‰ˆå·²æ”¯æŒï¼Œä¸Šæ–¹ç›´æ¥ä¸‹è½½ï¼‰ğŸ‘‰è¿›å…¥Clashåº”ç”¨ï¼Œä¾æ¬¡ç‚¹å‡»ã€Œé…ç½®ã€&gt;ã€Œæ–°é…ç½®ã€&gt;ã€Œä»URLå¯¼å…¥ã€ğŸ‘‰å¡«å†™åç§°ï¼šlolico.meï¼ŒURLåœ°å€ï¼šhttps://lolico.me/subscribe/Clash/config.yaml ï¼Œè‡ªåŠ¨æ›´æ–°ï¼š1440ğŸ‘‰ä¿å­˜åé€‰ä¸­æ­¤é…ç½®ğŸ‘‰å›åˆ°ä¸»ç•Œé¢å¯åŠ¨ä»£ç†ğŸ˜˜Enjoy itï¼Clashé…ç½®ä¸­æœ‰å¤šä¸ªèŠ‚ç‚¹ï¼Œå½“èŠ‚ç‚¹ä¸å¯ç”¨æ—¶ï¼Œè¯·åˆ‡æ¢è‡³å…¶ä»–èŠ‚ç‚¹æˆ–å°è¯•æ›´æ–°é…ç½®æ–‡ä»¶ã€‚iOSé¦–å…ˆä¸‹è½½CAè¯ä¹¦ï¼ˆæ‰“ä¸å¼€çš„è¯·æŒ‚ä»£ç†ï¼‰ï¼Œå‰å¾€â€œè®¾ç½®-é€šç”¨-æè¿°æ–‡ä»¶â€ï¼Œå®‰è£…ã€ŒUnblockNeteaseMusic Root CAã€ï¼Œç„¶ååœ¨â€œè®¾ç½®-é€šç”¨-å…³äºæœ¬æœº-è¯ä¹¦ä¿¡ä»»è®¾ç½®â€å¤„å¼€å¯å¯¹ã€ŒUnblockNeteaseMusic Root CAã€çš„ä¿¡ä»»ã€‚ShadowrocketğŸ‘‰å®‰è£…è½¯ä»¶ğŸ‘‰å¯¼å…¥èŠ‚ç‚¹ğŸ‘‰å¯¼å…¥é…ç½®ğŸ˜˜Enjoy itï¼QuantumultXğŸ‘‰å®‰è£…è½¯ä»¶ğŸ‘‰å¯¼å…¥é…ç½®ğŸ‘‰è¿›å…¥åº”ç”¨ï¼Œé•¿æŒ‰ğŸ¸ç½‘æ˜“äº‘éŸ³ä¹ç­–ç•¥ç»„å¹¶æ·»åŠ è§£é”èŠ‚ç‚¹ğŸ˜˜Enjoy itï¼è¿™é‡Œå¦å¤–å†æä¾›ä¸€ä¸ªåŒ…å«ï¼šç­–ç•¥ç»„ã€å¸¸ç”¨åˆ†æµã€è„šæœ¬è®¢é˜…çš„ç²¾ç®€å…¨å±€é…ç½®æ–‡ä»¶ï¼ˆé€‚ç”¨äºQuantumultX v1.0.10åŠä»¥ä¸Šç‰ˆæœ¬ï¼‰ï¼šhttps://lolico.me/subscribe/QuantumultX/simple.confæ³¨æ„ï¼šå¦‚æœæµ‹è¯•èŠ‚ç‚¹è¿æ¥å»¶è¿Ÿæ˜¾ç¤ºtimeout/è¶…æ—¶æ˜¯æ­£å¸¸çš„ï¼ŒæœåŠ¡ç«¯å¼€å¯ä¸¥æ ¼æ¨¡å¼åä»…èƒ½é€šè¿‡ç½‘æ˜“äº‘ç›¸å…³åŸŸåæˆ–ipçš„è¯·æ±‚ã€‚éƒ¨åˆ†è§£é”èŠ‚ç‚¹æ¥è‡ªtelegramé¢‘é“ï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»åˆ é™¤ï¼Œè°¢è°¢ï¼FAQä¸ºä»€ä¹ˆå¼€å¯ä»£ç†åï¼Œå¬æ•°å­—ä¸“è¾‘ä¸­çš„éŸ³ä¹ä¼šæç¤ºè´­ä¹°ï¼Ÿç›´æ¥æœæ•°å­—ä¸“è¾‘ä¸­çš„éŸ³ä¹åœ¨æ’­æ”¾æ—¶å¯èƒ½å‡ºç°è¿™ç§ç°è±¡ï¼Œå°è¯•ä»ä¸“è¾‘ä¸­è¿›å…¥å¹¶æ’­æ”¾ã€‚ä¸ºä»€ä¹ˆå¼€å¯ä»£ç†åï¼Œç™»å½•ç½‘æ˜“äº‘éŸ³ä¹æç¤ºç½‘ç»œå¼‚å¸¸ï¼Ÿå…ˆå…³é—­ä»£ç†å†è¿›è¡Œç™»å½•ï¼Œè¿›å…¥åå†å¼€å¯ä»£ç†ã€‚ä¸ºä»€ä¹ˆæ’­æ”¾éŸ³ä¹æç¤ºç½‘ç»œä¸ç»™åŠ›æˆ–è€…æ­Œæ›²ä¸å­˜åœ¨ï¼ŸiOSç«¯å‡ºç°ç½‘ç»œä¸ç»™åŠ›æ—¶ï¼Œè¯·ç¡®ä¿CAè¯ä¹¦å·²ä¿¡ä»»ï¼›æ­Œæ›²ä¸å­˜åœ¨ï¼Œè¯·å°è¯•ä½¿ç”¨å…¶ä»–èŠ‚ç‚¹è§£é”ï¼Œä¸åŒèŠ‚ç‚¹åœ¨æœç´¢éŸ³æºæ—¶ä½¿ç”¨çš„å¹³å°ä¸åŒï¼Œéƒ¨åˆ†æ­Œæ›²æ‰¾ä¸åˆ°æ˜¯æ­£å¸¸çš„ç°è±¡ã€‚ä¸ºä»€ä¹ˆæ’­æ”¾çš„éŸ³ä¹æ˜¯liveç‰ˆæˆ–è€…å®Œå…¨ä¸åŒçš„ä¸€é¦–éŸ³ä¹ï¼Ÿç”±äºè§£é”æœåŠ¡æ˜¯ä»å…¶ä»–å¹³å°æœç´¢éŸ³æºï¼Œå¹¶ä¸”é€‰æ‹©ç­–ç•¥ä¸å¯èƒ½åšåˆ°åå…¨åç¾ï¼Œåœ¨éŸ³ä¹é‡åå¹¶ä¸”ç«çƒ­ç¨‹åº¦ä¸åŒçš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå‡ºç°è¿™ç§ç°è±¡ï¼Œç›®å‰æ²¡æœ‰è¾ƒå¥½çš„è§£å†³æ–¹æ³•ã€‚ä¸ºä»€ä¹ˆå¼€å¯ä»£ç†åæŸäº›ç½‘ç«™æˆ–åº”ç”¨åŠ è½½èµ„æºå¾ˆæ…¢ç”šè‡³å¤±è´¥ï¼Ÿç”±äºä½¿ç”¨ä»£ç†å¹¶ä¸”æ ¹æ®è¯·æ±‚åˆ†æµï¼Œæ‰€ä»¥è¯´ç›¸æ¯”ä¸å¼€ä»£ç†ç†è®ºä¸Šçš„ç¡®ä¼šæœ‰å»¶è¿Ÿï¼ˆåŸºæœ¬å¿½ç•¥ä¸è®¡ï¼‰ã€‚å¦‚æœæ„Ÿè§‰æœ‰æ˜æ˜¾çš„ç½‘ç»œå»¶è¿Ÿå¹¶ä¸”ç¡®å®šä¸æ˜¯ç”±äºè‡ªå·±ç½‘ç»œç¯å¢ƒè¾ƒå·®æ‰€è‡´ï¼Œè¯·åœ¨å¿…è¦æ—¶å†å¼€å¯ä»£ç†ï¼Œæ—¥å¸¸ä¸Šç½‘å…³é—­å³å¯ã€‚è¿™å†™çš„éƒ½æ˜¯äº›å•¥ç©æ„ï¼Ÿâ€¦â€¦","categories":[{"name":"ä¸æ­£å¸¸çš„æ–‡ç« ","slug":"ä¸æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E4%B8%8D%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"ï¼Ÿï¼Ÿï¼Ÿ","slug":"ï¼Ÿï¼Ÿï¼Ÿ","permalink":"https://lolico.me/tags/%EF%BC%9F%EF%BC%9F%EF%BC%9F/"}]},{"title":"è®ºå¦‚ä½•ç”¨å±ç­‘ä¸€åº§å±±","slug":"Fucking-shit","date":"2020-03-23T03:57:06.000Z","updated":"2022-03-06T10:28:21.343Z","comments":true,"path":"2020/03/23/Fucking-shit/","link":"","permalink":"https://lolico.me/2020/03/23/Fucking-shit/","excerpt":"","text":"ç½‘è¯¾ç°åœº1234567891011121314151617181920212223public class Product &#123; // ... private Integer sex; private String sexView; public static String[] SEXViews = new String[]&#123;\"å¥³\", \"ç”·\"&#125;; // #2-2 private Long date; private String dateView; public void setSex(Integer sex) &#123; this.sex = sex; // switch (sex) &#123; #1 // ... // &#125; this.sexView = SEXViews[sex]; // #2-1 &#125; public void setDate(Long date) &#123; this.date = date; this.dateView = DateFormat.toShortString(date); &#125; // ...&#125;ä½ å“ï¼Œä½ ç»†ç»†çš„å“ã€‚è´§å¸éœ€è¦æ ¼å¼åŒ–å±•ç¤ºå—ï¼Ÿå½“ç„¶æ˜¯ä¸éœ€è¦ï¼ˆè¯¯è´§å¸æ ¼å¼åŒ–æŸäº›åœºæ™¯ä¸‹æ˜¯è¦çš„ã€‚çƒçƒäº†ï¼Œçœ‹ä¸‹org.springframework.formatåŒ…ä¸‹çš„ä¸œè¥¿å§ã€‚æˆ‘è§‰å¾—@NumberFormatterï¼Œå’Œ@CurrencyFormatterç”¨çš„å°‘ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯æƒ…æœ‰å¯åŸã€‚ä½†ç”¨åˆ°@DateFormatterçš„æ—¶å€™å°±æ²¡å»çœ‹çœ‹è¿™ä¸ªæ³¨è§£çš„åŒ…ä¸‹è¿˜æä¾›äº†ä»€ä¹ˆæ³¨è§£æˆ–è€…æ¥å£å—ï¼Ÿï¼Ÿï¼Ÿâ€¦â€¦å“ï¼Œæ— å¥ˆè‡ªå·±ä¸æƒ³é€ å±å±±ï¼Œä½†ç°å®å´æ˜¯ï¼Œæ€»æœ‰ä¸€å †å±å±±äº¤åˆ°è‡ªå·±æ‰‹ä¸Šã€‚","categories":[{"name":"ä¸æ­£å¸¸çš„æ–‡ç« ","slug":"ä¸æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E4%B8%8D%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"ï¼Ÿï¼Ÿï¼Ÿ","slug":"ï¼Ÿï¼Ÿï¼Ÿ","permalink":"https://lolico.me/tags/%EF%BC%9F%EF%BC%9F%EF%BC%9F/"}]},{"title":"åµŒå¥—åˆ—è¡¨æ¨å¯¼å¼","slug":"åµŒå¥—åˆ—è¡¨æ¨å¯¼å¼","date":"2020-03-15T06:36:20.000Z","updated":"2022-03-06T10:28:21.347Z","comments":true,"path":"2020/03/15/åµŒå¥—åˆ—è¡¨æ¨å¯¼å¼/","link":"","permalink":"https://lolico.me/2020/03/15/%E5%B5%8C%E5%A5%97%E5%88%97%E8%A1%A8%E6%8E%A8%E5%AF%BC%E5%BC%8F/","excerpt":"","text":"åˆ—è¡¨è§£æä¸­çš„ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼å¯ä»¥æ˜¯ä»»ä½•è¡¨è¾¾å¼ï¼ŒåŒ…æ‹¬åˆ—è¡¨è§£æã€‚è€ƒè™‘ä¸‹é¢ç”±ä¸‰ä¸ªé•¿åº¦ä¸º 4 çš„åˆ—è¡¨ç»„æˆçš„ 3x4 çŸ©é˜µï¼š12345&gt;&gt;&gt; matrix = [... [1, 2, 3, 4],... [5, 6, 7, 8],... [9, 10, 11, 12],... ]ç°åœ¨ï¼Œå¦‚æœä½ æƒ³äº¤æ¢è¡Œå’Œåˆ—ï¼Œå¯ä»¥ç”¨åµŒå¥—çš„åˆ—è¡¨æ¨å¯¼å¼ï¼š12&gt;&gt;&gt; [[row[i] for row in matrix] for i in range(4)][[1, 5, 9], [2, 6, 10], [3, 7, 11], [4, 8, 12]]åƒå‰é¢çœ‹åˆ°çš„ï¼ŒåµŒå¥—çš„åˆ—è¡¨æ¨å¯¼å¼æ˜¯å¯¹ for åé¢çš„å†…å®¹è¿›è¡Œæ±‚å€¼ï¼Œæ‰€ä»¥ä¸Šä¾‹å°±ç­‰ä»·äºï¼š123456&gt;&gt;&gt; transposed = []&gt;&gt;&gt; for i in range(4):... transposed.append([row[i] for row in matrix])...&gt;&gt;&gt; transposed[[1, 5, 9], [2, 6, 10], [3, 7, 11], [4, 8, 12]]åè¿‡æ¥è¯´ï¼Œå¦‚ä¸‹ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼š12345678910&gt;&gt;&gt; transposed = []&gt;&gt;&gt; for i in range(4):... # the following 3 lines implement the nested listcomp... transposed_row = []... for row in matrix:... transposed_row.append(row[i])... transposed.append(transposed_row)...&gt;&gt;&gt; transposed[[1, 5, 9], [2, 6, 10], [3, 7, 11], [4, 8, 12]]åœ¨å®é™…ä¸­ï¼Œä½¿ç”¨å†…ç½®å‡½æ•°ç»„æˆå¤æ‚æµç¨‹è¯­å¥ã€‚å¯¹æ­¤ç§æƒ…å†µzip()å‡½æ•°å°†ä¼šåšçš„æ›´å¥½ï¼š12&gt;&gt;&gt; list(zip(*matrix))[(1, 5, 9), (2, 6, 10), (3, 7, 11), (4, 8, 12)]","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Python","slug":"Python","permalink":"https://lolico.me/tags/Python/"}]},{"title":"2020å¹´JetBrains Quest ç¬¬ä¸‰å¼¹","slug":"2020-JetBrains-Quest-Three","date":"2020-03-14T08:52:33.000Z","updated":"2022-03-06T10:28:21.343Z","comments":true,"path":"2020/03/14/2020-JetBrains-Quest-Three/","link":"","permalink":"https://lolico.me/2020/03/14/2020-JetBrains-Quest-Three/","excerpt":"2020å¹´3æœˆ13ï¼ŒJetBrains Questç¬¬ä¸‰å¼¹åˆ°æ¥ï¼š","text":"2020å¹´3æœˆ13ï¼ŒJetBrains Questç¬¬ä¸‰å¼¹åˆ°æ¥ï¼šç»™ä¸ªæç¤ºï¼Œä¸Šé¢çš„é‚£ä¸€ä¸²æ˜¯ç»è¿‡äº†Base64ç¼–ç è§£è°œåè¿™æ¬¡çš„å¥–åŠ±æ˜¯ä¸€å¼ 8æŠ˜ä¼˜æƒ åˆ¸ï¼Ÿï¼Ÿï¼Ÿç®—äº†ç®—äº†ï¼Œå‘Šè¾","categories":[{"name":"ä¸æ­£å¸¸çš„æ–‡ç« ","slug":"ä¸æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E4%B8%8D%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"JetBrains Quest","slug":"JetBrains-Quest","permalink":"https://lolico.me/tags/JetBrains-Quest/"}]},{"title":"2020å¹´JetBrains Quest ç¬¬äºŒå¼¹","slug":"2020-JetBrains-Quest-Two","date":"2020-03-11T07:33:33.000Z","updated":"2022-03-06T10:28:21.343Z","comments":true,"path":"2020/03/11/2020-JetBrains-Quest-Two/","link":"","permalink":"https://lolico.me/2020/03/11/2020-JetBrains-Quest-Two/","excerpt":"","text":"2020å¹´3æœˆ11ï¼ŒJetBrains Questç¬¬äºŒå¼¹åˆ°æ¥ï¼š.spleh A+lrtC/dmC .thgis fo tuo si ti semitemos ,etihw si txet nehw sa drah kooL .tseretni wohs dluohs uoy ecalp a si ,dessecorp si xat hctuD erehw esac ehT .sedih tseuq fo txen eht erehw si ,deificeps era segaugnal cificeps-niamod tcudorp ehTçœ‹ç€è¿™ä¸€ä¸²æ•°å­—ä¸éš¾çœ‹å‡ºæ¥æ˜¯ç»è¿‡reverseè¿‡çš„ï¼Œpythonè§£å†³ï¼š12s = '.spleh A+lrtC/dmC .thgis fo tuo si ti semitemos ,etihw si txet nehw sa drah kooL .tseretni wohs dluohs uoy ecalp a si ,dessecorp si xat hctuD erehw esac ehT .sedih tseuq fo txen eht erehw si ,deificeps era segaugnal cificeps-niamod tcudorp ehT'print(s[::-1])è¾“å‡ºï¼šThe product domain-specific languages are specified, is where the next of quest hides. The case where Dutch tax is processed, is a place you should show interest. Look hard as when text is white, sometimes it is out of sight. Cmd/Ctrl+A helps.æ¥åˆ°MPSäº§å“é¡µï¼Œæœç´¢Dutch taxï¼šç‚¹å‡»Read MPS case studyè·³è½¬åˆ°ä¸€ä¸ªPDFæ–‡ä»¶ï¼šè¿˜è®°å¾—è¿™ä¸ªæç¤ºå—ï¼šLook hard as when text is white, sometimes it is out of sight. Cmd/Ctrl+A helps.Ctrl+Aè¯•ä¸€ä¸‹ï¼šå³è¾¹æœ‰4è¡Œæ–‡å­—éšè—äº†ï¼Œå¤åˆ¶å‡ºæ¥åº·åº·ï¼šThis is our 20th year as a company,we have shared numbers in our JetBrainsAnnual report, sharing the section with18,650 numbers will progress your queè¿™å¥è¯çš„æåˆ°äº†JetBrains Annual reportï¼Œçœ‹çœ‹å»https://www.jetbrains.com/company/annualreport/2019/åœ¨è¿™ä¸ªé¡µé¢å…œå…œè½¬è½¬ï¼Œæœç´¢18650ï¼Œæ€ä¹ˆéƒ½å‘ç°ä¸äº†ä»€ä¹ˆçº¿ç´¢ï¼Œå‚è€ƒè¿™ä¸ªå¸–å­è¯„è®ºåŒºï¼Œå‘ç°è¿™äº›æ•°å­—åŠ èµ·æ¥å…¶å®å°±æ˜¯18650è€Œçº¿ç´¢å°±è—åœ¨åˆ†äº«çš„ç¼–è¾‘æ é‡Œé¢ï¼šç‚¹å‡»åˆ†äº«ï¼šI have found the JetBrains Quest! Sometimes you just need to look closely at the Haskell language, Hello,World! in the hackathon lego brainstorms project https://blog.jetbrains.com/blog/2019/11/22/jetbrains-7th-annual-hackathon/#JetBrainsQuestç»™äº†ä¸ªåšå®¢é“¾æ¥ï¼Œç‚¹è¿›å»æœç´¢lego brainstormsï¼šè¿˜æ˜¯æ²¡æœ‰å¤´ç»ªï¼ŒF12å¼€å‘è€…æ¨¡å¼æŸ¥çœ‹è¿™ç§å›¾ç‰‡ï¼šå‘ç°åœ¨altå±æ€§ä¸­æœ‰è¿™ä¹ˆä¸€ä¸²æ–‡å­—ï¼šd1D j00 kN0w J378r41n2 12 4lW4Y2 H1R1N9? ch3CK 0u7 73h K4r33r2 P493 4nD 533 1f 7H3r3 12 4 J08 F0r J00 0R 4 KW357 cH4LL3n93 70 90 fUr7h3r @ l3457.è¿™ç©æ„æœ‰çš„å•è¯çœ‹ç€æƒ³æ˜¯æŸäº›å­—æ¯ç”¨æ•°å­—ä»£æ›¿ï¼Œæœ‰çš„åˆçœ‹ä¸å‡ºæ¥ï¼Œåœ¨gistä¸Šçœ‹äº†ä¸‹æ‰çŸ¥é“è¿™æ˜¯å˜¤æ–‡çš„ç«æ˜Ÿæ–‡ğŸ™„ğŸ™„ğŸ™„ï¼Œå…¶å®åœ¨ç¬¬ä¸€å¼¹çš„é‚®ä»¶é‡Œä¹Ÿæœ‰ä¸€ä¸²å·®ä¸å¤šçš„å½©è›‹ã€‚ç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼šDid you know Jetbrains is always hiring? Check out the kareers(careers) page and see if there is a job for you or for kwest(quest) challenge to go further at least.å»èŒä½å‘å¸ƒé¡µé¢çœ‹çœ‹ï¼šæœç´¢Questå¹¶ç‚¹è¿›å»ï¼šçœ‹ä¸€ä¸‹å•¥æ˜¯cheat at Konami gamesï¼šä¸Šä¸Šä¸‹ä¸‹å·¦å³å·¦å³BAï¼ŒåŸæ¥è¿˜æœ‰ä¸ªåå­—å«åšKonami Codeï¼Œç›¸å½“äºä¸€ä¸ªéšè—æ¸¸æˆçš„å¯åŠ¨ä»£ç ã€‚é­‚æ–—ç½—30æ¡å‘½ï¼æˆ‘æ¥è¾½ï¼ï¼ï¼â†‘â†‘â†“â†“â†â†’â†â†’BAwowï¼Œæ‰“æ‰æ‰€æœ‰å—ï¼Œåˆç™½å«–åˆ°3ä¸ªæœˆçš„å¥–åŠ±ï¼Œå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ","categories":[{"name":"ä¸æ­£å¸¸çš„æ–‡ç« ","slug":"ä¸æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E4%B8%8D%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"JetBrains Quest","slug":"JetBrains-Quest","permalink":"https://lolico.me/tags/JetBrains-Quest/"}]},{"title":"2020å¹´JetBrains Quest ç¬¬ä¸€å¼¹","slug":"2020-JetBrains-Quest-One","date":"2020-03-10T12:53:12.000Z","updated":"2022-03-06T10:28:21.343Z","comments":true,"path":"2020/03/10/2020-JetBrains-Quest-One/","link":"","permalink":"https://lolico.me/2020/03/10/2020-JetBrains-Quest-One/","excerpt":"","text":"2020å¹´3æœˆ9æ—¥ï¼ŒJetBrainså®˜æ–¹æ¨ç‰¹å‘å¸ƒäº†è¿™ä¹ˆä¸€æ¡æ¶ˆæ¯ï¼š48 61 76 65 20 79 6f 75 20 73 65 65 6e 20 74 68 65 20 73 6f 75 72 63 65 20 63 6f 64 65 20 6f 66 20 74 68 65 20 4a 65 74 42 72 61 69 6e 73 20 77 65 62 73 69 74 65 3fè§‚å¯Ÿè¿™äº›æ•°å­—ï¼Œä¸éš¾çŒœæµ‹æ˜¯å­—ç¬¦å¯¹åº”çš„asciiç çš„åå…­è¿›åˆ¶æ•°ï¼Œè½¬æ¢åï¼Œå¾—åˆ°è¿™æ ·çš„æç¤ºï¼šHave you seen the source code of the JetBrains website?é—®æˆ‘ä»¬æ˜¯å¦çœ‹è¿‡JetBrainsç½‘ç«™çš„æºç æ‰“å¼€JetBrainså®˜ç½‘æŸ¥çœ‹æºç ï¼Œæœç´¢JetBrains Questï¼šWelcome to the JetBrains Quest.â€‹What awaits ahead is a series of challenges. Each one will require a little initiative, a little thinking, and a whole lot of JetBrains to get to the end. Cheating is allowed and in some places encouraged. You have until the 15th of March at 12:00 CET to finish all the quests.Getting to the end of each quest will earn you a reward.Let the quest commence!â€‹JetBrains has a lot of products, but there is one that looks like a joke on our Products page, you should start thereâ€¦ (hint: use Chrome Incognito mode)Itâ€™s dangerous to go alone take this key: Good luck! == Jrrg#oxfn$å¤§æ¦‚è¯´çš„å°±æ˜¯åœ¨3æœˆ15æ—¥æ¬§æ´²ä¸­éƒ¨æ—¶é—´12:00å‰å®Œæˆè°œé¢˜å°±å¯ä»¥æ‹¿åˆ°å¥–åŠ±ï¼Œå¹¶ä¸”ç»™äº†æˆ‘ä»¬ä¸€ä¸ªå¯†é’¥ï¼šGood luck! == Jrrg#oxfn$è°œé¢˜ï¼šJetBrainsæœ‰å¾ˆå¤šäº§å“ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬çš„äº§å“é¡µé¢ä¸Šæœ‰ä¸€ä¸ªçœ‹èµ·æ¥åƒjokeçš„äº§å“ï¼Œæ‚¨åº”è¯¥ä»é‚£é‡Œå¼€å§‹â€¦ï¼ˆæç¤ºï¼šä½¿ç”¨è°·æ­Œæ— ç—•æ¨¡å¼ï¼‰è°·æ­Œæµè§ˆå™¨æ— ç—•æ¨¡å¼è®¿é—®JetBrainsäº§å“é¡µï¼ˆå®é™…ä¸Šæˆ‘ä¸å¼€æ— ç—•æ¨¡å¼è¿›å…¥ä¹Ÿæ˜¯å¯ä»¥çš„ï¼‰åœ¨äº§å“é‡Œæ‰¾åˆ°ä¸€ä¸ªå«JKçš„äº§å“ï¼Œç‚¹å‡»Learn Moreï¼šYou have discovered our JetBrains Quest! If you donâ€™t know what this is, you should start from Twitter, Facebook or LinkedIn.â€‹To continue to the next challenge you need to go to the following linkâ€¦ But there is a problem, the last 3 digits are missing:â€‹https://jb.gg/###â€‹To get these digits you need to know how many prime numbers there are between 500 and 5000â€‹Good Luck!500åˆ°5000é‡Œæœ‰å¤šå°‘ä¸ªè´¨æ•°ï¼Œç®€å•ï¼Œ574ä¸ªã€‚è¡¥å……åˆ°é“¾æ¥ä¸Šä¹Ÿå°±æ˜¯è®©æˆ‘ä»¬å»è¿™ä¸ªåœ°æ–¹ï¼šhttps://jb.gg/574é‡å®šå‘æ¥åˆ°äº†è¿™é‡Œï¼šå¦‚æœä½ å¯¹JetBrainsç½‘ç«™å¾ˆäº†è§£ä½ å°±ä¼šçŸ¥é“è¿™ä¸ªLogoæ˜¯youtrackï¼Œä¹Ÿå°±æ˜¯JebBrainsç½‘ç«™çš„é—®é¢˜åŒºï¼Œå°†åé¢çš„é—®é¢˜ç¼–ç è¾“è¿›å»ï¼Œå¾—åˆ°é“¾æ¥ï¼šhttps://youtrack.jetbrains.com/issue/MPS-31816è·³è½¬åˆ°è¿™ä¸ªé¡µé¢ï¼šJetBrains Questâ€‹â€œThe key is to think back to the beginning.â€ â€“ The JetBrains Quest teamâ€‹Qlfh$#Li#|rx#duh#uhdglqj#wklv#|rx#pxvw#kdyh#zrunhg#rxw#krz#wr#ghfu|sw#lw1#Wklv#lv#rxu#lvvxh#wudfnhu#ghvljqhg#iru#djloh#whdpv1#Lw#lv#iuhh#iru#xs#wr#6#xvhuv#lq#Forxg#dqg#iru#43#xvhuv#lq#Vwdqgdorqh/#vr#li#|rx#zdqw#wr#jlyh#lw#d#jr#lq#|rxu#whdp#wkhq#zh#wrwdoo|#uhfrpphqg#lw1#|rx#kdyh#ilqlvkhg#wkh#iluvw#Txhvw/#qrz#lwâ€œv#wlph#wr#uhghhp#|rxu#iluvw#sul}h1#Wkh#frgh#iru#wkh#iluvw#txhvw#lv#â€ŸWkhGulyhWrGhyhorsâ€ 1#Jr#wr#wkh#Txhvw#Sdjh#dqg#xvh#wkh#frgh#wr#fodlp#|rxu#sul}h1#kwwsv=22zzz1mhweudlqv1frp2surpr2txhvw2å‘Šè¯‰æˆ‘ä»¬éœ€è¦å›å¤´æƒ³ä¸€ä¸‹å¯†é’¥ï¼Œé‚£ä¸å°±æ˜¯ç½‘ç«™æºç é‡Œçš„Good luck! == Jrrg#oxfn$å˜›ã€‚é‚£åé¢é‚£ä¸€ä¸²ä¸œè¥¿å’Œè¿™ä¸ªæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿæˆ‘å°±ä¸å–å…³å­äº†ï¼Œå…¶å®ä¹Ÿå°±æ˜¯å‡¯æ’’åŠ å¯†ï¼Œæºç é‡Œå‘Šè¯‰æˆ‘ä»¬çš„Good luck! == Jrrg#oxfn$å…¶å®å°±ç›¸å½“äºä¸€ä¸ªè¾“å…¥è¾“å‡ºæ¡ˆä¾‹ï¼šæ˜æ–‡Good luck!ç»å‡¯æ’’åŠ å¯†åå¾—åˆ°Jrrg#oxfn$å‡¯æ’’åŠ å¯†ï¼šå°†æ˜æ–‡å­—ç¬¦ä»¥æŸä¸ªæ•°å­—ç§»ä½å¾—åˆ°å¦ä¸€ä¸ªå­—ç¬¦ï¼Œè¯´äººè¯ä¹Ÿå°±æ˜¯æŠŠå­—ç¬¦çš„asciiç åŠ æˆ–è€…å‡æŸä¸ªæ•°å¾—åˆ°å¦ä¸€ä¸ªå­—ç¬¦çš„asciiä¹Ÿå°±æ˜¯å¯†æ–‡æ‰€ä»¥è¯´ç»™å‡ºçš„è¿™ä¸ªè¾“å…¥è¾“å‡ºæˆ‘ä»¬å¯ä»¥çŸ¥é“è¿™ä¸ªæ•°å­—æ˜¯3ã€‚æ‰€ä»¥è¯´å°†ç»™å‡ºçš„è¿™ä¸ªå¯†æ–‡è¿˜åŸæˆæ˜æ–‡åªéœ€è¦å°†æ¯ä¸ªå­—ç¬¦çš„asciiç å‡ä¸‰å¾—åˆ°çš„å­—ç¬¦ä¸²å°±æ˜¯æ˜æ–‡äº†ï¼š1234567if __name__ == \"__main__\": s = \"Qlfh$#Li#|rx#duh#uhdglqj#wklv#|rx#pxvw#kdyh#zrunhg#rxw#krz#wr#ghfu|sw#lw1#Wklv#lv#rxu#lvvxh#wudfnhu#ghvljqhg#iru#djloh#whdpv1#Lw#lv#iuhh#iru#xs#wr#6#xvhuv#lq#Forxg#dqg#iru#43#xvhuv#lq#Vwdqgdorqh/#vr#li#|rx#zdqw#wr#jlyh#lw#d#jr#lq#|rxu#whdp#wkhq#zh#wrwdoo|#uhfrpphqg#lw1#|rx#kdyh#ilqlvkhg#wkh#iluvw#Txhvw/#qrz#lwâ€œv#wlph#wr#uhghhp#|rxu#iluvw#sul&#125;h1#Wkh#frgh#iru#wkh#iluvw#txhvw#lv#â€ŸWkhGulyhWrGhyhorsâ€ 1#Jr#wr#wkh#Txhvw#Sdjh#dqg#xvh#wkh#frgh#wr#fodlp#|rxu#sul&#125;h1#kwwsv=22zzz1mhweudlqv1frp2surpr2txhvw2\" step = ord('J')-ord('G') #Good luck! == Jrrg#oxfn$ list = list(s) for i in range(len(list)): list[i] = chr(ord(list[i]) - step) print(\"\".join(list))è¾“å‡ºï¼šNice! If you are reading this you must have worked out how to decrypt it. This is our issue tracker designed for agile teams. It is free for up to 3 users in Cloud and for 10 users in Standalone, so if you want to give it a go in your team then we totally recommend it. you have finished the first Quest, now itâ€™s time to redeem your first prize. The code for the first quest is â€œTheDriveToDevelopâ€. Go to the Quest Page and use the code to claim your prize. https://www.jetbrains.com/promo/quest/å¾—åˆ°ä¸€ä¸ªç½‘å€å’Œå…‘æ¢ç ã€‚æ¥ä¸‹æ¥çš„å…‘å¥–ç¯èŠ‚åº”è¯¥å°±ä¸ç”¨å¤šè¯´äº†ã€‚","categories":[{"name":"ä¸æ­£å¸¸çš„æ–‡ç« ","slug":"ä¸æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E4%B8%8D%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"JetBrains Quest","slug":"JetBrains-Quest","permalink":"https://lolico.me/tags/JetBrains-Quest/"}]},{"title":"è·å–æ³›å‹å‚æ•°çš„ç±»å‹","slug":"è·å–æ³›å‹å‚æ•°çš„ç±»å‹","date":"2020-03-10T09:18:17.000Z","updated":"2022-03-06T10:28:21.347Z","comments":true,"path":"2020/03/10/è·å–æ³›å‹å‚æ•°çš„ç±»å‹/","link":"","permalink":"https://lolico.me/2020/03/10/%E8%8E%B7%E5%8F%96%E6%B3%9B%E5%9E%8B%E5%8F%82%E6%95%B0%E7%9A%84%E7%B1%BB%E5%9E%8B/","excerpt":"","text":"ç°åœ¨æœ‰è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šæœ‰ä¸€ä¸ªæŒ‰é’®ç›‘å¬å™¨ç±»ButtonListenerï¼šButtonListener.java123456import me.lolico.demo.button.event.ButtonEvent;import java.util.EventListener;public interface ButtonListener&lt;E extends ButtonEvent&gt; extends EventListener &#123; void onButtonEvent(E event);&#125;ä»¥åŠä¸€ä¸ªç›‘å¬æŒ‰é’®nameæ˜¯å¦æ”¹å˜å³ButtonNameHasChangedEventäº‹ä»¶çš„å®ç°ç±»ButtonNameListenerï¼šButtonNameListener.java1234567891011121314import me.lolico.demo.button.Button;import me.lolico.demo.button.ButtonListener;import me.lolico.demo.button.event.ButtonNameHasChangedEvent;/** * @author Lolico li */public class ButtonNameListener implements ButtonListener&lt;ButtonNameHasChangedEvent&gt; &#123; @Override public void onButtonEvent(ButtonNameHasChangedEvent event) &#123; Button button = (Button) event.getSource(); System.out.println(button + \"name has changed!\"); &#125;&#125;å½“æˆ‘ä»¬è°ƒç”¨è®¾ç½®æŒ‰é’®setNameæ–¹æ³•æ—¶éœ€è¦å‘å¸ƒButtonNameHasChangedEventäº‹ä»¶ï¼Œæˆ‘ä»¬éœ€è¦æ€ä¹ˆå»é€šçŸ¥ç›‘å¬è¿™ä¸ªäº‹ä»¶çš„ç›‘å¬å™¨å‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦è·å–åˆ°æ‰€æœ‰çš„æŒ‰é’®ç›‘å¬å™¨ï¼Œç„¶åéå†ï¼Œè·å–æ³›å‹ç±»å‹ï¼Œå¦‚æœç±»å‹åŒ¹é…ï¼Œé‚£ä¹ˆåˆ™é€šçŸ¥è¿™ä¸ªç›‘å¬å™¨æ‰€ä»¥ç°åœ¨é—®é¢˜å˜æˆäº†å¦‚ä½•è·å–æŒ‰é’®ç›‘å¬å™¨çš„æ³›å‹ç±»å‹ï¼Œå¦‚æœæˆ‘ä»¬ç™¾åº¦ä¸€ä¸‹ï¼Œæ¸…ä¸€è‰²çš„ç­”æ¡ˆéƒ½æ˜¯ä¸‹é¢è¿™ç§ï¼šè·å–æŸä¸ªç±»çš„æ³›å‹å‚æ•°çš„ç±»å‹1((ParameterizedType) clazz.getGenericSuperclass()).getActualTypeArguments()å¯¹äºè¿™ç§åœºæ™¯ï¼Œé‚£ä¹ˆå°±æ˜¯ä¸€ä¸ªå¼‚å¸¸æŠ›å‡ºï¼š1java.lang.ClassCastException: java.lang.Class cannot be cast to java.lang.reflect.ParameterizedTypeä¸ºä»€ä¹ˆå‘¢ï¼Œå› ä¸ºClass#getGenericSuperclass()æ–¹æ³•è¿”å›çš„æ˜¯è¶…ç±»çš„Typeï¼Œæ‰€ä»¥è¯´è¿™ç§æ–¹æ³•åªèƒ½ç”¨äºè·å–è¶…ç±»ä¸Šé¢çš„æ³›å‹ç±»å‹ï¼Œè€Œæˆ‘ä»¬ä¸Šé¢çš„æ¡ˆä¾‹æ˜æ˜¾æ˜¯è¦è·å–æ¥å£ä¸Šçš„çš„æ³›å‹ç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥ä½¿ç”¨çš„æ˜¯Class#getGenericInterfaces()æ–¹æ³•ã€‚è·å–ä¸€ä¸ªç±»ä¸Šçš„æ‰€æœ‰æ³›å‹ç±»å‹ï¼š12345678910111213public Set&lt;Type&gt; resolveGenericType(Class&lt;?&gt; clazz) &#123; Set&lt;Type&gt; genericSet = new HashSet&lt;&gt;(); Type superclass = clazz.getGenericSuperclass(); if (superclass instanceof ParameterizedType) &#123; genericSet.addAll(Arrays.asList(((ParameterizedType) superclass).getActualTypeArguments())); &#125; Type[] interfaces = clazz.getGenericInterfaces(); for (Type type : interfaces) &#123; Type[] genericType = ((ParameterizedType) type).getActualTypeArguments(); genericSet.addAll(Arrays.asList(genericType)); &#125; return genericSet;&#125;æ³¨æ„ï¼šè·å–çš„æ³›å‹ç±»å‹ä¸åŒ…æ‹¬å®ç°çš„æ¥å£ç»§æ‰¿çš„æ¥å£ä¸Šçš„æ³›å‹ç±»å‹ï¼Œå› ä¸ºClass#getGenericInterfaces()æ–¹æ³•ä¸æ˜¯é€’å½’è·å–æ‰€æœ‰æ¥å£ç±»å‹ï¼Œåªè·å–å½“å‰ç±»å®ç°çš„æ¥å£çš„ç±»å‹ã€‚","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://lolico.me/tags/Java/"}]},{"title":"æºç è§’åº¦åˆ†æSpringå®¹å™¨å¯åŠ¨é˜¶æ®µæ³¨å†ŒControllerå¤„ç†å™¨çš„æµç¨‹","slug":"æºç è§’åº¦åˆ†æSpringå®¹å™¨å¯åŠ¨é˜¶æ®µæ³¨å†ŒControllerå¤„ç†å™¨çš„æµç¨‹","date":"2020-03-09T08:09:08.000Z","updated":"2022-03-06T10:28:21.347Z","comments":true,"path":"2020/03/09/æºç è§’åº¦åˆ†æSpringå®¹å™¨å¯åŠ¨é˜¶æ®µæ³¨å†ŒControllerå¤„ç†å™¨çš„æµç¨‹/","link":"","permalink":"https://lolico.me/2020/03/09/%E6%BA%90%E7%A0%81%E8%A7%92%E5%BA%A6%E5%88%86%E6%9E%90Spring%E5%AE%B9%E5%99%A8%E5%90%AF%E5%8A%A8%E9%98%B6%E6%AE%B5%E6%B3%A8%E5%86%8CController%E5%A4%84%E7%90%86%E5%99%A8%E7%9A%84%E6%B5%81%E7%A8%8B/","excerpt":"","text":"å‰è¨€æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œåœ¨ä¸€ä¸ªè¯·æ±‚è¢«å‰ç«¯æ§åˆ¶å™¨DispatchServletæ•è·åä¼šç»å†ä¸‹é¢å‡ ä¸ªæµç¨‹ï¼šDispatherServletæ ¹æ®è¯·æ±‚URLè§£æè·å–è¯·æ±‚URIï¼Œè°ƒç”¨HandlerMapping#getHandleræ–¹æ³•è·å–HandlerExecutionChainè·å–è¿”å›çš„HandlerExecutionChainå¤„ç†å™¨æ‰§è¡Œé“¾ï¼ˆåŒ…æ‹¬å¤„ç†å™¨å¯¹è±¡å’Œæ‹¦æˆªå™¨å¯¹è±¡ï¼‰æ ¹æ®å¤„ç†å™¨æ‰§è¡Œé“¾è·å–ä¸€ä¸ªå¤„ç†å™¨é€‚é…å™¨HandlerAdapterï¼Œå¦‚æœæˆåŠŸè·å–ï¼Œåˆ™å¼€å§‹æ‰§è¡Œæ‹¦æˆªå™¨ï¼‰å¤„ç†å™¨é€‚é…å™¨æ ¹æ®è¯·æ±‚çš„Handlerï¼ˆä¸€èˆ¬æ¥è¯´æ˜¯HandlerMethodï¼‰é€‚é…å¹¶æ ¹æ®é…ç½®çš„HttpMessageConveterå°†è¯·æ±‚æ¶ˆæ¯è§£æä¸ºæ¨¡å‹æ•°æ®ï¼Œå¡«å…… Handlerå…¥å‚ï¼Œå¼€å§‹æ‰§è¡Œå¤„ç†å™¨é€»è¾‘ã€‚å¤„ç†å™¨æ‰§è¡Œå®Œæ¯•ï¼Œè¿”å›ModelAndViewï¼Œå¤„ç†å™¨é€‚é…å™¨æ¥æ”¶åˆ°åè¿”å›ç»™DispatherServletDispatherServletæ ¹æ®æ¨¡å‹å’Œè§†å›¾è¯·æ±‚å¯¹åº”çš„è§†å›¾è§£æå™¨è§†å›¾è§£æå™¨è§£ææ¨¡å‹æ•°æ®è·å–å¯¹åº”çš„è§†å›¾ï¼Œæ¸²æŸ“è§†å›¾åè¿”å›ç»™DispatherServletDispatherServletå°†æ¸²æŸ“åçš„è§†å›¾ç›¸åº”ç»™ç”¨æˆ·æˆ–å®¢æˆ·ç«¯é‚£ä¹ˆSpringå®¹å™¨å¯åŠ¨åæ˜¯å¦‚ä½•è‡ªåŠ¨å‘ç°å¤„ç†å™¨ï¼ˆæˆ‘åœ¨è¿™ç§°ä¹‹ä¸ºè‡ªåŠ¨å‘ç°æœºåˆ¶ï¼‰å¹¶è¿›è¡Œæ³¨å†Œçš„å‘¢ï¼Ÿåœ¨webç¯å¢ƒä¸‹Springå®¹å™¨å¯åŠ¨æ—¶ä¼šæ³¨å†ŒHandlerMappingï¼Œå…·ä½“åœ¨SpringBootä¸­ï¼ŒWebMvcAutoConfigurationä¼šé€šè¿‡WebMvcConfigurationSupport#requestMappingHandlerMappingæ–¹æ³•å‘å®¹å™¨ä¸­æ³¨å†Œä¸€ä¸ªHandlerMappingçš„å®ç°RequestMappingHandlerMappingè‡ªåŠ¨å‘ç°æœºåˆ¶çš„å®ç°Springå®¹å™¨å¯åŠ¨æ—¶ä¼šæ³¨å†ŒHandlerMappingï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°±ä»¥RequestMappingHandlerMappingå®ç°ç±»ä¸ºä¾‹è¿›è¡Œåˆ†æRequestMappingHandlerMappingRequestMappingHandlerMapping#afterPropertiesSetæ–¹æ³•å®é™…ä¸Šè°ƒç”¨äº†çˆ¶ç±»çš„afterPropertiesSetçš„æ–¹æ³•ï¼šRequestMappingHandlerMapping#afterPropertiesSet1234public void afterPropertiesSet() &#123; ... super.afterPropertiesSet();&#125;è€Œåœ¨çˆ¶ç±»çš„è¿™ä¸ªæ–¹æ³•ä¸­è¿›è¡Œåˆå§‹åŒ–å¤„ç†å™¨é€»è¾‘ï¼šAbstractHandlerMethodMapping#afterPropertiesSet12345678/** * Detects handler methods at initialization. * @see #initHandlerMethods */@Overridepublic void afterPropertiesSet() &#123; initHandlerMethods();&#125;åœ¨initHandlerMethodsæ–¹æ³•ä¸­å…ˆä»å®¹å™¨ä¸­è·å–æ‰€æœ‰çš„å€™é€‰beanï¼Œè°ƒç”¨processCandidateBeanæ–¹æ³•ï¼šAbstractHandlerMethodMapping#initHandlerMethods1234567891011121314/** * Scan beans in the ApplicationContext, detect and register handler methods. * @see #getCandidateBeanNames() * @see #processCandidateBean * @see #handlerMethodsInitialized */protected void initHandlerMethods() &#123; for (String beanName : getCandidateBeanNames()) &#123; if (!beanName.startsWith(SCOPED_TARGET_NAME_PREFIX)) &#123; processCandidateBean(beanName); &#125; &#125; handlerMethodsInitialized(getHandlerMethods());&#125;åœ¨processCandidateBeanæ–¹æ³•ä¸­æ ¹æ®beançš„ç±»å‹è°ƒç”¨ç”±å­ç±»å®ç°çš„isHandleræ–¹æ³•åˆ¤æ–­æ˜¯å¦æ˜¯å¤„ç†å™¨ï¼Œç„¶åè°ƒç”¨detectHandlerMethodsæ–¹æ³•å¯»æ‰¾è¯¥å¤„ç†å™¨ä¸­çš„å¤„ç†æ–¹æ³•å¹¶æ³¨å†Œã€‚æ¥çœ‹ä¸‹RequestMappingHandlerMapping#isHandler1234protected boolean isHandler(Class&lt;?&gt; beanType) &#123; return (AnnotatedElementUtils.hasAnnotation(beanType, Controller.class) || AnnotatedElementUtils.hasAnnotation(beanType, RequestMapping.class));&#125;å¯¹åº”çš„AnnotatedElementUtils#hasAnnotationæ–¹æ³•ï¼Œæœ€ç»ˆä¼šè°ƒç”¨åˆ°AnnotatedElementUtils#searchWithFindSemanticsæ–¹æ³•ï¼Œä»£ç ç‰‡æ®µå¦‚ä¸‹12345678910111213141516171819202122 else if (element instanceof Class) &#123; Class&lt;?&gt; clazz = (Class&lt;?&gt;) element; if (!Annotation.class.isAssignableFrom(clazz)) &#123; // Search on interfaces åœ¨å®ç°æ¥å£ä¸­æŸ¥æ‰¾ for (Class&lt;?&gt; ifc : clazz.getInterfaces()) &#123; T result = searchWithFindSemantics(ifc, annotationTypes, annotationName, containerType, processor, visited, metaDepth); if (result != null) &#123; return result; &#125; &#125; // Search on superclass åœ¨çˆ¶ç±»ä¸­æŸ¥æ‰¾ Class&lt;?&gt; superclass = clazz.getSuperclass(); if (superclass != null &amp;&amp; superclass != Object.class) &#123; T result = searchWithFindSemantics(superclass, annotationTypes, annotationName, containerType, processor, visited, metaDepth); if (result != null) &#123; return result; &#125; &#125; &#125;&#125;å‘ç°è¿™ä¸ªåœ°æ–¹æŸ¥æ‰¾æ˜¯å¦æœ‰æŒ‡å®šæ³¨è§£æ—¶ï¼Œå¦‚æœç»§æ‰¿çš„ç±»æˆ–å®ç°çš„æ¥å£æœ‰ç›¸åº”çš„æ³¨è§£ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè¿™ä¸ªç‰¹æ€§åœ¨æŸäº›æƒ…å†µä¸‹æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œæ¯”å¦‚åœ¨è‡ªåŠ¨é…ç½®ç±»ä¸­å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‰¹ç‚¹ï¼Œä½¿ç”¨@Beanæ³¨è§£å†é…åˆ@Conditionalxxxç­‰æ³¨è§£å®ç°æŒ‰éœ€æ³¨å…¥Controllerã€‚æˆ‘ä»¬åªè¦å®šä¹‰ä¸€ä¸ªæ ‡è®°ç±»/æ¥å£ï¼Œå†åœ¨è¯¥ç±»ä¸Šæ³¨è§£@Controlleræˆ–@RequestMappingï¼Œç„¶åè®©éœ€è¦æŒ‰éœ€æ³¨å…¥çš„Controllerç»§æ‰¿è¿™ä¸ªæ ‡è®°ç±»/æ¥å£å³å¯ã€‚æ³¨æ„ï¼Œåœ¨ä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨@Beanæˆ–@Componentæ³¨è§£æ˜¯ä¸èƒ½å°†ä¸€ä¸ªBeanæ³¨å†Œä¸ºControllerçš„AbstractHandlerMethodMapping#detectHandlerMethodsç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸ªè‡ªåŠ¨å‘ç°æœºåˆ¶ä¸­æœ€å…³é”®çš„æ–¹æ³•ï¼šAbstractHandlerMethodMapping#detectHandlerMethods12345678910111213141516171819202122232425262728293031protected void detectHandlerMethods(Object handler) &#123; Class&lt;?&gt; handlerType = (handler instanceof String ? obtainApplicationContext().getType((String) handler) : handler.getClass()); if (handlerType != null) &#123; // è·å–ç”¨æˆ·å®šä¹‰çš„ç±»ï¼Œé˜²æ­¢åœ¨ä»£ç†æ¨¡å¼ä¸‹ä¸èƒ½è·å–åˆ°æ–¹æ³•ä»¥åŠä¸Šé¢çš„æ³¨è§£ Class&lt;?&gt; userType = ClassUtils.getUserClass(handlerType); // è¿”å›æ–¹æ³•åŠå…¶ç›¸å…³å…ƒæ•°æ®çš„ä¸€ä¸ªmapï¼Œå…ƒæ•°æ®æ˜¯å›è°ƒlambdaè·å–çš„ï¼Œå¯ä»¥çœ‹ä¸‹MetadataLookup#inspectå‡½æ•°å¼æ¥å£ Map&lt;Method, T&gt; methods = MethodIntrospector.selectMethods(userType, (MethodIntrospector.MetadataLookup&lt;T&gt;) method -&gt; &#123; try &#123; // ç”±å­ç±»å®ç°çš„æŠ½è±¡æ–¹æ³• // åœ¨RequestMappingHandlerMappingä¸­æ˜¯RequestMappingInfo return getMappingForMethod(method, userType); &#125; catch (Throwable ex) &#123; throw new IllegalStateException(\"Invalid mapping on handler class [\" + userType.getName() + \"]: \" + method, ex); &#125; &#125;); if (logger.isTraceEnabled()) &#123; logger.trace(formatMappings(userType, methods)); &#125; methods.forEach((method, mapping) -&gt; &#123; // è·å–è¯¥æ–¹æ³•çš„å¯è°ƒç”¨æ–¹æ³• Method invocableMethod = AopUtils.selectInvocableMethod(method, userType); // æ³¨å†Œ registerHandlerMethod(handler, invocableMethod, mapping); &#125;); &#125;&#125;è€Œåœ¨RequestMappingHandlerMapping#getMappingForMethodä¸­å…ˆæ£€æŸ¥æ˜¯å¦æ³¨è§£äº†@RequestMappingï¼Œå¦‚æœæœ‰åˆ™è·å–æ³¨è§£ä¸­çš„è¯·æ±‚çš„è·¯å¾„ï¼Œè¯·æ±‚çš„æ–¹å¼ï¼ˆGET,POST,â€¦)ç­‰ç­‰ä¿¡æ¯ï¼Œå°è£…åˆ°RequestMappingInfoä¸­è¿”å›ï¼Œå…·ä½“çš„ä»£ç å°±ä¸æ”¾äº†ï¼Œè¿˜æ˜¯å¾ˆå¥½ç†è§£çš„ã€‚å†æ¥çœ‹ä¸‹æœ€åè¿™ä¸ªAbstractHandlerMethodMapping#registerHandlerMethodæ–¹æ³•AbstractHandlerMethodMapping#registerHandlerMethod123protected void registerHandlerMethod(Object handler, Method method, T mapping) &#123; this.mappingRegistry.register(mapping, handler, method);&#125;å¾ˆå¥½ç†è§£ï¼Œè°ƒç”¨mappingRegistry#registeræ–¹æ³•è¿›è¡Œæ³¨å†Œï¼Œé‚£è¿™ä¸ªmappingRegistryæ˜¯ä»€ä¹ˆä¸œè¥¿å‘¢ï¼ŸMappingRegistryå®é™…ä¸Šå°±æ˜¯AbstractHandlerMethodMappingç±»ä¸­çš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œçœ‹åå­—å¾ˆå¥½ç†è§£ï¼šæ˜ å°„æ³¨å†Œè¡¨ï¼Œè¿™ä¸ªç±»ä¸­ç»´æŠ¤äº†å­˜æ”¾æ˜ å°„ä¿¡æ¯çš„mapMappingRegistryMappingRegistryæ˜¯AbstractHandlerMethodMappingç±»ä¸­çš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œåœ¨å…¶ä¸­ç»´æŠ¤äº†äº”ä¸ªç”¨äºå­˜æ”¾æ˜ å°„ä¿¡æ¯çš„Mapï¼šMappingRegistryç±»å­—æ®µ1234567891011// çœŸæ­£æ„ä¹‰ä¸Šçš„æ³¨å†Œè¡¨ï¼Œä»¥RequestMappingInfoä¸ºkey// MappingRegistrationä¸­å­˜æ”¾è¯·æ±‚æ˜ å°„ä¿¡æ¯RequestMappingInfoã€å¤„ç†å™¨æ–¹æ³•HandlerMethodï¼ˆå³æ ‡æ³¨äº†@RequestMappingçš„å¤„ç†æ–¹æ³•ï¼‰ã€æ˜ å°„è·¯å¾„urlã€å¤„ç†å™¨nameprivate final Map&lt;T, MappingRegistration&lt;T&gt;&gt; registry = new HashMap&lt;&gt;();// RequestMappingInfoå’ŒHandlerMethodçš„mapprivate final Map&lt;T, HandlerMethod&gt; mappingLookup = new LinkedHashMap&lt;&gt;();// url(è¯·æ±‚è·¯å¾„)å’ŒRequestMappingInfoçš„mapprivate final MultiValueMap&lt;String, T&gt; urlLookup = new LinkedMultiValueMap&lt;&gt;();// å¤„ç†å™¨nameå’Œå¤„ç†å™¨æ–¹æ³•çš„mapprivate final Map&lt;String, List&lt;HandlerMethod&gt;&gt; nameLookup = new ConcurrentHashMap&lt;&gt;();// å¤„ç†å™¨æ–¹æ³•å’Œè·¨åŸŸé…ç½®çš„mapprivate final Map&lt;HandlerMethod, CorsConfiguration&gt; corsLookup = new ConcurrentHashMap&lt;&gt;();MappingRegistry#registerMappingRegistry#register12345678910111213141516171819202122232425262728293031323334353637public void register(T mapping, Object handler, Method method) &#123; // Assert that the handler method is not a suspending one. if (KotlinDetector.isKotlinType(method.getDeclaringClass()) &amp;&amp; KotlinDelegate.isSuspend(method)) &#123; throw new IllegalStateException(\"Unsupported suspending handler method detected: \" + method); &#125; this.readWriteLock.writeLock().lock(); try &#123; // åˆ›å»ºå¤„ç†å™¨æ–¹æ³• HandlerMethod handlerMethod = createHandlerMethod(handler, method); validateMethodMapping(handlerMethod, mapping); // å°†æ˜ å°„ä¿¡æ¯å’Œå¤„ç†å™¨æ–¹æ³•æ”¾åˆ°mapä¸­ this.mappingLookup.put(mapping, handlerMethod); // è·å–æ˜ å°„çš„è¯·æ±‚è·¯å¾„æ•°ç»„ï¼Œåœ¨RequestMappingæ³¨è§£ä¸­å¯å¯¹ä¸€ä¸ªæ–¹æ³•æŒ‡å®šå¤šä¸ªæ˜ å°„è·¯å¾„ List&lt;String&gt; directUrls = getDirectUrls(mapping); for (String url : directUrls) &#123; // æ”¾å…¥map this.urlLookup.add(url, mapping); &#125; // å¦‚æœnameå­˜å‚¨ç­–ç•¥ä¸ä¸ºç©ºï¼Œå°†å¤„ç†å™¨nameå’Œå¤„ç†å™¨æ–¹æ³•æ”¾åˆ°nameLookup mapä¸­ String name = null; if (getNamingStrategy() != null) &#123; name = getNamingStrategy().getName(handlerMethod, mapping); // å°†å¤„ç†å™¨nameå’Œå¤„ç†å™¨æ–¹æ³•æ”¾åˆ°nameLookup mapä¸­ addMappingName(name, handlerMethod); &#125; // è·¨åŸŸé…ç½® CorsConfiguration corsConfig = initCorsConfiguration(handler, method, mapping); if (corsConfig != null) &#123; this.corsLookup.put(handlerMethod, corsConfig); &#125; // å°†æ˜ å°„ä¿¡æ¯å’ŒMappingRegistrationæ”¾åˆ°æ³¨å†Œè¡¨Map this.registry.put(mapping, new MappingRegistration&lt;&gt;(mapping, handlerMethod, directUrls, name)); &#125; finally &#123; this.readWriteLock.writeLock().unlock(); &#125;&#125;è¿™ä¸ªæ–¹æ³•è¯´ç™½äº†ï¼Œå°±æ˜¯æŠŠå¤„ç†å™¨ï¼Œå¤„ç†å™¨æ–¹æ³•ï¼Œè¯·æ±‚æ˜ å°„ä¿¡æ¯ç­‰ç­‰ä¿¡æ¯æ”¾åˆ°Mapä¸­ï¼Œçœ‹åˆ°è¿™é‡Œå¯èƒ½ä¼šå¯¹RequestMappingInfoå’Œ MappingRegistrationè¿™ä¸¤ä¸ªä¸œè¥¿æ„Ÿåˆ°ç–‘æƒ‘ï¼Œå…¶å®å¾ˆç®€å•ï¼Œå‰è€…æ˜¯Springå®¹å™¨å¯åŠ¨æ—¶æ§åˆ¶å™¨è‡ªåŠ¨å‘ç°æœºåˆ¶æ ¹æ®æ–¹æ³•ä¸Š@RequestMappingæ³¨è§£ä¸­çš„ä¿¡æ¯å°è£…çš„å¯¹è±¡ï¼Œå†³å®šäº†ä»€ä¹ˆæ ·çš„è¯·æ±‚èƒ½å‘½ä¸­é‚£ä¸ªå¤„ç†å™¨æ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯MappingRegistry#registryæ³¨å†Œè¡¨ä¸­ä»¥RequestMappingInfoä¸ºkeyçš„åŸå› ï¼Œè€ŒMappingRegistrationä¸­å°è£…äº†å¤„ç†å™¨Handler,å¤„ç†å™¨æ–¹æ³•HandlerMethodä¿¡æ¯ã€‚æ‰€ä»¥ç°åœ¨èƒ½çŸ¥é“ä¸€ä¸ªè¯·æ±‚åˆ°æ¥æ—¶æ˜¯å¦‚ä½•æ‰¾åˆ°å¤„ç†å™¨æ–¹æ³•å¹¶è°ƒç”¨çš„äº†ï¼šæ ¹æ®è¯·æ±‚çš„urlåˆ°MappingRegistry#urlLookupå­—æ®µä¸­åŒ¹é…ï¼Œå¦‚æœåŒ¹é…ä¸Šï¼Œåˆ™å–å‡ºå¯¹åº”çš„RequestMappingInfoï¼Œå†åˆ°MappingRegistry#registryå­—æ®µä¸­å–å‡ºMappingRegistrationï¼Œå†å–å‡ºMappingRegistrationä¸­çš„å¤„ç†å™¨Handlerå’Œæ–¹æ³•HandlerMethodï¼Œåå°„è°ƒç”¨å®Œæˆè¯·æ±‚ã€‚å½“ç„¶ï¼Œè¿™åªæ˜¯å¤§æ¦‚çš„æµç¨‹ã€‚åè¯­Springå®¹å™¨å¯åŠ¨ï¼Œæ³¨å†Œå¤„ç†å™¨çš„æµç¨‹åˆ†æå®Œäº†ã€‚å…¶å®è¯´ç™½äº†ï¼ŒSpringå®¹å™¨æ³¨å†Œæ§åˆ¶å™¨å°±æ˜¯æ‰«æå®¹å™¨ä¸­çš„beanç„¶åæ£€æŸ¥æ˜¯å¦æ˜¯æ§åˆ¶å™¨Controllerï¼Œç„¶åå°†å…¶ä¸­æ³¨è§£æœ‰@RequestMappingçš„æ–¹æ³•æ³¨å†Œä¸ºå¤„ç†å™¨æ–¹æ³•ã€‚å…¶å®HandlerMappingçš„å®ç°ç±»å¹¶ä¸æ˜¯åªæœ‰RequestMappingHandlerMappingä¸€ä¸ªï¼Œä½†æ˜¯æ˜¯AbstractHandlerMethodMappingæä¾›çš„ä¸»è¦çš„å®ç°é€»è¾‘ï¼Œè€Œå®ç°ç±»åªæ˜¯æä¾›äº†åŸºç¡€çš„åˆ¤æ–­ï¼šæ˜¯å¦æ˜¯å¤„ç†å™¨ï¼ˆisHandler)ï¼Œè·å–è¯·æ±‚æ˜ å°„ä¿¡æ¯getMappingForMethodç­‰æŠ½è±¡æ–¹æ³•ï¼Œæ‰€ä»¥è¯´å¦‚æœåœ¨æŸäº›åœºæ™¯ä¸‹éœ€è¦å®ç°è‡ªå®šä¹‰çš„HandlerMappingæ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»§æ‰¿RequestMappingInfoHandlerMappingç„¶åé‡å†™isHandlerå’ŒgetMappingForMethodæ–¹æ³•å³å¯ã€‚ï¼ˆRequestMappingHandlerMappingç»§æ‰¿è‡ªRequestMappingInfoHandlerMappingï¼‰è‡³äºæ¡ˆä¾‹ï¼Œä»¥åæœ‰ç©ºäº†å†è¡¥ä¸Š","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"https://lolico.me/tags/Spring/"},{"name":"Web","slug":"Web","permalink":"https://lolico.me/tags/Web/"},{"name":"Java","slug":"Java","permalink":"https://lolico.me/tags/Java/"}]},{"title":"Hello World","slug":"hello-world","date":"2020-03-02T16:00:00.000Z","updated":"2022-03-06T10:28:21.347Z","comments":true,"path":"2020/03/02/hello-world/","link":"","permalink":"https://lolico.me/2020/03/02/hello-world/","excerpt":"","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.åšå®¢ä»¥è¿ç§»è‡³Hexoï¼Œæ‰˜ç®¡åœ¨GitHubä¸Šï¼Œç›®å‰æ„Ÿè§‰é™¤äº†é€Ÿåº¦å…¶ä»–éƒ½è¿˜å¥½ï¼Œåç»­å¯èƒ½è€ƒè™‘æ‰˜ç®¡åœ¨å¯¹è±¡å­˜å‚¨ä¸Šã€‚å°è¯•ç€æŠŠtypechoçš„å†…å®¹è¿ç§»äº†è¿‡æ¥ï¼Œè¿˜æœ‰å¾…å®Œå–„ã€‚ä¿ç•™çš„å†…å®¹æ–‡ç« æ•°æ®æ–‡ç« åˆ†ç±»ä»¥åŠtagä¸¢å¤±çš„å†…å®¹è¯„è®ºæ•°æ®æ–‡ç« ä¸­å›¾ç‰‡","categories":[],"tags":[]},{"title":"æºç è§’åº¦åˆ†æShiroè®¤è¯æµç¨‹ä»¥åŠä¸€ä¸ªå‰åç«¯åˆ†ç¦»æ¡ˆä¾‹","slug":"æºç è§’åº¦åˆ†æShiroè®¤è¯æµç¨‹ä»¥åŠä¸€ä¸ªå‰åç«¯åˆ†ç¦»æ¡ˆä¾‹","date":"2020-02-04T10:50:51.000Z","updated":"2022-03-06T10:28:21.347Z","comments":true,"path":"2020/02/04/æºç è§’åº¦åˆ†æShiroè®¤è¯æµç¨‹ä»¥åŠä¸€ä¸ªå‰åç«¯åˆ†ç¦»æ¡ˆä¾‹/","link":"","permalink":"https://lolico.me/2020/02/04/%E6%BA%90%E7%A0%81%E8%A7%92%E5%BA%A6%E5%88%86%E6%9E%90Shiro%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B%E4%BB%A5%E5%8F%8A%E4%B8%80%E4%B8%AA%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E6%A1%88%E4%BE%8B/","excerpt":"","text":"ä»æºç å»åˆ†æè®¤è¯æµç¨‹å‰ï¼Œä½ éœ€è¦çŸ¥é“Shiroæ˜¯ä»€ä¹ˆï¼Œä»¥åŠShiroä¸­çš„åŸºæœ¬ç»„ä»¶ã€‚åœ¨çœ‹æœ¬ç¯‡æ–‡ç« å‰ï¼Œæˆ‘å‡è®¾ä½ å·²ç»çŸ¥é“ä¸Šè¿°ä¸œè¥¿ï¼Œå¹¶ä¸”åç»­çš„åˆ†æä¸ä¼šå¯¹è¿™äº›ç»„ä»¶æ˜¯ä»€ä¹ˆè¿›è¡Œè®²è§£ã€‚å¦‚æœä½ å¹¶ä¸äº†è§£Shiroå¯ä»¥çœ‹ä¸‹æˆ‘çš„è¿™ç¯‡åšæ–‡ï¼šShiroç®€ä»‹ å¯¹äºæ›´è¯¦ç»†çš„åˆ†æï¼Œå¤§å®¶å¯ä»¥ç™¾åº¦ã€googleä¸€ä¸‹ï¼Œèµ„æ–™åº”è¯¥æ˜¯å¾ˆå…¨çš„ã€‚Shiroå·¥ä½œæµç¨‹ç®€è¿°Shiroè¿›è¡Œè®¤è¯çš„æœ¬è´¨è¿˜æ˜¯é€šè¿‡è¿‡æ»¤å™¨è¿›è¡Œæ‹¦æˆªï¼Œè¿‡æ»¤å™¨æ‹¦æˆªååˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œè®¤è¯ï¼Œå¦‚æœéœ€è¦ï¼Œå–å‡ºâ€tokenâ€å¹¶äº¤ç»™SecurityManagerè¿›è¡Œè®¤è¯ï¼Œè®¤è¯é€šè¿‡åæ”¾è¡Œï¼Œå¦‚æœä¸éœ€è¦è®¤è¯åˆ™ç›´æ¥æ”¾è¡Œã€‚è‡³äºä¸ºä»€ä¹ˆtokenæ‰“ä¸Šå¼•å·ï¼Œæ˜¯å› ä¸ºtokenå¹¶ä¸ä¸€å®šæ˜¯æ™®éæ„ä¹‰ä¸Šçš„JWTï¼ˆjson web tokenï¼‰,ä¹Ÿå¯ä»¥æ˜¯åŸºäºBASIC HTTPçš„tokenï¼Œè¿˜å¯ä»¥æ˜¯è¡¨å•ä¸­çš„ç”¨æˆ·åå’Œå¯†ç â€¦æ‰€ä»¥Shiroä¸­å°±å†…ç½®äº†ä¸€äº›å¸¸ç”¨çš„Filterï¼Œæœ‰åŸºäºè¡¨å•è®¤è¯çš„FormAuthenticationFilterç±»å’ŒåŸºäºBASIC HTTPçš„BasicHttpAuthenticationFilterç±»ï¼Œè¿˜æœ‰ä¸éœ€è¦è®¤è¯ç›´æ¥æ”¾è¡Œçš„AnonymousFilterç±»ï¼Œä¹Ÿæœ‰ä¸€äº›ç”¨äºæ£€æŸ¥Roleså’ŒPermissionsçš„è¿‡æ»¤å™¨ï¼Œå…·ä½“çš„å¯ä»¥å»DefaultFilterä¸­çœ‹çœ‹ã€‚è¿‡æ»¤å™¨Shiroä¸­çš„è¿‡æ»¤å™¨å…¶å®è¿˜æ˜¯Servletä¸­çš„Filterï¼Œåªä¸è¿‡å¯¹å…¶è¿›è¡Œäº†å°è£…ã€‚å…ˆæ¥çœ‹ä¸‹Shiroä¸­Filterçš„ç±»å›¾Shiro FilterAbstractFilterï¼šæä¾›äº†ç®€åŒ–çš„åˆå§‹åŒ–é€»è¾‘å’Œaccessåˆ°åˆå§‹åŒ–å‚æ•°ï¼Œå¹¶ä¸”æä¾›äº†getInitParam(String paramName)æ–¹æ³•è·å–ã€‚NameableFilterï¼šä¸ºFilteræä¾›nameå±æ€§å€¼ï¼Œå¯é€šè¿‡getterå’Œsetteræ–¹æ³•è·å–å’Œè®¾ç½®ã€‚OncePerRequestFilterï¼šç»§æ‰¿è‡ªNameableFilterï¼Œé€šè¿‡åå­—çœ‹å‡ºï¼Œä¸€æ¬¡è¯·æ±‚æ‰§è¡Œä¸€æ¬¡ã€‚ä¸éš¾çœ‹å‡ºShiroä¸­çš„æ‰€æœ‰Filteréƒ½æ˜¯é€šè¿‡ç»§æ‰¿OncePerRequestFilteræŠ½è±¡ç±»è€Œæ¥ï¼Œæ¥çœ‹ä¸‹è¿™ä¸ªç±»çš„doFilter(...)æ–¹æ³•ï¼š12345678910111213141516171819202122232425public final void doFilter(ServletRequest request, ServletResponse response, FilterChain filterChain) throws ServletException, IOException &#123; String alreadyFilteredAttributeName = getAlreadyFilteredAttributeName(); if ( request.getAttribute(alreadyFilteredAttributeName) != null ) &#123; filterChain.doFilter(request, response); &#125; else if (!isEnabled(request, response) || shouldNotFilter(request) ) &#123; filterChain.doFilter(request, response); &#125; else &#123; request.setAttribute(alreadyFilteredAttributeName, Boolean.TRUE); try &#123; doFilterInternal(request, response, filterChain); &#125; finally &#123; request.removeAttribute(alreadyFilteredAttributeName); &#125; &#125;&#125;// é»˜è®¤å®ç°æ˜¯ä½¿ç”¨è¿‡æ»¤å™¨çš„nameä½œä¸ºå±æ€§åï¼Œå¦‚æœä¸ºç©ºåˆ™ç”¨ç±»çš„å…¨è·¯å¾„åä½œä¸ºå±æ€§å// è¿™ä¸ªå±æ€§åä¸€èˆ¬æ¥è¯´æ˜¯å”¯ä¸€çš„protected String getAlreadyFilteredAttributeName() &#123; String name = getName(); if (name == null) &#123; name = getClass().getName(); &#125; return name + ALREADY_FILTERED_SUFFIX; // ALREADY_FILTERED_SUFFIX = \".FILTERED\";&#125;å¯ä»¥çœ‹å‡ºé¦–å…ˆè°ƒç”¨getAlreadyFilteredAttributeName()è·å–å½“å‰è¿‡æ»¤å™¨çš„å±æ€§åï¼Œè¯¥æ–¹æ³•çš„é»˜è®¤å®ç°æ˜¯ä½¿ç”¨è¿‡æ»¤å™¨çš„nameä½œä¸ºå±æ€§åï¼Œå¦‚æœä¸ºç©ºåˆ™ç”¨ç±»çš„å…¨è·¯å¾„åä½œä¸ºå±æ€§åï¼Œè¿™ä¸ªå±æ€§åä¸€èˆ¬æ¥è¯´æ˜¯å”¯ä¸€çš„ã€‚è·å–åˆ°å±æ€§ååçœ‹ä¸‹requestä¸­æœ‰æ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™æ”¾è¡Œï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ç»§ç»­åˆ¤æ–­è¿‡æ»¤å™¨æ˜¯å¦å¯ç”¨ï¼Œæˆ–è€…æ˜¯å¦ç›´æ¥æ”¾è¡Œï¼Œå¦‚æœæ˜¯åˆ™ä¹Ÿæ”¾è¡Œï¼Œæœ€åä¸Šè¿°ä¸¤ç§æƒ…å†µéƒ½ä¸ç¬¦åˆï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦è¿›è¡Œè¿‡æ»¤,å…ˆå°†è¿‡æ»¤å™¨çš„å±æ€§åè®¾ç½®åˆ°è¿™æ¬¡è¯·æ±‚ä¸­ï¼Œå†å°è¯•è¿›è¡Œå…·ä½“é€»è¾‘doFilterInternal(...)æ–¹æ³•ï¼ˆè¯¥æ–¹æ³•æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œéœ€è¦å­ç±»å®ç°ï¼‰ï¼Œæœ€åfinallyä¸­é€»è¾‘æ˜¾è€Œæ˜“è§ï¼Œè¿‡æ»¤å™¨å…·ä½“é€»è¾‘æ‰§è¡Œå®Œæ¯•åç§»é™¤è¿‡æ»¤å™¨çš„å±æ€§åã€‚è¯´çš„ç®€å•ç‚¹ï¼Œä¹Ÿå°±æ˜¯å®ç°äº†ä¸€æ¬¡è¯·æ±‚è¿‡æ»¤ä¸€æ¬¡ï¼Œç„¶åå°†è¿‡æ»¤å™¨å…·ä½“çš„é€»è¾‘æ”¾åœ¨äº†è¿™ä¸ªæŠ½è±¡æ–¹æ³•ä¸­ï¼š1protected abstract void doFilterInternal(ServletRequest request, ServletResponse response, FilterChain chain) throws ServletException, IOException;AdviceFilterç±»ã€PathMatchingFilterç±»å’ŒAccessControlFilterç±»AdviceFilteç±»AdviceFilterç±»ç»§æ‰¿è‡ªOncePerRequestFilterï¼Œä¹Ÿæ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œä½†ä»–å®ç°äº†çˆ¶ç±»çš„doFilterInternal(...)æ–¹æ³•ä¸­ï¼Œå°†å…·ä½“é€»è¾‘åˆåˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š123456789101112131415161718192021222324public void doFilterInternal(ServletRequest request, ServletResponse response, FilterChain chain) throws ServletException, IOException &#123; Exception exception = null; try &#123; //æ‰§è¡Œå‰ç½®å¤„ç† boolean continueChain = preHandle(request, response); if (log.isTraceEnabled()) &#123; log.trace(\"Invoked preHandle method. Continuing chain?: [\" + continueChain + \"]\"); &#125; //å‰ç½®å¤„ç†å¦‚æœæ²¡é—®é¢˜ï¼Œæ‰§è¡ŒexecuteChain(...)æ–¹æ³• if (continueChain) &#123; executeChain(request, response, chain); &#125; //æ‰§è¡Œåç½®å¤„ç† postHandle(request, response); if (log.isTraceEnabled()) &#123; log.trace(\"Successfully invoked postHandle method\"); &#125; &#125; catch (Exception e) &#123; exception = e; &#125; finally &#123; cleanup(request, response, exception); &#125;&#125;preHandle(...)æ–¹æ³•é»˜è®¤è¿”å›trueï¼Œå…¶å®æ‰€æœ‰å­ç±»è¿‡æ»¤å™¨çš„é€»è¾‘åº”è¯¥æ”¾åœ¨è¿™é‡Œé¢ã€‚executeChain(ServletRequest request, ServletResponse response, FilterChain chain)æ–¹æ³•ä¸€å®šè¦æ³¨æ„ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•çš„é€»è¾‘æ˜¯chain.doFilter(request, response)ï¼Œæ‰§è¡Œä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨postHandle(...)æ–¹æ³•é»˜è®¤æ˜¯ä¸€ä¸ªç©ºæ–¹æ³•ã€‚æ‰€æœ‰è¿‡æ»¤å™¨çœŸæ­£çš„é€»è¾‘åº”è¯¥åœ¨preHandle(...)ä¸­è€Œä¸æ˜¯executeChain(...)ä¸­ï¼Œè‡ªå®šä¹‰è¿‡æ»¤å™¨é‡å†™æ–¹æ³•çš„æ—¶å€™ä¸€å®šè¦æ³¨æ„ã€‚çœ‹åˆ°è¿™ä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼šçœŸæ­£çš„å‰ç½®å¤„ç†åœ¨å“ªé‡Œï¼Ÿå…¶å®å¹¶æ²¡æœ‰æä¾›çœŸæ­£æ„ä¹‰ä¸Šçš„å‰ç½®å¤„ç†ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿçœ‹ä¸‹PathMatchingFilterå’ŒAccessControlFilterå°±çŸ¥é“äº†ã€‚PathMatchingFilterç±»ç»§æ‰¿è‡ªAdviceFilterçš„PathMatchingFilterä¸­é‡å†™çš„preHandleræ–¹æ³•ä¼šæ£€æŸ¥è¯·æ±‚è·¯å¾„æ˜¯å¦åŒ¹é…é…ç½®ï¼ŒåŒ¹é…çš„è¯åˆ™æ‰§è¡ŒisFilterChainContinued()æ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•ä¸­è°ƒç”¨äº†ä¸€ä¸ªæŠ½è±¡æ–¹æ³•onPreHandle(...)ï¼Œæºç å¦‚ä¸‹ï¼Œå°±ä¸è§£é‡Šäº†ã€‚1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253protected boolean preHandle(ServletRequest request, ServletResponse response) throws Exception &#123; if (this.appliedPaths == null || this.appliedPaths.isEmpty()) &#123; if (log.isTraceEnabled()) &#123; log.trace(\"appliedPaths property is null or empty. This Filter will passthrough immediately.\"); &#125; return true; &#125; for (String path : this.appliedPaths.keySet()) &#123; // If the path does match, then pass on to the subclass implementation for specific checks //(first match 'wins'): if (pathsMatch(path, request)) &#123; log.trace(\"Current requestURI matches pattern '&#123;&#125;'. Determining filter chain execution...\", path); Object config = this.appliedPaths.get(path); return isFilterChainContinued(request, response, path, config); &#125; &#125; //no path matched, allow the request to go through: return true;&#125;/** * Simple method to abstract out logic from the preHandle implementation - it was getting a bit unruly. * * @since 1.2 */@SuppressWarnings(&#123;\"JavaDoc\"&#125;)private boolean isFilterChainContinued(ServletRequest request, ServletResponse response, String path, Object pathConfig) throws Exception &#123; if (isEnabled(request, response, path, pathConfig)) &#123; //isEnabled check added in 1.2 if (log.isTraceEnabled()) &#123; log.trace(\"Filter '&#123;&#125;' is enabled for the current request under path '&#123;&#125;' with config [&#123;&#125;]. \" + \"Delegating to subclass implementation for 'onPreHandle' check.\", new Object[]&#123;getName(), path, pathConfig&#125;); &#125; //The filter is enabled for this specific request, so delegate to subclass implementations //so they can decide if the request should continue through the chain or not: return onPreHandle(request, response, pathConfig); &#125; if (log.isTraceEnabled()) &#123; log.trace(\"Filter '&#123;&#125;' is disabled for the current request under path '&#123;&#125;' with config [&#123;&#125;]. \" + \"The next element in the FilterChain will be called immediately.\", new Object[]&#123;getName(), path, pathConfig&#125;); &#125; //This filter is disabled for this specific request, //return 'true' immediately to indicate that the filter will not process the request //and let the request/response to continue through the filter chain: return true;&#125;AccessControlFilterç±»AccessControlFilteræŠ½è±¡ç±»ç»§æ‰¿è‡ªPathMatchingFilterAccessControlFilterå®ç°äº†onPreHandle(...)æ–¹æ³•ï¼š12345678910public boolean onPreHandle(ServletRequest request, ServletResponse response, Object mappedValue) throws Exception &#123; return isAccessAllowed(request, response, mappedValue) || onAccessDenied(request, response, mappedValue);&#125;protected abstract boolean isAccessAllowed(ServletRequest request, ServletResponse response, Object mappedValue) throws Exception;protected boolean onAccessDenied(ServletRequest request, ServletResponse response, Object mappedValue) throws Exception &#123; return onAccessDenied(request, response);&#125;protected abstract boolean onAccessDenied(ServletRequest request, ServletResponse response) throws Exception;çœ‹åˆ°è¿™é‡Œä¹Ÿå°±æ˜æœ—äº†ï¼Œè¿”å›isAccessAllowed(...) || onAccessDenied(...)ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œè¿™ä¸ªé€»è¾‘çš„æ„æ€è§£é‡Šèµ·æ¥å°±æ˜¯ï¼šå…ˆæ‰§è¡ŒisAccessAllowedæ–¹æ³•çœ‹ä¸‹èƒ½ä¸èƒ½è®¿é—®èƒ½è®¿é—®åˆ™ç›´æ¥è¿”å›ä¹Ÿå°±æ˜¯trueï¼Œå¦‚æœä¸èƒ½è®¿é—®ï¼Œåˆ™æ‰§è¡ŒonAccessDeniedæ–¹æ³•å¹¶è¿”å›ç»“æœï¼ˆæ³¨æ„ç†è§£â€˜æˆ–â€™è¿ç®—ç¬¦ï¼‰ã€‚AuthenticationFilterç±»å’ŒAuthenticatingFilterç±»æ³¨æ„è¿™ä¸¤ä¸ªç±»åçš„ä¸åŒã€‚AuthenticationFilteråªå®ç°äº†isAccessAllowed(...)æ–¹æ³•ï¼š12345protected boolean isAccessAllowed(ServletRequest request, ServletResponse response, Object mappedValue) &#123; // è¿”å›ç»‘å®šåˆ°å½“å‰çº¿ç¨‹ä¸Šçš„ä¸»ä½“æ˜¯å¦å·²ç»è®¤è¯çš„ç»“æœ Subject subject = getSubject(request, response); return subject.isAuthenticated();&#125;è€ŒAuthenticatingFilterç»§æ‰¿è‡ªAuthenticationFilterç±»ï¼š12345678910111213141516171819202122protected boolean executeLogin(ServletRequest request, ServletResponse response) throws Exception &#123; AuthenticationToken token = createToken(request, response); if (token == null) &#123; String msg = \"createToken method implementation returned null. A valid non-null AuthenticationToken \" + \"must be created in order to execute a login attempt.\"; throw new IllegalStateException(msg); &#125; try &#123; Subject subject = getSubject(request, response); subject.login(token); return onLoginSuccess(token, subject, request, response); &#125; catch (AuthenticationException e) &#123; return onLoginFailure(token, e, request, response); &#125;&#125;protected abstract AuthenticationToken createToken(ServletRequest request, ServletResponse response) throws Exception;protected boolean isAccessAllowed(ServletRequest request, ServletResponse response, Object mappedValue) &#123; return super.isAccessAllowed(request, response, mappedValue) || (!isLoginRequest(request, response) &amp;&amp; isPermissive(mappedValue));&#125;è§£é‡Šä¸€ä¸‹è¿™ä¸ªisAccessAllowed(...)æ–¹æ³•ï¼šThe default implementation returns true if the user is authenticated. Will also return true if the isLoginRequest returns false and the â€œpermissiveâ€ flag is setå¦‚æœå·²ç»è®¤è¯åˆ™è¿”å›trueï¼Œæˆ–è€…è¯·æ±‚ä¸éœ€è¦è®¤è¯å¹¶ä¸”è®¾ç½®äº†â€permissiveâ€ï¼Œè®¾ç½®â€permissiveâ€æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼šæ¯”å¦‚è¯´é…ç½®è¿‡æ»¤å™¨çš„è·¯ç”±ç­–ç•¥æ—¶ï¼šmap.add(â€œ/**â€,â€authc[permissive]â€)æ‰€ä»¥è¿™ä¸ªç±»å…¶å®å·²ç»æä¾›äº†ä¸€ä¸ªé€šç”¨çš„é€»è¾‘ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œä¹Ÿæ˜¯èƒ½å¤Ÿé€‚åº”å¤§å¤šæ•°åœºæ™¯ä¸‹çš„éœ€æ±‚çš„ï¼Œæ‰€ä»¥è¯´ï¼Œä¸€èˆ¬æˆ‘ä»¬è‡ªå®šä¹‰è¿‡æ»¤å™¨å°±æ˜¯ç»§æ‰¿AuthenticatingFilterç±»ï¼Œç„¶ååªéœ€è¦é‡å†™onAccessDenied(...)æ–¹æ³•ï¼Œåœ¨å…¶ä¸­è°ƒç”¨executeLoginæ–¹æ³•è¿›è¡Œè®¤è¯ï¼Œç„¶åæä¾›åˆ›å»ºTokençš„å…·ä½“é€»è¾‘ä¹Ÿå°±æ˜¯createToken(..)æ–¹æ³•å°±å¯ä»¥äº†ã€‚å¦‚æœæœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œæ¯”å¦‚å¯¹äºOptionè¯·æ±‚ç›´æ¥æ”¾è¡Œï¼Œé‚£ä¹ˆå¯ä»¥é‡å†™isAccessAllowed(...)æ–¹æ³•ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯optionè¯·æ±‚ï¼Œä¸€èˆ¬æ¥è¯´æˆ‘ä»¬è¿˜æ˜¯ä¼šè°ƒç”¨ä¸€ä¸‹çˆ¶ç±»çš„é€šç”¨åˆ¤æ–­æ–¹æ³•ï¼šsuper.isAccessAllowed(...)ï¼Œåç»­çš„æ¡ˆä¾‹å°±ç”¨äº†è¿™ç§æ–¹æ³•å®ç°è·¨åŸŸè¯·æ±‚ç›´æ¥æ”¾è¡Œã€‚å¹¶ä¸”å¯ä»¥çœ‹åˆ°executeLogin(..)æ–¹æ³•ä¸­è·å–Subjectå¹¶ä½¿ç”¨createTokenæ–¹æ³•è¿”å›çš„Tokenå»è°ƒç”¨loginè¿›è¡Œè®¤è¯ï¼Œå¯¹äºè®¤è¯æˆåŠŸå’Œè®¤è¯å¤±è´¥è¿˜æä¾›äº†å›è°ƒå¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥é‡å†™è¿™ä¸¤ä¸ªæ–¹æ³•ä»¥æ»¡è¶³æŸäº›åœºæ™¯ä¸‹çš„éœ€æ±‚ï¼Œæ¯”å¦‚jwtè®¤è¯æˆåŠŸååˆ¤æ–­æ˜¯å¦éœ€è¦åˆ·æ–°tokenã€‚SecurityManagerå½“æˆ‘ä»¬ä½¿ç”¨Subjectå»è°ƒç”¨login(AuthenticationToken)æ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šæ˜¯å§”æ‰˜ç»™DelegatingSubjectå»å¤„ç†,è€Œè¿™ä¸ªç±»åˆä¼šä»SecurityManagerä¸­è·å–ä¿¡æ¯å†è¿›è¡Œå¤„ç†:DelegatingSubject#loginæ–¹æ³•12345public void login(AuthenticationToken token) throws AuthenticationException &#123; ... Subject subject = securityManager.login(this, token); ...&#125;SecurityManager#loginæ–¹æ³•1234567891011121314151617181920public Subject login(Subject subject, AuthenticationToken token) throws AuthenticationException &#123; AuthenticationInfo info; try &#123; //è°ƒç”¨authenticateæ–¹æ³• info = authenticate(token); &#125; catch (AuthenticationException ae) &#123; try &#123; onFailedLogin(token, ae, subject); &#125; catch (Exception e) &#123; if (log.isInfoEnabled()) &#123; log.info(\"onFailedLogin method threw an \" + \"exception. Logging and propagating original AuthenticationException.\", e); &#125; &#125; throw ae; //propagate &#125; Subject loggedIn = createSubject(token, info, subject); onSuccessfulLogin(token, info, loggedIn); return loggedIn;&#125;AbstractSecurityManagerä¸­æœ‰ä¸€ä¸ªAuthenticatorè®¤è¯å™¨ï¼Œåœ¨SecurityManagerè¿›è¡Œè®¤è¯çš„æ—¶å€™å°±æ˜¯å§”æ‰˜å®ƒè¿›è¡Œè®¤è¯çš„ï¼š123public AuthenticationInfo authenticate(AuthenticationToken token) throws AuthenticationException &#123; return this.authenticator.authenticate(token);&#125;Authenticatoræ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¹¶ä¸”åªæœ‰ä¸€ä¸ªè®¤è¯æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›è®¤è¯ä¿¡æ¯ã€‚1234public interface Authenticator &#123; public AuthenticationInfo authenticate(AuthenticationToken authenticationToken) throws AuthenticationException;&#125;AbstractAuthenticator#authenticateæ–¹æ³•ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152public final AuthenticationInfo authenticate(AuthenticationToken token) throws AuthenticationException &#123; if (token == null) &#123; throw new IllegalArgumentException(\"Method argument (authentication token) cannot be null.\"); &#125; log.trace(\"Authentication attempt received for token [&#123;&#125;]\", token); AuthenticationInfo info; try &#123; //è°ƒç”¨`doAuthenticate(AuthenticationToken)`æŠ½è±¡æ–¹æ³• info = doAuthenticate(token); if (info == null) &#123; String msg = \"No account information found for authentication token [\" + token + \"] by this \" + \"Authenticator instance. Please check that it is configured correctly.\"; throw new AuthenticationException(msg); &#125; &#125; catch (Throwable t) &#123; AuthenticationException ae = null; if (t instanceof AuthenticationException) &#123; ae = (AuthenticationException) t; &#125; if (ae == null) &#123; //Exception thrown was not an expected AuthenticationException. Therefore it is probably a little more //severe or unexpected. So, wrap in an AuthenticationException, log to warn, and propagate: String msg = \"Authentication failed for token submission [\" + token + \"]. Possible unexpected \" + \"error? (Typical or expected login exceptions should extend from AuthenticationException).\"; ae = new AuthenticationException(msg, t); if (log.isWarnEnabled()) log.warn(msg, t); &#125; try &#123; notifyFailure(token, ae); &#125; catch (Throwable t2) &#123; if (log.isWarnEnabled()) &#123; String msg = \"Unable to send notification for failed authentication attempt - listener error?. \" + \"Please check your AuthenticationListener implementation(s). Logging sending exception \" + \"and propagating original AuthenticationException instead...\"; log.warn(msg, t2); &#125; &#125; throw ae; &#125; log.debug(\"Authentication successful for token [&#123;&#125;]. Returned account [&#123;&#125;]\", token, info); notifySuccess(token, info); return info;&#125;è¯¥æ–¹æ³•è°ƒç”¨doAuthenticate(AuthenticationToken)æŠ½è±¡æ–¹æ³•ï¼Œè¿”å›è®¤è¯ä¿¡æ¯ã€‚Shiroä¸­çš„è®¤è¯å™¨åªæœ‰ä¸€ä¸ªå®ç°ç±»ï¼šModularRealmAuthenticatorModularRealmAuthenticator#doAuthenticateæ–¹æ³•123456789protected AuthenticationInfo doAuthenticate(AuthenticationToken authenticationToken) throws AuthenticationException &#123; assertRealmsConfigured(); Collection&lt;Realm&gt; realms = getRealms(); if (realms.size() == 1) &#123; return doSingleRealmAuthentication(realms.iterator().next(), authenticationToken); &#125; else &#123; return doMultiRealmAuthentication(realms, authenticationToken); &#125;&#125;å¦‚æœåªæœ‰ä¸€ä¸ªRealmï¼Œæ‰§è¡ŒdoSingleRealmAuthentication(..)æ–¹æ³•å¦åˆ™æ‰§è¡ŒdoMultiRealmAuthentication(..)æ–¹æ³•è¿™ä¸¤ä¸ªæ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼ŸåŒºåˆ«åœ¨äºç¬¬äºŒä¸ªæ–¹æ³•å¤šäº†ä¸€ä¸ªè®¤è¯ç­–ç•¥AuthenticationStrategyï¼Œæœ‰ä¸‰ä¸ªå®ç°ï¼šAllSuccessfulStrategyï¼šéœ€è¦æ‰€æœ‰çš„Realmè®¤è¯é€šè¿‡AtLeastOneSuccessfulStrategyï¼šè‡³å°‘éœ€è¦ä¸€ä¸ªRealmè®¤è¯é€šè¿‡FirstSuccessfulStrategyï¼šåªéœ€è¦ä¸€ä¸ªRealmè®¤è¯é€šè¿‡æœ€åä¸¤ä¸ªè®¤è¯ç­–ç•¥æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿå‰è€…åœ¨ç¬¬ä¸€ä¸ªRealmè®¤è¯æˆåŠŸåè¿˜ä¼šç»§ç»­è®¤è¯å‰©ä¸‹çš„Realmï¼Œå¹¶æŠŠæ‰€æœ‰çš„è®¤è¯ä¿¡æ¯AuthenticationInfoè¿›è¡Œåˆå¹¶ã€‚åè€…åœ¨ç¬¬ä¸€ä¸ªRealmè®¤è¯æˆåŠŸåç›´æ¥è¿”å›è®¤è¯ä¿¡æ¯ã€‚é»˜è®¤ä½¿ç”¨çš„æ˜¯AtLeastOneSuccessfulStrategyæ¥çœ‹ä¸‹doSingleRealmAuthentication(..)å’ŒdoMultiRealmAuthentication(..)è¿™ä¸¤ä¸ªæ–¹æ³•ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657protected AuthenticationInfo doSingleRealmAuthentication(Realm realm, AuthenticationToken token) &#123; if (!realm.supports(token)) &#123; String msg = \"Realm [\" + realm + \"] does not support authentication token [\" + token + \"]. Please ensure that the appropriate Realm implementation is \" + \"configured correctly or that the realm accepts AuthenticationTokens of this type.\"; throw new UnsupportedTokenException(msg); &#125; AuthenticationInfo info = realm.getAuthenticationInfo(token); if (info == null) &#123; String msg = \"Realm [\" + realm + \"] was unable to find account data for the \" + \"submitted AuthenticationToken [\" + token + \"].\"; throw new UnknownAccountException(msg); &#125; return info;&#125;protected AuthenticationInfo doMultiRealmAuthentication(Collection&lt;Realm&gt; realms, AuthenticationToken token) &#123; AuthenticationStrategy strategy = getAuthenticationStrategy(); AuthenticationInfo aggregate = strategy.beforeAllAttempts(realms, token); if (log.isTraceEnabled()) &#123; log.trace(\"Iterating through &#123;&#125; realms for PAM authentication\", realms.size()); &#125; for (Realm realm : realms) &#123; aggregate = strategy.beforeAttempt(realm, token, aggregate); if (realm.supports(token)) &#123; log.trace(\"Attempting to authenticate token [&#123;&#125;] using realm [&#123;&#125;]\", token, realm); AuthenticationInfo info = null; Throwable t = null; try &#123; info = realm.getAuthenticationInfo(token); &#125; catch (Throwable throwable) &#123; t = throwable; if (log.isDebugEnabled()) &#123; String msg = \"Realm [\" + realm + \"] threw an exception during a multi-realm authentication attempt:\"; log.debug(msg, t); &#125; &#125; aggregate = strategy.afterAttempt(realm, token, info, aggregate, t); &#125; else &#123; log.debug(\"Realm [&#123;&#125;] does not support token &#123;&#125;. Skipping realm.\", realm, token); &#125; &#125; aggregate = strategy.afterAllAttempts(token, aggregate); return aggregate;&#125;doSingleRealmAuthentication(..)æ–¹æ³•ä¸éœ€è¦è§£é‡Šã€‚doMultiRealmAuthentication(..)æ–¹æ³•å¤§ä½“å°±æ˜¯ä¾¿åˆ©æ‰€æœ‰çš„Realmï¼Œå¦‚æœè¿™ä¸ªRealmæ”¯æŒå½“å‰è¿™ä¸ªTokenï¼Œåˆ™è°ƒç”¨getAuthenticationInfo(AuthenticationToken)æ–¹æ³•è·å–è®¤è¯ä¿¡æ¯ï¼Œç„¶åæ ¹æ®ä½¿ç”¨çš„è®¤è¯ç­–ç•¥å»å¤„ç†è®¤è¯ä¿¡æ¯ã€‚è€ŒgetAuthenticationInfo(AuthenticationToken)æ–¹æ³•å¾ˆç®€å•ï¼š12345678910111213141516171819202122public final AuthenticationInfo getAuthenticationInfo(AuthenticationToken token) throws AuthenticationException &#123; AuthenticationInfo info = getCachedAuthenticationInfo(token); if (info == null) &#123; //otherwise not cached, perform the lookup: info = doGetAuthenticationInfo(token); log.debug(\"Looked up AuthenticationInfo [&#123;&#125;] from doGetAuthenticationInfo\", info); if (token != null &amp;&amp; info != null) &#123; cacheAuthenticationInfoIfPossible(token, info); &#125; &#125; else &#123; log.debug(\"Using cached authentication info [&#123;&#125;] to perform credentials matching.\", info); &#125; if (info != null) &#123; assertCredentialsMatch(token, info); &#125; else &#123; log.debug(\"No AuthenticationInfo found for submitted AuthenticationToken [&#123;&#125;]. Returning null.\", token); &#125; return info;&#125;å…ˆä»ç¼“å­˜ä¸­å–ï¼Œå¦‚æœç¼“å­˜é‡Œæ²¡æœ‰åˆ™è°ƒç”¨doGetAuthenticationInfo(AuthenticationToken)æ–¹æ³•è·å–ï¼ˆæˆ‘ä»¬å®ç°è‡ªå·±çš„Realmæ—¶ä¸€èˆ¬å°±è¦å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ˜¯è·å–è®¤è¯ä¿¡æ¯çš„æ–¹æ³•ï¼Œè¿˜æœ‰ä¸€ä¸ªè·å–æƒé™ä¿¡æ¯çš„æ–¹æ³•ï¼‰æœ€åï¼Œå¦‚æœinfoä¸ä¸ºnullï¼Œè°ƒç”¨assertCredentialsMatch(..)æ–¹æ³•åˆ¤æ–­tokenå’Œinfoæ˜¯å¦åŒ¹é…ã€‚é»˜è®¤ä½¿ç”¨çš„CredentialsMatcheræ˜¯SimpleCredentialsMatcherï¼Œå³è°ƒç”¨AuthenticationTokenå’ŒAuthenticationInfoçš„getCredentials()åè¿›è¡Œç®€å•çš„equalåŒ¹é…ã€‚ä¸€ä¸ªå‰åç«¯åˆ†ç¦»æ¡ˆä¾‹JWTToken123456789101112131415161718192021222324252627282930313233343536373839404142public class JWTToken implements HostAuthenticationToken &#123; public static final JWTToken NONE = new JWTToken(null, null); private String token; private String host; public JWTToken(String token) &#123; this(token, null); &#125; public JWTToken(String token, String host) &#123; this.token = token; this.host = host; &#125; public String getToken() &#123; return this.token; &#125; public String getHost() &#123; return host; &#125; @Override public Object getPrincipal() &#123; return token; &#125; @Override public Object getCredentials() &#123; return token; &#125; @Override public String toString() &#123; return \"JWTToken&#123;\" + \"token='\" + token + '\\'' + \", host='\" + host + '\\'' + '&#125;'; &#125;&#125;JwtHttpAuthenticationFilter123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388package me.lolico.blog.web.filter;import me.lolico.blog.web.JWTToken;import org.apache.shiro.authc.AuthenticationException;import org.apache.shiro.authc.AuthenticationToken;import org.apache.shiro.subject.Subject;import org.apache.shiro.web.filter.authc.AuthenticatingFilter;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import javax.servlet.ServletRequest;import javax.servlet.ServletResponse;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.util.HashSet;import java.util.Locale;import java.util.Set;/** * @author lolico */public class JwtHttpAuthenticationFilter extends AuthenticatingFilter &#123; /** * This class's private logger. */ private static final Logger log = LoggerFactory.getLogger(JwtHttpAuthenticationFilter.class); /** * HTTP Authorization header, equal to &lt;code&gt;Authorization&lt;/code&gt; */ private static final String AUTHORIZATION_HEADER = \"Authorization\"; /** * HTTP Authentication header, equal to &lt;code&gt;WWW-Authenticate&lt;/code&gt; */ private static final String AUTHENTICATE_HEADER = \"WWW-Authenticate\"; /** * The authzScheme default value to look for in the &lt;code&gt;Authorization&lt;/code&gt; header */ private static final String DEFAULT_AUTHORIZATION_SCHEME = \"Bearer\"; /** * The name that is displayed during the challenge process of authentication, defauls to &lt;code&gt;application&lt;/code&gt; * and can be overridden by the &#123;@link #setApplicationName(String) setApplicationName&#125; method. */ private String applicationName = \"application\"; /** * The authzScheme value to look for in the &lt;code&gt;Authorization&lt;/code&gt; header, defaults to &lt;code&gt;Bearer&lt;/code&gt; * Can override by &#123;@link #setAuthzScheme(String)&#125; */ private String authzScheme = DEFAULT_AUTHORIZATION_SCHEME; /** * &lt;code&gt;true&lt;/code&gt; will enable \"OPTION\" request method, &lt;code&gt;false&lt;/code&gt; otherwise */ private boolean isCorsEnable = true; /** * the callback handler for successful authentication */ private SuccessfulHandler successfulHandler; /** * the callback handler for unsuccessful authentication */ private UnsuccessfulHandler unsuccessfulHandler; public JwtHttpAuthenticationFilter() &#123; unsuccessfulHandler = (token, e, request, response) -&gt; &#123; //defaults to set 401-unauthorized http status HttpServletResponse httpResponse = ((HttpServletResponse) response); String authcHeader = getAuthzScheme() + \" realm=\\\"\" + getApplicationName() + \"\\\"\"; httpResponse.setHeader(AUTHENTICATE_HEADER, authcHeader); httpResponse.setStatus(HttpServletResponse.SC_UNAUTHORIZED); &#125;; &#125; public JwtHttpAuthenticationFilter(String authzScheme, boolean isCorsEnable, SuccessfulHandler successfulHandler, UnsuccessfulHandler unsuccessfulHandler) &#123; this.authzScheme = authzScheme; this.isCorsEnable = isCorsEnable; this.successfulHandler = successfulHandler; this.unsuccessfulHandler = unsuccessfulHandler; &#125; /** * Returns the name that is displayed during the challenge process of authentication * Default value is &lt;code&gt;application&lt;/code&gt; * * @return the name that is displayed during the challenge process of authentication */ public String getApplicationName() &#123; return applicationName; &#125; /** * Sets the name that is displayed during the challenge process of authentication * Default value is &lt;code&gt;application&lt;/code&gt; * * @param applicationName the name that is displayed during the challenge process of authentication */ public void setApplicationName(String applicationName) &#123; this.applicationName = applicationName; &#125; /** * Returns the HTTP &lt;b&gt;&lt;code&gt;Authorization&lt;/code&gt;&lt;/b&gt; header value that this filter will respond to as indicating * a login request. * &lt;p/&gt; * Unless overridden by the &#123;@link #setAuthzScheme(String)&#125; method, the * default value is &lt;code&gt;Bearer&lt;/code&gt;. * * @return the Http 'Authorization' header value that this filter will respond to as indicating a login request */ public String getAuthzScheme() &#123; return authzScheme; &#125; /** * Sets the HTTP &lt;b&gt;&lt;code&gt;Authorization&lt;/code&gt;&lt;/b&gt; header value that this filter will respond to as indicating a * login request. * &lt;p/&gt; * Unless overridden by this method, the default value is &lt;code&gt;Bearer&lt;/code&gt; * * @param authzScheme the HTTP &lt;code&gt;Authorization&lt;/code&gt; header value that this filter will respond to as * indicating a login request. */ public void setAuthzScheme(String authzScheme) &#123; this.authzScheme = authzScheme; &#125; /** * Default value is &lt;code&gt;true&lt;/code&gt; * * @param corsEnable &lt;code&gt;true&lt;/code&gt; will enable \"OPTION\" request method, &lt;code&gt;false&lt;/code&gt; otherwise */ public void setCorsEnable(boolean corsEnable) &#123; isCorsEnable = corsEnable; &#125; /** * Default value is &lt;code&gt;true&lt;/code&gt; * * @return is cors enable */ public boolean isCorsEnable() &#123; return isCorsEnable; &#125; /** * Returns the callback handler for successful authentication * * @return the callback handler for successful authentication */ public SuccessfulHandler getSuccessfulHandler() &#123; return successfulHandler; &#125; /** * @param successfulHandler the callback handler for successful authentication */ public void setSuccessfulHandler(SuccessfulHandler successfulHandler) &#123; this.successfulHandler = successfulHandler; &#125; /** * Returns the callback handler for unsuccessful authentication * * @return the callback handler for unsuccessful authentication */ public UnsuccessfulHandler getUnsuccessfulHandler() &#123; return unsuccessfulHandler; &#125; /** * @param unsuccessfulHandler the callback handler for successful authentication */ public void setUnsuccessfulHandler(UnsuccessfulHandler unsuccessfulHandler) &#123; this.unsuccessfulHandler = unsuccessfulHandler; &#125; /** * The Basic authentication filter can be configured with a list of HTTP methods to which it should apply. This * method ensures that authentication is &lt;em&gt;only&lt;/em&gt; required for those HTTP methods specified. For example, * if you had the configuration: * &lt;pre&gt; * [urls] * /basic/** = authcJwt[POST,PUT,DELETE] * &lt;/pre&gt; * then a GET request would not required authentication but a POST would. * * @param request The current HTTP servlet request. * @param response The current HTTP servlet response. * @param mappedValue The array of configured HTTP methods as strings. This is empty if no methods are configured. */ protected boolean isAccessAllowed(ServletRequest request, ServletResponse response, Object mappedValue) &#123; HttpServletRequest httpRequest = ((HttpServletRequest) request); String httpMethod = httpRequest.getMethod(); // Check whether the current request's method requires authentication. // If no methods have been configured, then all of them require auth, // otherwise only the declared ones need authentication. Set&lt;String&gt; methods = httpMethodsFromOptions((String[]) mappedValue); boolean authcRequired = methods.size() == 0; // If enable cors and this request_method is equal to \"OPTION\", do not authentication. // Can override by configuration: // /** = authcJwt[POST,DELETE,OPTION] // then a OPTION request would required authentication. // if (isCorsEnable &amp;&amp; httpMethod.equalsIgnoreCase(\"OPTION\")) &#123; // authcRequired = false; // &#125; for (String m : methods) &#123; if (httpMethod.toUpperCase(Locale.ENGLISH).equals(m)) &#123; // list of methods is in upper case authcRequired = true; break; &#125; &#125; // if (isCorsEnable &amp;&amp; httpMethod.equalsIgnoreCase(\"OPTION\")) &#123; // responseForCors(request, response); // &#125; if (authcRequired) &#123; return super.isAccessAllowed(request, response, mappedValue); &#125; else &#123; return true; &#125; &#125; /** * cors support */ @Override protected boolean preHandle(ServletRequest request, ServletResponse response) throws Exception &#123; if (isCorsEnable() &amp;&amp; ((HttpServletRequest) request).getMethod().equals(\"OPTIONS\")) &#123; responseForCors(request, response); return false; &#125; return super.preHandle(request, response); &#125; private void responseForCors(ServletRequest request, ServletResponse response) &#123; HttpServletRequest httpRequest = (HttpServletRequest) request; HttpServletResponse httpResponse = (HttpServletResponse) response; httpResponse.setHeader(\"Access-Control-Allow-Origin\", httpRequest.getHeader(\"Origin\")); httpResponse.setHeader(\"Access-Control-Allow-Headers\", httpRequest.getHeader(\"Access-Control-Allow-Headers\")); httpResponse.setHeader(\"Access-Control-Allow-Methods\", \"GET,POST,PUT,DELETE,OPTIONS\"); httpResponse.setHeader(\"Access-Control-Allow-Credentials\", \"true\"); httpResponse.setStatus(HttpServletResponse.SC_OK); &#125; private Set&lt;String&gt; httpMethodsFromOptions(String[] options) &#123; Set&lt;String&gt; methods = new HashSet&lt;&gt;(); if (options != null) &#123; for (String option : options) &#123; // to be backwards compatible with 1.3, we can ONLY check for known args // ideally we would just validate HTTP methods, but someone could already be using this for webdav if (!option.equalsIgnoreCase(PERMISSIVE)) &#123; methods.add(option.toUpperCase(Locale.ENGLISH)); &#125; &#125; &#125; return methods; &#125; /** * Processes unauthenticated requests. It handles the two-stage request/challenge authentication protocol. * * @param request incoming ServletRequest * @param response outgoing ServletResponse * @return true if the request should be processed; false if the request should not continue to be processed */ @Override protected boolean onAccessDenied(ServletRequest request, ServletResponse response) throws Exception &#123; boolean loggedIn = false; //false by default or we wouldn't be in this method if (isLoginRequest(request, response)) &#123; if (log.isDebugEnabled()) &#123; log.debug(\"Attempting to execute login with auth header\"); &#125; loggedIn = executeLogin(request, response); &#125; return loggedIn; &#125; /** * Returns &lt;code&gt;true&lt;/code&gt; if the incoming request have &#123;@link #getAuthzHeader(ServletRequest)&#125; * and the header's value is start with &#123;@link #getAuthzScheme()&#125;, &lt;code&gt;false&lt;/code&gt; otherwise. * * @param request the incoming &lt;code&gt;ServletRequest&lt;/code&gt; * @param response the outgoing &lt;code&gt;ServletResponse&lt;/code&gt; * @return &lt;code&gt;true&lt;/code&gt; if the incoming request is required auth, &lt;code&gt;false&lt;/code&gt; otherwise. */ @Override protected boolean isLoginRequest(ServletRequest request, ServletResponse response) &#123; String authzHeader = getAuthzHeader(request); String scheme = getAuthzScheme().toLowerCase(Locale.ENGLISH); return authzHeader != null &amp;&amp; authzHeader.toLowerCase(Locale.ENGLISH).startsWith(scheme); &#125; /** * @param request the incoming &lt;code&gt;ServletRequest&lt;/code&gt; * @return the &lt;code&gt;Authorization&lt;/code&gt; header's value */ private String getAuthzHeader(ServletRequest request) &#123; return ((HttpServletRequest) request).getHeader(AUTHORIZATION_HEADER); &#125; /** * Returns the authentication token encapsulated by the value of the Authorization header * * @param request the incoming &lt;code&gt;ServletRequest&lt;/code&gt; * @param response the outgoing &lt;code&gt;ServletResponse&lt;/code&gt; * @return the authentication token encapsulated by the value of the Authorization header */ @Override protected AuthenticationToken createToken(ServletRequest request, ServletResponse response) throws Exception &#123; String authzHeader = getAuthzHeader(request); if (authzHeader == null || authzHeader.length() == 0) &#123; return JWTToken.NONE; &#125; String scheme = getAuthzScheme(); if (scheme != null &amp;&amp; scheme.length() != 0) &#123; authzHeader = authzHeader.substring(scheme.length()); &#125; String token = authzHeader.trim(); String host = request.getRemoteHost(); return new JWTToken(token, host); &#125; /** * Callback processing after authentication successful. */ @Override protected boolean onLoginSuccess(AuthenticationToken token, Subject subject, ServletRequest request, ServletResponse response) throws Exception &#123; if (successfulHandler != null) &#123; if (log.isDebugEnabled()) &#123; log.debug(\"&#123;&#125; can pass auth, the auth subject is &#123;&#125;\", token, subject); &#125; successfulHandler.onSuccessful(token, subject, request, response); &#125; return true; &#125; /** * Callback processing after authentication failure. */ @Override protected final boolean onLoginFailure(AuthenticationToken token, AuthenticationException e, ServletRequest request, ServletResponse response) &#123; if (unsuccessfulHandler != null) &#123; if (log.isDebugEnabled()) &#123; log.debug(\"&#123;&#125; can not pass auth, the auth exception message is &#123;&#125;\", token, e.getMessage()); &#125; unsuccessfulHandler.onUnsuccessful(token, e, request, response); &#125; return false; &#125; &#125;interface UnsuccessfulHandler &#123; /** * Callback processing when auth successful * * @param token the token can not pass authentication * @param e the exception thrown during authentication * @param request the incoming &lt;code&gt;ServletRequest&lt;/code&gt; * @param response the outgoing &lt;code&gt;ServletResponse&lt;/code&gt; */ void onUnsuccessful(AuthenticationToken token, AuthenticationException e, ServletRequest request, ServletResponse response);&#125;interface SuccessfulHandler &#123; /** * Callback processing when auth unsuccessful * * @param token the token can pass authentication * @param subject the incoming auth &lt;code&gt;Subject&lt;/code&gt; * @param request the incoming &lt;code&gt;ServletRequest&lt;/code&gt; * @param response the outgoing &lt;code&gt;ServletResponse&lt;/code&gt; */ void onSuccessful(AuthenticationToken token, Subject subject, ServletRequest request, ServletResponse response);&#125;JwtRealm1234567891011121314151617181920212223@Componentpublic class JwtRealm extends AuthorizingRealm &#123; @Override protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) &#123; return null; &#125; @Override protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) throws AuthenticationException &#123; String jwt = ((JWTToken) token).getToken(); boolean authResult = JwtUtils.verifyToken(jwt); if (!authResult) &#123; throw new IncorrectCredentialsException(); &#125; return new SimpleAuthenticationInfo(jwt, jwt, getName()); &#125; @Override public boolean supports(AuthenticationToken token) &#123; return token instanceof JWTToken; &#125;&#125;JwtUtils123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140@Slf4j@Componentpublic class JwtUtils &#123; private static String issuer; private static String secret; private static Duration lifeTime; private static SignatureAlgorithm algorithm; @Autowired public void init(SecurityProperties securityProperties) &#123; SecurityProperties.JWT jwt = securityProperties.getJwt(); JwtUtils.issuer = jwt.getIss(); JwtUtils.secret = jwt.getSecret(); JwtUtils.lifeTime = jwt.getLifeTime(); JwtUtils.algorithm = jwt.getAlg(); &#125; public static String createToken(String subject) &#123; Map&lt;String, Object&gt; claims = Collections.emptyMap(); return doCreateToken(subject, claims, lifeTime); &#125; public static String createToken(String subject, Consumer&lt;Map&lt;String, Object&gt;&gt; consumer) &#123; Map&lt;String, Object&gt; claims = new HashMap&lt;&gt;(); consumer.accept(claims); return doCreateToken(subject, claims, lifeTime); &#125; public static String createToken(String subject, Map&lt;String, Object&gt; claims) &#123; return createToken(subject, map -&gt; map.putAll(claims)); &#125; public static String createToken(String subject, Map&lt;String, Object&gt; claims, long expiration, ChronoUnit unit) &#123; return doCreateToken(subject, claims, Duration.of(expiration, unit)); &#125; private static String doCreateToken(String subject, Map&lt;String, Object&gt; claims, Duration expiration) &#123; Instant now = Instant.now(); JwtBuilder builder = Jwts.builder() .setHeaderParam(Header.TYPE, Header.JWT_TYPE) //æ·»åŠ ä»¤ç‰Œç±»å‹ .addClaims(claims) //æ·»åŠ è‡ªå®šä¹‰Claims .setSubject(subject) //æ¥å—äºº .setIssuedAt(Date.from(now)) //ç­¾å‘æ—¶é—´ .signWith(algorithm, secret); if (StringUtils.hasText(issuer)) &#123; builder.setIssuer(issuer); //ç­¾å‘äºº &#125; if (expiration != null &amp;&amp; expiration.isNegative()) &#123; builder.setExpiration(Date.from(now.plus(expiration))); //è¿‡æœŸæ—¶é—´ &#125; String token = builder.compact(); if (log.isTraceEnabled()) &#123; log.trace(\"Create token[&#123;&#125;] in &#123;&#125;\", token, Date.from(now)); &#125; return token; &#125; public static Claims getClaims(String token) &#123; Claims body; try &#123; body = Jwts.parser() .setSigningKey(secret) .parseClaimsJws(token) .getBody(); &#125; catch (ExpiredJwtException e) &#123; // ignoring expired token exception body = e.getClaims(); &#125; catch (Exception e) &#123; if (log.isDebugEnabled()) &#123; log.debug(\"An exception[&#123;&#125;] occurred during get claims\", e.getMessage()); &#125; body = null; &#125; return body; &#125; public static boolean verifyToken(String token) &#123; //noinspection rawtypes Jwt jwt; try &#123; jwt = parseToken(token); &#125; catch (Exception e) &#123; if (log.isDebugEnabled()) &#123; log.debug(\"Token[&#123;&#125;] verify failed, message: &#123;&#125;\", token, e.getMessage()); &#125; return false; &#125; Claims claims = (Claims) jwt.getBody(); String issuer = claims.getIssuer(); if (issuer != null &amp;&amp; !issuer.equals(JwtUtils.issuer)) &#123; if (log.isDebugEnabled()) &#123; String msg = \"Incorrect issuer: \" + issuer; log.debug(\"Token[&#123;&#125;] verify failed, message: &#123;&#125;\", token, msg); &#125; return false; &#125; String subject = claims.getSubject(); if (!StringUtils.hasText(subject)) &#123; if (log.isDebugEnabled()) &#123; String msg = \"subject cannot be null or empty\"; log.debug(\"Token[&#123;&#125;] verify failed, message: &#123;&#125;\", token, msg); &#125; return false; &#125; return true; &#125; /** * @see JwtParser#parse(String) */ @SuppressWarnings(\"rawtypes\") private static Jwt parseToken(String token) throws ExpiredJwtException, MalformedJwtException, SignatureException &#123; return Jwts.parser() .setSigningKey(secret) .parse(token); &#125; public static boolean isValidToken(String token, String subject) &#123; Optional&lt;String&gt; username = getClaimFromToken(token, Claims::getSubject); return username.filter(s -&gt; (s.equals(subject) &amp;&amp; !isTokenExpired(token))).isPresent(); &#125; public static boolean isTokenExpired(String token) &#123; Optional&lt;Date&gt; expiration = getClaimFromToken(token, Claims::getExpiration); return expiration.map(date -&gt; date.before(new Date())).orElse(false); &#125; public static &lt;T&gt; Optional&lt;T&gt; getClaimFromToken(String token, Function&lt;Claims, T&gt; resolver) &#123; Claims claims = getClaims(token); if (claims == null) &#123; if (log.isDebugEnabled()) &#123; log.debug(\"Cannot operate on a null Claims\"); &#125; return Optional.empty(); &#125; return Optional.ofNullable(resolver.apply(claims)); &#125;&#125;ShiroConfig123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990@Configuration@EnableConfigurationProperties(SecurityProperties.class)@ConditionalOnProperty(name = \"me.lolico.blog.security.enable\", matchIfMissing = true)public class ShiroConfig &#123; @Bean public SecurityManager securityManager(Collection&lt;Realm&gt; realms) &#123; DefaultWebSecurityManager securityManager = new DefaultWebSecurityManager(realms); /* * å…³é—­shiroè‡ªå¸¦çš„session */ DefaultSubjectDAO subjectDAO = new DefaultSubjectDAO(); DefaultSessionStorageEvaluator defaultSessionStorageEvaluator = new DefaultSessionStorageEvaluator(); defaultSessionStorageEvaluator.setSessionStorageEnabled(false); subjectDAO.setSessionStorageEvaluator(defaultSessionStorageEvaluator); securityManager.setSubjectDAO(subjectDAO); //è®¤è¯å™¨ ModularRealmAuthenticator authenticator = new ModularRealmAuthenticator(); authenticator.setRealms(realms); //è®¤è¯ç­–ç•¥ authenticator.setAuthenticationStrategy(new FirstSuccessfulStrategy()); securityManager.setAuthenticator(authenticator); return securityManager; &#125; @Bean public ShiroFilterFactoryBean shiroFilterFactoryBean(SecurityManager securityManager) &#123; ShiroFilterFactoryBean factoryBean = new ShiroFilterFactoryBean(); factoryBean.setSecurityManager(securityManager); // è‡ªå®šä¹‰è¿‡æ»¤å™¨ Map&lt;String, Filter&gt; map = new HashMap&lt;&gt;(); map.put(\"auth\", new JwtHttpAuthenticationFilter()); factoryBean.setFilters(map); // è‡ªå®šä¹‰è·¯ç”±ç­–ç•¥ Map&lt;String, String&gt; definitionMap = new LinkedHashMap&lt;&gt;(); definitionMap.put(\"/login\", \"anon\"); definitionMap.put(\"/register\", \"anon\"); definitionMap.put(\"/u/confirm/**\", \"anon\"); definitionMap.put(\"/**\", \"auth\"); factoryBean.setFilterChainDefinitionMap(definitionMap); return factoryBean; &#125; /** * A &#123;@code credentialsMatcher&#125;, * using SHA256 algorithm and iteration three times * * @return a credentialsMatcher */ @Bean public CredentialsMatcher hashedCredentialsMatcher() &#123; HashedCredentialsMatcher credentialsMatcher = new HashedCredentialsMatcher(); credentialsMatcher.setHashAlgorithmName(Sha256Hash.ALGORITHM_NAME); credentialsMatcher.setHashIterations(Constant.security.ITERATIONS); credentialsMatcher.setStoredCredentialsHexEncoded(Constant.security.TO_HEX); return credentialsMatcher; &#125; /** * Annotation support */ @Bean @DependsOn(\"lifecycleBeanPostProcessor\") public DefaultAdvisorAutoProxyCreator defaultAdvisorAutoProxyCreator() &#123; DefaultAdvisorAutoProxyCreator defaultAdvisorAutoProxyCreator = new DefaultAdvisorAutoProxyCreator(); // å¼ºåˆ¶ä½¿ç”¨cglibï¼Œé˜²æ­¢é‡å¤ä»£ç†å’Œå¯èƒ½å¼•èµ·ä»£ç†å‡ºé”™çš„é—®é¢˜ // https://zhuanlan.zhihu.com/p/29161098 defaultAdvisorAutoProxyCreator.setProxyTargetClass(true); return defaultAdvisorAutoProxyCreator; &#125; @Bean public LifecycleBeanPostProcessor lifecycleBeanPostProcessor() &#123; return new LifecycleBeanPostProcessor(); &#125; @Bean public AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor(SecurityManager securityManager) &#123; AuthorizationAttributeSourceAdvisor advisor = new AuthorizationAttributeSourceAdvisor(); advisor.setSecurityManager(securityManager); return advisor; &#125; &#125;JwtRealm#doGetAuthorizationInfoè·å–æƒé™å¯ä»¥ä»tokenä¸­è§£æç„¶åè¿”å›ï¼Œæ³¨æ„åœ¨ç”Ÿæˆtokençš„æ—¶å€™è¦æ”¾åˆ°Claimsä¸­JwtAuthenticationFilter#isAccessAllowedæ–¹æ³•ä¸­æ³¨é‡Šçš„éƒ¨åˆ†å’ŒJwtAuthenticationFilter#preHandleæ–¹æ³•æ˜¯æ”¯æŒcorsçš„ä¸¤ç§æ–¹å¼ã€‚è‡³äºå…¶ä»–åœ°æ–¹ï¼Œåº”è¯¥ä¸éš¾ç†è§£ã€‚åè¯­Shiroçš„è®¤è¯æµç¨‹åˆ°ç°åœ¨ï¼Œé‚£ä¹ˆä¹Ÿå°±åˆ†æå®Œäº†ã€‚ä»Shiroçš„Filteråˆ°SecurityManagerå†åˆ°å‰åç«¯åˆ†ç¦»æ¡ˆä¾‹ï¼Œå…¶å®ä¸€è·¯çœ‹ä¸‹æ¥ï¼ŒShiroæ¡†æ¶çš„ä»£ç æ˜¯ååˆ†ä¼˜é›…å¹¶ä¸”ç®€å•æ˜“ç”¨çš„ã€‚æ–‡ç« ä¸­ä»£ç è¾ƒå¤šã€‚å¦‚æœ‰ä»»ä½•é”™è¯¯ï¼Œè¿˜è¯·æŒ‡å‡ºï¼Œè°¢è°¢ã€‚","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Web","slug":"Web","permalink":"https://lolico.me/tags/Web/"},{"name":"Shiro","slug":"Shiro","permalink":"https://lolico.me/tags/Shiro/"},{"name":"Security","slug":"Security","permalink":"https://lolico.me/tags/Security/"}]},{"title":"Shiroç®€ä»‹","slug":"Shiroç®€ä»‹","date":"2020-02-04T10:48:33.000Z","updated":"2022-03-06T10:28:21.343Z","comments":true,"path":"2020/02/04/Shiroç®€ä»‹/","link":"","permalink":"https://lolico.me/2020/02/04/Shiro%E7%AE%80%E4%BB%8B/","excerpt":"","text":"Apache Shiroæ˜¯ä¸€ä¸ªå¼ºå¤§ä¸”æ˜“ç”¨çš„Javaå®‰å…¨æ¡†æ¶,æ‰§è¡Œèº«ä»½éªŒè¯ã€æˆæƒã€å¯†ç å’Œä¼šè¯ç®¡ç†ã€‚ä½¿ç”¨Shiroçš„æ˜“äºç†è§£çš„API,æ‚¨å¯ä»¥å¿«é€Ÿã€è½»æ¾åœ°è·å¾—ä»»ä½•åº”ç”¨ç¨‹åº,ä»æœ€å°çš„ç§»åŠ¨åº”ç”¨ç¨‹åºåˆ°æœ€å¤§çš„ç½‘ç»œå’Œä¼ä¸šåº”ç”¨ç¨‹åºã€‚Shiro å¯ä»¥éå¸¸å®¹æ˜“çš„å¼€å‘å‡ºè¶³å¤Ÿå¥½çš„åº”ç”¨ï¼Œå…¶ä¸ä»…å¯ä»¥ç”¨åœ¨ JavaSE ç¯å¢ƒï¼Œä¹Ÿå¯ä»¥ç”¨åœ¨JavaEE ç¯å¢ƒã€‚Shiro å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®Œæˆï¼šè®¤è¯ã€æˆæƒã€åŠ å¯†ã€ä¼šè¯ç®¡ç†ã€ä¸ Web é›†æˆã€ç¼“å­˜ç­‰ã€‚Authenticationï¼šèº«ä»½è®¤è¯/ç™»å½•ï¼ŒéªŒè¯ç”¨æˆ·æ˜¯ä¸æ˜¯æ‹¥æœ‰ç›¸åº”çš„èº«ä»½ï¼›Authorizationï¼šæˆæƒï¼Œå³æƒé™éªŒè¯ï¼ŒéªŒè¯æŸä¸ªå·²è®¤è¯çš„ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æŸä¸ªæƒé™ï¼›å³åˆ¤æ–­ç”¨æˆ·æ˜¯å¦èƒ½åšäº‹æƒ…ï¼Œå¸¸è§çš„å¦‚ï¼šéªŒè¯æŸä¸ªç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æŸä¸ªè§’è‰²ã€‚æˆ–è€…ç»†ç²’åº¦çš„éªŒè¯æŸä¸ªç”¨æˆ·å¯¹æŸä¸ªèµ„æºæ˜¯å¦å…·æœ‰æŸä¸ªæƒé™ï¼›Session Managerï¼šä¼šè¯ç®¡ç†ï¼Œå³ç”¨æˆ·ç™»å½•åå°±æ˜¯ä¸€æ¬¡ä¼šè¯ï¼Œåœ¨æ²¡æœ‰é€€å‡ºä¹‹å‰ï¼Œå®ƒçš„æ‰€æœ‰ä¿¡æ¯éƒ½åœ¨ä¼šè¯ä¸­ï¼›ä¼šè¯å¯ä»¥æ˜¯æ™®é€šJavaSE ç¯å¢ƒçš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¦‚ Web ç¯å¢ƒçš„ï¼›Cryptographyï¼šåŠ å¯†ï¼Œä¿æŠ¤æ•°æ®çš„å®‰å…¨æ€§ï¼Œå¦‚å¯†ç åŠ å¯†å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œè€Œä¸æ˜¯æ˜æ–‡å­˜å‚¨ï¼›Web Supportï¼šWeb æ”¯æŒï¼Œå¯ä»¥éå¸¸å®¹æ˜“çš„é›†æˆåˆ° Web ç¯å¢ƒï¼›Cachingï¼šç¼“å­˜ï¼Œæ¯”å¦‚ç”¨æˆ·ç™»å½•åï¼Œå…¶ç”¨æˆ·ä¿¡æ¯ã€æ‹¥æœ‰çš„è§’è‰²/æƒé™ä¸å¿…æ¯æ¬¡å»æŸ¥ï¼Œè¿™æ ·å¯ä»¥æé«˜æ•ˆç‡ï¼›Concurrencyï¼šshiro æ”¯æŒå¤šçº¿ç¨‹åº”ç”¨çš„å¹¶å‘éªŒè¯ï¼Œå³å¦‚åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å¼€å¯å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œèƒ½æŠŠæƒé™è‡ªåŠ¨ä¼ æ’­è¿‡å»ï¼›Testingï¼šæä¾›æµ‹è¯•æ”¯æŒï¼›Run Asï¼šå…è®¸ä¸€ä¸ªç”¨æˆ·å‡è£…ä¸ºå¦ä¸€ä¸ªç”¨æˆ·ï¼ˆå¦‚æœä»–ä»¬å…è®¸ï¼‰çš„èº«ä»½è¿›è¡Œè®¿é—®ï¼›Remember Meï¼šè®°ä½æˆ‘ï¼Œè¿™ä¸ªæ˜¯éå¸¸å¸¸è§çš„åŠŸèƒ½ï¼Œå³ä¸€æ¬¡ç™»å½•åï¼Œä¸‹æ¬¡å†æ¥çš„è¯ä¸ç”¨ç™»å½•äº†ã€‚æ³¨ï¼šShiro ä¸ä¼šå»ç»´æŠ¤ç”¨æˆ·ã€ç»´æŠ¤æƒé™ï¼›è¿™äº›éœ€è¦æˆ‘ä»¬è‡ªå·±å»è®¾è®¡/æä¾›ï¼›ç„¶åé€šè¿‡ç›¸åº”çš„æ¥å£æ³¨å…¥ç»™ Shiro å³å¯ã€‚ä»å¤–éƒ¨çœ‹ï¼ŒShiro ä¸­å¯¹å¤–äº¤äº’çš„APIå¦‚ä¸‹ï¼šSubjectï¼šä¸»ä½“ï¼Œä»£è¡¨äº†å½“å‰â€œç”¨æˆ·â€ï¼Œè¿™ä¸ªç”¨æˆ·ä¸ä¸€å®šæ˜¯ä¸€ä¸ªå…·ä½“çš„äººï¼Œä¸å½“å‰åº”ç”¨äº¤äº’çš„ä»»ä½•ä¸œè¥¿éƒ½æ˜¯ Subjectï¼Œå¦‚ç½‘ç»œçˆ¬è™«ï¼Œæœºå™¨äººç­‰ï¼›å³ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼›æ‰€æœ‰ Subject éƒ½ç»‘å®šåˆ° SecurityManagerï¼Œä¸ Subject çš„æ‰€æœ‰äº¤äº’éƒ½ä¼šå§”æ‰˜ç»™ SecurityManagerï¼›å¯ä»¥æŠŠ Subject è®¤ä¸ºæ˜¯ä¸€ä¸ªé—¨é¢ï¼›SecurityManager æ‰æ˜¯å®é™…çš„æ‰§è¡Œè€…ï¼›SecurityManagerï¼šå®‰å…¨ç®¡ç†å™¨ï¼›å³æ‰€æœ‰ä¸å®‰å…¨æœ‰å…³çš„æ“ä½œéƒ½ä¼šä¸ SecurityManager äº¤äº’ï¼›ä¸”å®ƒç®¡ç†ç€æ‰€æœ‰ Subjectï¼›å¯ä»¥çœ‹å‡ºå®ƒæ˜¯ Shiro çš„æ ¸å¿ƒï¼Œå®ƒè´Ÿè´£ä¸åè¾¹ä»‹ç»çš„å…¶ä»–ç»„ä»¶è¿›è¡Œäº¤äº’ï¼Œå¦‚æœå­¦ä¹ è¿‡ SpringMVCï¼Œä½ å¯ä»¥æŠŠå®ƒçœ‹æˆ DispatcherServlet å‰ç«¯æ§åˆ¶å™¨ï¼›Realmï¼šåŸŸï¼ŒShiro ä»ä» Realm è·å–å®‰å…¨æ•°æ®ï¼ˆå¦‚ç”¨æˆ·ã€è§’è‰²ã€æƒé™ï¼‰ï¼Œå°±æ˜¯è¯´ SecurityManagerè¦éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œé‚£ä¹ˆå®ƒéœ€è¦ä» Realm è·å–ç›¸åº”çš„ç”¨æˆ·è¿›è¡Œæ¯”è¾ƒä»¥ç¡®å®šç”¨æˆ·èº«ä»½æ˜¯å¦åˆæ³•ï¼›ä¹Ÿéœ€è¦ä» Realm å¾—åˆ°ç”¨æˆ·ç›¸åº”çš„è§’è‰²/æƒé™è¿›è¡ŒéªŒè¯ç”¨æˆ·æ˜¯å¦èƒ½è¿›è¡Œæ“ä½œï¼›å¯ä»¥æŠŠ Realm çœ‹æˆ DataSourceï¼Œå³å®‰å…¨æ•°æ®æºã€‚ä»å†…éƒ¨çœ‹ï¼ŒShiro ä¸­çš„æ¶æ„å¦‚ä¸‹ï¼šSubjectï¼šä¸»ä½“ï¼Œå¯ä»¥çœ‹åˆ°ä¸»ä½“å¯ä»¥æ˜¯ä»»ä½•å¯ä»¥ä¸åº”ç”¨äº¤äº’çš„â€œç”¨æˆ·â€ï¼›SecurityManager ï¼š ç›¸ å½“ äº SpringMVC ä¸­ çš„ DispatcherServlet æˆ– è€… Struts2 ä¸­ çš„ FilterDispatcherï¼›æ˜¯ Shiro çš„å¿ƒè„ï¼›æ‰€æœ‰å…·ä½“çš„äº¤äº’éƒ½é€šè¿‡ SecurityManager è¿›è¡Œæ§åˆ¶ï¼›å®ƒç®¡ç†ç€æ‰€æœ‰ Subjectã€ä¸”è´Ÿè´£è¿›è¡Œè®¤è¯å’Œæˆæƒã€åŠä¼šè¯ã€ç¼“å­˜çš„ç®¡ç†ã€‚Authenticatorï¼šè®¤è¯å™¨ï¼Œè´Ÿè´£ä¸»ä½“è®¤è¯çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªæ‰©å±•ç‚¹ï¼Œå¦‚æœç”¨æˆ·è§‰å¾— Shiro é»˜è®¤çš„ä¸å¥½ï¼Œå¯ä»¥è‡ªå®šä¹‰å®ç°ï¼›å…¶éœ€è¦è®¤è¯ç­–ç•¥ï¼ˆAuthentication Strategyï¼‰ï¼Œå³ä»€ä¹ˆæƒ…å†µä¸‹ç®—ç”¨æˆ·è®¤è¯é€šè¿‡äº†ï¼›Authrizerï¼šæˆæƒå™¨ï¼Œæˆ–è€…è®¿é—®æ§åˆ¶å™¨ï¼Œç”¨æ¥å†³å®šä¸»ä½“æ˜¯å¦æœ‰æƒé™è¿›è¡Œç›¸åº”çš„æ“ä½œï¼›å³æ§åˆ¶ç€ç”¨æˆ·èƒ½è®¿é—®åº”ç”¨ä¸­çš„å“ªäº›åŠŸèƒ½ï¼›Realmï¼šå¯ä»¥æœ‰ 1 ä¸ªæˆ–å¤šä¸ª Realmï¼Œå¯ä»¥è®¤ä¸ºæ˜¯å®‰å…¨å®ä½“æ•°æ®æºï¼Œå³ç”¨äºè·å–å®‰å…¨å®ä½“çš„ï¼›å¯ä»¥æ˜¯ JDBC å®ç°ï¼Œä¹Ÿå¯ä»¥æ˜¯ LDAP å®ç°ï¼Œæˆ–è€…å†…å­˜å®ç°ç­‰ç­‰ï¼›ç”±ç”¨æˆ·æä¾›ï¼›æ³¨æ„ï¼šä¸çŸ¥é“ä½ çš„ç”¨æˆ·/æƒé™å­˜å‚¨åœ¨å“ªåŠä»¥ä½•ç§æ ¼å¼å­˜å‚¨ï¼›æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬åœ¨åº”ç”¨ä¸­éƒ½éœ€è¦å®ç°è‡ªå·±çš„ Realmï¼›SessionManagerï¼šå¦‚æœå†™è¿‡ Servlet å°±åº”è¯¥çŸ¥é“ Session çš„æ¦‚å¿µï¼ŒSession å‘¢éœ€è¦æœ‰äººå»ç®¡ç†å®ƒçš„ç”Ÿå‘½å‘¨æœŸï¼Œè¿™ä¸ªç»„ä»¶å°±æ˜¯ SessionManagerï¼›è€Œ Shiro å¹¶ä¸ä»…ä»…å¯ä»¥ç”¨åœ¨ Web ç¯å¢ƒï¼Œä¹Ÿå¯ä»¥ç”¨åœ¨å¦‚æ™®é€šçš„ JavaSE ç¯å¢ƒã€EJB ç­‰ç¯å¢ƒï¼›æ‰€æœ‰å‘¢ï¼ŒShiro å°±æŠ½è±¡äº†ä¸€ä¸ªè‡ªå·±çš„ Sessionæ¥ç®¡ç†ä¸»ä½“ä¸åº”ç”¨ä¹‹é—´äº¤äº’çš„æ•°æ®ï¼›è¿™æ ·çš„è¯ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨ Web ç¯å¢ƒç”¨ï¼Œåˆšå¼€å§‹æ˜¯ä¸€å°Web æœåŠ¡å™¨ï¼›æ¥ç€åˆä¸Šäº†å° EJB æœåŠ¡å™¨ï¼›è¿™æ—¶æƒ³æŠŠä¸¤å°æœåŠ¡å™¨çš„ä¼šè¯æ•°æ®æ”¾åˆ°ä¸€ä¸ªåœ°æ–¹ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥å®ç°è‡ªå·±çš„åˆ†å¸ƒå¼ä¼šè¯ï¼ˆå¦‚æŠŠæ•°æ®æ”¾åˆ° Memcached æœåŠ¡å™¨ï¼‰ï¼›SessionDAOï¼šDAO å¤§å®¶éƒ½ç”¨è¿‡ï¼Œæ•°æ®è®¿é—®å¯¹è±¡ï¼Œç”¨äºä¼šè¯çš„ CRUDï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³æŠŠ Sessionä¿å­˜åˆ°æ•°æ®åº“ï¼Œé‚£ä¹ˆå¯ä»¥å®ç°è‡ªå·±çš„ SessionDAOï¼Œé€šè¿‡å¦‚ JDBC å†™åˆ°æ•°æ®åº“ï¼›æ¯”å¦‚æƒ³æŠŠSession æ”¾åˆ° Memcached ä¸­ï¼Œå¯ä»¥å®ç°è‡ªå·±çš„ Memcached SessionDAOï¼›å¦å¤– SessionDAOä¸­å¯ä»¥ä½¿ç”¨ Cache è¿›è¡Œç¼“å­˜ï¼Œä»¥æé«˜æ€§èƒ½ï¼›CacheManagerï¼šç¼“å­˜æ§åˆ¶å™¨ï¼Œæ¥ç®¡ç†å¦‚ç”¨æˆ·ã€è§’è‰²ã€æƒé™ç­‰çš„ç¼“å­˜çš„ï¼›å› ä¸ºè¿™äº›æ•°æ®åŸºæœ¬ä¸Šå¾ˆå°‘å»æ”¹å˜ï¼Œæ”¾åˆ°ç¼“å­˜ä¸­åå¯ä»¥æé«˜è®¿é—®çš„æ€§èƒ½Cryptographyï¼šå¯†ç æ¨¡å—ï¼ŒShiro æé«˜äº†ä¸€äº›å¸¸è§çš„åŠ å¯†ç»„ä»¶ç”¨äºå¦‚å¯†ç åŠ å¯†/è§£å¯†çš„ã€‚","categories":[{"name":"ä¸æ­£å¸¸çš„æ–‡ç« ","slug":"ä¸æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E4%B8%8D%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Web","slug":"Web","permalink":"https://lolico.me/tags/Web/"},{"name":"Shiro","slug":"Shiro","permalink":"https://lolico.me/tags/Shiro/"},{"name":"Security","slug":"Security","permalink":"https://lolico.me/tags/Security/"}]},{"title":"æ—¶é—´æˆ³ä½œä¸ºsaltæ—¶çš„ç²¾åº¦é—®é¢˜","slug":"æ—¶é—´æˆ³ä½œä¸ºsaltæ—¶çš„ç²¾åº¦é—®é¢˜","date":"2020-01-23T10:46:22.000Z","updated":"2022-03-06T10:28:21.347Z","comments":true,"path":"2020/01/23/æ—¶é—´æˆ³ä½œä¸ºsaltæ—¶çš„ç²¾åº¦é—®é¢˜/","link":"","permalink":"https://lolico.me/2020/01/23/%E6%97%B6%E9%97%B4%E6%88%B3%E4%BD%9C%E4%B8%BAsalt%E6%97%B6%E7%9A%84%E7%B2%BE%E5%BA%A6%E9%97%AE%E9%A2%98/","excerpt":"","text":"å‰è¨€åœ¨webé¡¹ç›®ä¸­é‡‡ç”¨ç”¨æˆ·æ³¨å†Œæ—¶çš„æ—¶é—´æˆ³ä½œä¸ºå¯†ç åŠ å¯†çš„saltï¼š123public String getSalt(User user) &#123; return String.valueOf(user.getRegistrationTime().getTime()/1000L);&#125;æ•°æ®åº“ä¸­ä¿å­˜æ³¨å†Œæ—¶é—´æˆ³çš„å­—æ®µç±»å‹ä½¿ç”¨Timestamp(0)å³10ä½ç²¾ç¡®åˆ°çš„ç§’æ—¶é—´æˆ³æ³¨å†Œç”¨æˆ·é€»è¾‘ï¼š12345678910111213public User registerAnAccount(User user) &#123; if (isExist(user.getName(), user.getEmail())) &#123; return null; &#125; HttpServletRequest request = ((ServletRequestAttributes) Objects.requireNonNull(RequestContextHolder.getRequestAttributes())).getRequest(); user.setRegistrationIp(request.getRemoteAddr()); user.setRegistrationTime(Timestamp.from(Instant.now())); user.setStatus(User.Status.WAITING_CONFIRMATION); user.setPassword(HashUtils.hash(user.getPassword(), getSalt(user))); return repository.save(user);&#125;è·å–æ—¶é—´æˆ³åè®¾ç½®æ³¨å†Œç”¨æˆ·çš„å±æ€§ï¼Œä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºsaltç»™å¯†ç åŠ å¯†ä¿å­˜åˆ°æ•°æ®åº“ã€‚getSalt(User)æ–¹æ³•ç›´æ¥è¿”å›timestamp.getTime()/1000Lçš„å€¼ï¼Œæ˜¯ä¸€ä¸ª10ä½ç²¾ç¡®åˆ°ç§’çš„æ—¶é—´æˆ³ã€‚åœ¨ç”¨æˆ·ç™»å½•æ—¶å‘ç°éƒ¨åˆ†ç”¨æˆ·ç™»å½•å¯†ç é”™è¯¯ã€‚å¯ä»¥ä¿è¯çš„æ˜¯ä¸šåŠ¡ä»£ç çš„é€»è¾‘æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œé‚£ä¹ˆå¯ä»¥è‚¯å®šåº”è¯¥å°±æ˜¯æ•°æ®å­˜å‚¨åˆ°æ•°æ®åº“æ—¶å‘ç”Ÿäº†é—®é¢˜ã€‚åŸå› æ¨¡æ‹Ÿæ³¨å†Œæ“ä½œï¼Œæ‰“ä¸Šæ–­ç‚¹ï¼šsaltï¼š1579764044registrationTimeï¼š2020-01-23 15:20:44.986ï¼ˆå¯ä»¥çœ‹åˆ°nanoså­—æ®µä¸º986000000ï¼Œç²¾ç¡®åˆ°æ¯«ç§’ï¼‰æ¨¡æ‹Ÿç™»å½•æ“ä½œï¼Œé‡‡ç”¨Shiroæ¡†æ¶å®ç°è®¤è¯å’Œé‰´æƒï¼Œåœ¨è¿”å›SimpleAuthenticationInfoæ—¶æ‰“ä¸Šæ–­ç‚¹ï¼šæŸ¥çœ‹ä»æ•°æ®åº“æŸ¥å‡ºæ¥çš„ç”¨æˆ·ä¿¡æ¯å’Œsaltå€¼ï¼šsaltï¼š1579764045registrationTimeï¼š2020-01-23 15:20:45.0ï¼ˆnanonså­—æ®µä¸º0å› ä¸ºæ•°æ®åº“å­—æ®µè®¾ç½®ä¸ºç²¾ç¡®åˆ°ç§’ï¼‰åœ¨è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹ä¹‹å‰è¿˜æ¨¡æ‹Ÿäº†ä¸€äº›ç”¨æˆ·æ³¨å†Œå’Œç™»å½•ï¼Œå‘ç°ç”¨æˆ·åœ¨ç™»é™†æ—¶çš„saltå€¼å’Œæ³¨å†Œæ—¶çš„æ˜¯ä¸€æ ·çš„ï¼Œå¯ä»¥ç™»å½•æˆåŠŸï¼Œè€Œè¿™ä¸ªåœ¨ç™»é™†æ—¶çš„å´æ¯”æ³¨å†Œæ—¶æ‰€ç”¨çš„saltå¤§1ï¼Œè§‚å¯Ÿåˆ°èƒ½ç™»é™†æˆåŠŸçš„ç”¨æˆ·ä¿¡æ¯æ³¨å†Œæ—¶çš„æ—¶é—´æˆ³å­—æ®µæ¯«ç§’éƒ¨åˆ†éƒ½å°äº500ï¼Œè€Œè¿™ä¸ªç”¨ä¾‹çš„æ¯«ç§’éƒ¨åˆ†ä¸º986ï¼ŒçŒœæµ‹åœ¨ä¿å­˜æ—¶é—´æˆ³åˆ°æ•°æ®åº“ï¼Œä¸¢å¤±ç²¾åº¦ï¼ˆæ¯«ç§’éƒ¨åˆ†ï¼‰æ—¶ä¼šè¿›è¡Œå››èˆäº”å…¥ï¼Œæ¯«ç§’éƒ¨åˆ†å¤§äº500è¿›1ï¼Œæ‰€ä»¥å¯¼è‡´çš„å°±æ˜¯åœ¨æ³¨å†Œæ—¶å¦‚æœæ¯«ç§’éƒ¨åˆ†å¤§äº500ï¼Œæ³¨å†Œgetçš„ç›å€¼ä¼šæ¯”ç™»å½•æ—¶getçš„ç›å€¼è¦å°1ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢å›¾ç‰‡ä¸­çš„æƒ…å†µã€‚googleå¹¶ä¸”å¤§é‡æµ‹è¯•è¯å®äº†çŒœæƒ³ã€‚è§£å†³æ•°æ®åº“Timestampç±»å‹é•¿åº¦è®¾ç½®ä¸º3å³ç²¾ç¡®åˆ°æ¯«ç§’ï¼ˆå¯ä»¥ä¿è¯åœ¨ä¿å­˜æ—¶ä¸ä¼šå‘ç”Ÿä¸¢å¤±ç²¾åº¦å¯¼è‡´çš„å››èˆäº”å…¥æƒ…å†µï¼‰ä¿®æ”¹getSalt(User)æ–¹æ³•ï¼š1234567public String getSalt(User user) &#123; int nanos = user.getRegistrationTime().getNanos(); if (nanos &gt; 500000000) &#123; return String.valueOf(user.getRegistrationTime().getTime() / 1000L + 1); &#125; return String.valueOf(user.getRegistrationTime().getTime() / 1000L);&#125;æ³¨å†Œæ—¶è®¾ç½®registrationTime123&#x2F;&#x2F;user.setRegistrationTime(Timestamp.from(Instant.now()));&#x2F;&#x2F;æ”¹ä¸ºä¸‹é¢è¿™ç§ï¼Œæˆªæ–­æ¯«ç§’éƒ¨åˆ†user.setRegistrationTime(new Timestamp(Instant.now().getEpochSecond()*1000));","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://lolico.me/tags/Java/"},{"name":"Password","slug":"Password","permalink":"https://lolico.me/tags/Password/"},{"name":"Salt","slug":"Salt","permalink":"https://lolico.me/tags/Salt/"}]},{"title":"SpringBoot Aop+æ³¨è§£å®ç°åŠ¨æ€å¤šæ•°æ®æº","slug":"SpringBoot-Aop-æ³¨è§£å®ç°åŠ¨æ€å¤šæ•°æ®æº","date":"2020-01-17T10:43:19.000Z","updated":"2022-03-06T10:28:21.343Z","comments":true,"path":"2020/01/17/SpringBoot-Aop-æ³¨è§£å®ç°åŠ¨æ€å¤šæ•°æ®æº/","link":"","permalink":"https://lolico.me/2020/01/17/SpringBoot-Aop-%E6%B3%A8%E8%A7%A3%E5%AE%9E%E7%8E%B0%E5%8A%A8%E6%80%81%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90/","excerpt":"","text":"å‰è¨€Springæä¾›äº†AbstractRoutingDataSourceç±»ä»¥æ–¹ä¾¿å¼€å‘è€…å®ç°å¤šæ•°æ®æºï¼Œçœ‹ä¸€ä¸‹AbstractRoutingDataSource#getConnection()çš„æºç ï¼š1234@Overridepublic Connection getConnection() throws SQLException &#123; return determineTargetDataSource().getConnection();&#125;å¯ä»¥çœ‹åˆ°åœ¨getConnection()æ–¹æ³•ä¸­æ˜¯é€šè¿‡è°ƒç”¨determineTargetDataSource().getConnection();è·å–ä¸€ä¸ªè¿æ¥ï¼Œç»§ç»­è¿½è¸ªåˆ°determineTargetDataSource()æ–¹æ³•ï¼š12345678910111213141516protected DataSource determineTargetDataSource() &#123; Assert.notNull(this.resolvedDataSources, \"DataSource router not initialized\"); //è·å–key,æ¨¡æ¿æ–¹æ³•æ¨¡å¼ Object lookupKey = determineCurrentLookupKey(); //æ ¹æ®keyè·å–DataSource DataSource dataSource = this.resolvedDataSources.get(lookupKey); //å¦‚æœdataSourceä¸ºç©ºå¹¶ä¸”å¯ç”¨è·å–é»˜è®¤dataSourceæˆ–lookupKeyä¸ºç©ºæ—¶å–é»˜è®¤çš„DataSource //ï¼ˆlenientFallbacké»˜è®¤ä¸ºtrueï¼‰ if (dataSource == null &amp;&amp; (this.lenientFallback || lookupKey == null)) &#123; dataSource = this.resolvedDefaultDataSource; &#125; if (dataSource == null) &#123;//å¦‚æœdataSourceä¸ºç©ºæŠ›å‡ºå¼‚å¸¸ throw new IllegalStateException(\"Cannot determine target DataSource for lookup key [\" + lookupKey + \"]\"); &#125; return dataSource;&#125;å¯ä»¥çœ‹åˆ°determineTargetDataSource()æ–¹æ³•å…ˆè°ƒç”¨determineCurrentLookupKey()è·å–lookupKeyï¼Œå†é€šè¿‡this.resolvedDataSources.get(lookupKey);å–å‡ºDataSourceï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹determineCurrentLookupKey()æ–¹æ³•ï¼Œå‘ç°è¿™ä¸ªæ–¹æ³•æ˜¯ä¸ªabstractæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´å­ç±»å¿…é¡»è¦å®ç°ï¼Œå†çœ‹ä¸‹this.resolvedDataSourcesæ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼š1private Map&lt;Object, DataSource&gt; resolvedDataSources;æ‰€ä»¥è¯´AbstractRoutingDataSourceä¸­ç»´æŠ¤äº†ä¸€ä¸ªMapï¼Œåœ¨getConnectionçš„æ—¶å€™å…ˆè·å–keyå†ä»resolvedDataSourcesä¸­getä¸€ä¸ªDataSourceè¿”å›ï¼ˆå¦‚æœä¸ºç©ºæ—¶åˆ¤æ–­æ˜¯å¦å¯ç”¨è·å–é»˜è®¤dataSourceå†å†³å®šæ˜¯å¦ç”¨é»˜è®¤çš„dataSourceï¼‰è€Œè·å–keyçš„æ–¹æ³•determineCurrentLookupKey()ç”±å­ç±»å®ç°ï¼ˆæ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼‰ã€‚æ‰€ä»¥å®ç°åŠ¨æ€å¤šæ•°æ®æºçš„æ€è·¯å°±ååˆ†æ˜ç¡®äº†å®šä¹‰ä¸€ä¸ªDynamicDataSourceContextHolderç”¨äºä¿å­˜å½“å‰çº¿ç¨‹éœ€è¦ä½¿ç”¨çš„dataSourceå¯¹åº”çš„keyé‡å†™determineCurrentLookupKey()æ–¹æ³•å°†è¿™ä¸ªkeyè¿”å›å®é™…ä¸Šå®Œæˆä¸Šè¿°ä¸¤ä¸ªæ­¥éª¤å…¶å®å°±å¯ä»¥å®ç°å¤šæ•°æ®æºäº†ï¼Œåªè¦åœ¨getConnectionå‰è°ƒç”¨DynamicDataSourceContextHolder#setKeyæ–¹æ³•è®¾ç½®éœ€è¦ä½¿ç”¨çš„dataSourceå¯¹åº”çš„keyå°±å¯ä»¥äº†ã€‚ä½†é€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬å¹¶ä¸å¸Œæœ›è®¾ç½®ä½¿ç”¨é‚£ä¸ªæ•°æ®åº“çš„ä»£ç ä¾µå…¥åˆ°æˆ‘ä»¬çš„ä¸šåŠ¡ä»£ç ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨aopå®ç°ï¼šå®šä¹‰ä¸€ä¸ªæ³¨è§£@DataSourceå’Œæ³¨è§£åˆ‡é¢DataSourceAspectï¼Œç„¶åå°±å¯ä»¥åœ¨éœ€è¦åˆ‡æ¢æ•°æ®åº“çš„æ–¹æ³•ä¸Šä½¿ç”¨æ³¨è§£è¿›è¡Œè®¾ç½®ã€‚ä»£ç DataSourceConfiguration12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273/** * @author lolico */@Slf4j@Configurationpublic class DataSourceConfiguration implements ApplicationContextAware &#123; private ApplicationContext applicationContext; @Override public void setApplicationContext(ApplicationContext applicationContext) throws BeansException &#123; this.applicationContext = applicationContext; &#125; /* configuration */ @Bean @Qualifier(\"defaultDataSource\") @ConfigurationProperties(prefix = \"spring.datasource.first\") public DataSource dataSource1() &#123; return DataSourceBuilder.create().build(); &#125; @Bean @ConfigurationProperties(prefix = \"spring.datasource.second\") public DataSource dataSource2() &#123; return DataSourceBuilder.create().build(); &#125; @Bean @Primary public DataSource dataSource(Map&lt;String, DataSource&gt; dataSourceMap, @Qualifier(\"defaultDataSource\") DataSource defaultDataSource) &#123; AbstractRoutingDataSource dataSource = new AbstractRoutingDataSource() &#123; @Override protected Object determineCurrentLookupKey() &#123; return DynamicDataSourceContextHolder.getKey(); &#125; @Override public void setTargetDataSources(Map&lt;Object, Object&gt; targetDataSources) &#123; super.setTargetDataSources(targetDataSources); DynamicDataSourceContextHolder.setDataSourceMap(targetDataSources); &#125; @Override public void setDefaultTargetDataSource(Object defaultTargetDataSource) &#123; if (defaultTargetDataSource instanceof String) &#123; super.setDefaultTargetDataSource(dataSourceMap.get(defaultTargetDataSource)); DynamicDataSourceContextHolder.setDefaultKey((String) defaultTargetDataSource); &#125; else if (defaultTargetDataSource instanceof DataSource) &#123; super.setDefaultTargetDataSource(defaultTargetDataSource); DynamicDataSourceContextHolder.setDefaultKey(resolveSpecifiedLookupKey((DataSource) defaultTargetDataSource)); &#125; else &#123; log.info(\"Why am i here?\"); &#125; &#125; private String resolveSpecifiedLookupKey(DataSource defaultTargetDataSource) &#123; String[] beanDefinitionNames = applicationContext.getBeanNamesForType(defaultTargetDataSource.getClass()); for (String beanDefinitionName : beanDefinitionNames) &#123; if (applicationContext.getBean(beanDefinitionName) == defaultTargetDataSource) &#123; return beanDefinitionName; &#125; &#125; return null; &#125; &#125;; dataSource.setTargetDataSources(Collections.unmodifiableMap(dataSourceMap)); dataSource.setDefaultTargetDataSource(defaultDataSource); return dataSource; &#125; &#125;DynamicDataSourceContextHolder12345678910111213141516171819202122232425262728@Slf4jpublic class DynamicDataSourceContextHolder &#123; private final static ThreadLocal&lt;String&gt; KEY = new ThreadLocal&lt;&gt;(); private static Map&lt;Object, Object&gt; targetDataSourceMap; private static String defaultKey; public static void setDataSourceMap(Map&lt;Object, Object&gt; targetDataSourceMap) &#123; DynamicDataSourceContextHolder.targetDataSourceMap = targetDataSourceMap; &#125; public static String getKey() &#123; return Optional.ofNullable(DynamicDataSourceContextHolder.KEY.get()) .orElseGet(() -&gt; DynamicDataSourceContextHolder.defaultKey); &#125; public static void setKey(String key) &#123; DynamicDataSourceContextHolder.KEY.set(targetDataSourceMap.containsKey(key) ? key : DynamicDataSourceContextHolder.defaultKey); &#125; public static void remove() &#123; DynamicDataSourceContextHolder.KEY.remove(); &#125; public static void setDefaultKey(String defaultKey) &#123; DynamicDataSourceContextHolder.defaultKey = defaultKey; log.debug(\"è®¾ç½®defaultKey:[&#123;&#125;]\", defaultKey); &#125;&#125;DataSourceæ³¨è§£12345678910/** * @author lolico */@Target(ElementType.METHOD)@Retention(RetentionPolicy.RUNTIME)@Inherited@Documentedpublic @interface DataSource &#123; String value() default \"\";&#125;DataSourceAspectåˆ‡é¢12345678910111213141516171819202122@Slf4j@Component@Aspect@Order(Ordered.LOWEST_PRECEDENCE - 1)public class DataSourceAspect &#123; @Pointcut(value = \"@annotation(dataSource)\", argNames = \"dataSource\") public void pointcut(DataSource dataSource) &#123; &#125; @Before(value = \"pointcut(dataSource)\", argNames = \"dataSource\") public void before(DataSource dataSource) &#123; String value = dataSource.value(); DynamicDataSourceContextHolder.setKey(value); log.debug(\"ä½¿ç”¨æ•°æ®åº“&#123;&#125;\", value); &#125; @After(\"@annotation(cn.griouges.learnspringboot.common.annotation.DataSource)\") public void after() &#123; DynamicDataSourceContextHolder.remove(); &#125;&#125;æµ‹è¯•å‘ç°å¦‚æœåˆ‡é¢ä¼˜å…ˆçº§ä¸ºOrdered.LOWEST_PRECEDENCEæ—¶ï¼Œæ¯æ¬¡éƒ½ä¼šåœ¨getConnectionä¹‹åå†æ‹¦æˆªè¿›è¡Œè®¾ç½®keyï¼Œä¸ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Œæ·»åŠ @Order(Ordered.LOWEST_PRECEDENCE - 1)è®¾ç½®åˆ‡é¢ä¼˜å…ˆçº§ï¼Œåœ¨è·å–æ•°æ®åº“è¿æ¥å‰è¿›è¡Œè®¾ç½®æ•°æ®åº“keyã€‚é…ç½®å®Œæ¯•åç»­è¿˜æœ‰æ•°æ®æºï¼Œåªè¦æ³¨å†Œbeanåˆ°å®¹å™¨ä¸­å°±å¯ä»¥è‡ªåŠ¨æ·»åŠ åˆ°AbstractRoutingDataSourceçš„targetDataSourcesä¸­ï¼Œkeyä¸ºbeançš„nameã€‚æµ‹è¯•application.propertiesä¸­æ·»åŠ é…ç½®12345678spring.datasource.first.jdbc-url=jdbc:mysql://localhost:3306/mysite?useUnicode=true&amp;characterEncoding=utf-8spring.datasource.first.username=rootspring.datasource.first.password=leisure.spring.datasource.first.driver-class-name=com.mysql.cj.jdbc.Driverspring.datasource.second.jdbc-url=jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=utf-8spring.datasource.second.username=rootspring.datasource.second.password=leisure.spring.datasource.second.driver-class-name=com.mysql.cj.jdbc.Driverserviceå±‚çš„æ–¹æ³•ä¸Šæ·»åŠ æ³¨è§£1234@DataSource(\"dataSource2\")public User findUserForLogin(String username, String password) &#123; return userRepository.findByUsernameAndPassword(username, password);&#125;æµ‹è¯•å‘ç°åœ¨Daoå±‚çš„æ¥å£è¿›è¡Œæ³¨è§£æ—¶ï¼Œæ‹¦æˆªä¼šåœ¨è·å–è¿æ¥åæ‰§è¡Œï¼Œå¯¼è‡´å¤±æ•ˆã€‚å…·ä½“åŸå› æ²¡å»æ·±è¿½ï¼Œåç»­æœ‰æ—¶é—´å†æ–­ç‚¹è°ƒè¯•æŸ¥çœ‹æ˜¯ä»€ä¹ˆåŸå› ï¼Œormä½¿ç”¨çš„æ˜¯Sprng Data Jpaï¼Œä½¿ç”¨mybatisè²Œä¼¼ä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µã€‚controleræ·»åŠ æµ‹è¯•æ–¹æ³•12345678@PostMapping(\"/test\")public AjaxResponseVO test(String username,String password) &#123; User userForLogin = service.findUserForLogin(username, password); if (userForLogin != null) &#123; return AjaxResponseVO.success(\"ç™»å½•æˆåŠŸ\"); &#125; return AjaxResponseVO.fail(\"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯\");&#125;postæµ‹è¯•ï¼šæµ‹è¯•é€šè¿‡ï¼Œæ‰“å°æ—¥å¿—:","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"https://lolico.me/tags/Spring/"},{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://lolico.me/tags/SpringBoot/"},{"name":"Java","slug":"Java","permalink":"https://lolico.me/tags/Java/"}]},{"title":"SpringBootæ—¶é—´æ ¼å¼åŒ–æ€»ç»“","slug":"SpringBootæ—¶é—´æ ¼å¼åŒ–æ€»ç»“","date":"2020-01-16T12:18:15.000Z","updated":"2022-03-06T10:28:21.343Z","comments":true,"path":"2020/01/16/SpringBootæ—¶é—´æ ¼å¼åŒ–æ€»ç»“/","link":"","permalink":"https://lolico.me/2020/01/16/SpringBoot%E6%97%B6%E9%97%B4%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%80%BB%E7%BB%93/","excerpt":"","text":"Jsonä¸­çš„æ—¶é—´å¯¹äºjsonå½¢å¼çš„è¯·æ±‚æˆ–å“åº”(content-type=application/json)ï¼Œæ ¼å¼åŒ–æ—¶é—´æœ‰å¦‚ä¸‹æ–¹æ³•ï¼šé…ç½®spring.jackson.date-formatä½¿ç”¨@JsonFormatè‡ªå®šä¹‰ObjectMapperé€šè¿‡Jackson2ObjectMapperBuilderCustomizerè‡ªå®šä¹‰ObjectMapperè‡ªå®šä¹‰com.fasterxml.jackson.databind.Moduleè§org.springframework.boot.autoconfigure.jackson.JacksonAutoConfigurationéJsonä¸­çš„æ—¶é—´å¯¹äºè¡¨å•è¯·æ±‚ï¼Œæ ¼å¼åŒ–æ—¶é—´æœ‰å¦‚ä¸‹æ–¹æ³•ï¼šé…ç½®spring.mvc.format.dateé…ç½®spring.mvc.format.timeé…ç½®spring.mvc.format.date-timeå®šä¹‰Converterå®šä¹‰Formatterä½¿ç”¨@DateTimeFormatè§org.springframework.boot.autoconfigure.web.servlet.WebMvcAutoConfiguration.EnableWebMvcConfiguration#mvcConversionService","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"https://lolico.me/tags/Spring/"},{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://lolico.me/tags/SpringBoot/"},{"name":"Web","slug":"Web","permalink":"https://lolico.me/tags/Web/"},{"name":"Java","slug":"Java","permalink":"https://lolico.me/tags/Java/"}]},{"title":"SpringBootæ—¶é—´ç±»å‹å‚æ•°ç»‘å®šå’Œåºåˆ—åŒ–ä¸ºJsonæ—¶æ ¼å¼åŒ–çš„é—®é¢˜","slug":"SpringBootæ—¶é—´ç±»å‹å‚æ•°ç»‘å®šå’Œåºåˆ—åŒ–ä¸ºJsonæ—¶æ ¼å¼åŒ–çš„é—®é¢˜","date":"2020-01-15T10:34:15.000Z","updated":"2022-03-06T10:28:21.343Z","comments":true,"path":"2020/01/15/SpringBootæ—¶é—´ç±»å‹å‚æ•°ç»‘å®šå’Œåºåˆ—åŒ–ä¸ºJsonæ—¶æ ¼å¼åŒ–çš„é—®é¢˜/","link":"","permalink":"https://lolico.me/2020/01/15/SpringBoot%E6%97%B6%E9%97%B4%E7%B1%BB%E5%9E%8B%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A%E5%92%8C%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%BAJson%E6%97%B6%E6%A0%BC%E5%BC%8F%E5%8C%96%E7%9A%84%E9%97%AE%E9%A2%98/","excerpt":"","text":"å‰è¨€åœ¨ä½¿ç”¨Springè¿›è¡Œwebå¼€å‘æ—¶ç»å¸¸ä¼šé‡åˆ°å‰åå°äº’ç›¸ä¼ å€¼çš„é—®é¢˜ï¼Œå¤§è‡´åˆ†æ— éå°±æ˜¯ä¸‹é¢ä¸¤ç§æƒ…å†µï¼šå°†å‚æ•°ä»¥åŠå€¼ç›´æ¥æ”¾åœ¨requestçš„è¯·æ±‚ä½“ï¼ˆPOSTï¼‰æˆ–è€…urlï¼ˆGETï¼‰ä¸­ã€‚å°†å‚æ•°ä»¥åŠå€¼ä»¥JSONçš„å½¢å¼å‘é€ï¼ˆPOSTæˆ–è€…GETï¼‰åˆ°æœåŠ¡ç«¯ã€‚Springå…¶å®å¯¹å‰åå°ä¼ å€¼æ—¶å‚æ•°çš„ç»‘å®šæä¾›äº†æ”¯æŒï¼Œåƒæˆ‘ä»¬å¹³æ—¶æ¥è§¦çš„è½¬æ¢å™¨Converterä»¥åŠæ¶ˆæ¯è½¬æ¢å™¨HttpMessageConverterçš„å·¥ä½œå°±æ˜¯å°†â€˜å€¼â€™è¿›è¡Œç±»å‹è½¬åŒ–æˆ–æ ¼å¼åŒ–åç»‘å®šåˆ°æˆ‘ä»¬çš„æ–¹æ³•å‚æ•°ä¸­ã€‚å¯¹äºç®€å•çš„åŸºç¡€ç±»å‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬å¹¶ä¸éœ€è¦è¿›è¡Œå¤„ç†ï¼Œè€Œæ˜¯è½¬æ¢æˆå¯¹åº”çš„ç±»å‹åç›´æ¥æ‹¿åŸå§‹çš„å€¼å°±è¡Œäº†ï¼›ä½†æ˜¯å¯¹äºæŸäº›ç±»å‹ï¼Œæ¯”å¦‚æ—¶é—´ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šè€ƒè™‘è¿›è¡Œæ ¼å¼åŒ–åä¼ åˆ°å‰å°æˆ–è€…è¦æŒ‡å®šä¼ æ¥çš„æ ¼å¼æ‰èƒ½ç»‘å®šåˆ°æ–¹æ³•ä¸­ï¼Œæ‰€ä»¥å°±éœ€è¦æŒ‡å®šä¸€ä¸ªæ ‡å‡†ã€‚è¿™å¾€å¾€è®©äººå¾ˆå›°æƒ‘ï¼Œå› ä¸ºå¯èƒ½ä¼ æ¥çš„æ˜¯requestä¸­çš„ä¹Ÿå¯èƒ½æ˜¯requestBodyä¸­çš„ï¼Œè€Œåœ¨å‘é€ç»™å‰å°æ—¶ä¹Ÿå¯èƒ½æ˜¯ä»¥JSONæˆ–è€…å…¶ä»–çš„å½¢å¼ï¼Œåœ¨ç½‘ä¸ŠæŸ¥äº†ä¸€ç•ªèµ„æ–™å‘ç°å®åœ¨æ˜¯å¤ªä¹±äº†ï¼Œç»è¿‡æ‰¾èµ„æ–™å’Œæµ‹è¯•ï¼Œç°åœ¨æ¥æ€»ç»“ä¸€ä¸‹ã€‚Controllerä¸­æ¥å—requestä¸­çš„å‚æ•°æ¥å—Dateã€LocalDateTimeã€LocalTimeç­‰å‚æ•°å¹¶ç»‘å®šåˆ°æ–¹æ³•å…¥å‚ä¸­å¸¸ç”¨çš„æ˜¯ä¸‹é¢ä¸¤ç§æ–¹æ³•ï¼šä½¿ç”¨@DateTimeFormatæ³¨è§£è¿™ç§æ–¹å¼æ¯”è¾ƒç®€å•ï¼Œä½†ç¼ºç‚¹æ˜¯ä¸å¤Ÿçµæ´»ã€‚1234567//1.åªèƒ½å°†Getè¯·æ±‚ä¸­æ ¼å¼ä¸ºyyyy-MM-dd HH:mm:ssçš„dateå‚æ•°çš„å€¼ç»‘å®šåˆ°æ–¹æ³•çš„dateå‚æ•°,æ¥å—å…¶ä»–ç±»å‹çš„è¯·æ±‚å¯ä»¥å°†GetMappingæ”¹ä¸ºRequestMapping//2.å‚æ•°ç±»å‹å¯ä»¥æ˜¯Dateæˆ–è€…jdk8ä¸­æ–°çš„æ—¶é—´ç±»å‹ï¼Œå¦‚ï¼š@DateTimeFormat(pattern = \"yyyy-MM-dd\") LocalDate date@GetMapping(\"/date\")public LocalDateTime getDate(@DateTimeFormat(pattern = \"yyyy-MM-dd HH:mm:ss\") LocalDateTime date) &#123; System.out.println(date); return date;&#125;è‡ªå®šä¹‰è½¬æ¢å™¨Converterå®ç°Converteræ¥å£ï¼Œè‡ªå®šä¹‰è½¬æ¢è§„åˆ™ï¼Œæ¯”è¾ƒçµæ´»ã€‚Controllerä¸­æ¥å—requestBodyä¸­çš„å‚æ•°ï¼ˆååºåˆ—åŒ–ï¼‰å’Œåºåˆ—åŒ–ä¸ºjsonæ—¶çš„æ ¼å¼@JsonFormatæ³¨è§£é…åˆ@JsonDeserializeæˆ–@JsonSerializeä½¿ç”¨123456789101112@Datapublic class TestVO &#123; private String msg; //ä½¿ç”¨JsonFormatæ³¨è§£æŒ‡å®šåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ ¼å¼ //ä½¿ç”¨JsonDeserializeå’ŒJsonSerializeæŒ‡å®šä½¿ç”¨çš„åºåˆ—åŒ–å™¨ //jackson-datatype-jsr310åŒ…ä¸‹æ˜¯å¸¸ç”¨çš„ååºåˆ—åŒ–å™¨å’Œåºåˆ—åŒ–å™¨ï¼Œspring-boot-starter-jsonåŒ…å·²ç»åŒ…å«è¯¥jsr310æ‰©å±•åŒ… @JsonFormat(pattern = \"yyyy-MM-dd HH:mm:ss\") @JsonDeserialize(using = LocalDateTimeDeserializer.class) @JsonSerialize(using = LocalDateTimeSerializer.class) private LocalDateTime localDateTime; &#125;é…ç½®ObjectMapper12345678910111213141516@Bean@Primarypublic ObjectMapper objectMapper() &#123; ObjectMapper objectMapper = new ObjectMapper(); JavaTimeModule javaTimeModule = new JavaTimeModule(); javaTimeModule.addSerializer(LocalDateTime.class, new LocalDateTimeSerializer(DateTimeFormatter.ofPattern(\"yyyy-MM-dd HH:mm:ss\"))); javaTimeModule.addSerializer(LocalDate.class, new LocalDateSerializer(DateTimeFormatter.ofPattern(\"yyyy-MM-dd\"))); javaTimeModule.addSerializer(LocalTime.class, new LocalTimeSerializer(DateTimeFormatter.ofPattern(\"HH:mm:ss\"))); javaTimeModule.addDeserializer(LocalDateTime.class, new LocalDateTimeDeserializer(DateTimeFormatter.ofPattern(\"yyyy-MM-dd HH:mm:ss\"))); javaTimeModule.addDeserializer(LocalDate.class, new LocalDateDeserializer(DateTimeFormatter.ofPattern(\"yyyy-MM-dd\"))); javaTimeModule.addDeserializer(LocalTime.class, new LocalTimeDeserializer(DateTimeFormatter.ofPattern(\"HH:mm:ss\"))); objectMapper.registerModule(javaTimeModule); return objectMapper;&#125;","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"https://lolico.me/tags/Spring/"},{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://lolico.me/tags/SpringBoot/"},{"name":"Web","slug":"Web","permalink":"https://lolico.me/tags/Web/"},{"name":"Java","slug":"Java","permalink":"https://lolico.me/tags/Java/"}]},{"title":"å†è°ˆSpringDataJPA","slug":"å†è°ˆSpringDataJPA","date":"2019-12-27T10:21:08.000Z","updated":"2022-03-06T10:28:21.347Z","comments":true,"path":"2019/12/27/å†è°ˆSpringDataJPA/","link":"","permalink":"https://lolico.me/2019/12/27/%E5%86%8D%E8%B0%88SpringDataJPA/","excerpt":"","text":"å‰è¨€åœ¨ å…³äºSpringBootä½¿ç”¨JPAè¿›è¡Œæ›´æ–°æ“ä½œ è¿™ä¸€ç¯‡æ–‡ç« ä¸­æ›¾æåˆ°äº†å…³äºjpaä½¿ç”¨saveæ–¹æ³•æ›´æ–°è®°å½•æ—¶ä¼šå‡ºç°å½“æœ‰äº›å‚æ•°ä¸ºnullæ—¶ï¼Œsaveæ“ä½œä¼šç”¨nullè¦†ç›–æ•°æ®åº“ä¸­çš„å­—æ®µçš„æƒ…å†µï¼Œé€šå¸¸æˆ‘ä»¬çš„éœ€æ±‚æ˜¯åŠ¨æ€çš„å»æ›´æ–°è®°å½•ï¼Œè€Œä¸æ˜¯å…¨éƒ¨è¦†ç›–ï¼Œæ‰€ä»¥å¯¹æ¯”èµ·Mybatisçš„åŠ¨æ€sqlï¼ŒJpaä¸å¤ªçµæ´»çš„ç‰¹æ€§å°±æš´éœ²å‡ºæ¥ï¼Œäº‹å®ä¸Šï¼Œå¯¹äºåŠ¨æ€æ›´æ–°è™½ç„¶å®ç°ä¸Šéº»çƒ¦äº†ç‚¹ï¼Œä½†è¿˜æ˜¯èƒ½æ“ä½œä¸€ä¸‹çš„ã€‚ä»¥å‰çš„æ–¹æ³•å¯¹äºä»¥å‰å®ç°åŠ¨æ€æ›´æ–°ï¼Œæˆ‘ä»¬æ— éæ˜¯ä½¿ç”¨@Queryæ³¨è§£æ¥å†™åŸç”Ÿsql,å°±åƒè¿™æ ·ï¼š123456789@Transactional@Modifying@Query(\"update User u set u.email=:#&#123;#user.email&#125; where u.id=:#&#123;#user.id&#125;\")void dynamicUpdateEmailById(@Param(\"user\") User user);@Transactional@Modifying@Query(\"update User u set u.email=?2 where u.id=?1\")void dynamicUpdateEmailById(int id, String email);ä½†å¾€å¾€æˆ‘ä»¬æ¯å¼ è¡¨éƒ½ä¼šæœ‰åŠ¨æ€æ›´æ–°çš„éœ€æ±‚ï¼ŒæŒ‰ç…§è¿™æ ·çš„æ–¹æ³•ï¼Œéƒ½å†™ä¸€éåŸç”Ÿsqlå®åœ¨æ˜¯åˆéº»çƒ¦åˆæ˜“é”™ï¼Œè€Œä¸”è¿™ç§æ–¹æ³•å®é™…ä¸Šå¹¶æ²¡æœ‰çœŸæ­£åšåˆ°åŠ¨æ€ï¼Œè€Œæ˜¯æˆ‘ä»¬è‡ªå·±æŠŠéœ€è¦æ›´æ–°çš„éƒ¨åˆ†å†™æ­»äº†ï¼Œå½“æˆ‘ä»¬éœ€è¦æ›´æ–°å…¶ä»–å­—æ®µå²‚ä¸æ˜¯åˆè¦å†å†™ä¸€ä¸ªæ–¹æ³•ï¼Ÿæ€»ä¹‹ï¼Œå¾ˆæ˜¯éº»çƒ¦ã€‚åŠ¨æ€sqlæ–°å§¿åŠ¿å‡è®¾ç°åœ¨æœ‰å¥½å‡ å¼ è¡¨ï¼šuserã€rank â€¦ï¼Œå¯¹äºæ‰€æœ‰çš„æœ‰åŠ¨æ€æ›´æ–°éœ€æ±‚çš„è¡¨éƒ½è¦è¿›è¡Œå®ç°çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼šå…ˆå®šä¹‰ä¸€ä¸ªBaseRepository123456789/** * @author lolico */@NoRepositoryBeanpublic interface BaseRepository&lt;T, ID extends Serializable&gt; extends JpaRepository&lt;T, ID&gt;, JpaSpecificationExecutor&lt;T&gt; &#123; T dynamicUpdate(T entity); &#125;ç„¶åå®šä¹‰ä¸€ä¸ªBaseRepositoryImplä½œä¸ºBaseRepositoryçš„é»˜è®¤å®ç°1234567891011121314public class BaseRepositoryImpl&lt;T, ID extends Serializable&gt; extends SimpleJpaRepository&lt;T, ID&gt; implements BaseRepository&lt;T, ID&gt; &#123; private Class&lt;T&gt; entityClass; private EntityManager entityManager; private JpaEntityInformation&lt;T, ?&gt; entityInformation; public BaseRepositoryImpl(JpaEntityInformation&lt;T, ?&gt; entityInformation, EntityManager entityManager) &#123; super(entityInformation, entityManager); this.entityClass = entityInformation.getJavaType(); this.entityManager = entityManager; this.entityInformation = entityInformation; &#125; &#125;ç„¶ååœ¨é…ç½®ç±»ä¸ŠåŠ ä¸Šæ³¨è§£@EnableJpaRepositories(repositoryBaseClass = BaseRepositoryImpl.class)ï¼Œçœ‹åˆ°è¿™é‡Œï¼Œåº”è¯¥æœ‰æœ‹å‹ä¼šæ„Ÿè§‰æœ‰ç‚¹ç†Ÿæ‚‰ã€‚è¿™æ­£æ˜¯æˆ‘ä»¬ä¸ºæ‰€æœ‰Repositoryè‡ªå®šä¹‰å…¬å…±æ–¹æ³•çš„å®ç°æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨BaseRepositoryä¸­å®šä¹‰å…±æœ‰æ–¹æ³•ï¼Œç„¶ååœ¨BaseRepositoryImplä¸­æä¾›å®ç°ï¼Œåç»­æ‰€æœ‰ç»§æ‰¿BaseRepositoryè¿™ä¸ªæ¥å£çš„Repositoryéƒ½å¯ä»¥è·å¾—è¿™ä¸ªé»˜è®¤å®ç°ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨æ³¨è§£@EnableJpaRepositories(repositoryBaseClass = BaseRepositoryImpl.class)ä¸­æŒ‡å®šäº†Repositoryçš„é»˜è®¤å®ç°ç”¨BaseRepositoryImplï¼Œè€ŒBaseRepositoryImplç»§æ‰¿SimpleJpaRepositoryè¿™ä¸ªjpaé»˜è®¤çš„å®ç°ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›¸å½“äºæ‰©å±•JpaRepositoryï¼Œå¥½çš„ï¼Œæ‰¯è¿œâ€¦æ‰€ä»¥ç°åœ¨æˆ‘ä»¬åªè¦åœ¨BaseRepositoryä¸­å®šä¹‰T dynamicUpdate(T t);è¿™æ ·ä¸€ä¸ªæ–¹æ³•,ç„¶ååœ¨BaseRepositoryImplä¸­æä¾›å®ç°ï¼Œé‚£ä¹ˆæ‰€æœ‰repositoryéƒ½å¯ä»¥è·å¾—è¿™ä¸ªå®ç°ï¼Œæ‰€ä»¥ï¼Œè¯´åˆ°æœ€åï¼Œæ€ä¹ˆå®ç°è¿™æ ·ä¸€ä¸ªæ–¹æ³•å‘¢ï¼Ÿ12345678910111213141516171819202122232425262728293031323334/** * @author lolico */@Transactional(readOnly = true)public class BaseRepositoryImpl&lt;T, ID extends Serializable&gt; extends SimpleJpaRepository&lt;T, ID&gt; implements BaseRepository&lt;T, ID&gt; &#123; private Class&lt;T&gt; entityClass; private EntityManager entityManager; private JpaEntityInformation&lt;T, ?&gt; entityInformation; public BaseRepositoryImpl(JpaEntityInformation&lt;T, ?&gt; entityInformation, EntityManager entityManager) &#123; super(entityInformation, entityManager); this.entityClass = entityInformation.getJavaType(); this.entityManager = entityManager; this.entityInformation = entityInformation; &#125; @Override @Transactional public T dynamicUpdate(T entity) &#123; BeanWrapper wrapper = new BeanWrapperImpl(entity); Object id = entityInformation.getRequiredId(entity); //è·å–idçš„å€¼ T old = entityManager.find(entityClass, id); //å…ˆæ ¹æ®idä»æ•°æ®åº“ä¸­æŸ¥å‡ºè®°å½• Set&lt;String&gt; nullProperty = new HashSet&lt;&gt;(); //å­˜æ”¾ä¸ºnullçš„å±æ€§å for (PropertyDescriptor propertyDescriptor : wrapper.getPropertyDescriptors()) &#123; String propertyName = propertyDescriptor.getName(); //å±æ€§å Object propertyValue = wrapper.getPropertyValue(propertyName); //å±æ€§å€¼ if (propertyValue == null) &#123; //å¦‚æœå±æ€§å€¼ä¸ºnullå°±æ·»åŠ åˆ°setä¸­ nullProperty.add(propertyName); &#125; &#125; BeanUtils.copyProperties(entity, old, nullProperty.toArray(new String[0])); //å°†tä¸­å±æ€§çš„å€¼å¤åˆ¶åˆ°oldä¸­ï¼Œå¿½ç•¥nullProperty.toArray(new String[0])ä¸­çš„å±æ€§ return entityManager.merge(old); //æ›´æ–°å¹¶è¿”å›æ›´æ–°åçš„ç»“æœ &#125;&#125;æ€è·¯æ³¨é‡Šé‡Œå·²ç»å†™å¾—å¾ˆæ¸…æ¥šäº†ã€‚å¯¹äºBeanWrapperImplå’ŒBeanUtilsè¿™ä¸¤ä¸ªç±»ï¼Œéƒ½æ˜¯åˆ©ç”¨åå°„å»è·å–Beançš„å„ç§ä¿¡æ¯ä»¥åŠè¿›è¡Œæ“ä½œçš„ç±»ã€‚å‰è€…æ˜¯Beançš„åŒ…è£…ç±»ï¼Œåè€…æ˜¯Beanå·¥å…·ç±»,ä¸¤è€…æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿçœ‹ç±»åä¹Ÿèƒ½çŒœå‡ºæ¥ï¼Œå‰è€…åŒ…è£…beanåå¯ä»¥è·å¾—è¿™ä¸ªbeançš„ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚æœ‰é‚£äº›å±æ€§ï¼Œå±æ€§çš„å€¼æ˜¯ä»€ä¹ˆï¼Œå€¼å¯ä¸å¯ä»¥ä¿®æ”¹ï¼Œèƒ½ä¸èƒ½è¯»å–ç­‰ç­‰ï¼ˆä¾§é‡äºå¯¹ä¼ è¿›å»çš„beanå¯¹è±¡è¿›è¡Œæ“ä½œï¼‰ã€‚åè€…æä¾›äº†ä¸€äº›é™æ€æ–¹æ³•ï¼Œç”¨äºå®ä¾‹åŒ–bean,æ£€æŸ¥beançš„å±æ€§ç±»å‹ï¼Œå¤åˆ¶å±æ€§å€¼ç­‰ï¼ˆä¾§é‡äºå¯¹ç±»çš„ä¿¡æ¯å’Œbeanä¹‹é—´å±æ€§è¿›è¡Œæ“ä½œï¼‰ã€‚æµ‹è¯•User.java12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879/** * @author lolico */@Entity@Table(name = \"user\")@DynamicUpdatepublic class User &#123; private int id; private String username; private String password; private String email; @Id @Column(name = \"id\") @GeneratedValue(strategy = GenerationType.IDENTITY) public int getId() &#123; return id; &#125; public void setId(int id) &#123; this.id = id; &#125; @Basic @Column(name = \"uname\") public String getUsername() &#123; return username; &#125; public void setUsername(String username) &#123; this.username = username; &#125; @Basic @Column(name = \"upassword\") public String getPassword() &#123; return password; &#125; public void setPassword(String password) &#123; this.password = password; &#125; @Basic @Column(name = \"uemail\") public String getEmail() &#123; return email; &#125; public void setEmail(String email) &#123; this.email = email; &#125; @Override public boolean equals(Object o) &#123; if (this == o) return true; if (o == null || getClass() != o.getClass()) return false; User that = (User) o; return id == that.id &amp;&amp; Objects.equals(username, that.username) &amp;&amp; Objects.equals(password, that.password) &amp;&amp; Objects.equals(email, that.email); &#125; @Override public int hashCode() &#123; return Objects.hash(id, username, password, email); &#125; @Override public String toString() &#123; return \"User&#123;\" + \"id=\" + id + \", username='\" + username + '\\'' + \", password='\" + password + '\\'' + \", email='\" + email + '\\'' + '&#125;'; &#125;&#125;UserRepository.java1234@Repositorypublic interface UserRepository extends CustomUserRepository, BaseRepository&lt;User, Integer&gt; &#123; &#125;æµ‹è¯•æ–¹æ³•ï¼š12345678@Testvoid dynamicUpdate() &#123; User user = new User(); user.setId(3); user.setUsername(\"test3\"); user = repository.dynamicUpdate(user); System.out.println(user);&#125;å¯¹æ•°æ®åº“è¡¨ä¸­idä¸º3çš„è®°å½•è¿›è¡Œæ›´æ–°ï¼Œå°†usernameè®¾ç½®ä¸ºtest3,åŸæœ¬çš„è®°å½•æ˜¯3&emsp;&emsp;test&emsp;&emsp;test3&emsp;&emsp;test3@tttæ‰§è¡Œæ–¹æ³•ï¼Œè¾“å‡ºï¼šç»“æœä¸¤æ¡sql,å…ˆæŸ¥è¯¢å†æ›´æ–°ï¼Œæ›´æ–°çš„sqlä¸­å¯ä»¥çœ‹åˆ°åªå¯¹unameè¿›è¡Œsetï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨Userå®ä½“ç±»ä¸Šæ³¨è§£äº†@DynamicUpdateæ³¨æ„è¿™ä¸ªæ³¨è§£å¹¶ä¸æ˜¯åŠ¨æ€æ›´æ–°è®°å½•çš„æ„æ€ï¼Œè¿™ä¸ªæ³¨è§£çš„æ„æ€æ˜¯åœ¨è¿›è¡Œmergeæ›´æ–°æ—¶ï¼Œä¼šå¯¹æ¯”æ•°æ®åº“ä¸­çš„è®°å½•ï¼Œå¦‚æœä¸ä¸€è‡´å°±ç”Ÿæˆå¯¹åº”setçš„è¯­å¥ï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æµ‹è¯•è¾“å‡ºçš„æ›´æ–°sqlè¯­å¥é‡Œåªæœ‰å¯¹unameè¿›è¡Œsetçš„sqlï¼Œå› ä¸ºå…¶ä»–å­—æ®µçš„å€¼ä¸æ•°æ®åº“è®°å½•æ˜¯ä¸€è‡´çš„ï¼Œåˆ©ç”¨è¿™ä¸ªæ³¨è§£æˆ‘ä»¬å¯ä»¥å®ç°å¯¹äºæ•°æ®åº“ä¸­è®¾ç½®é»˜è®¤å€¼æ¯”å¦‚DateTimeï¼Œåœ¨ä½¿ç”¨@DynamicInsertåå°±ä¸ä¼šæ’å…¥nullå€¼ï¼Œè€Œæ˜¯ä½¿ç”¨é»˜è®¤çš„å€¼ã€‚è®²çš„æœ‰ç‚¹ä¹±ï¼Œè¿˜æ²¡ç†è§£çš„å¯ä»¥å»çœ‹çœ‹è¿™ç¯‡æ–‡ç« å…³äº@DynamicUpdateçš„è¯¯è§£ç°åœ¨çœ‹ä¸‹æ•°æ®åº“ä¸­id=3çš„è®°å½•æ˜¯å¦æ›´æ–°äº†unameï¼šæ›´æ–°åçš„è®°å½•ä¸è¾“å‡ºçš„ä¸€è‡´ï¼Œå¾ˆå®Œç¾ï¼æ€»ç»“å¯¹äºåŠ¨æ€sqlï¼Œåˆ©ç”¨è¿™ä¸ªæ–¹æ³•æˆ–è®¸æ€§èƒ½ä¸å¤ªè¡Œï¼ˆå› ä¸ºå…ˆæŸ¥è¯¢äº†ä¸€ä¸‹ï¼‰ï¼Œä½†å¯è¡Œæ€§ä¸Šæ¥è¯´è¿˜æ˜¯å¯ä»¥çš„ï¼Œæ—¢ç„¶æƒ³ä½“éªŒSpring Data JPAè‡ªåŠ¨ç”Ÿæˆå®ç°çš„åŠŸèƒ½ï¼Œè‡ªç„¶å°±å¾ˆéš¾å†ä¿è¯Mybatisé‚£ç§çµæ´»çš„ç‰¹æ€§ã€‚","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"https://lolico.me/tags/Spring/"},{"name":"Java","slug":"Java","permalink":"https://lolico.me/tags/Java/"},{"name":"JPA","slug":"JPA","permalink":"https://lolico.me/tags/JPA/"}]},{"title":"SpringBoot æ‹¦æˆªå™¨ï¼Œè¿‡æ»¤å™¨ï¼Œè½¬æ¢å™¨ï¼Œæ¶ˆæ¯è½¬æ¢å™¨çš„æ³¨å†Œ","slug":"SpringBoot-æ‹¦æˆªå™¨-è¿‡æ»¤å™¨-è½¬æ¢å™¨-æ¶ˆæ¯è½¬æ¢å™¨çš„æ³¨å†Œ","date":"2019-12-26T10:16:57.000Z","updated":"2022-03-06T10:28:21.343Z","comments":true,"path":"2019/12/26/SpringBoot-æ‹¦æˆªå™¨-è¿‡æ»¤å™¨-è½¬æ¢å™¨-æ¶ˆæ¯è½¬æ¢å™¨çš„æ³¨å†Œ/","link":"","permalink":"https://lolico.me/2019/12/26/SpringBoot-%E6%8B%A6%E6%88%AA%E5%99%A8-%E8%BF%87%E6%BB%A4%E5%99%A8-%E8%BD%AC%E6%8D%A2%E5%99%A8-%E6%B6%88%E6%81%AF%E8%BD%AC%E6%8D%A2%E5%99%A8%E7%9A%84%E6%B3%A8%E5%86%8C/","excerpt":"","text":"ç¯å¢ƒï¼šSpringBoot 2.2.2æ‹¦æˆªå™¨æ–¹å¼ä¸€ï¼šå†™ä¸€ä¸ªé…ç½®ç±»ï¼Œå®ç°WebMvcConfigureræ¥å£å¹¶å®ç°addInterceptorsæ–¹æ³•è¿‡æ»¤å™¨æ–¹å¼ä¸€ï¼šä½¿ç”¨@Componentæˆ–@Beané…åˆè¿›è¡Œæ³¨å†Œæ–¹å¼äºŒï¼šå½“ä½¿ç”¨åµŒå…¥å¼webæœåŠ¡å™¨æ—¶ä½¿ç”¨@ServletComponentScané…ç½®æ‰«æï¼ŒåŒæ—¶å¯ä»¥ç”¨æ¥æ³¨å†Œfilterã€servletå’Œlinstenerè½¬æ¢å™¨æ–¹å¼ä¸€ï¼šä½¿ç”¨@Componentæˆ–@Beanæ³¨å†Œæ–¹å¼äºŒï¼šå†™ä¸€ä¸ªé…ç½®ç±»ï¼Œå®ç°WebMvcConfigureræ¥å£å¹¶å®ç°addFormattersæ–¹æ³•æ¶ˆæ¯è½¬æ¢å™¨æ–¹å¼ä¸€ï¼šä½¿ç”¨@Componentæˆ–@Beanæ³¨å†Œæ–¹å¼äºŒï¼šå†™ä¸€ä¸ªé…ç½®ç±»ï¼Œå®ç°WebMvcConfigureræ¥å£å¹¶å®ç°configureMessageConvertersæ–¹æ³•æ–¹å¼ä¸‰ï¼šå†™ä¸€ä¸ªé…ç½®ç±»ï¼Œå®ç°WebMvcConfigureræ¥å£å¹¶å®ç°extendMessageConvertersæ–¹æ³•æ€»ç»“å¾—ç›ŠäºSpringBootçš„è‡ªåŠ¨é…ç½®ï¼Œé€šå¸¸æˆ‘ä»¬åªéœ€è¦é€šè¿‡æ³¨å†ŒBeanè¿™æ ·ç®€å•çš„æ–¹å¼å°±å¯ä»¥å‘å®¹å™¨ä¸­çš„ç»„ä»¶æ³¨å…¥é…ç½®ã€‚","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"https://lolico.me/tags/Spring/"},{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://lolico.me/tags/SpringBoot/"},{"name":"Web","slug":"Web","permalink":"https://lolico.me/tags/Web/"},{"name":"Java","slug":"Java","permalink":"https://lolico.me/tags/Java/"}]},{"title":"SpringBootè‡ªåŠ¨é…ç½®åŸç†","slug":"SpringBootè‡ªåŠ¨é…ç½®åŸç†","date":"2019-12-19T10:06:00.000Z","updated":"2022-03-06T10:28:21.343Z","comments":true,"path":"2019/12/19/SpringBootè‡ªåŠ¨é…ç½®åŸç†/","link":"","permalink":"https://lolico.me/2019/12/19/SpringBoot%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86/","excerpt":"","text":"å‰è¨€ä¸è®ºåœ¨å·¥ä½œä¸­ï¼Œäº¦æˆ–æ˜¯æ±‚èŒé¢è¯•ï¼ŒSpring Bootå·²ç»æˆä¸ºæˆ‘ä»¬å¿…çŸ¥å¿…ä¼šçš„æŠ€èƒ½é¡¹ã€‚é™¤äº†æŸäº›è€æ—§çš„æ”¿åºœé¡¹ç›®æˆ–é‡‘èé¡¹ç›®æŒæœ‰è§‚æœ›æ€åº¦å¤–ï¼Œå¦‚ä»Šçš„å„è¡Œå„ä¸šéƒ½åœ¨é£é€Ÿçš„æ‹¥æŠ±è¿™ä¸ªå·²ç»ä¸æ˜¯å¾ˆæ–°çš„Springå¯åŠ¨æ¡†æ¶ã€‚å½“ç„¶ï¼Œä½œä¸ºSpring Bootçš„ç²¾é«“ï¼Œè‡ªåŠ¨é…ç½®åŸç†çš„å·¥ä½œè¿‡ç¨‹å¾€å¾€åªæœ‰åœ¨â€œé¢è¯•â€çš„æ—¶å€™æ‰èƒ½ç”¨å¾—ä¸Šï¼Œä½†æ˜¯å¦‚æœåœ¨å·¥ä½œä¸­ä½ èƒ½å¤Ÿæ·±å…¥çš„ç†è§£Spring Bootçš„è‡ªåŠ¨é…ç½®åŸç†ï¼Œå°†æ— å¾€ä¸åˆ©ã€‚Spring Bootçš„å‡ºç°ï¼Œå¾—ç›Šäºâ€œçº¦å®šå¤§äºé…ç½®â€çš„ç†å¿µï¼Œæ²¡æœ‰ç¹ççš„é…ç½®ã€éš¾ä»¥é›†æˆçš„å†…å®¹ï¼ˆå¤§å¤šæ•°æµè¡Œç¬¬ä¸‰æ–¹æŠ€æœ¯éƒ½è¢«é›†æˆï¼‰ï¼Œè¿™æ˜¯åŸºäºSpring 4.xæä¾›çš„æŒ‰æ¡ä»¶é…ç½®Beançš„èƒ½åŠ›ã€‚Spring Bootçš„é…ç½®æ–‡ä»¶åˆè¯†Spring Bootæ—¶æˆ‘ä»¬å°±çŸ¥é“ï¼ŒSpring Bootæœ‰ä¸€ä¸ªå…¨å±€é…ç½®æ–‡ä»¶ï¼šapplication.propertiesæˆ–application.ymlæˆ‘ä»¬çš„å„ç§å±æ€§éƒ½å¯ä»¥åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼Œæœ€å¸¸é…ç½®çš„æ¯”å¦‚ï¼šserver.portã€logging.level.* ç­‰ç­‰ï¼Œç„¶è€Œæˆ‘ä»¬å®é™…ç”¨åˆ°çš„å¾€å¾€åªæ˜¯å¾ˆå°‘çš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆè¿™äº›å±æ€§æ˜¯å¦æœ‰æ®å¯ä¾å‘¢ï¼Ÿç­”æ¡ˆå½“ç„¶æ˜¯è‚¯å®šçš„ï¼Œè¿™äº›å±æ€§éƒ½å¯ä»¥åœ¨å®˜æ–¹æ–‡æ¡£ä¸­æŸ¥æ‰¾åˆ°ï¼šcommon-application-propertiesï¼ˆæ‰€ä»¥ï¼Œè¯åˆè¯´å›æ¥ï¼Œæ‰¾èµ„æ–™è¿˜å¾—æ˜¯å®˜æ–¹æ–‡æ¡£ï¼Œç™¾åº¦å‡ºæ¥ä¸€å¤§å †ï¼Œè¿˜æ˜¯ç¨æ˜¾ä¸šä½™äº†ä¸€äº›ï¼‰é™¤äº†å®˜æ–¹æ–‡æ¡£ä¸ºæˆ‘ä»¬æä¾›äº†å¤§é‡çš„å±æ€§è§£é‡Šï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨IDEçš„ç›¸å…³æç¤ºåŠŸèƒ½ï¼Œæ¯”å¦‚IDEAçš„è‡ªåŠ¨æç¤ºã€‚ä»¥ä¸Šï¼Œæ˜¯Spring Bootçš„é…ç½®æ–‡ä»¶çš„å¤§è‡´ä½¿ç”¨æ–¹æ³•ï¼Œå…¶å®éƒ½æ˜¯äº›é¢˜å¤–è¯ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šè¿™äº›é…ç½®æ˜¯å¦‚ä½•åœ¨Spring Booté¡¹ç›®ä¸­ç”Ÿæ•ˆçš„å‘¢ï¼Ÿæ¥ä¸‹æ¥ï¼Œå°±éœ€è¦èšç„¦æœ¬ç¯‡åšå®¢çš„ä¸»é¢˜ï¼šè‡ªåŠ¨é…ç½®å·¥ä½œåŸç†æˆ–è€…å«å®ç°æ–¹å¼ã€‚å·¥ä½œåŸç†å‰–æSpring Bootå…³äºè‡ªåŠ¨é…ç½®çš„æºç åœ¨spring-boot-autoconfigure-x.x.x.x.jarä¸­ï¼šå½“ç„¶ï¼Œè‡ªåŠ¨é…ç½®åŸç†çš„ç›¸å…³æè¿°ï¼Œå®˜æ–¹æ–‡æ¡£è²Œä¼¼æ˜¯æ²¡æœ‰æåŠã€‚ä¸è¿‡æˆ‘ä»¬ä¸éš¾çŒœå‡ºï¼ŒSpring Bootçš„å¯åŠ¨ç±»ä¸Šæœ‰ä¸€ä¸ª@SpringBootApplicationæ³¨è§£ï¼Œè¿™ä¸ªæ³¨è§£æ˜¯Spring Booté¡¹ç›®å¿…ä¸å¯å°‘çš„æ³¨è§£ã€‚é‚£ä¹ˆè‡ªåŠ¨é…ç½®åŸç†ä¸€å®šå’Œè¿™ä¸ªæ³¨è§£æœ‰ç€åƒä¸ä¸‡ç¼•çš„è”ç³»ï¼@EnableAutoConfiguration@SpringBootApplicationæ˜¯ä¸€ä¸ªå¤åˆæ³¨è§£æˆ–æ´¾ç”Ÿæ³¨è§£ï¼Œåœ¨@SpringBootApplicationä¸­æœ‰ä¸€ä¸ªæ³¨è§£@EnableAutoConfigurationï¼Œç¿»è¯‘æˆäººè¯å°±æ˜¯å¼€å¯è‡ªåŠ¨é…ç½®ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼šè€Œè¿™ä¸ªæ³¨è§£ä¹Ÿæ˜¯ä¸€ä¸ªæ´¾ç”Ÿæ³¨è§£ï¼Œå…¶ä¸­çš„å…³é”®åŠŸèƒ½ç”±@Importæä¾›ï¼Œå…¶å¯¼å…¥çš„AutoConfigurationImportSelector#selectImportsæ–¹æ³•é€šè¿‡SpringFactoriesLoader#loadFactoryNamesæ‰«ææ‰€æœ‰å…·æœ‰META-INF/spring.factoriesçš„jaråŒ…ã€‚spring-boot-autoconfigure-x.x.x.x.jaré‡Œå°±æœ‰ä¸€ä¸ªè¿™æ ·çš„spring.factoriesæ–‡ä»¶ã€‚è¿™ä¸ªspring.factoriesæ–‡ä»¶ä¹Ÿæ˜¯ä¸€ç»„ä¸€ç»„çš„key=valueçš„å½¢å¼ï¼Œå…¶ä¸­ä¸€ä¸ªkeyæ˜¯EnableAutoConfigurationç±»çš„å…¨ç±»åï¼Œè€Œå®ƒçš„valueæ˜¯ä¸€ä¸ªxxxAutoConfigurationçš„ç±»åçš„åˆ—è¡¨ï¼Œè¿™äº›ç±»åä»¥é€—å·åˆ†éš”ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼šè¿™ä¸ª@EnableAutoConfigurationæ³¨è§£é€šè¿‡@SpringBootApplicationè¢«é—´æ¥çš„æ ‡è®°åœ¨äº†Spring Bootçš„å¯åŠ¨ç±»ä¸Šã€‚åœ¨SpringApplication.run(...)çš„å†…éƒ¨å°±ä¼šæ‰§è¡ŒselectImports()æ–¹æ³•ï¼Œæ‰¾åˆ°æ‰€æœ‰JavaConfigè‡ªåŠ¨é…ç½®ç±»çš„å…¨é™å®šåå¯¹åº”çš„classï¼Œç„¶åå°†æ‰€æœ‰è‡ªåŠ¨é…ç½®ç±»åŠ è½½åˆ°Springå®¹å™¨ä¸­ã€‚è‡ªåŠ¨é…ç½®ç”Ÿæ•ˆæ¯ä¸€ä¸ªxxxAutoConfigurationè‡ªåŠ¨é…ç½®ç±»éƒ½æ˜¯åœ¨æŸäº›æ¡ä»¶ä¹‹ä¸‹æ‰ä¼šç”Ÿæ•ˆçš„ï¼Œè¿™äº›æ¡ä»¶çš„é™åˆ¶åœ¨Spring Bootä¸­ä»¥æ³¨è§£çš„å½¢å¼ä½“ç°ï¼Œå¸¸è§çš„æ¡ä»¶æ³¨è§£æœ‰å¦‚ä¸‹å‡ é¡¹ï¼š@ConditionalOnBeanï¼šå½“å®¹å™¨é‡Œæœ‰æŒ‡å®šçš„beançš„æ¡ä»¶ä¸‹ã€‚@ConditionalOnMissingBeanï¼šå½“å®¹å™¨é‡Œä¸å­˜åœ¨æŒ‡å®šbeançš„æ¡ä»¶ä¸‹ã€‚@ConditionalOnClassï¼šå½“ç±»è·¯å¾„ä¸‹æœ‰æŒ‡å®šç±»çš„æ¡ä»¶ä¸‹ã€‚@ConditionalOnMissingClassï¼šå½“ç±»è·¯å¾„ä¸‹ä¸å­˜åœ¨æŒ‡å®šç±»çš„æ¡ä»¶ä¸‹ã€‚@ConditionalOnPropertyï¼šæŒ‡å®šçš„å±æ€§æ˜¯å¦æœ‰æŒ‡å®šçš„å€¼ï¼Œæ¯”å¦‚@ConditionalOnProperties(prefix=â€xxx.xxxâ€, value=â€enableâ€, matchIfMissing=true)ï¼Œä»£è¡¨å½“xxx.xxxä¸ºenableæ—¶æ¡ä»¶çš„å¸ƒå°”å€¼ä¸ºtrueï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®çš„æƒ…å†µä¸‹ä¹Ÿä¸ºtrueã€‚ä»¥ServletWebServerFactoryAutoConfigurationé…ç½®ç±»ä¸ºä¾‹ï¼Œè§£é‡Šä¸€ä¸‹å…¨å±€é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§å¦‚ä½•ç”Ÿæ•ˆï¼Œæ¯”å¦‚ï¼šserver.port=8081ï¼Œæ˜¯å¦‚ä½•ç”Ÿæ•ˆçš„ï¼ˆå½“ç„¶ä¸é…ç½®ä¹Ÿä¼šæœ‰é»˜è®¤å€¼ï¼Œè¿™ä¸ªé»˜è®¤å€¼æ¥è‡ªäºorg.apache.catalina.startup.Tomcatï¼‰ã€‚åœ¨ServletWebServerFactoryAutoConfigurationç±»ä¸Šï¼Œæœ‰ä¸€ä¸ª@EnableConfigurationPropertiesæ³¨è§£ï¼šå¼€å¯é…ç½®å±æ€§ï¼Œè€Œå®ƒåé¢çš„å‚æ•°æ˜¯ä¸€ä¸ªServerPropertiesç±»ï¼Œè¿™å°±æ˜¯çº¦å®šå¤§äºé…ç½®çš„æœ€ç»ˆè½åœ°ç‚¹ã€‚åœ¨è¿™ä¸ªç±»ä¸Šï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸€ä¸ªéå¸¸ç†Ÿæ‚‰çš„æ³¨è§£ï¼š@ConfigurationPropertiesï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯ä»é…ç½®æ–‡ä»¶ä¸­ç»‘å®šå±æ€§åˆ°å¯¹åº”çš„beanä¸Šï¼Œè€Œ@EnableConfigurationPropertiesè´Ÿè´£å¯¼å…¥è¿™ä¸ªå·²ç»ç»‘å®šäº†å±æ€§çš„beanåˆ°springå®¹å™¨ä¸­ï¼ˆè§ä¸Šé¢æˆªå›¾ï¼‰ã€‚é‚£ä¹ˆæ‰€æœ‰å…¶ä»–çš„å’Œè¿™ä¸ªç±»ç›¸å…³çš„å±æ€§éƒ½å¯ä»¥åœ¨å…¨å±€é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒçœŸæ­£â€œé™åˆ¶â€æˆ‘ä»¬å¯ä»¥åœ¨å…¨å±€é…ç½®æ–‡ä»¶ä¸­é…ç½®å“ªäº›å±æ€§çš„ç±»å°±æ˜¯è¿™äº›xxxPropertiesç±»ï¼Œå®ƒä¸é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„prefixå…³é”®å­—å¼€å¤´çš„ä¸€ç»„å±æ€§æ˜¯å”¯ä¸€å¯¹åº”çš„ã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬å¤§è‡´å¯ä»¥äº†è§£ã€‚åœ¨å…¨å±€é…ç½®çš„å±æ€§å¦‚ï¼šserver.portç­‰ï¼Œé€šè¿‡@ConfigurationPropertiesæ³¨è§£ï¼Œç»‘å®šåˆ°å¯¹åº”çš„xxxPropertiesé…ç½®å®ä½“ç±»ä¸Šå°è£…ä¸ºä¸€ä¸ªbeanï¼Œç„¶åå†é€šè¿‡@EnableConfigurationPropertiesæ³¨è§£å¯¼å…¥åˆ°Springå®¹å™¨ä¸­ã€‚è€Œè¯¸å¤šçš„xxxAutoConfigurationè‡ªåŠ¨é…ç½®ç±»ï¼Œå°±æ˜¯Springå®¹å™¨çš„JavaConfigå½¢å¼ï¼Œä½œç”¨å°±æ˜¯ä¸ºSpring å®¹å™¨å¯¼å…¥beanï¼Œè€Œæ‰€æœ‰å¯¼å…¥çš„beanæ‰€éœ€è¦çš„å±æ€§éƒ½é€šè¿‡xxxPropertiesçš„beanæ¥è·å¾—ã€‚å¯èƒ½åˆ°ç›®å‰ä¸ºæ­¢è¿˜æ˜¯æœ‰æ‰€ç–‘æƒ‘ï¼Œä½†é¢è¯•çš„æ—¶å€™ï¼Œå…¶å®è¿œè¿œä¸éœ€è¦å›ç­”çš„è¿™ä¹ˆå…·ä½“ï¼Œä½ åªéœ€è¦è¿™æ ·å›ç­”ï¼šSpring Bootå¯åŠ¨çš„æ—¶å€™ä¼šé€šè¿‡@EnableAutoConfigurationæ³¨è§£æ‰¾åˆ°META-INF/spring.factoriesé…ç½®æ–‡ä»¶ä¸­çš„æ‰€æœ‰è‡ªåŠ¨é…ç½®ç±»ï¼Œå¹¶å¯¹å…¶è¿›è¡ŒåŠ è½½ï¼Œè€Œè¿™äº›è‡ªåŠ¨é…ç½®ç±»éƒ½æ˜¯ä»¥AutoConfigurationç»“å°¾æ¥å‘½åçš„ï¼Œå®ƒå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªJavaConfigå½¢å¼çš„Springå®¹å™¨é…ç½®ç±»ï¼Œå®ƒèƒ½é€šè¿‡ä»¥Propertiesç»“å°¾å‘½åçš„ç±»ä¸­å–å¾—åœ¨å…¨å±€é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„å±æ€§å¦‚ï¼šserver.portï¼Œè€ŒXxxxPropertiesç±»æ˜¯é€šè¿‡@ConfigurationPropertiesæ³¨è§£ä¸å…¨å±€é…ç½®æ–‡ä»¶ä¸­å¯¹åº”çš„å±æ€§è¿›è¡Œç»‘å®šçš„ã€‚é€šè¿‡ä¸€å¼ å›¾æ ‡æ¥ç†è§£ä¸€ä¸‹è¿™ä¸€ç¹å¤çš„æµç¨‹ï¼šæ€»ç»“ç»¼ä¸Šæ˜¯å¯¹è‡ªåŠ¨é…ç½®åŸç†çš„è®²è§£ã€‚å½“ç„¶ï¼Œåœ¨æµè§ˆæºç çš„æ—¶å€™ä¸€å®šè¦è®°å¾—ä¸è¦å¤ªè¿‡æ‹˜æ³¥ä¸ä»£ç çš„å®ç°ï¼Œè€Œæ˜¯åº”è¯¥æŠ“ä½é‡ç‚¹è„‰ç»œã€‚ä¸€å®šè¦è®°å¾—xxxPropertiesç±»çš„å«ä¹‰æ˜¯ï¼šå°è£…é…ç½®æ–‡ä»¶ä¸­ç›¸å…³å±æ€§ï¼›xxxAutoConfigurationç±»çš„å«ä¹‰æ˜¯ï¼šè‡ªåŠ¨é…ç½®ç±»ï¼Œç›®çš„æ˜¯ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶ã€‚è€Œå…¶ä»–çš„ä¸»æ–¹æ³•å¯åŠ¨ï¼Œåˆ™æ˜¯ä¸ºäº†åŠ è½½è¿™äº›äº”èŠ±å…«é—¨çš„xxxAutoConfigurationç±»ã€‚","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://lolico.me/tags/SpringBoot/"},{"name":"Java","slug":"Java","permalink":"https://lolico.me/tags/Java/"}]},{"title":"å…³äºä½¿ç”¨@Configurationæ³¨è§£çš„é…ç½®ç±»ä¸­å®šä¹‰BeanFactoryPostProcessoråæ³¨å…¥Environmentä¸ºnullçš„é—®é¢˜","slug":"å…³äºä½¿ç”¨-Configurationæ³¨è§£çš„é…ç½®ç±»ä¸­å®šä¹‰BeanFactoryPostProcessoråæ³¨å…¥Environmentä¸ºnullçš„é—®é¢˜","date":"2019-12-17T09:42:22.000Z","updated":"2022-03-06T10:28:21.347Z","comments":true,"path":"2019/12/17/å…³äºä½¿ç”¨-Configurationæ³¨è§£çš„é…ç½®ç±»ä¸­å®šä¹‰BeanFactoryPostProcessoråæ³¨å…¥Environmentä¸ºnullçš„é—®é¢˜/","link":"","permalink":"https://lolico.me/2019/12/17/%E5%85%B3%E4%BA%8E%E4%BD%BF%E7%94%A8-Configuration%E6%B3%A8%E8%A7%A3%E7%9A%84%E9%85%8D%E7%BD%AE%E7%B1%BB%E4%B8%AD%E5%AE%9A%E4%B9%89BeanFactoryPostProcessor%E5%90%8E%E6%B3%A8%E5%85%A5Environment%E4%B8%BAnull%E7%9A%84%E9%97%AE%E9%A2%98/","excerpt":"","text":"é—®é¢˜ç”±æ¥å¼‚å¸¸ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'empDao': Unsatisfied dependency expressed through field 'jdbcTemplate'; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'jdbcTemplate' defined in class path resource [me/lolico/App.class]: Unsatisfied dependency expressed through method 'jdbcTemplate' parameter 0; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'dataSource' defined in class path resource [me/lolico/App.class]: Bean instantiation via factory method failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [javax.sql.DataSource]: Factory method 'dataSource' threw exception; nested exception is java.lang.NullPointerException at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.java:643) at org.springframework.beans.factory.annotation.InjectionMetadata.inject(InjectionMetadata.java:116) at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.postProcessProperties(AutowiredAnnotationBeanPostProcessor.java:399) at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1422) at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:594) at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:517) at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:323) at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222) at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:321) at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202) at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:879) at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:878) at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:550) at org.springframework.context.support.ClassPathXmlApplicationContext.&lt;init&gt;(ClassPathXmlApplicationContext.java:144) at org.springframework.context.support.ClassPathXmlApplicationContext.&lt;init&gt;(ClassPathXmlApplicationContext.java:85) at me.lolico.AppTest.IOC(AppTest.java:24) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50) at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12) at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47) at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17) at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57) at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290) at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71) at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288) at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58) at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268) at org.junit.runners.ParentRunner.run(ParentRunner.java:363) at org.junit.runner.JUnitCore.run(JUnitCore.java:137) at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:68) at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:33) at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:230) at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:58)Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'jdbcTemplate' defined in class path resource [me/lolico/App.class]: Unsatisfied dependency expressed through method 'jdbcTemplate' parameter 0; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'dataSource' defined in class path resource [me/lolico/App.class]: Bean instantiation via factory method failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [javax.sql.DataSource]: Factory method 'dataSource' threw exception; nested exception is java.lang.NullPointerException at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:798) at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:539) at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1338) at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1177) at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:557) at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:517) at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:323) at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222) at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:321) at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202) at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:276) at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1287) at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1207) at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.java:640) ... 37 moreCaused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'dataSource' defined in class path resource [me/lolico/App.class]: Bean instantiation via factory method failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [javax.sql.DataSource]: Factory method 'dataSource' threw exception; nested exception is java.lang.NullPointerException at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:656) at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:484) at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1338) at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1177) at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:557) at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:517) at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:323) at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222) at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:321) at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202) at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:276) at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1287) at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1207) at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:885) at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:789) ... 50 moreCaused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [javax.sql.DataSource]: Factory method 'dataSource' threw exception; nested exception is java.lang.NullPointerException at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:185) at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:651) ... 64 moreCaused by: java.lang.NullPointerException at me.lolico.App.dataSource(App.java:30) at me.lolico.App$$EnhancerBySpringCGLIB$$5fe7f88f.CGLIB$dataSource$0(&lt;generated&gt;) at me.lolico.App$$EnhancerBySpringCGLIB$$5fe7f88f$$FastClassBySpringCGLIB$$c81ae23e.invoke(&lt;generated&gt;) at org.springframework.cglib.proxy.MethodProxy.invokeSuper(MethodProxy.java:244) at org.springframework.context.annotation.ConfigurationClassEnhancer$BeanMethodInterceptor.intercept(ConfigurationClassEnhancer.java:363) at me.lolico.App$$EnhancerBySpringCGLIB$$5fe7f88f.dataSource(&lt;generated&gt;) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:154) ... 65 moreåˆ†æé€šè¿‡é”™è¯¯å †æ ˆä¿¡æ¯ä¸éš¾çœ‹å‡ºå¼‚å¸¸æ˜¯åœ¨springå®¹å™¨å¯åŠ¨åå®ä¾‹åŒ–beanæ—¶æŠ›å‡ºçš„ã€‚æŸ¥çœ‹å †æ ˆä¿¡æ¯å¯ä»¥å‘ç°å®¹å™¨å¯åŠ¨åï¼šåˆ›å»ºEmpDao-&gt;å‘ç°å…¶ä¾èµ–jdbcTemplateåˆ›å»ºjdbcTemplate-&gt;å‘ç°å…¶ä¾èµ–dataSourceåˆ›å»ºdataSource-&gt;æŠ›å‡ºå¼‚å¸¸å †åº•å¼‚å¸¸ï¼š12345678910111213Caused by: java.lang.NullPointerException at me.lolico.App.dataSource(App.java:30) at me.lolico.App$$EnhancerBySpringCGLIB$$5fe7f88f.CGLIB$dataSource$0(&lt;generated&gt;) at me.lolico.App$$EnhancerBySpringCGLIB$$5fe7f88f$$FastClassBySpringCGLIB$$c81ae23e.invoke(&lt;generated&gt;) at org.springframework.cglib.proxy.MethodProxy.invokeSuper(MethodProxy.java:244) at org.springframework.context.annotation.ConfigurationClassEnhancer$BeanMethodInterceptor.intercept(ConfigurationClassEnhancer.java:363) at me.lolico.App$$EnhancerBySpringCGLIB$$5fe7f88f.dataSource(&lt;generated&gt;) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:154) ... 65 moreé‚£ä¹ˆå¥½ï¼Œç°åœ¨çŸ¥é“é—®é¢˜æ˜¯æ€ä¹ˆå‘ç”Ÿçš„ï¼Œé‚£æ€ä¹ˆè§£å†³å‘¢ï¼Ÿé‚å»æŸ¥çœ‹é…ç½®ç±»ä¸­dataSourceå®šä¹‰æ˜¯ä¸æ˜¯æœ‰é—®é¢˜ï¼š123456789101112131415161718192021222324252627282930313233@PropertySource(\"classpath:jdbc.properties\")@ComponentScan(basePackageClasses = App.class)@Configurationpublic class App &#123; @Autowired private Environment env; @Bean public JdbcTemplate jdbcTemplate(DataSource dataSource) &#123; return new JdbcTemplate(dataSource); &#125; @Bean public DataSource dataSource() &#123; DriverManagerDataSource dataSource = new DriverManagerDataSource(); dataSource.setDriverClassName(Objects.requireNonNull(env.getProperty(\"mysql.driver\"))); dataSource.setUrl(env.getProperty(\"mysql.url\")); dataSource.setUsername(env.getProperty(\"mysql.username\")); dataSource.setPassword(env.getProperty(\"mysql.password\")); return dataSource; &#125; @Bean public TransactionManager transactionManager(DataSource dataSource) &#123; return new DataSourceTransactionManager(dataSource); &#125; @Bean public BeanFactoryPostProcessor beanFactoryPostProcessor() &#123; return new TestBeanFactoryPostProcessor(); &#125; &#125;æ²¡æœ‰é—®é¢˜ï¼Œé‚£ä¸ºä»€ä¹ˆåˆ›å»ºçš„dataSourceä¸ºnullå‘¢ï¼Ÿæƒ³èµ·ä¹‹å‰è·‘æµ‹è¯•caseéƒ½æ²¡é”™ï¼Œå‡ºé”™å‰åœ¨é…ç½®ç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªBeanFactoryPostProcessor,å°±æ˜¯è¿™ä¸ªä¸œè¥¿:1234@Beanpublic BeanFactoryPostProcessor beanFactoryPostProcessor() &#123; return new TestBeanFactoryPostProcessor();&#125;ä½†æ˜¯å¼‚å¸¸å’Œå®šä¹‰çš„è¿™ä¸ªBeanFactoryPostProcessoræ‰¯ä¸ä¸Šå…³ç³»å•Šï¼Œè€Œä¸”TestBeanFactoryPostProcessorä¸­ä¹Ÿæ²¡æœ‰é€»è¾‘ã€‚é‚æŸ¥çœ‹æ¡†æ¶æ—¥å¿—ã€‚æ‰¾åˆ°åŸå› æ‰€åœ¨1234567891011121314151617181920212223242019-12-17 14:20:49,658 [main] [DEBUG] - Refreshing org.springframework.context.support.ClassPathXmlApplicationContext@7e0babb12019-12-17 14:20:49,932 [main] [DEBUG] - Loaded 15 bean definitions from class path resource [applicationContext.xml]2019-12-17 14:20:49,960 [main] [DEBUG] - Creating shared instance of singleton bean &#39;org.springframework.context.annotation.internalConfigurationAnnotationProcessor&#39;2019-12-17 14:20:50,103 [main] [DEBUG] - Identified candidate component class: file [D:\\ws_idea\\springmvc\\target\\classes\\me\\lolico\\dao\\EmpDao.class]2019-12-17 14:20:50,228 [main] [DEBUG] - Creating shared instance of singleton bean &#39;org.springframework.context.event.internalEventListenerProcessor&#39;2019-12-17 14:20:50,230 [main] [DEBUG] - Creating shared instance of singleton bean &#39;beanFactoryPostProcessor&#39;2019-12-17 14:20:50,231 [main] [DEBUG] - Creating shared instance of singleton bean &#39;me.lolico.App#0&#39;2019-12-17 14:20:50,234 [main] [INFO] - @Bean method App.beanFactoryPostProcessor is non-static and returns an object assignable to Spring&#39;s BeanFactoryPostProcessor interface. This will result in a failure to process annotations such as @Autowired, @Resource and @PostConstruct within the method&#39;s declaring @Configuration class. Add the &#39;static&#39; modifier to this method to avoid these container lifecycle issues; see @Bean javadoc for complete details.2019-12-17 14:20:50,248 [main] [DEBUG] - Creating shared instance of singleton bean &#39;org.springframework.context.event.internalEventListenerFactory&#39;2019-12-17 14:20:50,249 [main] [DEBUG] - Creating shared instance of singleton bean &#39;org.springframework.context.annotation.internalAutowiredAnnotationProcessor&#39;2019-12-17 14:20:50,251 [main] [DEBUG] - Creating shared instance of singleton bean &#39;org.springframework.context.annotation.internalCommonAnnotationProcessor&#39;2019-12-17 14:20:50,254 [main] [DEBUG] - Creating shared instance of singleton bean &#39;org.springframework.context.annotation.internalPersistenceAnnotationProcessor&#39;2019-12-17 14:20:50,262 [main] [DEBUG] - Creating shared instance of singleton bean &#39;org.springframework.web.servlet.resource.DefaultServletHttpRequestHandler#0&#39;2019-12-17 14:20:50,268 [main] [DEBUG] - Creating shared instance of singleton bean &#39;org.springframework.web.servlet.handler.SimpleUrlHandlerMapping#0&#39;2019-12-17 14:20:50,330 [main] [DEBUG] - Patterns [&#x2F;**] in &#39;org.springframework.web.servlet.handler.SimpleUrlHandlerMapping#0&#39;2019-12-17 14:20:50,330 [main] [DEBUG] - Creating shared instance of singleton bean &#39;mvcCorsConfigurations&#39;2019-12-17 14:20:50,331 [main] [DEBUG] - Creating shared instance of singleton bean &#39;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping&#39;2019-12-17 14:20:50,337 [main] [DEBUG] - Creating shared instance of singleton bean &#39;org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter&#39;2019-12-17 14:20:50,338 [main] [DEBUG] - Creating shared instance of singleton bean &#39;org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter&#39;2019-12-17 14:20:50,339 [main] [DEBUG] - Creating shared instance of singleton bean &#39;org.springframework.web.servlet.view.InternalResourceViewResolver#0&#39;2019-12-17 14:20:50,366 [main] [DEBUG] - Creating shared instance of singleton bean &#39;empDao&#39;2019-12-17 14:20:50,378 [main] [DEBUG] - Creating shared instance of singleton bean &#39;jdbcTemplate&#39;2019-12-17 14:20:50,383 [main] [DEBUG] - Creating shared instance of singleton bean &#39;dataSource&#39;2019-12-17 14:20:50,386 [main] [WARN] - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name &#39;empDao&#39;: Unsatisfied dependency expressed through field &#39;jdbcTemplate&#39;; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name &#39;jdbcTemplate&#39; defined in class path resource [me&#x2F;lolico&#x2F;App.class]: Unsatisfied dependency expressed through method &#39;jdbcTemplate&#39; parameter 0; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#39;dataSource&#39; defined in class path resource [me&#x2F;lolico&#x2F;App.class]: Bean instantiation via factory method failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [javax.sql.DataSource]: Factory method &#39;dataSource&#39; threw exception; nested exception is java.lang.NullPointerExceptionæ³¨æ„ç¬¬å…­æ¡æ—¥å¿—è®°å½•åŠä»¥åå‡ æ¡è®°å½•ï¼š1232019-12-17 14:20:50,230 [main] [DEBUG] - Creating shared instance of singleton bean &#39;beanFactoryPostProcessor&#39;2019-12-17 14:20:50,231 [main] [DEBUG] - Creating shared instance of singleton bean &#39;me.lolico.App#0&#39;2019-12-17 14:20:50,234 [main] [INFO] - @Bean method App.beanFactoryPostProcessor is non-static and returns an object assignable to Spring&#39;s BeanFactoryPostProcessor interface. This will result in a failure to process annotations such as @Autowired, @Resource and @PostConstruct within the method&#39;s declaring @Configuration class. Add the &#39;static&#39; modifier to this method to avoid these container lifecycle issues; see @Bean javadoc for complete details.Springå®¹å™¨å¯åŠ¨ï¼šåˆ›å»ºâ€™beanFactoryPostProcessorâ€™Beanï¼Œå†åˆ›å»ºâ€™me.lolico.App#0â€™Beanã€‚å› ä¸ºbeanFactoryPostProcessorå®šä¹‰åœ¨Appè¿™ä¸ªé…ç½®ç±»ä¸­å³ä¾èµ–äºâ€™me.lolico.App#0â€™Beanï¼Œé‚£ä¹ˆSpringå®¹å™¨åˆ›å»ºâ€™beanFactoryPostProcessorâ€™Beanå¯¼è‡´æå‰å®ä¾‹åŒ–â€™me.lolico.App#0â€™Beanï¼Œè€Œæ­¤æ—¶Springå®¹å™¨å¤„äºè¿˜æœªå®ä¾‹åŒ–æ‰€æœ‰Beanï¼ˆåªæ˜¯åŠ è½½äº†BeanDefinitionï¼‰çš„ç”Ÿå‘½å‘¨æœŸï¼Œé‚£ä¹ˆåœ¨åˆ›å»ºâ€™me.lolico.App#0â€™Beançš„æ—¶å€™è‡ªç„¶ä¸ä¼šå»æ³¨å…¥Environmentå±æ€§ï¼Œåªæ˜¯å…ˆå®ä¾‹åŒ–å‡ºæ¥å¹¶æœªæ³¨å…¥å±æ€§ï¼Œå‚è€ƒSpringå®ä¾‹åŒ–Beançš„ä¸‰çº§ç¼“å­˜æœºåˆ¶ï¼ˆæå‰æš´éœ²Beanä»¥è§£å†³å¾ªç¯ä¾èµ–çš„é—®é¢˜)ã€‚æ‰€ä»¥envä¸ºnullï¼Œè€Œåç»­å®ä¾‹åŒ–â€™dataSourceâ€™Beanï¼Œä½¿ç”¨ä¸ºnullçš„envå»getå±æ€§å€¼å½“ç„¶å°±ç©ºæŒ‡é’ˆå¼‚å¸¸äº†ã€‚äº‹å®ä¸Šï¼Œé€šè¿‡æ–­ç‚¹è°ƒè¯•ä¹ŸéªŒè¯äº†è¿™ä¸ªç»“è®º:æ–­ç‚¹è°ƒè¯•è€Œä¸”ä»”ç»†è§‚å¯Ÿæ—¥å¿—ï¼ŒSpringä¹Ÿå‘Šè¯‰äº†æˆ‘ä»¬è¿™ä¸€ç‚¹:2019-12-17 14:20:50,234 [main] [INFO] - @Bean method App.beanFactoryPostProcessor is non-static and returns an object assignable to Springâ€™s BeanFactoryPostProcessor interface. This will result in a failure to process annotations such as @Autowired, @Resource and @PostConstruct within the methodâ€™s declaring @Configuration class. Add the â€˜staticâ€™ modifier to this method to avoid these container lifecycle issues; see @Bean javadoc for complete details.@Beanæ–¹æ³•App.beanFactoryPostProcessoræ˜¯éé™æ€çš„ï¼Œå¹¶è¿”å›å¯åˆ†é…ç»™Springçš„BeanFactoryPostProcessoræ¥å£çš„å¯¹è±¡ã€‚è¿™å°†å¯¼è‡´æ— æ³•åœ¨æ–¹æ³•çš„å£°æ˜@Configurationç±»ä¸­å¤„ç†è¯¸å¦‚@ Autowiredï¼Œ@ Resourceå’Œ@PostConstructä¹‹ç±»çš„æ³¨é‡Šã€‚åœ¨æ­¤æ–¹æ³•ä¸­æ·»åŠ â€œé™æ€â€ä¿®é¥°ç¬¦å¯é¿å…è¿™äº›å®¹å™¨ç”Ÿå‘½å‘¨æœŸé—®é¢˜ï¼›æœ‰å…³å®Œæ•´çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§@Bean javadocã€‚è§£å†³ç¬¬ä¸€æƒ³åˆ°çš„æ˜¯ï¼šæ—¢ç„¶åˆ›å»ºâ€™me.lolico.App#0â€™Beançš„æ—¶å€™ä¸ä¼šæ³¨å…¥envå±æ€§ï¼Œé‚£ä¹ˆæ”¹ä¸ºæ„é€ å™¨å¼ºåˆ¶æ³¨å…¥,åº”è¯¥å°±å¯ä»¥äº†å§ï¼š123public App(Environment env) &#123; this.env = env;&#125;äº‹å®ä¸Šæ˜¯ä¸è¡Œçš„ï¼šjava.lang.NoSuchMethodException: me.lolico.App$$EnhancerBySpringCGLIB$$e5ab47a1.&lt;init&gt;()springåœ¨ä½¿ç”¨cglibåŠ¨æ€ä»£ç†ç”ŸæˆAppå®ä¾‹çš„æ—¶å€™è°ƒç”¨é»˜è®¤çš„æ— å‚æ„é€ å™¨ã€‚ä½†cglibç°åœ¨ä¹Ÿå¹¶ä¸è¦æ±‚ä»£ç†ç±»ä¸€å®šè¦æœ‰é»˜è®¤æ— å‚æ„é€ å™¨äº†ï¼Œå¯èƒ½æ˜¯Springåº•å±‚å®ç°çš„åŸå› ï¼Ÿæ‰€ä»¥çœŸæ­£çš„è§£å†³åŠæ³•Appé…ç½®ç±»å®ç°EnvironmentAwareæ¥å£Springä¼šé€šè¿‡å›è°ƒæ¥å£ä¼ å…¥ä¸€ä¸ªEnvironmentå¯¹è±¡12345678910public class App implements EnvironmentAware &#123; private Environment env; ...... @Override public void setEnvironment(Environment environment) &#123; this.env = environment; &#125;&#125;å°†BeanFactoryPostProcessorå®šä¹‰çš„æ–¹æ³•æ”¹ä¸ºé™æ€æ–¹æ³•Springå¯ä»¥é€šè¿‡ç±»å.æ–¹æ³•åè°ƒç”¨è·å–BeanFactoryPostProcessorçš„é™æ€æ–¹æ³•ã€‚å°†BeanFactoryPostProcessorå®šä¹‰åœ¨å…¶ä»–é…ç½®ç±»ä¸­æˆ–è€…å®šä¹‰åœ¨xmlé…ç½®æ–‡ä»¶ä¸­åŸå› ä¸è§£é‡Š~å°ç»“é€šè¿‡åˆ†æè¿™ä¸ªé—®é¢˜ï¼Œè¿˜èƒ½å¾—å‡ºä¸€äº›ä¿¡æ¯ï¼šå°†BeanFactoryPostProcessorå®šä¹‰åœ¨é…ç½®ç±»ä¸­å¹¶ä¸”å¹¶ä¸ä»¥é™æ€æ–¹æ³•å®šä¹‰çš„è¯ï¼Œä¼šå¯¼è‡´é…ç½®ç±»æå‰å®ä¾‹åŒ–ï¼ˆBeanFactoryPostProcessoråœ¨Springç”Ÿå‘½å‘¨æœŸä¸­åˆ›å»ºçš„å¾ˆæ—©ï¼Œè¦æ—©äºBeanPostProcessorå’ŒBeanå‚è€ƒAbstractApplicationContext#refresh)ï¼Œä»è€Œå‡ºç°ä¸€äº›ç”Ÿå‘½å‘¨æœŸçš„é—®é¢˜ï¼Œå¦‚æœä¸äº†è§£ï¼ŒçœŸçš„å¾ˆéš¾å‘ç°ã€‚å¯èƒ½ä½ è¿™æ ·å®šä¹‰æ²¡æœ‰é—®é¢˜ï¼Œé‚£åŸå› ä¹‹ä¸€å¯èƒ½æ˜¯å› ä¸ºä½ çš„è¿™ä¸ªé…ç½®ç±»ä¸­æ²¡æœ‰ç”¨åˆ°ç±»ä¼¼Environmentè¿™ç§éœ€è¦æ³¨å…¥è¿›æ¥çš„å±æ€§ã€‚å‚è€ƒï¼š^ BeanFactoryPostProcessor and @Bean problems #4711","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"https://lolico.me/tags/Spring/"},{"name":"Java","slug":"Java","permalink":"https://lolico.me/tags/Java/"}]},{"title":"Spring Data Jpaæ¨¡ç³ŠæŸ¥è¯¢","slug":"SpringDataJPAæ¨¡ç³ŠæŸ¥è¯¢","date":"2019-11-15T09:24:39.000Z","updated":"2022-03-06T10:28:21.343Z","comments":true,"path":"2019/11/15/SpringDataJPAæ¨¡ç³ŠæŸ¥è¯¢/","link":"","permalink":"https://lolico.me/2019/11/15/SpringDataJPA%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2/","excerpt":"","text":"å®ä½“ç±»User.java123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475@Entity@Table(name = \"user\")public class User &#123; private int id; private String username; private String password; private String email; @Id @Column(name = \"id\") @GeneratedValue(strategy = GenerationType.IDENTITY) public int getId() &#123; return id; &#125; public void setId(int id) &#123; this.id = id; &#125; @Basic @Column(name = \"uname\") public String getUsername() &#123; return username; &#125; public void setUsername(String username) &#123; this.username = username; &#125; @Basic @Column(name = \"upassword\") public String getPassword() &#123; return password; &#125; public void setPassword(String password) &#123; this.password = password; &#125; @Basic @Column(name = \"uemail\") public String getEmail() &#123; return email; &#125; public void setEmail(String email) &#123; this.email = email; &#125; @Override public boolean equals(Object o) &#123; if (this == o) return true; if (o == null || getClass() != o.getClass()) return false; User that = (User) o; return id == that.id &amp;&amp; Objects.equals(username, that.username) &amp;&amp; Objects.equals(password, that.password) &amp;&amp; Objects.equals(email, that.email); &#125; @Override public int hashCode() &#123; return Objects.hash(id, username, password, email); &#125; @Override public String toString() &#123; return \"User&#123;\" + \"id=\" + id + \", username='\" + username + '\\'' + \", password='\" + password + '\\'' + \", email='\" + email + '\\'' + '&#125;'; &#125;&#125;ä¸ä¾èµ–æ•°æ®åº“çš„å®ç°æ–¹æ³•è‡ªå®šä¹‰æŸ¥è¯¢è¯­å¥ï¼ˆconcatå‡½æ•°ï¼‰mysql:concat:ç”¨äºå°†å¤šä¸ªå­—ç¬¦ä¸²è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ˜¯æœ€é‡è¦çš„mysqlå‡½æ•°ä¹‹ä¸€ã€‚1234@Query(\"select u from User u \" + \" where (u.username like concat('%',?1,'%') or ?1 is null) \" + \" and u.email=?2 \")List&lt;User&gt; findByUsernameLikeAndEmail(String username, String email);1234@Testvoid findByUsernameLikeAndEmail() &#123; System.out.println(repository.findByUsernameLikeAndEmail(\"test\", \"test3@ttt\"));&#125;è¾“å‡ºï¼š[User{id=3, username=â€™test3â€™, password=â€™test3â€™, email=â€™test3@tttâ€™}, User{id=5, username=â€™test3â€™, password=â€™test3â€™, email=â€™test3@tttâ€™}, User{id=6, username=â€™test3â€™, password=â€™test3â€™, email=â€™test3@tttâ€™}, User{id=7, username=â€™test3â€™, password=â€™test3â€™, email=â€™test3@tttâ€™}]è‡ªå®šä¹‰æŸ¥è¯¢è¯­å¥1234@Query(\"select u from User u \" + \" where (u.username like ?1 or ?1 is null) \" + \" and u.email=?2\")List&lt;User&gt; findByUsernameLikeAndEmail(String username, String email);1234@Testvoid findByUsernameLikeAndEmail() &#123; System.out.println(repository.findByUsernameLikeAndEmail(\"%test%\", \"test3@ttt\"));&#125;è¾“å‡ºï¼šåŒæ–¹å¼ä¸€æ³¨æ„ï¼šæ•ˆæœåŒæ–¹å¼ä¸€ï¼Œè°ƒç”¨ä¼ å‚çš„ä¸åŒï¼Œç›¸æ¯”æ–¹å¼ä¸€è¦è‡ªå·±ä¼ å…¥åŒ…å«æ¨¡å¼çš„åŒ¹é…å­—ç¬¦ä¸²ï¼šâ€te_t%â€ã€â€test%â€ç­‰.æ–¹å¼ä¸€å’Œæ–¹å¼äºŒè°ƒç”¨ï¼šrepository.findByUsernameLikeAndEmail(null, &quot;test8@ttt&quot;)è¾“å‡ºï¼š[User{id=8, username=â€™nullâ€™, password=â€™8â€™, email=â€™test8@tttâ€™}]u.username like %?1% or ?1 is nullå’Œu.username like concat(&#39;%&#39;,?1,&#39;%&#39;) or ?1 is nullä»£è¡¨ä¸å­˜åœ¨åˆ™å¿½ç•¥æ¨¡ç³ŠæŸ¥è¯¢æ¡ä»¶ï¼Œå­˜åœ¨åˆ™è¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢ã€‚jpaè‡ªåŠ¨æä¾›å®ç°çš„æ–¹å¼1List&lt;User&gt; findByUsernameLikeAndEmail(String username,String email);1234@Testvoid findByUsernameLikeAndEmail() &#123; System.out.println(repository.findByUsernameLikeAndEmail(\"%test%\", \"test3@ttt\"));&#125;è¾“å‡ºï¼šåŒæ–¹å¼ä¸€1234@Testvoid findByUsernameLikeAndEmail() &#123; System.out.println(repository.findByUsernameLikeAndEmail(null, \"test8@ttt\"));&#125;ç”±äºjpaè‡ªåŠ¨æä¾›å®ç°ï¼Œæ²¡æœ‰or ?1 is nullé€»è¾‘ï¼Œä¼ å‚nullè¿›è¡Œè°ƒç”¨æŠ›å‡ºå¼‚å¸¸ï¼šå¼‚å¸¸ï¼šorg.springframework.dao.InvalidDataAccessApiUsageException: Value must not be null!; nested exception is java.lang.IllegalArgumentException: Value must not be null!åˆ©ç”¨ä¸åŒæ•°æ®åº“ä¸­æä¾›çš„å‡½æ•°çš„å®ç°æ–¹æ³•mysql:containsMYSQLä¸­å¯ä»¥ç”¨CONTAINSå‡½æ•°,åœ¨å…¨æ–‡ç´¢å¼•çš„çš„å­—æ®µä¸­ä½¿ç”¨ï¼š123456@Query(value = \" select * from event e \" + \" where (?1 is null or CONTAINS(e.event_title,'?1')) \" + \" and (to_days(e.register_time)=to_days(?2) or ?2 is null) \" + \" and e.status = '1' \" + \" order by e.register_time desc limit ?3,?4 \",nativeQuery = true) List&lt;Event&gt; findAllList(String eventTitle,Timestamp registerTime,Integer pageNumber,Integer pageSize);è¿˜å¯ä»¥ç”¨ find_in_set() æ–¹æ³•,ä¾‹å¦‚:select * FROM users WHERE find_in_set(&#39;aa@email.com&#39;, emails);oracle:instrOracleä¸­æä¾›äº† instr(strSource,strTarget)å‡½æ•°ï¼Œæ¯”ä½¿ç”¨ LIKE %å…³é”®å­—% çš„æ¨¡å¼æ•ˆç‡é«˜å¾ˆå¤šã€‚instrå‡½æ•°ä¹Ÿæœ‰ä¸‰ç§æƒ…å†µï¼šinstræ¡ä»¶ç›¸å½“äºlikeä»€ä¹ˆinstr(å­—æ®µ,â€˜å…³é”®å­—â€™)&gt;0å­—æ®µlike â€˜%å…³é”®å­—%â€™instr(å­—æ®µ,â€˜å…³é”®å­—â€™)=1å­—æ®µlike â€˜å…³é”®å­—%â€™instr(å­—æ®µ,â€˜å…³é”®å­—â€™)=0å­—æ®µnot like â€˜%å…³é”®å­—%â€™pgsql:~~ç”¨æ³•~ è¡¨ç¤ºåŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸”åŒºåˆ†å¤§å°å†™ã€‚~* è¡¨ç¤ºåŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸”ä¸åŒºåˆ†å¤§å°å†™ã€‚å¯ä»¥é€šè¿‡è¿™ä¸¤ä¸ªæ“ä½œç¬¦æ¥å®ç°likeå’Œilikeä¸€æ ·çš„æ•ˆæœ,^å’Œ$å°±æ˜¯æ­£åˆ™è¡¨è¾¾å¼é‡Œçš„ç”¨æ³•ï¼Œå¦‚ä¸‹ï¼šåŒ¹é…ä»¥â€œå¼ â€å¼€å¤´çš„å­—ç¬¦ä¸² : select * from table where name ~ â€˜^å¼ â€™;åŒ¹é…ä»¥â€œå°â€ç»“å°¾çš„å­—ç¬¦ä¸² : select * from table where name ~ â€˜å°$â€™;!~æ˜¯~çš„å¦å®šç”¨æ³•ï¼Œè¡¨ç¤ºä¸åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸”åŒºåˆ†å¤§å°å†™ã€‚!~*æ˜¯~*çš„å¦å®šç”¨æ³•ï¼Œè¡¨ç¤ºä¸åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸”ä¸åŒºåˆ†å¤§å°å†™ã€‚~~ç­‰æ•ˆäºlikeï¼Œ~~*ç­‰æ•ˆäºilikeã€‚!~~ç­‰æ•ˆäºnot likeï¼Œ!~~*ç­‰æ•ˆäºnot ilikeã€‚","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"https://lolico.me/tags/Spring/"},{"name":"Java","slug":"Java","permalink":"https://lolico.me/tags/Java/"},{"name":"JPA","slug":"JPA","permalink":"https://lolico.me/tags/JPA/"}]},{"title":"å…³äºSpringBootä½¿ç”¨JPAè¿›è¡Œæ›´æ–°æ“ä½œ","slug":"å…³äºSpringBootä½¿ç”¨JPAè¿›è¡Œæ›´æ–°æ“ä½œ","date":"2019-11-14T09:08:44.000Z","updated":"2022-03-06T10:28:21.347Z","comments":true,"path":"2019/11/14/å…³äºSpringBootä½¿ç”¨JPAè¿›è¡Œæ›´æ–°æ“ä½œ/","link":"","permalink":"https://lolico.me/2019/11/14/%E5%85%B3%E4%BA%8ESpringBoot%E4%BD%BF%E7%94%A8JPA%E8%BF%9B%E8%A1%8C%E6%9B%B4%E6%96%B0%E6%93%8D%E4%BD%9C/","excerpt":"","text":"ä½¿ç”¨SimpleJpaRepository#saveï¼ˆJpaRepositoryçš„é»˜è®¤å®ç°ï¼Œæ›´æ–°æ“ä½œæœ¬è´¨ä¸Šæ˜¯è°ƒç”¨EntityManager#mergeæ–¹æ³•ï¼‰è¿›è¡Œæ›´æ–°æ“ä½œæ—¶ä¼šå‘ç°ï¼šåœ¨ä¼ å…¥çš„å¯¹è±¡åªæœ‰éƒ¨åˆ†å‚æ•°æ—¶ï¼Œæ›´æ–°åæ•°æ®åº“ä¸­è¯¥è®°å½•çš„å…¶ä»–å­—æ®µä¸ºnullè§£å†³ï¼š123456789@Transactional@Modifying@Query(\"update User u set u.email=:#&#123;#user.email&#125; where u.id=:#&#123;#user.id&#125;\")void dynamicUpdateEmailById(@Param(\"user\") User user);@Transactional@Modifying@Query(\"update User u set u.email=?2 where u.id=?1\")void dynamicUpdateEmailById(int id, String email);å¯¹äºè°ƒç”¨SimpJpaReposiory#savaæ’å…¥æ–°çºªå½•ågetä¸åˆ°id(ä¸»é”®)çš„é—®é¢˜æ·»åŠ @GeneratedValueæ³¨è§£ä¿®æ”¹ä¸»é”®ç”Ÿæˆç­–ç•¥ä¸ºGenerationType.IDENTITYï¼Œé»˜è®¤æ˜¯GenerationType.AUTOå¼‚å¸¸ï¼šorg.springframework.dao.DataIntegrityViolationException: could not execute statement; SQL [n/a]; constraint [PRIMARY]; nested exception is org.hibernate.exception.ConstraintViolationException: could not execute statementè§£å†³ï¼šä½¿ç”¨GenerationType.IDENTITY12345678910111213141516@Entity@Table(name = \"user\")public class User &#123; private int id; private String username; private String password; private String email; @Id @Column(name = \"id\") @GeneratedValue(strategy = GenerationType.IDENTITY) public int getId() &#123; return id; &#125; ...&#125;æˆ–12345678910111213141516@Entity@Table(name = \"user\")public class User &#123; @Id @Column(name = \"id\") @GeneratedValue(strategy = GenerationType.IDENTITY) private int id; private String username; private String password; private String email; public int getId() &#123; return id; &#125; ...&#125;æ³¨æ„ï¼šæµ‹è¯•å°†@GeneratedValue(strategy = GenerationType.IDENTITY)æ ‡æ³¨åœ¨å±æ€§ï¼ˆ@Idã€@Columnç­‰è¿˜æ˜¯æ ‡æ³¨äºgetteræ–¹æ³•)æ—¶ä¸ç”Ÿæ•ˆï¼ŒåŸå› å¯èƒ½æ˜¯PPBåœ¨è§£æå±æ€§å’Œè¡¨å­—æ®µæ˜ å°„æ—¶è¦ä¹ˆä»getteræ–¹æ³•è¿›è¡Œè§£æç»‘å®šï¼Œè¦ä¹ˆä»å±æ€§è§£æç»‘å®šï¼Œè€Œä¸æ˜¯è§£æå±æ€§å’Œå¯¹åº”getteræ–¹æ³•è¿›è¡Œåˆå¹¶ã€‚","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"https://lolico.me/tags/Spring/"},{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://lolico.me/tags/SpringBoot/"},{"name":"Java","slug":"Java","permalink":"https://lolico.me/tags/Java/"},{"name":"JPA","slug":"JPA","permalink":"https://lolico.me/tags/JPA/"}]},{"title":"EntityManagerFactoryå’ŒEntityManager","slug":"EntityManagerFactoryå’ŒEntityManager","date":"2019-11-12T08:53:19.000Z","updated":"2022-03-06T10:28:21.343Z","comments":true,"path":"2019/11/12/EntityManagerFactoryå’ŒEntityManager/","link":"","permalink":"https://lolico.me/2019/11/12/EntityManagerFactory%E5%92%8CEntityManager/","excerpt":"","text":"å¸¸è§å¼‚å¸¸åŠå¯èƒ½çš„è§£å†³åŠæ³•javax.persistence.TransactionRequiredException: no transaction is in progresså¯èƒ½çš„åŸå› ï¼šæ²¡æœ‰å¼€å¯äº‹åŠ¡å¼€å¯äº‹åŠ¡æ²¡æœ‰ç”Ÿæ•ˆ@Transactionalæ³¨è§£æ˜¯ä½œç”¨äºEntityManagerçš„æ“ä½œçš„å±‚çº§ä¸ŠEntityManagerFactory#createEntityManagerç”Ÿæˆçš„EntityManagerå¯¹äºå†™æ“ä½œæ‰‹åŠ¨ç®¡ç†äº‹åŠ¡ï¼ˆå¼€å¯-æ“ä½œ-æäº¤ï¼‰æ—¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¯¹äºä¸€ä¸ªæ“ä½œä¸­çš„æ‰€æœ‰å­æ“ä½œè¦åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­å®Œæˆjava.lang.IllegalStateException: Transaction not successfully startedEntityManagerFactory#createEntityManageræ¯æ¬¡éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œæ‰€ä»¥é€šè¿‡EntityManagerFactory.createEntityManager().getTransaction()[.begin()|.commit()]å¼€å¯å’Œæäº¤äº‹åŠ¡æ˜¯ä¸è¡Œçš„ï¼Œä¾‹å¦‚ï¼š12345public void insertOne(User user) &#123; emf.createEntityManager().getTransaction().begin(); emf.createEntityManager().persist(user); emf.createEntityManager().getTransaction().commit();&#125;æ­£ç¡®æ–¹å¼ï¼š123456public void insertOne(User user) &#123; EntityManager entityManager = emf.createEntityManager(); entityManager.getTransaction().begin(); entityManager.persist(user); entityManager.getTransaction().commit();&#125;org.springframework.dao.InvalidDataAccessApiUsageException: Removing a detached instance;nested exception is java.lang.IllegalArgumentException: Removing a detached instance123456789public void deleteById(int id) &#123; EntityManager entityManager = emf.createEntityManager(); entityManager.getTransaction().begin(); entityManager.remove(getById(id)); entityManager.getTransaction().commit();&#125;public User getById(int id) &#123; return emf.createEntityManager().find(User.class, id);&#125;å¯èƒ½çš„åŸå› ï¼šæ³¨æ„getById(int id)ä¸­çš„å†…å®¹ï¼ŒEntityManagerFactory#createEntityManager()`æ¯æ¬¡è¿”å›ä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œå³åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­æ“ä½œä¸¤ä¸ªä¸åŒçš„entityManagerã€‚é€šå¸¸ï¼šåœ¨åˆ é™¤ä¸€ä¸ªæ¸¸ç¦»çŠ¶æ€çš„å®ä½“æ—¶ä¹Ÿä¼šæŠ¥è¿™ä¸ªå¼‚å¸¸ã€‚å¯¹äºå®ä½“ä¸åŒçŠ¶æ€ä¸‹çš„æ“ä½œè§ï¼šJPA EntityManagerçš„å››ä¸ªä¸»è¦æ–¹æ³• â€”â€”persist,merge,refreshå’Œremoveæ­£ç¡®æ–¹å¼ï¼š123456public void deleteById(int id) &#123; EntityManager entityManager = emf.createEntityManager(); entityManager.getTransaction().begin(); entityManager.remove(entityManager.find(User.class,id)); entityManager.getTransaction().commit();&#125;java.lang.IllegalArgumentException: attempt to create delete event with null entityåˆ é™¤çš„å®ä½“ä¸å­˜åœ¨ï¼Œæ£€æŸ¥éœ€è¦åˆ é™¤çš„è®°å½•æ˜¯å¦ä¸å­˜åœ¨äºæ•°æ®åº“çš„è¡¨ä¸­ã€‚SimpleJpaRepository#saveAndFlushå’ŒSimpleJpaRepository#saveæ–¹æ³•saveæ–¹æ³•åœ¨æ²¡æœ‰ä¸»é”®æ—¶è°ƒç”¨EntityManager.persistæ–¹æ³•æ‰§è¡Œæ’å…¥æ“ä½œã€‚åœ¨æœ‰ä¸»é”®æ—¶è°ƒç”¨EntityManager.mergeæ–¹æ³•æ‰§è¡Œæ›´æ–°æ“ä½œã€‚saveAndFlushæ–¹æ³•è°ƒç”¨saveæ–¹æ³•åè°ƒç”¨flushæ–¹æ³•ï¼Œå°†PersistenceContextçš„ä¿¡æ¯åˆ·æ–°åˆ°æ•°æ®åº“ä¸­ï¼Œå½“è§¦å‘flushè¿™ä¸ªåŠ¨ä½œçš„æ—¶å€™ï¼Œæ‰€æœ‰çš„å®ä½“éƒ½å°†ä¼šè¢«insert/update/removeåˆ°æ•°æ®åº“ä¸­ï¼Œæ•°æ®åº“ä¸ä¼šè§¦å‘Commitçš„æ“ä½œã€‚æºç 123456789101112131415161718192021@Transactional@Overridepublic &lt;S extends T&gt; S save(S entity) &#123; if (entityInformation.isNew(entity)) &#123; em.persist(entity); return entity; &#125; else &#123; return em.merge(entity); &#125;&#125;@Transactional@Overridepublic &lt;S extends T&gt; S saveAndFlush(S entity) &#123; S result = save(entity); flush(); return result;&#125;EntityManager#mergeå’ŒEntityManager#persistæ–¹æ³•persist(),æ˜¯ä¿å­˜ï¼Œè·Ÿsaveï¼ˆï¼‰æ–¹æ³•ä¸€æ ·ï¼ŒçŸ¥è¯†jpaå®˜æ–¹è¯´å«persistæ¯”è¾ƒå¥½ä¸€äº›ï¼Œæ›´æ¥è¿‘æŒä¹…åŒ–çš„å«ä¹‰ã€‚è€Œmergeï¼ˆï¼‰æ˜¯åˆå¹¶çš„æ„æ€ï¼Œå°±æ˜¯å½“ä½ ä¿å­˜çš„å®ä½“ï¼Œæ ¹æ®ä¸»é”®idåˆ’åˆ†ï¼Œå¦‚æœå·²å­˜åœ¨ï¼Œé‚£ä¹ˆå°±æ˜¯æ›´æ–°æ“ä½œï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±æ˜¯æ–°å¢æ“ä½œã€‚persistä¼šæŠŠä¼ è¿›å»çš„å®ä½“æ”¾åˆ°æŒä¹…åŒ–ä¸Šä¸‹æ–‡ä¸­ï¼Œæ­¤æ—¶å¦‚æœæŒä¹…åŒ–ä¸Šä¸‹æ–‡ä¸­æœ‰äº†è¿™ä¸ªå®ä½“ï¼Œå°±ä¼šæŠ›å‡ºjavax.persistence.EntityExistsExceptionï¼Œæ²¡æœ‰çš„è¯äº‹åŠ¡æäº¤çš„æ—¶å€™æŠŠé‚£ä¸ªå¯¹è±¡åŠ è¿›æ•°æ®åº“ä¸­ï¼Œå¦‚æœæ•°æ®åº“ä¸­å·²ç»å­˜åœ¨äº†é‚£ä¸ªå¯¹è±¡ï¼ˆé‚£ä¸€è¡Œï¼‰ï¼Œå°±ä¼šæŠ›å‡ºcom.mysql.jdbc.exceptions.jdbc4.MySQLIntegrityConstraintViolationExceptionï¼›è€Œmergeä¼šåœ¨æŒä¹…åŒ–ä¸Šä¸‹æ–‡ä¸­ç”Ÿæˆä¼ è¿›å»çš„å®ä½“çš„å—ç®¡ç‰ˆæœ¬ï¼Œå¦‚æœå·²ç»æœ‰äº†å—ç®¡ç‰ˆæœ¬ï¼Œé‚£ä¹Ÿä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œç„¶åæŠŠé‚£ä¸ªå—ç®¡çš„å®ä½“è¿”å›å‡ºæ¥ï¼Œäº‹åŠ¡æäº¤çš„æ—¶å€™å¦‚æœæ•°æ®åº“ä¸­ä¸å­˜åœ¨é‚£ä¸ªå¯¹è±¡ï¼ˆé‚£ä¸€è¡Œï¼‰ï¼Œå°±æŠŠæŠŠé‚£ä¸ªå—ç®¡çš„åŠ è¿›å»ï¼Œå­˜åœ¨çš„è¯å°±æ›¿æ¢æ‰åŸæ¥çš„æ•°æ®ã€‚mergeæ˜¯å¦‚æœæŒä¹…åŒ–ä¸Šä¸‹æ–‡ä¸­æœ‰äº†å—ç®¡ç‰ˆæœ¬ï¼Œé‚£å°±æ›´æ–°ï¼Œæ²¡æœ‰å°±å¤åˆ¶ä¸€ä»½ï¼Œè¿”å›å—ç®¡çš„ã€‚å†æ¬¡æ€»ç»“persistï¼ˆâ‘ ï¼Œâ‘¡-â‘¢ï¼Œâ‘£-â‘¤ï¼‰ï¼š ï¼ˆè¿™é‡Œè¯´çš„æŠ›å‡ºçš„å¼‚å¸¸éƒ½æ˜¯æŒ‡å¯¹è±¡ï¼ˆæˆ–è€…æ•°æ®åº“ä¸­çš„è¡Œï¼‰é‡å¤çš„å¼‚å¸¸ï¼‰ â‘ å¦‚æœpersistçš„æ˜¯ä¸€ä¸ªå—ç®¡å®ä½“ï¼ˆå³å·²ç»åœ¨ä¸Šä¸‹æ–‡ä¸­ï¼‰ï¼Œå°±ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚â‘¡å¦‚æœpersistçš„æ˜¯ä¸€ä¸ªæ¸¸ç¦»å®ä½“ï¼ˆå³ä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰å®ƒï¼‰ï¼Œè€Œä¸Šä¸‹æ–‡ä¸­åˆæ²¡æœ‰å®ƒçš„å—ç®¡ç‰ˆæœ¬ï¼Œæ•°æ®åº“ä¸­ä¹Ÿæ²¡æœ‰ï¼Œä¹Ÿä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œä¼šæŠŠè¿™ä¸ªå®ä½“å†™è¿›æ•°æ®åº“ä¸­ã€‚â‘¢å¦‚æœpersistçš„æ˜¯ä¸€ä¸ªæ¸¸ç¦»å®ä½“ï¼ˆå³ä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰ï¼‰ï¼Œè€Œä¸Šä¸‹æ–‡ä¸­åˆæ²¡æœ‰å®ƒçš„å—ç®¡ç‰ˆæœ¬ï¼Œæ•°æ®åº“å´æœ‰è¿™ä¸ªå®ä½“ï¼Œé‚£ä¹ˆEntityManageråœ¨persistå®ƒçš„æ—¶å€™ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä½†æ˜¯äº‹åŠ¡æäº¤çš„æ—¶å€™å°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼šCaused by: com.mysql.jdbc.exceptions.jdbc4.MySQLIntegrityConstraintViolationException: Duplicate entry â€˜7â€™ for key 1ï¼›â‘£å¦‚æœpersistçš„æ˜¯ä¸€ä¸ªæ¸¸ç¦»å®ä½“ï¼ˆå³ä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰ï¼‰ï¼Œè€Œä¸Šä¸‹æ–‡ä¸­å´æœ‰å®ƒçš„å—ç®¡ç‰ˆæœ¬ï¼Œæ•°æ®åº“ä¸­åˆæ²¡æœ‰è¿™ä¸ªå®ä½“ï¼Œé‚£ä¹ˆè¿˜æ˜¯ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œæ˜¯æŠŠå®ƒçš„å—ç®¡ç‰ˆæœ¬åŠ è¿›å»ï¼ˆä¸æ˜¯é‚£ä¸ªæ¸¸ç¦»çš„ï¼Œæ˜¯é‚£ä¸ªå—ç®¡çš„ï¼ï¼‰ï¼ˆå³ï¼Œè¿™ç§æƒ…å†µpersistå’Œæ²¡persistæ˜¯ä¸€æ ·çš„ï¼ï¼‰ã€‚ â‘¤å¦‚æœpersistçš„æ˜¯ä¸€ä¸ªæ¸¸ç¦»å®ä½“ï¼ˆå³ä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰ï¼‰ï¼Œè€Œä¸Šä¸‹æ–‡ä¸­å´æœ‰å®ƒçš„å—ç®¡ç‰ˆæœ¬ï¼Œæ•°æ®åº“ä¸­ä¹Ÿæœ‰äº†è¿™ä¸ªå®ä½“ï¼Œé‚£ä¹ˆEntityManageråœ¨persistå®ƒçš„æ—¶å€™å°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼šjavax.persistence.EntityExistsException è€Œmergeå°±ä¸ä¼šæŠ›å‡ºä»€ä¹ˆå¯¹è±¡é‡å¤çš„å¼‚å¸¸çš„äº†ã€‚äº‹å®ä¸Šï¼Œç»è¿‡æµ‹è¯•ï¼ŒEntityManager#mergeæ–¹æ³•åœ¨æ²¡ä¸»é”®æ—¶ä¼šæ‰§è¡Œæ’å…¥æ“ä½œï¼ˆå¯ç”¨äºæ’å…¥è®°å½•æ“ä½œï¼‰ã€‚ä½†æ˜¯æ— æ³•é€šè¿‡EntityManager#mergeæ’å…¥è‡ªå®šä¹‰ä¸»é”®çš„è®°å½•ï¼Œè€ŒEntityManager#persiståœ¨æœ‰æ— ä¸»é”®æ—¶éƒ½ä¼šè¿›è¡Œæ’å…¥æ“ä½œï¼Œå¯¹äºä¸»é”®çš„å€¼ä¼šæ ¹æ®è¡¨ä¸»é”®çš„ç”Ÿæˆç­–ç•¥è¿›è¡Œç”Ÿæˆã€‚å³ï¼špersistæ˜¯ç›´æ¥ä¿å­˜ï¼Œmergeæ˜¯æ ¹æ®idæ˜¯å¦å­˜åœ¨æ¥åˆ¤æ–­æ˜¯ä¿å­˜è¿˜æ˜¯ä¿®æ”¹ï¼ˆidå­˜åœ¨ï¼Œåˆ™ä¿®æ”¹ï¼› idä¸å­˜åœ¨ï¼Œåˆ™æ·»åŠ ï¼‰","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"https://lolico.me/tags/Spring/"},{"name":"Java","slug":"Java","permalink":"https://lolico.me/tags/Java/"},{"name":"JPA","slug":"JPA","permalink":"https://lolico.me/tags/JPA/"},{"name":"Hibernate","slug":"Hibernate","permalink":"https://lolico.me/tags/Hibernate/"}]},{"title":"æ·±å…¥ç†è§£@ModelAttributeã€@SessionAttributeå’Œ@SessionAttributesæ³¨è§£","slug":"ModelAttribute-SessionAttribute-and-SessionAttributes-in-SpringBoot","date":"2019-10-19T04:45:57.000Z","updated":"2022-03-06T10:28:21.343Z","comments":true,"path":"2019/10/19/ModelAttribute-SessionAttribute-and-SessionAttributes-in-SpringBoot/","link":"","permalink":"https://lolico.me/2019/10/19/ModelAttribute-SessionAttribute-and-SessionAttributes-in-SpringBoot/","excerpt":"","text":"@ModelAttributeå¦‚æœå¸Œæœ›å°†æ–¹æ³•å…¥å‚å¯¹è±¡æ·»åŠ åˆ°æ¨¡å‹ä¸­ï¼Œåˆ™ä»…éœ€è¦åœ¨ç›¸åº”å…¥å‚å‰ä½¿ç”¨@ModelAttributeæ³¨è§£ã€‚æ¥çœ‹ä¸€ä¸ªå…·ä½“çš„å®ä¾‹ï¼š12345@GetMapping(\"/h\")public User user(@ModelAttribute(\"user\") User user) &#123; user.setNickName(\"lolico li\"); return user;&#125;SpringMVCå°†è¯·æ±‚æ¶ˆæ¯ç»‘å®šåˆ°Userå¯¹è±¡ï¼Œç„¶åä»¥userä¸ºé”®å°†Userå¯¹è±¡æ”¾åˆ°æ¨¡å‹ä¸­ï¼Œåœ¨å‡†å¤‡å¯¹è§†å›¾è¿›è¡Œæ¸²æŸ“å‰ï¼ŒSpringMVCè¿˜ä¼šè¿›ä¸€æ­¥å°†æ¨¡å‹ä¸­çš„æ•°æ®è½¬å‚¨åˆ°è§†å›¾ä¸Šä¸‹æ–‡ä¸­å¹¶æš´éœ²ç»™è§†å›¾å¯¹è±¡ã€‚å¯¹äºJSPæ¥è¯´ï¼ŒSpringMVCå°†æ¨¡å‹æ•°æ®è½¬å‚¨åˆ°ServletRequestçš„å±æ€§åˆ—è¡¨ä¸­ï¼ˆé€šè¿‡ServletRequest#setAttribute(String name, Object o)æ–¹æ³•ï¼Œä½œç”¨åŸŸä¸ºè¯·æ±‚åŸŸ)ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ@ModelAttributeæ³¨è§£çš„å±æ€§åªèƒ½åœ¨ä¸€æ¬¡ç›¸åŒçš„è¯·æ±‚ä¸­å¯è§çš„åŸå› ã€‚é™¤äº†å¯ä»¥åœ¨æ–¹æ³•å…¥å‚ä¸Šä½¿ç”¨@ModelAttributeæ³¨è§£å¤– ï¼Œè¿˜å¯ä»¥åœ¨æ–¹æ³•å®šä¹‰ä¸Šä½¿ç”¨ã€‚SpringMVCåœ¨è°ƒç”¨ç›®æ ‡æ–¹æ³•å‰ï¼Œä¼šå…ˆé€ä¸ªè°ƒç”¨åœ¨æ–¹æ³•å±‚çº§ä¸Šæ ‡æ³¨äº†è¯¥æ³¨è§£çš„æ–¹æ³•ï¼Œå¹¶å°†è¿™äº›æ–¹æ³•çš„è¿”å›å€¼æ·»åŠ åˆ°æ¨¡å‹ä¸­ã€‚ä¸‹é¢ä¸€ä¸ªå…·ä½“çš„å®ä¾‹ï¼š123456789101112@ModelAttribute(\"user\")public User initUserModal() &#123; // 1 User user = new User(); user.setNickName(\"init user\"); return user;&#125;@GetMapping(\"/h\")public User handle(@ModelAttribute(\"user\") User user) &#123; // 2 user.setNickName(\"lolico li\"); return user;&#125;åœ¨è®¿é—®UserControllerä¸­çš„ä»»ä½•ä¸€ä¸ªè¯·æ±‚å¤„ç†æ–¹æ³•å‰ï¼Œéƒ½ä¼šå…ˆæ‰§è¡ŒinitUserModalæ–¹æ³•ï¼Œå¹¶å°†å…¶è¿”å›å€¼ä»¥userä¸ºé”®æ·»åŠ åˆ°æ¨¡å‹ä¸­ã€‚ç”±äºhandleæ–¹æ³•ä½¿ç”¨å…¥å‚çº§çš„@ModelAttributeæ³¨è§£ï¼Œä¸”å±æ€§åå’Œâ‘ å¤„æ–¹æ³•ä¸Šçš„@ModelAttributeçš„å±æ€§åç›¸åŒã€‚è¿™æ—¶SpringMVCä¼šä»æ¨¡å‹ä¸­å–å‡ºâ‘ å¤„è·å¾—çš„æ¨¡å‹å±æ€§ï¼Œèµ‹ç»™â‘¡å¤„çš„userå¯¹è±¡ï¼Œç„¶åå†æ ¹æ®è¯·æ±‚æ¶ˆæ¯å¯¹usrè¿›è¡Œå±æ€§å¡«å……è¦†ç›–ï¼Œå¾—åˆ°ä¸€ä¸ªæ•´åˆç‰ˆæœ¬çš„userå¯¹è±¡ã€‚æ³¨æ„ï¼šå¤„ç†æ–¹æ³•çš„å…¥å‚æœ€å¤šåªèƒ½ä½¿ç”¨ä¸€ä¸ªSpringMVCæ³¨è§£ã€‚å¦‚handleæ–¹æ³•çš„userå…¥å‚ä½¿ç”¨äº†@ModelAttributeï¼Œå°±ä¸èƒ½å†ä½¿ç”¨@RequestParamæˆ–@CookieValue,@RequestHeaderç­‰æ³¨è§£ã€‚å¦‚æœä½¿ç”¨äº†ä¸¤ä¸ªã€‚å°†æŠ›å‡ºå¼‚å¸¸ã€‚@SessionAttributeå¯ä»¥ç”¨äºè·å–HttpSessionä¸­çš„å±æ€§ï¼Œåœ¨å…¥å‚æ–¹æ³•ä¸Šæ ‡æ³¨@SessionAttributeæ³¨è§£ï¼ŒSpringMVCä¼šå°†ä¼šè¯ä¸­å¯¹åº”çš„å±æ€§ç»‘å®šåˆ°å…¥å‚ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªå…·ä½“çš„å®ä¾‹ï¼š12345@PostMapping(\"/login\")public User login(@SessionAttribute(\"user\") User user) &#123; // do something return user;&#125;ä½†æ˜¯å¾ˆå¯æƒœï¼Œå½“å‘/loginå‘é€è¯·æ±‚æ—¶ï¼ŒSpringMVCä¼šæŠ›å‡ºå¼‚å¸¸ï¼šServletRequestBindingException: Missing session attribute â€˜userâ€™ of type Userä¸åŒäº@ModelAttributeï¼Œå¦‚æœåœ¨HttpSessionä¸­æ²¡æœ‰å¯¹åº”çš„å±æ€§ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚é‚£è¿™æ ·çœ‹æ¥çš„è¯ï¼Œè¿™ä¸ªæ³¨è§£æ˜¯åªèƒ½ç”¨äºè·å–HttpSessionä¸­çš„å±æ€§å—ï¼Ÿå½“ç„¶ä¸æ˜¯è¿™æ ·çš„ï¼Œç±»ä¼¼@ModelAttributeæ³¨è§£ï¼Œ@SessionAttributeè¿˜ä¼šåœ¨æ–¹æ³•æ‰§è¡Œå®Œæ¯•åï¼Œå°†æ ‡æ³¨è¯¥æ³¨è§£çš„å…¥å‚å¯¹è±¡å†æ”¾å›åˆ°HttpSessionä¸­ï¼Œåˆ©ç”¨è¿™ä¸€ç‰¹æ€§æˆ‘ä»¬å¯ä»¥åœ¨æ–¹æ³•ä¸­å¯¹æŸä¸ªä¼šè¯å±æ€§è¿›è¡Œâ€œæ›´æ–°â€ã€‚é‚£è¯¥å¦‚ä½•å‘ä¼šè¯åŸŸä¸­æ·»åŠ å±æ€§å‘¢ï¼Ÿä½¿ç”¨ServletåŸç”ŸAPIä¸­çš„HttpSessionä½œä¸ºå…¥å‚æ—¶ï¼ŒSpringMVCä¼šå°†è¯·æ±‚ä¼šè¯ç»‘å®šåˆ°å…¥å‚ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥æ“ä½œè¿™ä¸ªå¯¹è±¡å»è®¾ç½®ä¼šè¯å±æ€§ã€‚ä½¿ç”¨SpringMVCæä¾›çš„åŸç”ŸServlet APIçš„ä»£ç†ç±»WebRequestä½œä¸ºå…¥å‚ï¼Œä½¿ç”¨WebRequest#setAttribute(String name, Object value, int scope)æ–¹æ³•å¯åŒæ—¶æ”¯æŒå‘è¯·æ±‚åŸŸæˆ–æ˜¯ä¼šè¯åŸŸä¸­æ·»åŠ å±æ€§ã€‚@SessionAttributeså¦‚æœå¸Œæœ›åœ¨å¤šä¸ªè¯·æ±‚ä¹‹é—´å…±äº«æŸä¸ªæ¨¡å‹å±æ€§æ•°æ®ï¼Œåˆ™å¯ä»¥åœ¨æ§åˆ¶å™¨ç±»ä¸Šæ ‡æ³¨ä¸€ä¸ª@SessionAttributesï¼ŒSpringMVCä¼šå°†æ¨¡å‹ä¸­å¯¹åº”çš„å±æ€§æš‚å­˜åˆ°HttpSessionä¸­ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿåé¢ä¼šæ…¢æ…¢åˆ†æï¼Œå…ˆæ¥çœ‹ä¸€ä¸ª@SessionAttributesä½¿ç”¨å®ä¾‹ï¼šUserController.java12345678910111213141516171819202122232425/** * @author Lolico li */@Controller@RequestMapping(\"/user\")@SessionAttributes(\"user\") // 1 ä¼šå°†2å¤„çš„æ¨¡å‹å±æ€§é€æ˜çš„ä¿å­˜åˆ°HttpSessionä¸­public class UserController &#123; @GetMapping(\"/h1\") // 2 public String handle1(@ModelAttribute(\"user\") User user) &#123; user.setNickName(\"lolico li\"); return \"redirect:/user/h2\"; &#125; @ResponseBody @GetMapping(\"/h2\") public ResponseEntity&lt;Object&gt; handle2(ModelMap modelMap, SessionStatus sessionStatus) &#123; User user = (User) modelMap.get(\"user\"); if (user != null) &#123; user.setNickName(\"griouges\"); sessionStatus.setComplete(); &#125; return ResponseEntity.ok().build(); &#125;&#125;åœ¨â‘ å¤„æ ‡æ³¨çš„@SessionAttributes(&quot;user&quot;)ä¼šè‡ªåŠ¨å°†æœ¬å¤„ç†å™¨çš„ä»»ä½•å¤„ç†æ–¹æ³•ä¸­å±æ€§åä¸ºuserçš„æ¨¡å‹å±æ€§é€æ˜åœ°å­˜å‚¨åˆ°HttpSessionä¸­ã€‚åœ¨â‘¡å¤„ï¼Œhandler1æ–¹æ³•çš„userå…¥å‚ä¼šæ·»åŠ åˆ°éšå«æ¨¡å‹ä¸­ï¼Œäºæ˜¯è¿™ä¸ªæ¨¡å‹å±æ€§åœ¨handle1æ–¹æ³•æ‰§è¡Œæ—¶ï¼ŒSpringMVCä¼šå°†å…¶é€æ˜çš„ä¿å­˜åˆ°HttpSessionä¸­ã€‚handle1è¿”å›çš„é€»è¾‘è§†å›¾åä¸ºredirect:/user/h2ï¼Œé‡å®šå‘å‘é€å¦ä¸€ä¸ªè¯·wæ±‚ã€‚è€Œè¿™ä¸ªè¯·æ±‚ç”±handle2æ–¹æ³•è´Ÿè´£å¤„ç†ã€‚ä¸¤ä¸ªå¤„ç†æ–¹æ³•ä½äºä¸åŒçš„è¯·æ±‚ä¸Šä¸‹æ–‡ä¸­ï¼Œä¹‹æ‰€ä»¥handle2å¯ä»¥è·å–åä¸ºuserçš„æ¨¡å‹å±æ€§ï¼Œå°±æ˜¯å› ä¸º@SessionAttributes(&quot;user&quot;)é€æ˜çš„å°†handle1çš„useræ¨¡å‹å±æ€§å­˜å‚¨åˆ°HttpSessionä¸­ï¼Œè€Œhandler2çš„éšå«æ¨¡å‹åˆè‡ªåŠ¨ä»HttpSessionä¸­è·å–åˆ°è¿™ä¸ªæ¨¡å‹å±æ€§ã€‚ï¼ˆPSï¼šä¸€èˆ¬è¿™ç§æƒ…å†µæˆ‘ä»¬ä½¿ç”¨forwardè½¬å‘ï¼Œè¿™é‡Œé‡å®šå‘æ˜¯ä¸ºäº†æ¼”ç¤º@SessionAttributesæ³¨è§£åœ¨ä¸åŒè¯·æ±‚ä¸Šä¸‹æ–‡ä¸­å…±äº«æ¨¡å‹å±æ€§çš„ä½œç”¨ï¼‰handle2æ–¹æ³•è¿˜åŒ…å«ä¸€ä¸ªSessionStatuså¯¹è±¡ï¼Œå½“è°ƒç”¨SessionStatus#setCompleteæ–¹æ³•ï¼ŒSpringMVCä¼šæ¸…é™¤æ§åˆ¶å™¨ç±»çš„æ‰€æœ‰ä¼šè¯å±æ€§ï¼›å¦åˆ™è¿™ä¸ªä¼šè¯å±æ€§ä¼šä¸€ç›´ä¿å­˜åœ¨HttpSessionä¸­ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¯´@SessionAttributesæ˜¯å°†æ¨¡å‹å±æ€§æš‚å­˜åˆ°HttpSessionä¸­çš„åŸå› ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡HttpSession#removeAttribute(String name)æ–¹æ³•æ‰‹åŠ¨åˆ é™¤ä¼šè¯å±æ€§ï¼Œä½†æ˜¯éœ€è¦æä¾›å±æ€§åï¼Œç¡¬ç¼–ç æ˜¯ä¸æå€¡ä¸”ä¸æ–¹ä¾¿çš„ã€‚è®²äº†è¿™ä¹ˆå¤šï¼Œä½†æ˜¯å¾ˆå¯æƒœï¼Œå½“å‘/h1å‘é€è¯·æ±‚æ—¶ï¼ŒSpringMVCæŠ›å‡ºå¼‚å¸¸ï¼šHttpSessionRequiredException: Session attribute â€˜userâ€™ required - not found in sessionè¿™ä¸ªå¼‚å¸¸å¾ˆå¥‡æ€ªï¼Œå› ä¸ºSpringä»…å®£ä¼ @SessionAttributesçš„ä½œç”¨æ˜¯å°†å¤„ç†æ–¹æ³•å¯¹åº”çš„æ¨¡å‹å±æ€§é€æ˜çš„ä¿å­˜åˆ°HttpSessionä¸­ï¼Œå¹¶æ²¡æœ‰è¦æ±‚HttpSessionä¸­å¿…é¡»äº‹å…ˆæ‹¥æœ‰å¯¹åº”çš„æ¨¡å‹å±æ€§ã€‚é€šè¿‡ç ”ç©¶SpringMVCçš„æºç ï¼Œæ‰æ‰¾åˆ°äº†é—®é¢˜çš„ç­”æ¡ˆã€‚åŸæ¥SpringMVCå¯¹@ModelAttributeã€@SessionAttributesçš„å¤„ç†éµå¾ªä¸€ä¸ªæµç¨‹ï¼Œå½“æµç¨‹æ¡ä»¶ä¸æ»¡è¶³æ—¶å°±ä¼šæŠ¥é”™ã€‚å¤„ç†æµç¨‹ç®€å•è¯´æ˜å¦‚ä¸‹ï¼šSpringMVCåœ¨è°ƒç”¨å¤„ç†æ–¹æ³•å‰ï¼Œåœ¨è¯·æ±‚çš„çº¿ç¨‹ä¸­è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªéšå«çš„æ¨¡å‹å¯¹è±¡ã€‚è°ƒç”¨æ‰€æœ‰æ ‡æ³¨äº†@ModelAttributeçš„æ–¹æ³•ï¼Œå¹¶å°†æ–¹æ³•è¿”å›å€¼æ·»åŠ åˆ°éšå«å¯¹è±¡ã€‚æŸ¥çœ‹Sessionä¸­æ˜¯å¦å­˜åœ¨@SessionAttributes(&quot;xxx&quot;)æ‰€æŒ‡å®šçš„xxxå±æ€§ï¼Œå¦‚æœæœ‰ï¼Œåˆ™å°†å…¶æ·»åŠ åˆ°éšå«æ¨¡å‹ä¸­ã€‚å¦‚æœæ¨¡å‹ä¸­å·²æœ‰xxxå±æ€§ï¼Œåˆ™è¦†ç›–å·²æœ‰çš„ã€‚å¯¹æ ‡æ³¨äº†@ModelAttribute(&quot;xxx&quot;)å¤„ç†æ–¹æ³•çš„å…¥å‚æŒ‰ä»¥ä¸‹æµç¨‹å¤„ç†ã€‚å¦‚æœéšå«æ¨¡å‹æ‹¥æœ‰åä¸ºxxxçš„å±æ€§ï¼Œåˆ™å°†å…¶èµ‹ç»™è¯¥å…¥å‚ï¼Œå†ç”¨è¯·æ±‚æ¶ˆæ¯å¡«å……è¯¥å…¥å‚å¯¹è±¡ç›´æ¥è¿”å›ï¼Œå¦åˆ™è½¬åˆ°4.2ã€‚å¦‚æœxxxæ˜¯ä¼šè¯å±æ€§ï¼Œå³åœ¨å¤„ç†ç±»ä¸Šæ ‡æ³¨äº†@SessionAttributes(&quot;xxx&quot;)ï¼Œåˆ™å°è¯•ä»ä¼šè¯ä¸­è·å–è¯¥å±æ€§ï¼Œå¹¶å°†å…¶èµ‹ç»™è¯¥å…¥å‚ï¼Œç„¶åå†ç”¨è¯·æ±‚æ¶ˆæ¯å¡«å……è¯¥å…¥å‚å¯¹è±¡ã€‚å¦‚æœåœ¨ä¼šè¯ä¸­æ‰¾ä¸åˆ°å¯¹åº”çš„å±æ€§ï¼Œåˆ™æŠ›å‡ºHttpSessionRequiredExceptionå¼‚å¸¸ã€‚å¦åˆ™è½¬åˆ°4.3ã€‚å¦‚æœéšå«æ¨¡å‹ä¸­ä¸å­˜åœ¨xxxå±æ€§ï¼Œä¸”xxxä¹Ÿä¸æ˜¯ä¼šè¯å±æ€§ï¼Œåˆ™åˆ›å»ºå…¥å‚çš„å¯¹è±¡å®ä¾‹ï¼Œç„¶åå†ç”¨è¯·æ±‚æ¶ˆæ¯å¡«å……è¯¥å…¥å‚ã€‚åˆ†æä¸Šé¢çš„ä»£ç ï¼Œç”±äºåœ¨å¤„ç†å™¨ç±»ä¸Šæ ‡æ³¨äº†@SessionAttributes(&quot;user&quot;)ï¼Œæ‰€ä»¥userä¸ºä¼šè¯å±æ€§ï¼Œåœ¨å¯¹handle1è¿›è¡Œå¤„ç†æ—¶ä¼šå…ˆåœ¨éšå«æ¨¡å‹ä¸­æŸ¥æ‰¾å¯¹åº”å±æ€§ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ç»§ç»­åœ¨ä¼šè¯ä¸­æŸ¥æ‰¾è¿™ä¸ªå±æ€§ã€‚ç”±äºä¼šè¯ä¸­ä¹Ÿä¸å­˜åœ¨ï¼Œå› æ­¤æŠ›å‡ºHttpSessionRequiredExceptionå¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯è¯´èµ°åˆ°äº†ä¸Šé¢çš„æµç¨‹çš„4.2ä¸­ã€‚è§£å†³è¿™ä¸ªå¼‚å¸¸çš„æ–¹æ³•å¾ˆç®€å•ï¼Œæ·»åŠ ä¸€ä¸ªæ ‡æ³¨äº†@ModelAttribute(&quot;user&quot;)çš„æ–¹æ³•ï¼Œä½¿å¾—åœ¨è®¿é—®å¤„ç†æ–¹æ³•å‰å…ˆå‘éšå«æ¨¡å‹ä¸­æ·»åŠ userå±æ€§ï¼Œè¿™æ ·4.1æ­¥å°±ä¼šæ‰§è¡Œï¼Œè€Œ4.2ä¸­ä¹Ÿå°±èƒ½åœ¨éšå«æ¨¡å‹ä¸­æ‰¾åˆ°å¯¹åº”å±æ€§ï¼Œä¸ä¼šæŠ¥é”™ã€‚æ€»ç»“@ModelAttributeæ³¨è§£åœ¨æ–¹æ³•å…¥å‚ä¸Šæ—¶å°±ç®—æ¨¡å‹ä¸­æ²¡æœ‰ä¹Ÿä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼ˆå‚è€ƒä¸Šè¿°æµç¨‹çš„ç¬¬1æ­¥ï¼‰ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå®Œæ¯•åé€æ˜çš„å°†å…¶æ”¾å…¥æ¨¡å‹ä¸­ï¼Œä½œç”¨åŸŸä¸ºè¯·æ±‚åŸŸï¼Œç±»ä¼¼äºServletRequest#setAttributeï¼›æ³¨è§£åœ¨æ–¹æ³•ä¸Šæ—¶ï¼Œå¤„ç†æ–¹æ³•æ‰§è¡Œå‰ä¼šå…ˆæ‰§è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œå¹¶å°†è¿”å›å€¼æ”¾å…¥æ¨¡å‹ä¸­ã€‚@SessionAttributeåªèƒ½æ³¨è§£åœ¨æ–¹æ³•å‚æ•°ï¼Œç”¨äºè®¿é—®Sessionä¸­çš„å±æ€§ï¼Œæ–¹æ³•æ‰§è¡Œå®Œæ¯•åä¼šå†å°†å…¶æ”¾å…¥HttpSessionä¸­ï¼Œè¦æ±‚HttpSessionä¸­å¿…é¡»äº‹å…ˆæ‹¥æœ‰å¯¹åº”å±æ€§ï¼Œå¦åˆ™æŠ›å‡ºServletRequestBindingExceptionï¼šMissing session attributeå¼‚å¸¸ï¼Œå¯è®¾ç½®require=falseï¼Œä½œç”¨åŸŸä¸ºä¼šè¯åŸŸï¼Œç±»ä¼¼äºHttpSession#setAttribute@SessionAttributeså¯ä»¥å°†æŒ‡å®šçš„æ¨¡å‹å±æ€§æš‚å­˜åˆ°HttpSessionä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªä½œç”¨æ˜¯å°†Sessionä¸­çš„å±æ€§å¡«å……è‡³æ¨¡å‹å±æ€§ä¸­ï¼ˆå‚è€ƒä¸Šè¿°æµç¨‹çš„ç¬¬2æ­¥ï¼‰ï¼Œä½¿å¾—æ–¹æ³•å…¥å‚çº§çš„@ModelAttributeå¯ä»¥è®¿é—®åˆ°ã€‚æ³¨æ„åŒºåˆ†@SessionAttributeå’Œ@SessionAttributesçš„ä¸åŒ","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"https://lolico.me/tags/Spring/"},{"name":"Web","slug":"Web","permalink":"https://lolico.me/tags/Web/"}]},{"title":"è§£ææ—¥æœŸå­—ç¬¦ä¸²æ ¼å¼å¹¶è½¬æ¢","slug":"è§£ææ—¥æœŸå­—ç¬¦ä¸²æ ¼å¼å¹¶è½¬æ¢","date":"2019-07-21T10:01:21.000Z","updated":"2022-03-06T10:28:21.347Z","comments":true,"path":"2019/07/21/è§£ææ—¥æœŸå­—ç¬¦ä¸²æ ¼å¼å¹¶è½¬æ¢/","link":"","permalink":"https://lolico.me/2019/07/21/%E8%A7%A3%E6%9E%90%E6%97%A5%E6%9C%9F%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%BC%E5%BC%8F%E5%B9%B6%E8%BD%AC%E6%8D%A2/","excerpt":"","text":"åˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ—¥æœŸå­—ç¬¦ä¸²æ ¼å¼å¹¶è½¬æ¢1234567891011121314151617181920212223242526272829303132public class DateConverter &#123; public static Date parseDate(String dateStr, String format) throws ParseException &#123; return new Date(new SimpleDateFormat(format).parse(dateStr).getTime()); &#125; public static String formatDate(Date date, String format) &#123; return new SimpleDateFormat(format).format(date); &#125; public Date convert(String source) &#123; if (source == null) return null; source = source.trim(); if (\"\".equals(source)) return null; try &#123; if (source.matches(\"^\\\\d&#123;4&#125;-\\\\d&#123;1,2&#125;-\\\\d&#123;1,2&#125;$\"))//yyyy-MM-dd return parseDate(source, \"yyyy-MM-dd\"); else if (source.matches(\"^\\\\d&#123;4&#125;/\\\\d&#123;1,2&#125;/\\\\d&#123;1,2&#125;$\"))//yyyy/MM/dd return parseDate(source, \"yyyy/MM/dd\"); else if (source.matches(\"^\\\\d&#123;4&#125;-\\\\d&#123;1,2&#125;-\\\\d&#123;1,2&#125; \\\\d&#123;1,2&#125;:\\\\d&#123;1,2&#125;:\\\\d&#123;1,2&#125;$\"))//yyyy-MM-dd HH:mm:ss return parseDate(source, \"yyyy-MM-dd HH:mm:ss\"); else if (source.matches(\"^\\\\d&#123;4&#125;/\\\\d&#123;1,2&#125;/\\\\d&#123;1,2&#125; \\\\d&#123;1,2&#125;:\\\\d&#123;1,2&#125;:\\\\d&#123;1,2&#125;$\"))//yyyy/MM/dd HH:mm:ss return parseDate(source, \"yyyy/MM/dd HH:mm:ss\"); else throw new IllegalArgumentException(\"Invalid date value '\" + source + \"'\"); &#125; catch (ParseException e) &#123; e.printStackTrace(); &#125; return null; &#125;&#125;","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://lolico.me/tags/Java/"}]},{"title":"Iteratorå’ŒIterableæ¥å£","slug":"Iteratorå’ŒIterableæ¥å£","date":"2018-11-14T08:30:32.000Z","updated":"2022-03-06T10:28:21.343Z","comments":true,"path":"2018/11/14/Iteratorå’ŒIterableæ¥å£/","link":"","permalink":"https://lolico.me/2018/11/14/Iterator%E5%92%8CIterable%E6%8E%A5%E5%8F%A3/","excerpt":"","text":"é€šå¸¸æƒ…å†µä¸‹,æˆ‘ä»¬ä½¿ç”¨é›†åˆæ¡†æ¶æ—¶ä¼šå¸Œæœ›èƒ½å¤Ÿéå†ä¸€ä¸ªé›†åˆä¸­çš„å…ƒç´ ã€‚ä¾‹å¦‚ï¼Œæ˜¾ç¤ºé›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚ä¸€èˆ¬çš„ï¼Œæˆ‘ä»¬éƒ½æ˜¯é‡‡ç”¨forå¾ªç¯æˆ–å¢å¼ºforï¼ˆfor-eachï¼‰ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•ä¹Ÿå¯ä»¥ç”¨åœ¨é›†åˆæ¡†æ¶ã€‚ä½†æ˜¯åœ¨é›†åˆæ¡†æ¶ä¸­è¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯é‡‡ç”¨è¿­ä»£å™¨éå†é›†åˆæ¡†æ¶ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ç°äº†Iteratoræ¥å£æˆ–ListIteratoræ¥å£ã€‚è¿­ä»£å™¨ï¼ˆIteratorï¼‰ï¼Œä½¿ä½ èƒ½å¤Ÿé€šè¿‡å¾ªç¯æ¥å¾—åˆ°æˆ–åˆ é™¤é›†åˆçš„å…ƒç´ ã€‚ListIteratorï¼Œç»§æ‰¿äº†Iteratorä»¥å…è®¸åŒå‘éå†åˆ—è¡¨å’Œä¿®æ”¹å…ƒç´ ã€‚ä¸¤ä¸ªé—®é¢˜ä»€ä¹ˆæ˜¯foreachå¾ªç¯ï¼Ÿfor-eachæ˜¯å¢å¼ºå‹çš„forå¾ªç¯ï¼Œæ˜¯Java5çš„æ–°ç‰¹æ€§ä¹‹ä¸€ã€‚foreachè¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š123for(å…ƒç´ ç±»å‹t å…ƒç´ å˜é‡x : éå†å¯¹è±¡obj)&#123; å¼•ç”¨äº†xçš„javaè¯­å¥&#125;ä»€ä¹ˆæ—¶å€™å¯ä»¥ä½¿ç”¨foreachè¿›è¡Œéå†ï¼Ÿå¯ä»¥è¢«foreachéå†çš„å¯¹è±¡åˆ†ä¸¤ç§ï¼šæ•°ç»„javaå¯¹äºæ•°ç»„çš„foreachå¤„ç†ç›¸å¯¹æ¥è¯´ç®€å•ã€‚åœ¨ç¼–è¯‘æœŸå°†foreachè¿˜åŸæˆç®€å•çš„forå¾ªç¯ã€‚å®ç°äº†Iterableæ¥å£çš„å¯¹è±¡å®ç°äº†Iterableæ¥å£çš„å¯¹è±¡ï¼Œå¯ä»¥è¢«foreachã€‚å¹¶ä¸”javaä¼šé€šè¿‡è¿­ä»£å™¨çš„å½¢å¼æ¥éå†ä»–ã€‚Iterableæ¥å£ï¼šæ•…åæ€è®®ï¼Œå®ç°äº†è¿™ä¸ªæ¥å£çš„é›†åˆå¯¹è±¡æ”¯æŒè¿­ä»£ï¼Œæ˜¯å¯è¿­ä»£çš„ã€‚Iteratoræ¥å£ï¼šè¿­ä»£å™¨ï¼Œå®ƒå°±æ˜¯æä¾›è¿­ä»£æœºåˆ¶çš„å¯¹è±¡ï¼Œå…·ä½“å¦‚ä½•è¿­ä»£ï¼Œéƒ½æ˜¯Iteratoræ¥å£è§„èŒƒçš„ã€‚Iterableå’ŒIteratorIterableæˆ‘ä»¬çœ‹çœ‹Iterableæ¥å£çš„ç”¨é€”æ˜¯ä»€ä¹ˆï¼š123456789101112&#x2F;** * Implementing this interface allows an object to be the target of * the &quot;for-each loop&quot; statement. See * &lt;strong&gt; * &lt;a href&#x3D;&quot;&#123;@docRoot&#125;&#x2F;..&#x2F;technotes&#x2F;guides&#x2F;language&#x2F;foreach.html&quot;&gt;For-each Loop&lt;&#x2F;a&gt; * &lt;&#x2F;strong&gt; * * @param &lt;T&gt; the type of elements returned by the iterator * * @since 1.5 * @jls 14.14.2 The enhanced for statement *&#x2F;å®ç°è¿™ä¸ªæ¥å£ï¼Œå…è®¸ä¸€ä¸ªå¯¹è±¡æˆä¸ºfor-eachçš„ç›®æ ‡å†æ¥çœ‹çœ‹æ¥å£ä¸­å®šä¹‰äº†å“ªäº›éœ€è¦å®ç°çš„æ–¹æ³•Iterable.java12345678public interface Iterable&lt;T&gt; &#123; /** * Returns an iterator over elements of type &#123;@code T&#125;. * * @return an Iterator. */ Iterator&lt;T&gt; iterator();&#125;ä¸Šé¢æˆ‘ä»¬è¯´è¿‡äº†ï¼Œå®ç°äº†Iterableæ¥å£çš„å¯¹è±¡ï¼Œå¯ä»¥è¢«foreachã€‚å¹¶ä¸”javaä¼šé€šè¿‡è¿­ä»£å™¨çš„å½¢å¼æ¥éå†ä»–ã€‚Iterableæ¥å£ä¸­çš„Iterator&lt;T&gt; iterator()æ–¹æ³•è¿”å›çš„å°±æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼ˆIterator)IteratoråŒ…å«2ä¸ªéœ€è¦å®ç°çš„æ–¹æ³•ï¼šhasNext()ã€next() å’Œä¸€ä¸ªé»˜è®¤æ–¹æ³•remove()ã€‚æˆ‘ä»¬ä»¥ArrayListä¸ºä¾‹ï¼š12List&lt;Object&gt; list=new ArrayList&lt;&gt;();for(Object obj:list);ç¼–è¯‘åæŸ¥çœ‹classæ–‡ä»¶:12345List&lt;Object&gt; list &#x3D; new ArrayList();Object var3;for(Iterator var2 &#x3D; list.iterator(); var2.hasNext(); var3 &#x3D; var2.next()) &#123;&#125;å¯ä»¥çœ‹åˆ°æ˜¯ä½¿ç”¨äº†è¿­ä»£å™¨æ¥éå†é›†åˆ,é¦–å…ˆè·å–é›†åˆçš„è¿­ä»£å™¨åè°ƒç”¨hasNext()æ–¹æ³•åˆ¤æ–­æ˜¯å¦è¿­ä»£åˆ°ç»ˆç‚¹,next()æ–¹æ³•ä¸ä»…è¦è¿”å›é›†åˆå…ƒç´ ï¼ˆä¸‹ä¸€ä¸ªï¼‰,è¿˜è¦å°†è¿­ä»£å™¨çš„æ¸¸æ ‡åç§»ã€‚å®šä¹‰ä¸€ä¸ªå®ç°äº†Iterableæ¥å£çš„ç±»IterableTester.java123456789101112131415161718192021222324252627282930313233343536373839404142434445464748public class IterableTester&lt;E&gt; implements Iterable&lt;E&gt; &#123; private Object[] elements = &#123;&#125;; //å­˜æ”¾æ³›å‹å¯¹è±¡çš„æ•°ç»„,å–å‡ºæ—¶éœ€è¦è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ private int size = 0; IterableTester(int initialCapacity) &#123; if (initialCapacity &gt; 0) &#123; elements = new Object[initialCapacity]; &#125; &#125; public boolean add(E element) &#123; if (size &lt; elements.length) &#123; elements[size] = element; size++; return true; &#125; else &#123; return false; &#125; &#125; public E get(int index) &#123; //rangeCheck(index); return (E) elements[index]; //å­˜æ”¾åœ¨Objectç±»å‹çš„æ•°ç»„ä¸­ï¼Œæ‰€ä»¥åœ¨å–å‡ºçš„æ—¶å€™ï¼Œéœ€è¦è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚ &#125; @Override public Iterator&lt;E&gt; iterator() &#123; return new itr(); //è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ &#125; //å†…éƒ¨ç±»,å®ç°Iteratoræ¥å£ private class itr implements Iterator&lt;E&gt; &#123; int cursor = 0; @Override public boolean hasNext() &#123; //å¦‚æœæ¸¸æ ‡ä¸ç­‰äºå…ƒç´ ä¸ªæ•°,åˆ™è¿˜æœ‰ä¸‹ä¸€ä¸ª return cursor != size; &#125; @Override public E next() &#123; if (cursor &gt;= size || cursor &gt;= elements.length) throw new RuntimeException(); return (E) elements[cursor++]; &#125; &#125;&#125;æ‰§è¡Œfor-eachçš„æ—¶å€™ï¼Œä¼šå…ˆè°ƒç”¨iterator()æ–¹æ³•è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ã€‚ç„¶åè°ƒç”¨è¿­ä»£å™¨çš„hasNext()å’Œnext()æ–¹æ³•æ¥è¿›è¡Œéå†ã€‚æµ‹è¯•æ ·ä¾‹11234567IterableTester&lt;String&gt; its = new IterableTester&lt;&gt;(5);its.add(new String(\"i \"));its.add(new String(\"am \"));its.add(new String(\"a \"));its.add(new String(\"coder\"));for (String s : its) System.out.print(s);è¾“å‡ºi am coderéœ€è¦æ³¨æ„çš„åœ°æ–¹è¿­ä»£å‡ºæ¥çš„å…ƒç´ éƒ½æ˜¯åŸé›†åˆå…ƒç´ çš„æ‹·è´Javaé›†åˆä¸­ä¿å­˜çš„å…ƒç´ å®è´¨æ˜¯å¯¹è±¡çš„å¼•ç”¨(å¯ä»¥ç†è§£ä¸ºCä¸­çš„æŒ‡é’ˆ)ï¼Œè€Œéå¯¹è±¡æœ¬èº«ã€‚è¿­ä»£å‡ºçš„å…ƒç´ ä¹Ÿå°±éƒ½æ˜¯å¼•ç”¨çš„æ‹·è´ï¼Œç»“æœè¿˜æ˜¯å¼•ç”¨ã€‚é‚£ä¹ˆï¼Œå¦‚æœé›†åˆä¸­ä¿å­˜çš„å…ƒç´ æ˜¯å¯å˜ç±»å‹çš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿­ä»£å‡ºçš„å…ƒç´ ä¿®æ”¹åŸé›†åˆä¸­çš„å¯¹è±¡ã€‚è€Œå¯¹äºä¸å¯å˜ç±»å‹ï¼Œå¦‚Stringæˆ–è€…åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»å‹Integerç­‰åˆ™ä¸ä¼šååº”åˆ°åŸé›†åˆä¸­ã€‚æµ‹è¯•æ ·ä¾‹212345678910111213141516171819202122232425262728public class Main &#123; public static void main(String[] args) &#123; IterableTester&lt;Person&gt; itp = new IterableTester&lt;&gt;(5); ArrayList&lt;String&gt; als = new ArrayList&lt;&gt;(); Person p = new Person(\"Tom\"); itp.add(p); als.add(new String(\"Tom\")); for (Person p_ : itp) p_.setName(\"Jack\"); //ä¿®æ”¹äº†åŸé›†åˆä¸­çš„å…ƒç´ (Personå¯¹è±¡) for (String s_ : als) s_ = \"Jack\"; //å®é™…ä¸Šæ˜¯S_=new String(\"Jack\"),å¹¶æ²¡æœ‰å¯¹åŸé›†åˆä¸­çš„å…ƒç´ è¿›è¡Œä¿®æ”¹ System.out.println(itp.get(0).getName()); System.out.println(als.get(0)); &#125;&#125;class Person &#123; private String name; Person(String name) &#123; this.name = name; &#125; public void setName(String name) &#123; this.name = name; &#125; public String getName() &#123; return name; &#125;&#125;è¾“å‡º12JackTomå€¼å¾—æ€è€ƒçš„é—®é¢˜æ—¢ç„¶è¯´:è¿­ä»£å‡ºæ¥çš„å…ƒç´ éƒ½æ˜¯åŸé›†åˆå…ƒç´ çš„æ‹·è´,å¦‚æœé›†åˆä¸­ä¿å­˜çš„å…ƒç´ æ˜¯å¯å˜ç±»å‹çš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿­ä»£å‡ºçš„å…ƒç´ ä¿®æ”¹åŸé›†åˆä¸­çš„å¯¹è±¡ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä¸å¯ä»¥åœ¨å°†è¿­ä»£å…ƒç´ ä¿®æ”¹æ—¶å´ä¸å½±å“åŸé›†åˆå…ƒç´ å‘¢?ç­”æ¡ˆæ˜¯è‚¯å®šçš„,å¤§æ¦‚æœ‰ä¸¤ä¸ªå®ç°çš„æ–¹æ³•(è¿™é‡Œåªè¯´ä¸€ä¸‹å¤§æ¦‚çš„æ€è·¯):å°†é›†åˆå®šä¹‰æˆä¸å¯å˜ç±»,å…·ä½“å¯çœ‹æˆ‘çš„è¿™ç¯‡åšæ–‡ï¼šåœ¨å®ç°Iterator#nextæ–¹æ³•æ—¶,è¿”å›é›†åˆå…ƒç´ çš„ä¸€ä¸ªå…‹éš†,å…·ä½“å¯çœ‹æˆ‘çš„è¿™ç¯‡åšæ–‡ï¼š","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://lolico.me/tags/Java/"}]},{"title":"response.getWriter()å’Œå†…ç½®å¯¹è±¡outçš„åŒºåˆ«","slug":"response-getWriter-å’Œå†…ç½®å¯¹è±¡outçš„åŒºåˆ«","date":"2018-11-03T08:25:16.000Z","updated":"2022-03-06T10:28:21.347Z","comments":true,"path":"2018/11/03/response-getWriter-å’Œå†…ç½®å¯¹è±¡outçš„åŒºåˆ«/","link":"","permalink":"https://lolico.me/2018/11/03/response-getWriter-%E5%92%8C%E5%86%85%E7%BD%AE%E5%AF%B9%E8%B1%A1out%E7%9A%84%E5%8C%BA%E5%88%AB/","excerpt":"","text":"é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“çš„æ˜¯:responseå¯¹è±¡å’Œoutå¯¹è±¡éƒ½æ˜¯jspå†…ç½®çš„éšå¼å¯¹è±¡ã€‚outæ˜¯JSPä¹å¤§å†…ç½®å¯¹è±¡ä¹‹ä¸€ï¼Œæ˜¯JspWriterçš„ä¸€ä¸ªå¯¹è±¡ï¼ŒJspWriterç»§æ‰¿äº†java.io.Writerç±»ã€‚response.getWriter()è¿”å›çš„æ˜¯PrintWriterçš„ä¸€ä¸ªå¯¹è±¡ï¼ŒPrintWriteråŒæ ·ç»§æ‰¿äº†java.io.Writerç±»ã€‚ä¸¤è€…çš„ä¸»è¦åŒºåˆ«ä¸¤è€…çš„ç±»å‹ä¸ä¸€æ ·ï¼šå†…ç½®å¯¹è±¡outçš„ç±»å‹æ˜¯JspWriterï¼Œresponse.getWrite()è¿”å›çš„ç±»å‹æ˜¯PrintWriterã€‚outå’Œresponse.getWriter()çš„ç±»ä¸ä¸€æ ·ï¼Œä¸€ä¸ªæ˜¯JspWriterï¼Œå¦ä¸€ä¸ªæ˜¯PrintWriter,ä½†è¿™ä¸¤ä¸ªç±»éƒ½ç»§æ‰¿è‡ªjava.io.Writerï¼Œä¸åŒçš„æ˜¯JspWriteræ˜¯æŠ½è±¡ç±»ã€‚è·å–æ–¹å¼ä¸åŒï¼šJspWriteræ˜¯JSPçš„å†…ç½®å¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œå¯¹è±¡åoutæ˜¯ä¿ç•™å­—ï¼Œä¹Ÿåªèƒ½é€šè¿‡outæ¥è°ƒç”¨å…¶ç›¸å…³æ–¹æ³•ã€‚æ­¤å¤–è¿˜å¯ä»¥é€šè¿‡å†…ç½®å¯¹è±¡pageContextè°ƒç”¨æ–¹æ³•getOut()è·å¾—ï¼›PrintWriteråˆ™æ˜¯åœ¨ç”¨çš„æ—¶å€™éœ€è¦é€šè¿‡å†…ç½®å¯¹è±¡responseè°ƒç”¨getWriter()è·å¾—ã€‚JspWriterçš„print()æ–¹æ³•ä¼šæŠ›å‡ºIOExceptionï¼Œè€ŒPrintWriteråˆ™ä¸ä¼šã€‚outä¸ºjspçš„å†…ç½®å¯¹è±¡ï¼Œåˆ·æ–°jspé¡µé¢ï¼Œè‡ªåŠ¨åˆå§‹åŒ–è·å¾—outå¯¹è±¡ï¼Œæ‰€ä»¥ä½¿ç”¨outå¯¹è±¡æ˜¯éœ€è¦åˆ·æ–°é¡µé¢çš„ï¼Œè€Œresponse.getWriter()å“åº”ä¿¡æ¯é€šè¿‡outå¯¹è±¡è¾“å‡ºåˆ°ç½‘é¡µä¸Šï¼Œå½“å“åº”ç»“æŸæ—¶å®ƒè‡ªåŠ¨è¢«å…³é—­ï¼Œä¸jspé¡µé¢æ— å…³ï¼Œæ— éœ€åˆ·æ–°é¡µé¢ã€‚outçš„print()æ–¹æ³•å’Œprintln()æ–¹æ³•åœ¨ç¼“å†²åŒºæº¢å‡ºå¹¶ä¸”æ²¡æœ‰è‡ªåŠ¨åˆ·æ–°æ—¶å€™ä¼šäº§ç”ŸIOExceptionï¼Œè€Œresponse.getWrite()æ–¹æ³•çš„printå’Œprintlnä¸­éƒ½æ˜¯æŠ‘åˆ¶ioexceptionå¼‚å¸¸çš„ï¼Œä¸ä¼šæœ‰IOExceptionã€‚out.println(â€œâ€)å¹¶ä¸èƒ½ä½¿é¡µé¢å¸ƒå±€æ¢è¡Œï¼Œåªèƒ½ä»¤htmlä»£ç æ¢è¡Œï¼Œè¦å®ç°é¡µé¢å¸ƒå±€æ¢è¡Œå¯ä»¥out.println(â€œ&lt;/br&gt;â€)æ‰§è¡ŒåŸç†ä¸åŒ:ç¤ºä¾‹ï¼š1234&lt;%=\"aaaa\"%&gt;bbbb&lt;%out.write(\"cccc\");%&gt;&lt;%response.getWriter().write(\"dddd\");%&gt;æ³¨æ„ï¼šresponse.getWriter().print()å®é™…ä¸Šè°ƒç”¨çš„è¿˜æ˜¯writeæ–¹æ³•ï¼ŒPrintWriterä¸­print(String)æºç :123456public void print(String s) &#123; if (s == null) &#123; s = \"null\"; &#125; write(s);&#125;è¿è¡Œä¸Šé¢çš„ç¤ºä¾‹ä¼šåœ¨é¡µé¢è¾“å‡º:dddd aaaa bbbb ccccé¡ºåºä¸ºä»€ä¹ˆæ˜¯è¿™æ ·çš„å‘¢?ç¤ºä¾‹ä¸­çš„å‰ä¸‰ä¸ªæ–¹å¼ï¼Œåœ¨jspè¢«ç¿»è¯‘ä¸ºservletæ—¶ï¼Œéƒ½ä¼šè¢«ç¿»è¯‘ä¸ºout.write()æ–¹æ³•ï¼Œå½“æˆ‘ä»¬å‘é¡µé¢è¾“å‡ºå†…å®¹æ—¶ï¼ŒtomcatæœåŠ¡å™¨ä¼šé»˜è®¤å…ˆåˆ·æ–°responseç¼“å†²åŒºä¸­çš„å†…å®¹åˆ°ç½‘é¡µä¸­ã€‚è€Œoutå¯¹è±¡æœ¬èº«ä¹Ÿæœ‰ä¸ªoutç¼“å†²åŒºï¼Œå‰3ä¸ªæ–¹æ³•æ‰§è¡Œåè¦è¾“å‡ºçš„å†…å®¹å…ˆè¢«å­˜åˆ°outç¼“å†²åŒºå†…ï¼Œç„¶åå†è½¬ç§»åˆ°responseç¼“å†²åŒºä¸­è¢«tomcatæœåŠ¡å™¨æå–ï¼Œå› ä¸ºJspWriterç›¸å½“äºä¸€ä¸ªå¸¦ç¼“å­˜åŠŸèƒ½çš„printWriterï¼Œå®ƒä¸æ˜¯ç›´æ¥å°†æ•°æ®è¾“å‡ºåˆ°é¡µé¢ï¼Œè€Œæ˜¯å°†æ•°æ®åˆ·æ–°åˆ°responseçš„ç¼“å†²åŒºåå†è¾“å‡ºã€‚æ‰€ä»¥response.getWriter().print(String)ç›´æ¥è¾“å‡ºæ•°æ®ï¼Œout.print(String)åªèƒ½åœ¨å…¶åè¾“å‡ºã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥è®©1ã€2ã€3çš„å†…å®¹ç›´æ¥å­˜åˆ°responseç¼“å†²åŒºä¸­ã€‚è¿™æ˜¯å› ä¸ºï¼Œoutç¼“å†²åŒºå¯ä»¥é€šè¿‡æŒ‡ä»¤bufferæ¥è®¾ç½®å®ƒçš„ç¼“å­˜åŒºå¤§å°ï¼Œä¸€èˆ¬é»˜è®¤çš„æ˜¯8kbï¼Œå½“æˆ‘ä»¬è®¾ç½®ä¸ºbuffer=â€œ0kbâ€æ—¶ï¼Œå°±è®©outç¼“å†²åŒºå­˜å‚¨ç©ºé—´ä¸º0ï¼Œè¿™æ ·1ã€2ã€3æ–¹æ³•è¾“å‡ºçš„å†…å®¹å°±ä¼šç›´æ¥å­˜åˆ°responseç¼“å†²åŒºä¸­ã€‚","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Web","slug":"Web","permalink":"https://lolico.me/tags/Web/"},{"name":"Java","slug":"Java","permalink":"https://lolico.me/tags/Java/"},{"name":"JSP","slug":"JSP","permalink":"https://lolico.me/tags/JSP/"}]},{"title":"Jspä¸­includeæŒ‡ä»¤ä¸includeåŠ¨ä½œ","slug":"Jspä¸­includeæŒ‡ä»¤ä¸includeåŠ¨ä½œ","date":"2018-10-18T08:19:05.000Z","updated":"2022-03-06T10:28:21.343Z","comments":true,"path":"2018/10/18/Jspä¸­includeæŒ‡ä»¤ä¸includeåŠ¨ä½œ/","link":"","permalink":"https://lolico.me/2018/10/18/Jsp%E4%B8%ADinclude%E6%8C%87%E4%BB%A4%E4%B8%8Einclude%E5%8A%A8%E4%BD%9C/","excerpt":"","text":"å‰è¨€ï¼œ%@ include file=&quot; &quot;%ï¼ä¸ºæŒ‡ä»¤å…ƒç´ ï¼œjsp:include page=&quot; &quot; flush=&quot;true&quot;/ï¼ä¸ºåŠ¨ä½œå…ƒç´ includeæŒ‡ä»¤é€šè¿‡fileå±æ€§æŒ‡å®šè¢«åŒ…å«çš„æ–‡ä»¶ï¼Œå¹¶ä¸”fileå±æ€§ä¸æ”¯æŒä»»ä½•è¡¨è¾¾å¼ï¼›&lt;jsp:include&gt;æ ‡è¯†é€šè¿‡pageå±æ€§æŒ‡å®šè¢«åŒ…å«çš„æ–‡ä»¶ï¼Œè€Œpageå±æ€§æ”¯æŒJSPè¡¨è¾¾å¼ä½¿ç”¨includeæŒ‡ä»¤ï¼Œè¢«åŒ…å«çš„æ–‡ä»¶è¢«åŸå°ä¸åŠ¨çš„æ’å…¥åˆ°åŒ…å«é¡µé¢ä¸­ä½¿ç”¨è¯¥æŒ‡ä»¤çš„ä½ç½®ï¼Œç„¶åJSPç¼–è¯‘å™¨å†å¯¹è¿™ä¸ªåˆæˆçš„æ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼Œæ‰€ä»¥åœ¨ä¸€ä¸ªJSPé¡µé¢ä¸­ä½¿ç”¨includeæŒ‡ä»¤æ¥åŒ…å«å¦ä¸€ä¸ªJSPé¡µé¢ï¼Œæœ€ç»ˆç¼–è¯‘åçš„æ–‡ä»¶åªæœ‰ä¸€ä¸ªã€‚ï¼ˆé™æ€åŒ…å«ï¼‰ä½¿ç”¨&lt;jsp:include&gt;åŠ¨ä½œåŒ…å«æ–‡ä»¶æ—¶ï¼Œå½“è¯¥åŠ¨ä½œæ ‡è¯†æ‰§è¡Œåï¼ŒJSPç¨‹åºä¼šå°†è¯·æ±‚è½¬å‘åˆ°ï¼ˆæ³¨æ„ä¸æ˜¯é‡å®šå‘ï¼‰è¢«åŒ…å«é¡µé¢ï¼Œå¹¶å°†æ‰§è¡Œç»“æœè¾“å‡ºåˆ°æµè§ˆå™¨ä¸­ï¼Œç„¶åè¿”å›é¡µé¢ç»§ç»­æ‰§è¡Œåé¢çš„ä»£ç ï¼Œå› ä¸ºæœåŠ¡å™¨æ‰§è¡Œçš„æ˜¯å¤šä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥JSPç¼–è¯‘å™¨ä¼šåˆ†åˆ«å¯¹è¿™äº›æ–‡ä»¶è¿›è¡Œç¼–è¯‘ã€‚ï¼ˆåŠ¨æ€åŒ…å«ï¼‰åœ¨åº”ç”¨includeæŒ‡ä»¤åŒ…å«æ–‡ä»¶æ—¶ï¼Œç”±äºè¢«åŒ…å«çš„æ–‡ä»¶æœ€ç»ˆä¼šç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥åœ¨è¢«åŒ…å«æ–‡ä»¶ã€åŒ…å«çš„æ–‡ä»¶ä¸­ä¸èƒ½æœ‰é‡åçš„å˜é‡æˆ–æ–¹æ³•ï¼›è€Œåœ¨åº”ç”¨&lt;jsp:include&gt;åŠ¨ä½œæ ‡è¯†åŒ…å«æ–‡ä»¶æ—¶ï¼Œç”±äºæ¯ä¸ªæ–‡ä»¶æ˜¯å•ç‹¬ç¼–è¯‘çš„ï¼Œæ‰€ä»¥åœ¨è¢«åŒ…å«æ–‡ä»¶å’ŒåŒ…å«æ–‡ä»¶ä¸­é‡åçš„å˜é‡å’Œæ–¹æ³•æ˜¯ä¸ç›¸å†²çªçš„ã€‚ç¤ºä¾‹12345678910111213&lt;%@ page language=\"java\" contentType=\"text/html;charset=UTF-8\" %&gt;&lt;html&gt;&lt;head&gt; &lt;meta charset=\"utf-8\"&gt; &lt;title&gt;JSPincludeåŠ¨ä½œå®ä¾‹&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;%@ include file=\"Static.txt\" %&gt;&lt;jsp:include page=\"Dyamic.jsp\" flush=\"true\"/&gt;&lt;/body&gt;&lt;/html&gt;Static.txt123456&lt;%@ page language&#x3D;&quot;java&quot; contentType&#x3D;&quot;text&#x2F;html;charset&#x3D;UTF-8&quot; %&gt;&lt;form action&#x3D;&quot;JSPIncludeActiveDemo.jsp&quot; method&#x3D;&quot;post&quot;&gt; ç”¨æˆ·åï¼š &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;name&quot;&gt;&lt;br&#x2F;&gt; å¯†ç ï¼š &lt;input type&#x3D;&quot;password&quot; name&#x3D;&quot;password&quot;&gt;&lt;br&#x2F;&gt; &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;ç™»å½•&quot;&gt;&lt;&#x2F;form&gt;Dyamic.jsp123456&lt;%@ page language=\"java\" contentType=\"text/html;charset=UTF-8\" %&gt;&lt;br/&gt;ç”¨æˆ·åï¼š&lt;%=request.getParameter(\"name\") %&gt;&lt;br/&gt;å¯†ç ï¼š&lt;%=request.getParameter(\"password\") %&gt;&lt;br/&gt;ç¤ºä¾‹","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://lolico.me/tags/Java/"},{"name":"JSP","slug":"JSP","permalink":"https://lolico.me/tags/JSP/"}]},{"title":"é«˜ç²¾åº¦è®¡ç®—","slug":"é«˜ç²¾åº¦è®¡ç®—","date":"2018-09-04T08:05:35.000Z","updated":"2022-03-06T10:28:21.347Z","comments":true,"path":"2018/09/04/é«˜ç²¾åº¦è®¡ç®—/","link":"","permalink":"https://lolico.me/2018/09/04/%E9%AB%98%E7%B2%BE%E5%BA%A6%E8%AE%A1%E7%AE%97/","excerpt":"","text":"å‰è¨€&emsp;&emsp;ç”±äºè®¡ç®—æœºè¿ç®—æ˜¯æœ‰æ¨¡è¿ç®—,æ•°æ®èŒƒå›´çš„è¡¨ç¤ºæœ‰ä¸€å®šé™åˆ¶,å¦‚æ•´å‹int(C++ä¸­intä¸longç›¸åŒ)è¡¨è¾¾èŒƒå›´æ˜¯(-2^312^31-1),unsigned long(æ— ç¬¦å·æ•´æ•°)æ˜¯(02^32-1),éƒ½çº¦ä¸ºå‡ åäº¿.å¦‚æœé‡‡ç”¨å®æ•°å‹,åˆ™èƒ½ä¿å­˜æœ€å¤§çš„doubleåªèƒ½æä¾›15~16ä½çš„æœ‰æ•ˆæ•°å­—,å³åªèƒ½ç²¾ç¡®è¡¨è¾¾æ•°ç™¾ä¸‡äº¿çš„æ•°.å› æ­¤,åœ¨è®¡ç®—ä½æ•°è¶…è¿‡åå‡ ä½çš„æ•°æ—¶,ä¸èƒ½é‡‡ç”¨ç°æœ‰ç±»å‹,åªèƒ½è‡ªå·±ç¼–ç¨‹è®¡ç®—.&emsp;&emsp;é«˜ç²¾åº¦è®¡ç®—é€šç”¨æ–¹æ³•:é«˜ç²¾åº¦è®¡ç®—æ—¶ä¸€èˆ¬ç”¨ä¸€ä¸ªæ•°ç»„æ¥å­˜å‚¨ä¸€ä¸ªæ•°,æ•°ç»„çš„ä¸€ä¸ªå…ƒç´ å¯¹åº”äºæ•°çš„ä¸€ä½(å½“ç„¶,åœ¨ä»¥åçš„å­¦ä¹ ä¸­ä¸ºäº†åŠ å¿«è®¡ç®—é€Ÿåº¦,ä¹Ÿå¯ç”¨æ•°ç»„çš„ä¸€ä¸ªå…ƒç´ è¡¨ç¤ºæ•°çš„å¤šä½æ•°å­—,æš‚æ—¶ä¸è®²),è¡¨ç¤ºæ—¶,ç”±äºæ•°è®¡ç®—æ—¶å¯èƒ½è¦è¿›ä½,å› æ­¤ä¸ºäº†æ–¹ä¾¿,å°†æ•°ç”±ä½ä½åˆ°é«˜ä½ä¾æ¬¡å­˜åœ¨æ•°ç»„ä¸‹æ ‡å¯¹åº”ç”±ä½åˆ°é«˜ä½ç½®ä¸Š,å¦å¤–,æˆ‘ä»¬ç”³è¯·æ•°ç»„å¤§å°æ—¶,ä¸€èˆ¬è€ƒè™‘äº†æœ€å¤§çš„æƒ…å†µ,åœ¨å¾ˆå¤šæƒ…å†µä¸‹,è¡¨ç¤ºæœ‰å¯Œä½™,å³é«˜ä½æœ‰å¾ˆå¤š0,å¯èƒ½é€ æˆæ— æ•ˆçš„è¿ç®—å’Œåˆ¤æ–­,å› æ­¤,æˆ‘ä»¬ä¸€èˆ¬å°†æ•°ç»„çš„ç¬¬0ä¸ªä¸‹æ ‡å¯¹åº”ä½ç½®æ¥å­˜å‚¨è¯¥æ•°çš„ä½æ•°.å¦‚æ•°:3485(ä¸‰åƒå››ç™¾å…«åäº”)ï¼Œè¡¨è¾¾åœ¨æ•°ç»„a[5]ä¸Šæƒ…å†µæ˜¯:ä¸‹æ ‡&emsp;&emsp;0&emsp;&emsp;1&emsp;&emsp;2&emsp;&emsp;3&emsp;&emsp;4å†…å®¹&emsp;&emsp;4&emsp;&emsp;5&emsp;&emsp;8&emsp;&emsp;4&emsp;&emsp;3è¯´æ˜ï¼š&nbsp;ä½æ•°&nbsp; ä¸ªä½&nbsp; åä½&nbsp; ç™¾ä½&nbsp; åƒä½å…·ä½“åœ¨è®¡ç®—åŠ å‡ä¹˜é™¤æ—¶æ–¹æ³•å°±æ˜¯å°å­¦æ—¶é‡‡ç”¨çš„åˆ—ç«–å¼æ–¹æ³•.é«˜ç²¾åº¦æ•°çš„å­˜å‚¨é‡‡ç”¨å­—ç¬¦ä¸²è¯»å…¥å°†æ•°å…ˆå­˜åœ¨å­—ç¬¦ä¸²ä¸­,å†é€ä½å€’å™å­˜å…¥æ•°ç»„ä¸­1234567891011121314151617#include &lt;cstring&gt;#include &lt;iostream&gt;using namespace std;int main() &#123; int num1[200], num2[200]; //æœ€é«˜199ä½ string input; memset(num1, 0, sizeof(num1)); //æ•°ç»„æ¸…é›¶ memset(num2, 0, sizeof(num2)); cin &gt;&gt; input; num1[0] = input.length(); //ä½æ•° for (int i = 1; i &lt;= num1[0]; ++i) num1[i] = input[num1[0] - i] - '0'; //å°†å­—ç¬¦è½¬ä¸ºæ•°å­—å¹¶å€’åºå­˜å‚¨è¿›æ•°ç»„ cin &gt;&gt; input; num2[0] = input.length(); for (int i = 1; i &lt;= num2[0]; ++i) num2[i] = input[num2[0] - i] - '0';&#125;é‡‡ç”¨ç›´æ¥è¯»å…¥åˆ©ç”¨å–ä½™æ•°çš„æ–¹å¼å­˜å…¥æ•°ç»„ä¸­12345678910111213#include &lt;iostream&gt;using namespace std;int main() &#123; int num[200], key; cin &gt;&gt; key; memset(num, 0, sizeof(num)); //æ•°ç»„æ¸…é›¶ int i = 0; //ç¬¬iä½ while(key)&#123; num[++i] = key % 10; //å–ç¬¬iä½æ•° key /= 10; &#125; num[0] = i; //ä½æ•°ä½iä½&#125;æ“ä½œé«˜ç²¾åº¦æ•°ä»¥ä¸‹ç¨‹åºåªå†™å®ç°åŠŸèƒ½çš„å‡½æ•°,å¹¶ä¸”å‡å®šé«˜ç²¾åº¦æ•°çš„æ•°æ®ç»“æ„æ»¡è¶³ä¸Šè¿°çº¦å®š.æ¯”è¾ƒä¸¤ä¸ªé«˜ç²¾åº¦æ•°1234567891011//æ¯”è¾ƒaå’Œbçš„å¤§å°å…³ç³»,a&gt;b return 1,a&lt;b return -1,a=b return 0int compare(int a[], int b[]) &#123; int k = a[0] &gt; b[0] ? a[0] : b[0]; //æ›´å¤§çš„ä½æ•° for (int i = k; i &gt; 0; --i) &#123; //é€ä½æ¯”è¾ƒ if (a[i] &gt; b[i]) return 1; if (a[i] &lt; b[i]) return -1; &#125; return 0; //å„ä½éƒ½ç›¸ç­‰&#125;é«˜ç²¾åº¦æ•°åŠ æ³•1234567891011void doplus(int a[], int b[]) &#123; //ç»“æœæ”¾åœ¨aä¸­ï¼Œå³è®¡ç®—a=a+b int k = a[0] &gt; b[0] ? a[0] : b[0]; for (int i = 1; i &lt;= k; ++i) &#123; a[i + 1] += (a[i] + b[i]) / 10; //å…ˆè¿›ä½ a[i] = (a[i] + b[i]) % 10; &#125; if (a[k + 1] &gt; 0) a[0] = k + 1; else a[0] = k;&#125;é«˜ç²¾åº¦æ•°å‡æ³•12345678910111213141516171819202122232425262728293031int dominus(int a[], int b[]) &#123; //ç»“æœæ”¾äºaä¸­ï¼Œè¿”å›ç¬¦å·ä½ï¼Œ1æ­£æ•°ï¼Œ0ç›¸ç­‰ï¼Œ-1è´Ÿæ•° if (compare(a, b) == 0) &#123; // a=a-b=0 return 0 a[1] = 0, a[0] = 1; // memset(a,0,sizeof(a)); return 0; &#125; if (compare(a, b) == 1) &#123; // a=a-b return 1 for (int i = 1; i &lt;= b[0]; ++i) &#123; if (a[i] &lt; b[i]) &#123; a[i + 1]--; a[i] = a[i] + 10 - b[i]; &#125; else &#123; a[i] -= b[i]; &#125; &#125; while (a[a[0]] == 0) a[0]--; return 1; &#125; for (int i = 1; i &lt;= b[0]; ++i) &#123; // a=b-a return -1 if (b[i] &lt; a[i]) &#123; b[i + 1]--; a[i] = b[i] + 10 - a[i]; &#125; else &#123; a[i] = b[i] - a[i]; &#125; &#125; a[0] = b[0]; while (a[a[0]] == 0) a[0]--; return -1;&#125;é«˜ç²¾åº¦ä¹˜æ³•è¦æ±‚å°½å¯èƒ½ç”¨æ›´å°‘çš„å­˜å‚¨å•å…ƒ,é€ä½ç›¸ä¹˜,æ³¨æ„è¿›ä½å’Œæ€»ä½æ•°.1234567891011121314int *multiply(int a[], int b[]) &#123; //ç»“æœå­˜åœ¨resæ•°ç»„ä¸­å¹¶è¿”å›res int res[a[0] + b[0]]; res[0] = a[0] + b[0]; //æœ€åæƒ…å†µä¸‹çš„ä½æ•° memset(res, 0, sizeof(res)); for (int i = 0; i &lt; a[0]; ++i) for (int j = 0; j &lt; b[0]; ++j) &#123; res[i + j] += a[i] * b[j]; res[i + j + 1] += res[i + j] / 10; res[i + j] = res[i + j] % 10; &#125; while (!res[res[0]]) //ä½æ•°çš„ä¿®æ­£ res[0]--; return res;&#125;é«˜ç²¾åº¦é™¤æ³•æ¨¡æ‹Ÿæ‰‹ç®—é™¤æ³•,æŠŠé™¤æ³•è¯•å•†è½¬åŒ–ä¸ºè¿å‡.123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121#include &lt;stdio.h&gt;#include &lt;string.h&gt;#define N 500int bj(int a[], int b[], int k1, int k2) /*æ¯”è¾ƒå¤§å°å‡½æ•°*/&#123; int i, t, flag; /*flagä½œæ ‡å¿—ä½*/ if (k1 &lt; k2) flag = 0; /*è¢«é™¤æ•°å°äºé™¤æ•°è¿”å›0*/ else if (k1 &gt; k2) flag = 1; /*è¢«é™¤æ•°å¤§äºé™¤æ•°è¿”å›1*/ else &#123; /*è¢«é™¤æ•°å’Œé™¤æ•°ä½æ•°ç›¸ç­‰åˆ™é€ä½è¿›è¡Œæ¯”è¾ƒ*/ i = k1; t = 0; while (t == 0 &amp;&amp; i &gt; 0) &#123; if (a[i] &gt; b[i]) &#123; t = 1; flag = 1; &#125; else if (a[i] == b[i]) i--; else &#123; t = 1; flag = 0; &#125; &#125; if (i == 0 &amp;&amp; t == 0) flag = 2; /*è¢«é™¤æ•°ç­‰äºé™¤æ•°è¿”å›2*/ &#125; return flag;&#125;int jf(int a[], int b[], int k1, int k2) /*å‡æ³•è¿ç®—*/&#123; int i, k, d[N]; for (i = 0; i &lt; k2; i++) d[i] = b[i]; /*æŠŠé™¤æ•°èµ‹ç»™æ•°ç»„d*/ for (i = k2; i &lt; N; i++) d[i] = 0; /*dæ•°ç»„æ— æ•°æ®çš„é«˜ä½ç½®0*/ k = k1 - k2 - 1; /*è®¡ç®—å‡æ³•èµ·å§‹ä½ç½®*/ if (k &lt; 0) k = 0; if (k &gt; 0) &#123; for (i = k2 - 1; i &gt;= 0; i--) d[i + k] = d[i]; /*ç§»åŠ¨å‡æ•°ä½æ•°ä¸è¢«å‡æ•°å¯¹é½*/ for (i = 0; i &lt; k; i++) d[i] = 0; /*ç§»åŠ¨åçš„å…¶ä½™ä½ç½®0*/ &#125; for (i = 0; i &lt; k1; i++) &#123; if (a[i] &gt;= d[i]) a[i] -= d[i]; else &#123; a[i + 1] = a[i + 1] - 1; a[i] = 10 + a[i] - d[i]; &#125; &#125; return k;&#125;int main() &#123; int a[N] = &#123; 0 &#125;, b[N] = &#123; 0 &#125;, c[N] = &#123; 0 &#125;, d[N] = &#123; 0 &#125;; int i, ka, kb, m, t, t1, t2, k, x, kd, kk; char a1[N], b1[N]; printf(\"Input è¢«é™¤æ•°:\"); scanf(\"%s\", a1); ka = strlen(a1); for (i = 0; i &lt; ka; i++) a[i] = a1[ka - i - 1] - '0'; printf(\"Input é™¤æ•°:\"); scanf(\"%s\", b1); kb = strlen(b1); for (i = 0; i &lt; kb; i++) b[i] = b1[kb - i - 1] - '0'; kd = ka; /*ä¿å­˜è¢«é™¤æ•°ä½æ•° */ t2 = bj(a, b, ka, kb); m = 0; do &#123; while (a[ka - 1] == 0) ka--; t = bj(a, b, ka, kb); if (t &gt;= 1) &#123; k = jf(a, b, ka, kb); c[k]++; if (k &gt; m) m = k; t1 = 0; for (i = k; i &lt;= m; i++) &#123; x = c[i] + t1; c[i] = x % 10; t1 = x / 10; &#125; if (t1 &gt; 0) &#123; m++; c[m] = t1; &#125; &#125; &#125; while (t == 1); if (t2 == 0) &#123; printf(\"å•†=0\"); printf(\"\\nä½™æ•°=\"); for (i = kd - 1; i &gt;= 0; i--) printf(\"%d\", a[i]); exit(1); &#125; if (t2 == 2) &#123; printf(\"å•† = 1\"); printf(\"\\nä½™æ•° = 0\"); exit(1); &#125; kk = kd; while (!c[kd - 1]) kd--; printf(\"å•† = \"); for (i = kd - 1; i &gt;= 0; i--) printf(\"%d\", c[i]); while (!a[kk]) kk--; printf(\"\\nä½™æ•° = \"); if (kk &lt; 0) &#123; printf(\"0\"); exit(1); &#125; for (i = kk; i &gt;= 0; i--) printf(\"%d\", a[i]);&#125;æ¡ˆä¾‹Nï¼ï¼Œè¦æ±‚ç²¾ç¡®åˆ°Pä½(0ã€ˆPã€ˆ1000)é—®é¢˜1. Nï¼ï¼Œè¦æ±‚ç²¾ç¡®åˆ°Pä½(0ã€ˆPã€ˆ1000)ç®—æ³•ï¼šç»“æœç”¨æ•°ç»„aä¿å­˜ï¼Œå¼€å§‹æ—¶a[0]=1ï¼Œä¾æ¬¡ä¹˜ä»¥æ•°ç»„ä¸­å„ä½ï¼Œæ³¨æ„è¿›ä½å’Œæ•°ç»„é•¿åº¦çš„å˜åŒ–æºç¨‹åºå¦‚ä¸‹ï¼š123456789101112131415161718192021222324#include &lt;stdio.h&gt;#define M 1000int main() &#123; int a[M], i, n, j, flag = 1; printf(\"n=\"); scanf(\"%d\", &amp;n); printf(\"n!=\"); a[0] = 1; for (i = 1; i &lt; M; i++) a[i] = 0; for (j = 2; j &lt;= n; j++) &#123; for (i = 0; i &lt; flag; i++) a[i] *= j; for (i = 0; i &lt; flag; i++) if (a[i] &gt;= 10) &#123; a[i + 1] += a[i] / 10; a[i] = a[i] % 10; if (i == flag - 1) flag++; &#125; &#125; for (j = flag - 1; j &gt;= 0; j--) printf(\"%d\", a[j]);&#125;éº¦æ£®æ•°é—®é¢˜2. éº¦æ£®æ•°ã€é—®é¢˜æè¿°ã€‘å½¢å¦‚2P-1çš„ç´ æ•°ç§°ä¸ºéº¦æ£®æ•°ï¼Œè¿™æ—¶Pä¸€å®šä¹Ÿæ˜¯ä¸ªç´ æ•°ã€‚ä½†åè¿‡æ¥ä¸ä¸€å®šï¼Œå³å¦‚æœPæ˜¯ä¸ªç´ æ•°ï¼Œ2P-1ä¸ä¸€å®šä¹Ÿæ˜¯ç´ æ•°ã€‚åˆ°1998å¹´åº•ï¼Œäººä»¬å·²æ‰¾åˆ°äº†37ä¸ªéº¦æ£®æ•°ã€‚æœ€å¤§çš„ä¸€ä¸ªæ˜¯P=3021377ï¼Œå®ƒæœ‰909526ä½ã€‚éº¦æ£®æ•°æœ‰è®¸å¤šé‡è¦åº”ç”¨ï¼Œå®ƒä¸å®Œå…¨æ•°å¯†åˆ‡ç›¸å…³ä»»åŠ¡ï¼šä»æ–‡ä»¶ä¸­è¾“å…¥Pï¼ˆ1000&lt;P&lt;3100000ï¼‰ï¼Œè®¡ç®—2P-1çš„ä½æ•°å’Œæœ€å500ä½æ•°å­—ï¼ˆç”¨åè¿›åˆ¶é«˜ç²¾åº¦æ•°è¡¨ç¤ºï¼‰ã€è¾“å…¥æ ¼å¼ã€‘æ–‡ä»¶ä¸­åªåŒ…å«ä¸€ä¸ªæ•´æ•°Pï¼ˆ1000&lt;P&lt;3100000ï¼‰ã€è¾“å‡ºæ ¼å¼ã€‘ç¬¬ä¸€è¡Œï¼šåè¿›åˆ¶é«˜ç²¾åº¦æ•°2P-1çš„ä½æ•°ã€‚ç¬¬2-11è¡Œï¼šåè¿›åˆ¶é«˜ç²¾åº¦æ•°2P-1çš„æœ€å500ä½æ•°å­—ã€‚ï¼ˆæ¯è¡Œè¾“å‡º50ä½ï¼Œå…±è¾“å‡º10è¡Œï¼Œä¸è¶³500ä½æ—¶é«˜ä½è¡¥0ï¼‰ä¸å¿…éªŒè¯2P-1ä¸Pæ˜¯å¦ä¸ºç´ æ•°ã€‚ã€è¾“å…¥æ ·ä¾‹ã€‘1279ã€è¾“å‡ºæ ·ä¾‹ã€‘38600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010407932194664399081925240327364085538615262247266704805319112350403608059673360298012239441732324184842421613954281007791383566248323464908139906605677320762924129509389220345773183349661583550472959420547689811211693677147548478866962501384438260291732348885311160828538416585028255604666224831890918801847068222203140521026698435488732958028878050869736186900714720710555703168729087ç®—æ³•ï¼š2çš„å¹‚å¯ä»¥è½¬åŒ–æˆå·¦ç§»è¿ç®—ï¼Œä¸ºäº†æé«˜è¿ç®—é€Ÿåº¦ï¼Œå¯æ¯æ¬¡å·¦ç§»10ä½ï¼Œå³æ¯æ¬¡ä¹˜210ã€‚å¯¹äºä¸ªä½å•ç‹¬è€ƒè™‘ï¼Œæ¯æ¬¡å·¦ç§»ä¸€ä½æºç¨‹åºå¦‚ä¸‹ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546#include &lt;math.h&gt;#include &lt;stdio.h&gt;#define MAX 100000int main() &#123; int p; int i, j; scanf(\"%d\", &amp;p); printf(\"%d\\n\", (int)(p * log10(2.0)) + 1); long store[110] = &#123; 0 &#125;; store[0] = 1; int left = p % 10; p /= 10; for (i = 1; i &lt;= p; i++) &#123; for (j = 0; j &lt;= 100; j++) store[j] &lt;&lt;= 10; for (j = 0; j &lt;= 100; j++) &#123; if (store[j] &gt;= MAX) &#123; store[j + 1] += store[j] / MAX; store[j] %= MAX; &#125; &#125; &#125; for (i = 1; i &lt;= left; i++) &#123; for (j = 0; j &lt;= 100; j++) store[j] &lt;&lt;= 1; for (j = 0; j &lt;= 100; j++) &#123; if (store[j] &gt;= MAX) &#123; store[j + 1] += store[j] / MAX; store[j] %= MAX; &#125; &#125; &#125; store[0] -= 1; for (i = 1; i &lt; 100; i++) &#123; if (store[i - 1] &lt; 0) &#123; store[i] -= 1; store[i - 1] += MAX; &#125; else break; &#125; for (i = 99; i &gt;= 0; i--) &#123; printf(\"%05d\", store[i]); if ((100 - i) % 10 == 0) printf(\"\\n\"); &#125;&#125;","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Cpp","slug":"Cpp","permalink":"https://lolico.me/tags/Cpp/"}]},{"title":"è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹é—´çš„å¤©æ•°","slug":"è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹é—´çš„å¤©æ•°","date":"2018-08-21T08:13:12.000Z","updated":"2022-03-06T10:28:21.347Z","comments":true,"path":"2018/08/21/è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹é—´çš„å¤©æ•°/","link":"","permalink":"https://lolico.me/2018/08/21/%E8%AE%A1%E7%AE%97%E4%B8%A4%E4%B8%AA%E6%97%A5%E6%9C%9F%E4%B9%8B%E9%97%B4%E7%9A%84%E5%A4%A9%E6%95%B0/","excerpt":"","text":"å‰è¨€ç»™å®šä¸¤ä¸ªæ—¥æœŸ(å¹´æœˆæ—¥)è¦æ±‚è®¡ç®—å‡º è¿™ä¸¤ä¸ªæ—¥æœŸä¹‹é—´çš„å¤©æ•°ã€‚åœ¨ç”Ÿæ´»ä¸­æˆ‘ä»¬ä¹Ÿæ€»ä¼šé‡åˆ°è¿™æ ·çš„é—®é¢˜ï¼Œä»”ç»†ä¸€æƒ³ï¼Œè™½ç„¶è®¡ç®—çš„æ–¹æ³•ä¸éš¾ï¼Œä½†æ˜¯çœŸæ­£ç®—èµ·æ¥è¿˜æ˜¯è¦èŠ±è´¹ä¸€ç‚¹æ—¶é—´çš„ï¼Œè€Œä¸”åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¾ˆå®¹æ˜“å› ä¸ºä¸ç»†å¿ƒè€Œå¾—å‡ºé”™è¯¯çš„ç»“æœã€‚å½“æˆ‘ä»¬æ¯æ¬¡é‡åˆ°è¿™ä¸ªé—®é¢˜æ—¶ï¼Œæ€»ä¸èƒ½æ¯æ¬¡éƒ½å¿ƒç®—æˆ–æ˜¯æ‰‹ç®—å§ï¼Ÿæ‰€ä»¥å‘¢ï¼Œå†™å‡ºä¸€ä¸ªç®€å•çš„è®¡ç®—ä¸¤æ—¥æœŸä¹‹é—´å¤©æ•°çš„ç¨‹åºè¿˜æ˜¯æœ‰ç‚¹ç”¨çš„ã€‚åˆ†æè™½è¯´è¿™ä¸ªè¿‡ç¨‹å¹¶ä¸å¤æ‚ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯è¦åˆ†æä¸€ä¸‹ï¼šæ—¥æœŸæ˜¯å¦ç¬¦åˆç”Ÿæ´»è§„å¾‹ï¼ˆå³ä¸èƒ½å‡ºç°æœˆä¸º13æˆ–æ˜¯æ—¥æœŸå‡ºç°40çš„æƒ…å†µï¼‰ç»™å®šæ—¥æœŸæ—¶ä¸ä¸€å®šæ˜¯å°çš„åœ¨å‰å¤§çš„åœ¨åè®¡ç®—ä¸¤æ—¥æœŸä¹‹é—´å¤©æ•°çš„ç®—æ³•è‡³äºæ—¥æœŸæ˜¯å¦ç¬¦åˆç”Ÿæ´»è§„å¾‹å†™ä¸ªåˆ¤æ–­å°±å¯ä»¥äº†ï¼Œè¿™ä¸ªå¾ˆç®€å•ï¼Œåœ¨è¿™é‡Œå°±ä¸èµ˜è¿°ï¼Œç¨‹åºä¸­é»˜è®¤ç»™å®šçš„æ—¥æœŸæ˜¯æ­£ç¡®çš„ï¼Œç»™å®šæ—¥æœŸçš„å…ˆåé¡ºåºä¹Ÿæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªåˆ¤æ–­å¹¶è¿›è¡Œä½ç½®äº¤æ¢ï¼Œè‡³äºå¤§çš„åœ¨å‰è¿˜æ˜¯å°çš„åœ¨å‰æŒ‰ä½ è‡ªå·±çš„ä¹ æƒ¯éƒ½è¡Œï¼Œä¸‹é¢çš„åˆ†æä»¥å°çš„åœ¨å‰å¤§çš„åœ¨åä¸ºåŸºå‡†å¹¶ä¸”å·²ç»è§£å†³æ—¥æœŸè§„èŒƒé—®é¢˜ã€‚æœ€æœ€æœ€å…³é”®çš„å½“ç„¶è¿˜æ˜¯è®¡ç®—å¤©æ•°çš„æ–¹æ³•ï¼šå†™è®¡ç®—å¤©æ•°çš„ç®—æ³•æ—¶æˆ‘ä»¬éœ€è¦è€ƒè™‘ï¼šå¹´ä»½æ˜¯åŒå¹´è¿˜æ˜¯ä¸åŒå¹´ï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜è¦è€ƒè™‘åˆ°æ˜¯å¦ä¸ºé—°å¹´çš„æƒ…å†µã€‚åŒå¹´çš„æƒ…å†µä¸‹è¿˜æœ‰æ˜¯å¦åŒæœˆçš„æƒ…å†µï¼Œè‹¥æ˜¯åŒæœˆï¼Œå°†æ—¥ç›¸å‡ä¾¿å¾—åˆ°ç»“æœï¼Œè¿™ä¹Ÿæ˜¯æœ€ç®€å•çš„ä¸€ç§æƒ…å†µã€‚è€ƒè™‘åˆ°è¿˜æœ‰æ˜¯å¦é—°å¹´ï¼Œå¹´ä»½æ˜¯å¦åŒå¹´çš„æƒ…å†µï¼Œè‹¥æ˜¯æˆ‘ä»¬è¿™æ ·åˆ†é‚£å°±ä¼šæœ‰å¾ˆå¤šç§ç»„åˆï¼Œç¨‹åºä¹Ÿä¼šæ˜¾å¾—å¾ˆæ‚ä¹±ã€‚é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆæ‰èƒ½è®©è®¡ç®—çš„è¿‡ç¨‹ç›¸å¯¹æ›´ç®€å•å‘¢ï¼Ÿåœ¨è¿™é‡Œï¼Œæˆ‘å°±åˆ†ä¸¤ç§æƒ…å†µï¼šåŒå¹´ä¸åŒå¹´1):åŒå¹´çš„æƒ…å†µä¸‹ä¸ºäº†ä¸å†åŒºåˆ†æ˜¯å¦åŒæœˆ,æˆ‘ä»¬è®¡ç®—å‡º:(å¤§çš„æ—¥æœŸåˆ°å¹´åˆçš„å¤©æ•°-å°çš„æ—¥æœŸåˆ°å¹´åˆçš„å¤©æ•°)2):ä¸åŒå¹´çš„æƒ…å†µä¸‹,è®¡ç®—å‡º:(å°çš„æ—¥æœŸåˆ°å¹´æœ«çš„å¤©æ•°+å¤§çš„æ—¥æœŸåˆ°å¹´åˆçš„å¤©æ•°+å¹´ä»½å·®ä¹‹é—´çš„å¤©æ•°)å¯¹äºä¸åŒå¹´,æˆ‘ä»¬è®¡ç®—å°çš„æ—¥æœŸåˆ°å¹´æœ«çš„å¤©æ•°æˆ‘ä»¬è¿˜å¯ä»¥è®¡ç®—å½“å‰å¹´çš„æ€»å¤©æ•°-å°çš„æ—¥æœŸåˆ°å¹´åˆçš„å¤©æ•°,æ‰€ä»¥æœ€åå°±å˜æˆäº†(å¤§çš„æ—¥æœŸåˆ°å¹´åˆçš„å¤©æ•°-å°çš„æ—¥æœŸåˆ°å¹´åˆçš„å¤©æ•°+å¹´ä»½å·®ä¹‹é—´çš„å¤©æ•°)æ³¨æ„æ­¤å¤„çš„å¹´ä»½å·®ä¹‹é—´çš„å¤©æ•°ä¸2)ä¸­çš„ä¸åŒ,ç›¸å·®1.ä¸ºäº†å†ç®€å•ç‚¹,æˆ‘ä»¬å†å°†è¿™ä¸¤ç§æƒ…å†µè§†ä¸ºä¸€ç§æƒ…å†µ:å³ä¸ç®¡ä»€ä¹ˆæƒ…å†µ,è®¡ç®—å‡º(å¤§çš„æ—¥æœŸåˆ°å¹´åˆçš„å¤©æ•°-å°çš„æ—¥æœŸåˆ°å¹´åˆçš„å¤©æ•°+å¹´ä»½å·®ä¹‹é—´çš„å¤©æ•°),å› ä¸ºåŒå¹´ä»½æ—¶çš„å¹´ä»½å·®ä¹‹é—´çš„å¤©æ•°ä¸ºé›¶ã€‚å®ç°å…ˆæ”¾ä¸Šå®Œæ•´ä»£ç :1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859#include &lt;iostream&gt;using namespace std;const int leepMonth[13] = &#123; 0, 31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 &#125;;const int noLeepMonth[13] = &#123; 0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 &#125;;const int year[2] = &#123; 365, 366 &#125;;typedef struct Date &#123; int year; int month; int day; int isLeep;&#125; Date;void isLeep(Date &amp;date) &#123; if ((date.year % 4 == 0 &amp;&amp; date.year % 100 != 0) || date.year % 400 == 0) date.isLeep = 1; date.isLeep = 0;&#125;void swap(Date &amp;min, Date &amp;max) &#123; Date temp; if (min.year &gt; max.year || (min.year == max.year &amp;&amp; min.month &gt; max.month) || (min.year == max.year &amp;&amp; min.month == max.month &amp;&amp; min.day &gt; max.day)) &#123; temp = min; min = max; max = temp; &#125;&#125;int diff(Date &amp;min, Date &amp;max) &#123; isLeep(min); isLeep(max); swap(min, max); //ä¿è¯å°çš„æ—¥æœŸåœ¨å‰å¤§çš„åœ¨å int minday = 0, maxday = 0, diff = 0; for (int m = 1; m &lt; min.month; m++) &#123; //è®¡ç®—å°çš„æ—¥æœŸåˆ°å¹´åˆçš„å¤©æ•°,æœ€åè¿˜è¦åŠ ä¸Šæ—¥æœŸä¸­çš„å¤©æ•° if (min.isLeep) minday += leepMonth[m]; else minday += noLeepMonth[m]; &#125; for (int m = 1; m &lt; max.month; m++) &#123; //è®¡ç®—å¤§çš„æ—¥æœŸåˆ°å¹´åˆçš„å¤©æ•°,æœ€åè¿˜è¦åŠ ä¸Šæ—¥æœŸä¸­çš„å¤©æ•° if (max.isLeep) maxday += leepMonth[m]; else maxday += noLeepMonth[m]; &#125; minday += min.day; //åŠ ä¸Šå¤©æ•° maxday += max.day; for (Date y = min; y.year &lt; max.year; y.year++) &#123; //è®¡ç®—å¹´ä»½å·®ä¹‹é—´çš„å¤©æ•° isLeep(y); diff += year[y.isLeep]; &#125; diff = diff + maxday - minday; //å¾—å‡ºç»“æœ return diff;&#125;int main() &#123; Date startDate, endDate; cout &lt;&lt; \"please input startday(yyyy MM dd):\"; cin &gt;&gt; startDate.year &gt;&gt; startDate.month &gt;&gt; startDate.day; cout &lt;&lt; \"please input endday(yyyy MM dd):\"; cin &gt;&gt; endDate.year &gt;&gt; endDate.month &gt;&gt; endDate.day; //æ—¥æœŸå…ˆåä¸å½±å“,swap()ç¡®ä¿å°çš„åœ¨å‰ cout &lt;&lt; \"daydiff: \" &lt;&lt; diff(startDate, endDate) &lt;&lt; endl;&#125;ä¸ºäº†ç¨‹åºçš„å¯è¯»æ€§,è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªç»“æ„ä½“Date,ä¸ºäº†è®¡ç®—å¹´ä»½å·®ä¹‹é—´çš„å¤©æ•°æ›´æ–¹ä¾¿,ç»“æ„ä½“ä¸­è¿˜å®šä¹‰äº†ä¸€ä¸ªisLeepæˆå‘˜,ç»“åˆæ•°ç»„year[2]={355,356}å¯ä»¥æ›´ç®€å•çš„è®¡ç®—å‡ºå¹´ä»½å·®ä¹‹é—´çš„å¤©æ•°,è¿™éƒ¨åˆ†çš„å®Œæ•´ä»£ç æŒ–å‡ºæ¥ä»¥ä¾¿æ›´å¥½ç†è§£:1234for (Date y = min; y.year &lt; max.year; y.year++) &#123; isLeep(y); diff += year[y.isLeep];&#125;isLeep()å‡½æ•°åˆ¤æ–­å½“å‰å¹´æ˜¯å¦ä¸ºé—°å¹´,å¹¶å¯¹ç»“æ„ä½“æˆå‘˜isLeepåˆå§‹åŒ–.ä¸ºé—°å¹´æ—¶year[y.isLeep]å³year[1]=366,ä¸æ˜¯é—°å¹´æ—¶year[y.isLeep]å³year[0]=365","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Cpp","slug":"Cpp","permalink":"https://lolico.me/tags/Cpp/"}]},{"title":"å°†å­—ç¬¦ä¸²è—åœ¨äºŒè¿›åˆ¶ç¼–ç ä¸­","slug":"å°†å­—ç¬¦ä¸²è—åœ¨äºŒè¿›åˆ¶ç¼–ç ä¸­","date":"2018-08-10T07:47:56.000Z","updated":"2022-03-06T10:28:21.347Z","comments":true,"path":"2018/08/10/å°†å­—ç¬¦ä¸²è—åœ¨äºŒè¿›åˆ¶ç¼–ç ä¸­/","link":"","permalink":"https://lolico.me/2018/08/10/%E5%B0%86%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%97%8F%E5%9C%A8%E4%BA%8C%E8%BF%9B%E5%88%B6%E7%BC%96%E7%A0%81%E4%B8%AD/","excerpt":"","text":"å‰è¨€å…ˆæ”¾ä¸¤å¼ å›¾å°†å­—ç¬¦ä¸²ä»¥äºŒè¿›åˆ¶çš„å½¢å¼ç¼–ç ,ä¹Ÿå°±æ˜¯å›¾ç‰‡ä¸­é‚£ä¸€å¤§ä¸²äºŒè¿›åˆ¶ä»£ç .çœ‹èµ·æ¥å¥½åƒå¾ˆå‰å®³çš„æ ·å­,å…¶å®å®ç°èµ·æ¥ååˆ†çš„ç®€å•.åœ¨ä¸æ‡‚çš„æœ‹å‹é¢å‰æˆ–è®¸æˆ‘ä»¬è¿˜å¯ä»¥ç”¨è¿™ä¸ªæ–¹å¼è£…ä¸ªé€¼ (é€ƒå®ç°åŸç†ç®€å•è¯´ä¸‹å®ç°çš„æ–¹æ³•ï¼šå­—ç¬¦ä¸²ä»¥äºŒè¿›åˆ¶å½¢å¼ç¼–ç :å°†å­—ç¬¦ä¸²ä»¥äºŒè¿›åˆ¶ç¼–ç å…¶å®å°±æ˜¯åˆ©ç”¨å­—ç¬¦çš„ASCIIç ,å¹¶å°†æ¯ä¸ªå­—ç¬¦çš„ASCIIç è½¬æ¢ä¸ºäºŒè¿›åˆ¶çš„å½¢å¼ä¾¿å°†å­—ç¬¦ä¸²â€è—åœ¨äº†äºŒè¿›åˆ¶ç¼–ç ä¸­â€.å°†äºŒè¿›åˆ¶å­—ç¬¦ä¸²è¿˜åŸ:ä¹Ÿå°±æ˜¯å°†å›¾ç‰‡ä¸­çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²â€ç ´è§£â€,å…¶å®ä¹Ÿå¾ˆç®€å•,å°±æ˜¯å°†äºŒè¿›åˆ¶å­—ç¬¦ä¸²åˆ†å‰²,å†è½¬æ¢ä¸ºåè¿›åˆ¶çš„ASCIIç ,æœ€åå†è½¬ä¸ºå­—ç¬¦ç±»å‹å³å¯.è¯´ç™½äº†,å°±æ˜¯å°†ä¸Šé¢çš„æ­¥éª¤åè¿‡æ¥.ä»£ç 12345678910111213141516171819202122232425262728293031323334353637383940414243public class BinaryString &#123; private String binaryCode=\"\"; public BinaryString(String str) &#123; char[] chars = str.toCharArray(); for (char ch : chars) &#123; String s=Integer.toBinaryString((int)ch);//å°†å­—ç¬¦çš„ASCIIç è½¬æ¢ä¸ºäºŒè¿›åˆ¶ while(s.length()&lt;8)//ä¸å¤Ÿ8ä½åˆ™åœ¨å‰é¢è¡¥0 s=\"0\"+s; binaryCode+=s+\" \"; &#125; &#125; public String getBinaryCode()&#123; //å¾—åˆ°äºŒè¿›åˆ¶ç¼–ç çš„å­—ç¬¦ä¸² return binaryCode; &#125; public static String toDecimalString(String binaryCode)&#123; //å°†äºŒè¿›åˆ¶ç¼–ç çš„å­—ç¬¦ä¸²è¿˜åŸ String decimalString=\"\"; String[] strings=binaryCode.split(\" \");//åˆ†å‰²äºŒè¿›åˆ¶å­—ç¬¦ä¸²,å¾—åˆ°æ¯ä¸ªå­—ç¬¦çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸² for(String str:strings)&#123; char ch= (char) Integer.parseInt(str,2);//è½¬æ¢ä¸ºåè¿›åˆ¶ASCIIå¹¶å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸ºchar decimalString+=ch; &#125; return decimalString; &#125; public static void main(String[] args) &#123; String Code=\"01010011 01101111 01101101 01100101 \" + \"01110100 01101001 01101101 01100101 \" + \"01110011 00100000 01001001 00100000 \" + \"01100110 01100001 01101001 01101100 \" + \"00100000 01101111 01110010 01100100 \" + \"01100101 01110010 01110011 00100000 \" + \"01101111 01101110 00100000 01110000 \" + \"01110101 01110010 01110000 01101111 \" + \"01110011 01100101 00100000 01110100 \" + \"01101111 00100000 01100001 01101110 \" + \"01101110 01101111 01111001 00100000 \" + \"01101101 01111001 00100000 01110100 \" + \"01100101 01100001 01101101 00100001\"; System.out.println(toDecimalString(Code)); System.out.println(new BinaryString(\"Thrall and Jaina sitting in a tree, K-I-S-S-I-N-G\").getBinaryCode()); &#125;&#125;è¾“å‡º12Sometimes I fail orders on purpose to annoy my team!01010100 01101000 01110010 01100001 01101100 01101100 00100000 01100001 01101110 01100100 00100000 01001010 01100001 01101001 01101110 01100001 00100000 01110011 01101001 01110100 01110100 01101001 01101110 01100111 00100000 01101001 01101110 00100000 01100001 00100000 01110100 01110010 01100101 01100101 00101100 00100000 01001011 00101101 01001001 00101101 01010011 00101101 01010011 00101101 01001001 00101101 01001110 00101101 01000111","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://lolico.me/tags/Java/"}]},{"title":"Chevereto-åœ¨æœåŠ¡å™¨ä¸Šæ­å»ºè‡ªå·±çš„å›¾åºŠ","slug":"Chevereto-åœ¨æœåŠ¡å™¨ä¸Šæ­å»ºè‡ªå·±çš„å›¾åºŠ","date":"2018-08-09T07:43:03.000Z","updated":"2022-03-06T10:28:21.343Z","comments":true,"path":"2018/08/09/Chevereto-åœ¨æœåŠ¡å™¨ä¸Šæ­å»ºè‡ªå·±çš„å›¾åºŠ/","link":"","permalink":"https://lolico.me/2018/08/09/Chevereto-%E5%9C%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%9B%BE%E5%BA%8A/","excerpt":"","text":"ä»‹ç»å®˜ç½‘:chevereto.comgithubé¡¹ç›®:Chevereto-FreeChevereto æ˜¯ä¸€æ¬¾é‡‡ç”¨ PHP è¯­è¨€å¼€å‘çš„ç½‘ç»œç›¸å†Œè„šæœ¬ç¨‹åºï¼Œæ”¯æŒå¤šè¯­è¨€ï¼Œæä¾›ä¸­æ–‡è¯­è¨€åŒ…çš„ä¸‹è½½çš„å¼€æºåœ¨çº¿å›¾ç‰‡å­˜å‚¨åˆ†äº«æœåŠ¡ç³»ç»Ÿï¼Œæ”¯æŒæœ¬åœ°ä¸Šä¼ å’Œåœ¨çº¿è·å–ä¸¤ç§å›¾åƒä¸Šä¼ æ–¹å¼ï¼Œå¹¶é›†æˆäº† TinyURL ç½‘å€ç¼©çŸ­æœåŠ¡ã€‚Chevereto è¿™å¥—ç¨‹åºå¯ä»¥åƒ Discuz æˆ– WordPress ä¸€æ ·éšæ„æ¶è®¾åœ¨ä»»ä½•ç©ºé—´ä¸Šã€‚è€Œå®ƒçš„åŠŸèƒ½é™¤äº†ä¸€èˆ¬å›¾ç‰‡ç©ºé—´å•çº¯çš„ä»ç”µè„‘ä¸Šä¼ å›¾ç‰‡å¤–ï¼Œä¹Ÿæ”¯æ´åˆ©ç”¨ç½‘å€ä¹Ÿå¯ä»¥ä¸Šä¼ ï¼Œæœ€å±Œçš„æ˜¯è¿˜æœ‰ TinyURL çš„ç¼©çŸ­ç½‘å€çš„åŠŸèƒ½å¯ä»¥ä½¿ç”¨ï¼Œå› æ­¤è¿™å¥— Chevereto å¯ä»¥è¯´æ˜¯æ¯”å¸‚é¢ä¸Šä¸€äº›å…è´¹å›¾åºŠå¥½å¤ªå¤šäº†ã€‚å®‰è£…ç›®å‰Cheveretoæœ‰å…è´¹ç‰ˆå’Œä»˜è´¹ç‰ˆä¸¤ç§,ä¸”å½“å‰æœ€æ–°ç‰ˆæœ¬å·²ç»æ”¯æŒPHP7,ä½†æ˜¯PHP7å·²ç»ä¸æ”¯æŒmysqlæ‰©å±•,æ‰€ä»¥å»ºè®®ä¸è¦ä½¿ç”¨PHP7,ä½¿ç”¨PHP5.5,PHP5.6å³å¯ä¸‹è½½æºç åè§£å‹å¹¶æ”¾åœ¨ç½‘ç«™æ ¹ç›®å½•,å®˜ç½‘å’Œgithubä¸‹è½½å¾ˆæ…¢,è¿™é‡Œæä¾›ä¸€ä¸ª: chevereto-3.10.13.zipæ‰“å¼€ä½ çš„ç½‘ç«™,è‹¥ç½‘ç«™æç¤ºä½ Chevereto canâ€™t create the app/settings.php file. You must manually create this file.åœ¨app/ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªsetting.phpæ–‡ä»¶å³å¯.åˆ·æ–°ç½‘é¡µ,å¼€å§‹å®‰è£…,å®‰è£…ç•Œé¢æ˜¯è‹±æ–‡çš„,è‹±è¯­ä¸å·®åˆ°ç¦»è°±åº”è¯¥è¿˜æ˜¯èƒ½å¤Ÿçœ‹æ‡‚çš„,å¡«å…¥å¯¹åº”æ•°æ®åº“ä¿¡æ¯,ç™»é™†åå°è´¦å·å¯†ç ç­‰å°±å¯ä»¥å¼€å§‹å®‰è£…äº†.å®‰è£…å¯èƒ½è¿˜ä¼šæç¤ºä½ æŸäº›æ–‡ä»¶å¤¹æƒé™ä¸å¤Ÿæˆ–è€…setting.phpæ–‡ä»¶æ— æ³•å†™å…¥,å¯ä»¥ä¿®æ”¹å¯¹åº”æ–‡ä»¶å¤¹æƒé™,æˆ–æ˜¯è‡ªå·±åœ¨setting.phpä¸­å†™å…¥å®‰è£…ç¨‹åºæç¤ºä½ çš„ä»£ç å³å¯ç»§ç»­å®‰è£….ä¸Šè¿°æ­¥éª¤å®Œæˆå,æˆ‘ä»¬çš„å›¾åºŠä¾¿æ­å»ºå¥½äº†,ç°åœ¨å°±å¯ä»¥ç™»å½•åå°å¯¹ä¸€äº›åŸºç¡€åŠŸèƒ½è¿›è¡Œè®¾ç½®å’Œä¿®æ”¹.æ¼”ç¤ºç«™ç‚¹img.griouges.cn","categories":[{"name":"ä¸æ­£å¸¸çš„æ–‡ç« ","slug":"ä¸æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E4%B8%8D%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"ï¼Ÿï¼Ÿï¼Ÿ","slug":"ï¼Ÿï¼Ÿï¼Ÿ","permalink":"https://lolico.me/tags/%EF%BC%9F%EF%BC%9F%EF%BC%9F/"}]},{"title":"å­—ç¬¦ä¸²ä¸ä»»æ„ç±»å‹æ•°æ®æ‹¼æ¥","slug":"å­—ç¬¦ä¸²ä¸ä»»æ„ç±»å‹æ•°æ®æ‹¼æ¥","date":"2018-07-01T07:47:56.000Z","updated":"2022-03-06T10:28:21.347Z","comments":true,"path":"2018/07/01/å­—ç¬¦ä¸²ä¸ä»»æ„ç±»å‹æ•°æ®æ‹¼æ¥/","link":"","permalink":"https://lolico.me/2018/07/01/%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8E%E4%BB%BB%E6%84%8F%E7%B1%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E6%8B%BC%E6%8E%A5/","excerpt":"","text":"å‰è¨€c++ä¸­çš„stringç±»æä¾›äº†è®¸å¤šå‡½æ•°ç»™æˆ‘ä»¬ä½¿ç”¨,ä¹Ÿé‡è½½äº†ä¸€äº›åŸºæœ¬çš„è¿ç®—ç¬¦,ä¾‹å¦‚stringç±»ä¸­çš„append()å‡½æ•°å’Œé‡è½½çš„â€™+â€™è¿ç®—ç¬¦å¯ä»¥è®©æˆ‘ä»¬å°†å­—ç¬¦ä¸²ä¸å­—ç¬¦ä¸²æˆ–å­—ç¬¦è¿›è¡Œæ‹¼æ¥,ä½†æ˜¯å´æ²¡æœ‰ç›´æ¥æä¾›å°†å­—ç¬¦ä¸²ä¸å…¶ä»–åŸºæœ¬ç±»å‹æ•°æ®æ‹¼æ¥çš„å‡½æ•°æˆ–è¿ç®—ç¬¦,å½“æˆ‘ä»¬éœ€è¦å°†å­—ç¬¦ä¸²ä¸å…¶ä»–åŸºæœ¬ç±»å‹æ‹¼æ¥æ—¶è¯¥æ€ä¹ˆåŠå‘¢?å®ç°c++ä¸­å°†å­—ç¬¦ä¸²ä¸å…¶ä»–åŸºæœ¬ç±»å‹æ•°æ®æ‹¼æ¥ååˆ†çš„çµæ´»,çµæ´»ä¹‹å¤„åœ¨äºæœ‰å¾ˆå¤šç§æ–¹å¼å¯ä»¥å®ç°æ‹¼æ¥,ä¸‹é¢æˆ‘å°±ä»‹ç»å‡ ç§å°†å­—ç¬¦ä¸²ä¸å…¶ä»–åŸºæœ¬ç±»å‹æ‹¼æ¥çš„æ–¹æ³•.è®²çš„ä¸€äº›æ–¹æ³•ä¸­æ¸¸çš„éƒ¨åˆ†æ˜¯æ²¡æœ‰æ¶‰åŠåˆ°c++ä¸­çš„stringè€Œæ˜¯cä¸­çš„å­—ç¬¦ä¸²(å­—ç¬¦æ•°ç»„),è‹¥æ˜¯åªæƒ³çœ‹stringçš„å¯ä»¥è·³è¿‡ä¸€äº›æ–¹æ³•.sprintfå‡½æ•°å‡½æ•°åŸå‹:int sprintf (char *__stream, const char *__format, ...);123456789101112131415#include&lt;iostream&gt;#include&lt;cstring&gt;using namespace std;int main()&#123; char *s = \"aaa\"; int a = 1; double b = 1.11; char *buf = new char(); sprintf(buf, \"%s%d%.2f\", s, a, b); cout &lt;&lt; buf &lt;&lt; endl; system(\"pause\");&#125;//è¾“å‡º://aaa11.11//è¯·æŒ‰ä»»æ„é”®ç»§ç»­. . .æ­¤æ–¹æ³•å±€é™æ€§è¾ƒå¤§,ç”¨è¿™ç§æ–¹å¼æ‹¼æ¥ç±»ä¼¼äºcä¸­çš„å­—ç¬¦æ“ä½œå‡½æ•°char *strcat(char *dest,char *src)åªä¸è¿‡ç”¨sprintfå¯ä»¥å°†å­—ç¬¦ä¸²ä¸å…¶ä»–åŸºæœ¬ç±»å‹çš„æ•°æ®è¿›è¡Œæ‹¼æ¥,ç¾ä¸­ä¸è¶³çš„æ˜¯éœ€è¦æ³¨æ„æ‹¼æ¥æ—¶æœ‰æµ®ç‚¹å‹çš„æ•°æ®è¦æ§åˆ¶å°æ•°ç‚¹çš„ä½æ•°,å¹¶ä¸”ä¸strcat()ä¸€æ ·çš„,æ‹¼æ¥çš„å­—ç¬¦ä¸²å’Œæ‹¼æ¥åçš„å­—ç¬¦ä¸²æ˜¯cé£æ ¼çš„å­—ç¬¦ä¸².cé£æ ¼å­—ç¬¦ä¸²å’Œc++stringå­—ç¬¦ä¸²çš„ä¸åŒå’Œè½¬æ¢å¯ä»¥çœ‹ä¸‹è¿™ç¯‡æ–‡ç« :C++ stringå¯¹è±¡å’ŒCé£æ ¼å­—ç¬¦ä¸²çš„å·®åˆ«ä¸è½¬æ¢æ¥å£itoaå‡½æ•°å‡½æ•°åŸå‹:char *_itoa(int value, char *string, int radix);1234567891011121314#include&lt;iostream&gt;#include&lt;cstring&gt;using namespace std;int main() &#123; char* s = \"a\"; int a = 1; char *buf=new char(); _itoa(a, buf, 10); cout &lt;&lt; s+buf &lt;&lt; endl; system(\"pause\");&#125;//è¾“å‡º://a1//è¯·æŒ‰ä»»æ„é”®ç»§ç»­. . .æ­¤æ–¹æ³•å±€é™æ€§ç›¸æ¯”sprintf()æ›´å¤§,å› ä¸ºåªèƒ½å°†stringå­—ç¬¦ä¸²ä¸æ•´å‹æ•°æ®æ‹¼æ¥å¹¶ä¸”ä½¿ç”¨çš„æ˜¯éæ ‡å‡†Cè¯­è¨€å’ŒC++è¯­è¨€æ‰©å±•å‡½æ•°,æ³¨æ„å‡½æ•°åŸå‹ä¸­çš„radixå‚æ•°æ˜¯è½¬æ¢æ—¶çš„åŸºæ•°,å…·ä½“çš„å¯ä»¥è§:itoa-ç™¾åº¦ç™¾ç§‘to_stringå‡½æ•°å‡½æ•°åŸå‹:123456789string to_string (int val);string to_string (long val);string to_string (long long val);string to_string (unsigned val);string to_string (unsigned long val);string to_string (unsigned long long val);string to_string (float val);string to_string (double val);string to_string (long double val);12345678910111213#include &lt;iostream&gt;#include &lt;string&gt;using namespace std;int main() &#123; string s = \"a\"; int a = 1; double b = 1.11; cout &lt;&lt; s+to_string(a)+to_string(b) &lt;&lt; endl; system(\"pause\");&#125;//è¾“å‡º://a11.110000//è¯·æŒ‰ä»»æ„é”®ç»§ç»­. . .æ­¤æ–¹æ³•é€‚ç”¨äºstringå­—ç¬¦ä¸²ä¸å…¶ä»–åŸºç¡€ç±»å‹æ‹¼æ¥,éœ€è¦æ³¨æ„çš„æ˜¯to_string()å‡½æ•°æ˜¯c++11ä¸­å¼•å…¥çš„æ ‡å‡†åº“å‡½æ•°,ä½¿ç”¨è¯¥å‡½æ•°æ‹¼æ¥å”¯ä¸€ä¸è¶³çš„ä¸€ç‚¹å°±æ˜¯æ‹¼æ¥çš„æ˜¯æµ®ç‚¹å‹æ•°æ®æ—¶å°æ•°ç‚¹åä¼šè·Ÿ6ä½,ä¸è¶³6ä½0æ¥è¡¥,æœ‰æ—¶å€™å¯èƒ½è¾¾ä¸åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æœ.é‡è½½è¿ç®—ç¬¦1234567891011121314151617181920212223242526#include &lt;iostream&gt;#include &lt;sstream&gt;#include &lt;string&gt;using namespace std;template &lt;typename T&gt;string operator&amp;(const T &amp;t, const string &amp;s) &#123; ostringstream oss; oss &lt;&lt; t; return oss.str() + s;&#125;template &lt;typename T&gt;string operator&amp;(const string &amp;s, const T &amp;t) &#123; ostringstream oss; oss &lt;&lt; t; return s + oss.str();&#125;int main() &#123; string s = \"a\"; int a = 1; double b = 1.11; cout &lt;&lt; (s &amp; a &amp; b) &lt;&lt; endl; system(\"pause\");&#125;//è¾“å‡º//a11.11//è¯·æŒ‰ä»»æ„é”®ç»§ç»­. . .é‡è½½&amp;è¿ç®—ç¬¦ä½¿å¾—stringå­—ç¬¦ä¸²å¯ä»¥ä¸å…¶ä»–ä»»æ„åŸºæœ¬ç±»å‹è¿›è¡Œæ‹¼æ¥,å¯¹äºæµ®ç‚¹å‹æ•°æ®ä¹Ÿä¸ä¼šåœ¨å°æ•°ç‚¹åè·Ÿä¸Š0,å¯ä»¥è¯´æ˜¯ååˆ†å®Œç¾çš„ä¸€ç§æ–¹æ³•äº†.åè®°å¯¹äºstringå­—ç¬¦ä¸²æ‹¼æ¥,é™¤äº†ä¸Šé¢è®²çš„ä¸€äº›æ–¹æ³•è¿˜æœ‰å¾ˆå¤šæ–¹æ³•,ä¾‹å¦‚åˆ©ç”¨stringç±»ä¸­substr()å‡½æ•°è¿˜å¯ä»¥å®ç°å°†å­—ç¬¦ä¸²çš„æŸä¸€ç‰‡æ®µä¸å…¶ä»–å­—ç¬¦ä¸²æˆ–åŸºæœ¬ç±»å‹æ•°æ®æ‹¼æ¥,æ€»ä¹‹,æŒ‰ä¸åŒçš„éœ€æ±‚æ¥æ‹¼æ¥,æ€è·¯ä¸åŒ,æ–¹æ³•æ›´æ˜¯æœ‰å¾ˆå¤šç§.","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Cpp","slug":"Cpp","permalink":"https://lolico.me/tags/Cpp/"}]},{"title":"Cè¯­è¨€ç»“æ„ä½“å®šä¹‰çš„å‡ ç§æ–¹æ³•","slug":"Cè¯­è¨€ç»“æ„ä½“å®šä¹‰çš„å‡ ç§æ–¹æ³•","date":"2018-07-01T07:26:14.000Z","updated":"2022-03-06T10:28:21.343Z","comments":true,"path":"2018/07/01/Cè¯­è¨€ç»“æ„ä½“å®šä¹‰çš„å‡ ç§æ–¹æ³•/","link":"","permalink":"https://lolico.me/2018/07/01/C%E8%AF%AD%E8%A8%80%E7%BB%93%E6%9E%84%E4%BD%93%E5%AE%9A%E4%B9%89%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95/","excerpt":"","text":"ä»€ä¹ˆæ˜¯ç»“æ„ä½“ï¼Ÿåœ¨Cè¯­è¨€ä¸­ï¼Œç»“æ„ä½“(struct)æŒ‡çš„æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œæ˜¯Cè¯­è¨€ä¸­èšåˆæ•°æ®ç±»å‹(aggregate data type)çš„ä¸€ç±»ã€‚ç»“æ„ä½“å¯ä»¥è¢«å£°æ˜ä¸ºå˜é‡ã€æŒ‡é’ˆæˆ–æ•°ç»„ç­‰ï¼Œç”¨ä»¥å®ç°è¾ƒå¤æ‚çš„æ•°æ®ç»“æ„ã€‚ç»“æ„ä½“åŒæ—¶ä¹Ÿæ˜¯ä¸€äº›å…ƒç´ çš„é›†åˆï¼Œè¿™äº›å…ƒç´ ç§°ä¸ºç»“æ„ä½“çš„æˆå‘˜(member)ï¼Œä¸”è¿™äº›æˆå‘˜å¯ä»¥ä¸ºä¸åŒçš„ç±»å‹ï¼Œæˆå‘˜ä¸€èˆ¬ç”¨åå­—è®¿é—®ã€‚ç»“æ„ä½“çš„å®šä¹‰Cè¯­è¨€ç»“æ„ä½“ç±»å‹çš„å®šä¹‰æ¨¡æ¿å¤§æ¦‚ä¸ºï¼š123struct ç±»å‹å&#123; æˆå‘˜è¡¨åˆ—&#125; å˜é‡;åœ¨æˆå‘˜è¡¨åˆ—ä¸­å¯ä»¥æ˜¯å‡ ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»“æ„ä½“ç±»å‹ã€‚struct ç±»å‹å{} å˜é‡;åçš„åˆ†å·ä¸èƒ½æ¼ä¸‹é¢ç»™å‡ºå®šä¹‰ç»“æ„ä½“ç±»å‹çš„å‡ ç§æ–¹æ³•å…ˆå®šä¹‰ç»“æ„ä½“ç±»å‹ï¼Œå†å®šä¹‰ç»“æ„ä½“å˜é‡12345678struct student&#123; char no[20]; //å­¦å· char name[20]; //å§“å char sex[5]; //æ€§åˆ« int age; //å¹´é¾„&#125;; struct student stu1,stu2;//æ­¤æ—¶stu1,stu2ä¸ºstudentç»“æ„ä½“å˜é‡å®šä¹‰ç»“æ„ä½“ç±»å‹çš„åŒæ—¶å®šä¹‰ç»“æ„ä½“å˜é‡123456struct student&#123; char no[20]; //å­¦å· char name[20]; //å§“å char sex[5]; //æ€§åˆ« int age; //å¹´é¾„&#125; stu1,stu2;æ­¤æ—¶è¿˜å¯ä»¥ç»§ç»­å®šä¹‰studentç»“æ„ä½“å˜é‡å¦‚ï¼šstruct student stu3;ç›´æ¥å®šä¹‰ç»“æ„ä½“å˜é‡123456struct&#123; char no[20]; //å­¦å· char name[20]; //å§“å char sex[5]; //æ€§åˆ« int age; //å¹´é¾„&#125; stu1,stu2;ä¸€èˆ¬ä¸ä¼šä½¿ç”¨ç¬¬ä¸‰ç§å®šä¹‰æ–¹æ³•ï¼Œå› ä¸ºç›´æ¥å®šä¹‰ç»“æ„ä½“å˜é‡stu1,stu2åå°±ä¸èƒ½å†ç»§ç»­å®šä¹‰è¯¥ç±»å‹çš„å˜é‡ã€‚æ³¨æ„åœ¨Cè¯­è¨€ä¸­ä½¿ç”¨structå®šä¹‰ç»“æ„ä½“ç±»å‹åå®šä¹‰ç»“æ„ä½“å˜é‡æ—¶structä¸èƒ½çœç•¥ï¼Œåœ¨C++ä¸­å…è®¸çœç•¥structã€‚12345678910//åœ¨cä¸­:struct student&#123; ...&#125;;struct student stu1; //structä¸å¯çœç•¥//åœ¨c++ä¸­ï¼šstruct student&#123; ...&#125;;student stu1; //structå¯çœç•¥åœ¨Cä¸­å®šä¹‰ç»“æ„ä½“ç±»å‹åæ¯æ¬¡å®šä¹‰å˜é‡æ—¶éƒ½è¦ä½¿ç”¨structï¼Œå¦‚æœå«Œéº»çƒ¦ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ï¼š1234typedef struct student&#123; ...&#125;STUDENT;STUDENT stu1;ä½¿ç”¨typedefç»™struct studentå–ä¸€ä¸ªâ€åˆ«åâ€STUDENTåœ¨æŸäº›æƒ…å†µä¸‹è¿˜å¯ä»¥ä½¿ç”¨#defineæ¥å®ç°æ›´ç®€åŒ–çš„ç»“æ„ä½“å®šä¹‰ä¸å˜é‡çš„å®šä¹‰ï¼Œä½†å¯èƒ½ä¼šç‰ºç‰²éƒ¨åˆ†å¯è¯»æ€§ã€‚12345#define STUDENT struct studentSTUDENT&#123; ...&#125;;STUDENT stu1;typedefå’Œ#defineç”¨æ³•ä¸åŒï¼Œç”šè‡³å¯ä»¥ç»“åˆèµ·æ¥çµæ´»ä½¿ç”¨ï¼Œä½¿ç”¨æ—¶ä¸€å®šè¦æ³¨æ„ä¸¤è€…çš„ä¸åŒä¹‹å¤„ã€‚","categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"C","slug":"C","permalink":"https://lolico.me/tags/C/"}]},{"title":"åˆ©ç”¨äºšé©¬é€Šawsä¸€å¹´EC2å®ä¾‹æ­å»ºé…¸é…¸ä¹³ç§‘å­¦ä¸Šç½‘","slug":"åˆ©ç”¨äºšé©¬é€Šawsä¸€å¹´EC2å®ä¾‹æ­å»ºé…¸é…¸ä¹³ç§‘å­¦ä¸Šç½‘","date":"2018-07-01T07:21:36.000Z","updated":"2022-03-06T10:28:21.347Z","comments":true,"path":"2018/07/01/åˆ©ç”¨äºšé©¬é€Šawsä¸€å¹´EC2å®ä¾‹æ­å»ºé…¸é…¸ä¹³ç§‘å­¦ä¸Šç½‘/","link":"","permalink":"https://lolico.me/2018/07/01/%E5%88%A9%E7%94%A8%E4%BA%9A%E9%A9%AC%E9%80%8Aaws%E4%B8%80%E5%B9%B4EC2%E5%AE%9E%E4%BE%8B%E6%90%AD%E5%BB%BA%E9%85%B8%E9%85%B8%E4%B9%B3%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/","excerpt":"","text":"æ­å»ºå‰çš„ä¸»æœºå‡†å¤‡å·¥ä½œæ³¨å†Œawsè´¦å·é¦–å…ˆåœ¨awså®˜ç½‘ç½‘æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œå¹¶ç”¨ä¿¡ç”¨å¡è¿›è¡ŒéªŒè¯ã€‚æ³¨å†Œè´¦å·çš„æ–¹æ³•å°±ä¸è¯¦è¯´ï¼Œè‡³äºç”¨ä¿¡ç”¨å¡è¿›è¡Œè®¤è¯ï¼Œå¯ä»¥ä»æ·˜å®ä¸Šä¹°ä¸€ä¸ªvisaä¿¡ç”¨å¡è¿›è¡ŒéªŒè¯ï¼Œå®Œæˆè¿™äº›æ­¥éª¤åæˆ‘ä»¬å°±å¯ä»¥å…è´¹ä½¿ç”¨awsä¸€å¹´EC2å®ä¾‹ï¼Œæ­å»ºss/ssrè¿›è¡Œç§‘å­¦ä¸Šç½‘ã€‚åˆ›å»ºEC2å®ä¾‹å¹¶å¯åŠ¨æ­å»ºss/ssrä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¯åŠ¨ä¸€ä¸ªå®ä¾‹ã€‚é€‰æ‹©åˆ›å»ºå®ä¾‹çš„åœ°åŒºï¼Œæ³¨æ„ï¼šåœ¨æˆåŠŸéªŒè¯ä¿¡ç”¨å¡åawsä¼šå‘é€ä¸€å°é‚®ä»¶åˆ°æ³¨å†Œçš„é‚®ç®±ï¼Œåœ¨é‚®ä»¶ä¸­ä¼šå‘Šè¯‰æˆ‘ä»¬å¯ç”¨åœ°åŒºçš„EC2å®ä¾‹ï¼Œåšä¸»ä¹‹å‰ä¹Ÿæ˜¯æ²¡æ³¨æ„åˆ°è¿™å°é‚®ä»¶ï¼Œå¯¼è‡´åœ¨ä¸å…è®¸çš„åœ°åŒºåˆ›å»ºå®ä¾‹æ—¶ä¸èƒ½å¯åŠ¨ç‚¹å‡»æœåŠ¡é€‰æ‹©EC2awsåˆ›å»ºå®ä¾‹ç‚¹å‡»å¯åŠ¨å®ä¾‹awså¯åŠ¨å®ä¾‹é€‰æ‹©å®ä¾‹çš„æ“ä½œç³»ç»Ÿï¼Œè¿™é‡Œæˆ‘é€‰æ‹©çš„æ˜¯ç¬¬ä¸€ä¸ªLinuxç³»ç»Ÿé€‰æ‹©EC2ç³»ç»Ÿ2345æ­¥éƒ½å¯é»˜è®¤ï¼Œç‚¹å‡»ä¸‹ä¸€æ­¥ï¼Œè¿›å…¥é…ç½®å®‰å…¨ç»„ç•Œé¢é»˜è®¤ç‚¹å‡»ä¸‹ä¸€æ­¥åœ¨é…ç½®å®‰å…¨ç»„é¡µé¢æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªå…¥ç«™è§„åˆ™ï¼Œé€‰æ‹©æ‰€æœ‰æµé‡ï¼Œæ¥æºä¸­å¡«å†™0.0.0.0ï¼Œæœ€åç‚¹å‡»å®¡æ ¸å’Œå¯åŠ¨æ·»åŠ å…¥ç«™è§„åˆ™é€‰æ‹©ç™»å…¥å®ä¾‹çš„å¯†é’¥å¯¹ï¼Œæ²¡æœ‰çš„è¯ç‚¹å‡»åˆ›å»ºå¯†é’¥å¯¹ï¼Œå¹¶ä¸‹è½½è¿™ä¸ªå¯†é’¥å¯¹ï¼Œ(å¯†é’¥ååˆ†é‡è¦ï¼Œè¿™æ˜¯ç™»å…¥awså®ä¾‹çš„å”¯ä¸€é’¥åŒ™)åˆ›å»ºå¯†é’¥å¯¹â€”â€”åˆ°è¿™é‡Œï¼Œå®ä¾‹çš„åˆ›å»ºå°±å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¿æ¥æˆ‘ä»¬åˆšæ‰åˆ›å»ºçš„å®ä¾‹å¹¶æ­å»ºss/ssrä½¿ç”¨Xshellç™»å…¥å®ä¾‹åœ¨è¿™é‡Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨Xshell 5è¿æ¥å®ä¾‹ç‚¹å‡»æŸ¥çœ‹å®ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹è§æˆ‘ä»¬åˆšæ‰åˆ›å»ºçš„å®ä¾‹çš„ipï¼Œè®°ä¸‹è¿™ä¸ªipæ‰“å¼€Xshellå®ä¾‹ipç‚¹å‡»å·¥å…·ä¸­çš„ç”¨æˆ·å¯†é’¥ç®¡ç†è€…ï¼Œå¹¶å¯¼å…¥ä¸Šæ–‡è¯´çš„ååˆ†é‡è¦çš„é‚£ä¸ªå¯†é’¥å¯¼å…¥å¯†é’¥å¯¼å…¥å¯†é’¥åç‚¹å‡»Xshellå³ä¸Šè§’æ–‡ä»¶ä¸­çš„æ–°å»ºåœ¨ä¸»æœºé¡¹ä¸­å¡«å…¥åˆšæ‰è®°ä¸‹çš„ipå¡«å…¥ipå†ç‚¹å‡»å³è¾¹ç”¨æˆ·èº«ä»½éªŒè¯ï¼Œé€‰æ‹©å›¾ä¸­çš„æ–¹æ³•ï¼Œå¹¶é€‰æ‹©ç™»å…¥çš„å¯†é’¥ï¼Œåœ¨ç”¨æˆ·åé¡¹ä¸­å¡«å…¥ec2-userï¼Œå¹¶ç¡®è®¤(Linuxç³»ç»Ÿçš„å¡«ec2-userï¼ŒUbuntuç³»ç»Ÿå¡«Ubuntuï¼Œå¦åˆ™å¯èƒ½ä¼šè¿æ¥å¤±è´¥)é€‰æ‹©ç™»å…¥æ–¹æ³•å’Œå¯†é’¥è¿æ¥åˆšæ‰æ–°å»ºçš„ä¼šè¯ï¼Œç¬¬ä¸€æ¬¡è¿æ¥ä¼šæœ‰ä¸ªæç¤ºï¼Œé€‰æ‹©æ¥å—å¹¶ä¿å­˜ï¼Œå¦‚å›¾æ‰€ç¤ºåˆ™è¿æ¥æˆåŠŸè¿æ¥æˆåŠŸâ€”â€”åˆ°è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å°±æˆåŠŸè¿æ¥ä¸Šäº†å®ä¾‹ï¼Œç°åœ¨å°±å¯ä»¥å¼€å§‹æ­å»ºss/ssräº†æ­å»ºss/ssrè¾“å…¥sudo suè·å–rootæƒé™å®‰è£…è„šæœ¬ss1wget -N --no-check-certificate https://raw.githubusercontent.com/ToyoDAdoubi/doubi/master/ss-go.sh &amp;&amp; chmod +x ss-go.sh &amp;&amp; sudo bash ss-go.shssr1wget -N --no-check-certificate https://raw.githubusercontent.com/ToyoDAdoubi/doubi/master/ssr.sh &amp;&amp; chmod +x ssr.sh &amp;&amp; sudo bash ssr.shå®‰è£…å®Œæˆåæ˜¯è¿™æ ·çš„å®‰è£…å®Œæˆå®‰è£…å®Œæˆä¹‹åè¾“å…¥1å›è½¦ï¼Œè¿›è¡Œå®‰è£…é…ç½®ShadowsocksRâ‘ é€‰æ‹©ç«¯å£ï¼Œåšä¸»è¿™é‡Œè®¾ç½®çš„æ˜¯8080ï¼Œï¼ˆæ®è¯´é…åˆæ··æ·†å‚æ•°å¯ä»¥å®ç°å…æµï¼Œä½†ç°åœ¨å¥½åƒæ˜¯ä¸å¯ä»¥äº†ï¼‰é€‰æ‹©ç«¯å£â‘¡è®¾ç½®å¯†ç â‘¢è®¾ç½®åŠ å¯†æ–¹æ³•â‘£è®¾ç½®åè®®ï¼Œé€‰æ‹©æ’ä»¶å…¼å®¹åŸç‰ˆå¡«å…¥yè¿›è¡Œé…ç½®â‘¤è®¾ç½®æ··æ·†æ’ä»¶ï¼ŒåŒæ ·å¡«å…¥yé€‰æ‹©å…¼å®¹åŸç‰ˆï¼ˆâ‘¢â‘£â‘¤åšä¸»éƒ½æ˜¯ç›´æ¥é»˜è®¤å›è½¦ï¼‰â‘¥â‘¦â‘§é…ç½®ç«¯å£å’Œé€Ÿåº¦ç›´æ¥é»˜è®¤å›è½¦ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æŒ‰è‡ªå·±çš„æƒ³æ³•æ¥è®¾ç½®ä¹‹åå¡«å…¥yå¼€å§‹å®‰è£…ï¼Œå®‰è£…è¿‡ç¨‹ç¨æ…¢ï¼Œéœ€è¦ç­‰ä¸€ç­‰è¿›è¡Œå®‰è£…å®‰è£…æˆåŠŸï¼å®‰è£…æˆåŠŸå®‰è£…æˆåŠŸåå°±å¯ä»¥å¤åˆ¶é…ç½®ä¿¡æ¯ä¸­çš„ss/ssré“¾æ¥æˆ–äºŒç»´ç è¿›è¡Œè¿æ¥å¼€å§‹æˆ‘ä»¬çš„FQä¹‹æ—…è¡¥å……ï¼šBBRåŠ é€ŸSS/SSRssr.shè„šæœ¬å†…ç½®bbråŠ é€Ÿå››åˆä¸€è„šæœ¬1wget -N --no-check-certificate https://raw.githubusercontent.com/chiakge/Linux-NetSpeed/master/tcp.sh &amp;&amp; chmod +x tcp.sh &amp;&amp; sudo bash tcp.sh","categories":[{"name":"ä¸æ­£å¸¸çš„æ–‡ç« ","slug":"ä¸æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E4%B8%8D%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"ï¼Ÿï¼Ÿï¼Ÿ","slug":"ï¼Ÿï¼Ÿï¼Ÿ","permalink":"https://lolico.me/tags/%EF%BC%9F%EF%BC%9F%EF%BC%9F/"}]}],"categories":[{"name":"æ­£å¸¸çš„æ–‡ç« ","slug":"æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"},{"name":"ä¸æ­£å¸¸çš„æ–‡ç« ","slug":"ä¸æ­£å¸¸çš„æ–‡ç« ","permalink":"https://lolico.me/categories/%E4%B8%8D%E6%AD%A3%E5%B8%B8%E7%9A%84%E6%96%87%E7%AB%A0/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"https://lolico.me/tags/Spring/"},{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://lolico.me/tags/SpringBoot/"},{"name":"Redis","slug":"Redis","permalink":"https://lolico.me/tags/Redis/"},{"name":"MQ","slug":"MQ","permalink":"https://lolico.me/tags/MQ/"},{"name":"WPF","slug":"WPF","permalink":"https://lolico.me/tags/WPF/"},{"name":"NLog","slug":"NLog","permalink":"https://lolico.me/tags/NLog/"},{"name":".Net Core 3","slug":"Net-Core-3","permalink":"https://lolico.me/tags/Net-Core-3/"},{"name":"Asp.Net Core","slug":"Asp-Net-Core","permalink":"https://lolico.me/tags/Asp-Net-Core/"},{"name":"Nginx","slug":"Nginx","permalink":"https://lolico.me/tags/Nginx/"},{"name":"WSL","slug":"WSL","permalink":"https://lolico.me/tags/WSL/"},{"name":"IDEA","slug":"IDEA","permalink":"https://lolico.me/tags/IDEA/"},{"name":"WebStorm","slug":"WebStorm","permalink":"https://lolico.me/tags/WebStorm/"},{"name":"PyCharm","slug":"PyCharm","permalink":"https://lolico.me/tags/PyCharm/"},{"name":"AOP","slug":"AOP","permalink":"https://lolico.me/tags/AOP/"},{"name":"Web","slug":"Web","permalink":"https://lolico.me/tags/Web/"},{"name":"Security","slug":"Security","permalink":"https://lolico.me/tags/Security/"},{"name":"CORS","slug":"CORS","permalink":"https://lolico.me/tags/CORS/"},{"name":"Vue.js","slug":"Vue-js","permalink":"https://lolico.me/tags/Vue-js/"},{"name":"ï¼Ÿï¼Ÿï¼Ÿ","slug":"ï¼Ÿï¼Ÿï¼Ÿ","permalink":"https://lolico.me/tags/%EF%BC%9F%EF%BC%9F%EF%BC%9F/"},{"name":"git","slug":"git","permalink":"https://lolico.me/tags/git/"},{"name":"Python","slug":"Python","permalink":"https://lolico.me/tags/Python/"},{"name":"pip","slug":"pip","permalink":"https://lolico.me/tags/pip/"},{"name":"dlib","slug":"dlib","permalink":"https://lolico.me/tags/dlib/"},{"name":"JetBrains Quest","slug":"JetBrains-Quest","permalink":"https://lolico.me/tags/JetBrains-Quest/"},{"name":"Java","slug":"Java","permalink":"https://lolico.me/tags/Java/"},{"name":"Shiro","slug":"Shiro","permalink":"https://lolico.me/tags/Shiro/"},{"name":"Password","slug":"Password","permalink":"https://lolico.me/tags/Password/"},{"name":"Salt","slug":"Salt","permalink":"https://lolico.me/tags/Salt/"},{"name":"JPA","slug":"JPA","permalink":"https://lolico.me/tags/JPA/"},{"name":"Hibernate","slug":"Hibernate","permalink":"https://lolico.me/tags/Hibernate/"},{"name":"JSP","slug":"JSP","permalink":"https://lolico.me/tags/JSP/"},{"name":"Cpp","slug":"Cpp","permalink":"https://lolico.me/tags/Cpp/"},{"name":"C","slug":"C","permalink":"https://lolico.me/tags/C/"}]}